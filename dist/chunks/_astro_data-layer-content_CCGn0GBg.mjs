const _astro_dataLayerContent = [["Map",1,2,9,10],"meta::meta",["Map",3,4,5,6,7,8],"astro-version","5.17.1","content-config-digest","eef1f8c4076f6736","astro-config-digest","{\"root\":{},\"srcDir\":{},\"publicDir\":{},\"outDir\":{},\"cacheDir\":{},\"site\":\"https://chenguangliang.com/\",\"compressHTML\":true,\"base\":\"/\",\"trailingSlash\":\"ignore\",\"output\":\"static\",\"scopedStyleStrategy\":\"attribute\",\"build\":{\"format\":\"directory\",\"client\":{},\"server\":{},\"assets\":\"_astro\",\"serverEntry\":\"entry.mjs\",\"redirects\":true,\"inlineStylesheets\":\"auto\",\"concurrency\":1},\"server\":{\"open\":false,\"host\":false,\"port\":4321,\"streaming\":true,\"allowedHosts\":[]},\"redirects\":{},\"image\":{\"endpoint\":{\"route\":\"/_image\"},\"service\":{\"entrypoint\":\"astro/assets/services/sharp\",\"config\":{}},\"domains\":[],\"remotePatterns\":[],\"layout\":\"constrained\",\"responsiveStyles\":true},\"devToolbar\":{\"enabled\":true},\"markdown\":{\"syntaxHighlight\":{\"type\":\"shiki\",\"excludeLangs\":[\"math\"]},\"shikiConfig\":{\"langs\":[],\"langAlias\":{},\"theme\":\"github-dark\",\"themes\":{\"light\":\"min-light\",\"dark\":\"night-owl\"},\"defaultColor\":false,\"wrap\":false,\"transformers\":[{},{\"name\":\"@shikijs/transformers:notation-highlight\"},{\"name\":\"@shikijs/transformers:notation-highlight-word\"},{\"name\":\"@shikijs/transformers:notation-diff\"}]},\"remarkPlugins\":[null,[null,{\"test\":\"Table of contents\"}]],\"rehypePlugins\":[],\"remarkRehype\":{},\"gfm\":true,\"smartypants\":true},\"security\":{\"checkOrigin\":true,\"allowedDomains\":[]},\"env\":{\"schema\":{\"PUBLIC_GOOGLE_SITE_VERIFICATION\":{\"access\":\"public\",\"context\":\"client\",\"optional\":true,\"type\":\"string\"}},\"validateSecrets\":false},\"experimental\":{\"clientPrerender\":false,\"contentIntellisense\":false,\"headingIdCompat\":false,\"preserveScriptOrder\":true,\"fonts\":[{\"name\":\"Google Sans Code\",\"cssVariable\":\"--font-google-sans-code\",\"fallbacks\":[\"monospace\"],\"provider\":{\"name\":\"google\"},\"weights\":[300,400,500,600,700],\"styles\":[\"normal\",\"italic\"]}],\"liveContentCollections\":false,\"csp\":false,\"staticImportMetaEnv\":false,\"chromeDevtoolsWorkspace\":false,\"failOnPrerenderConflict\":false,\"svgo\":false},\"legacy\":{\"collections\":false}}","blog",["Map",11,12,48,49,69,70,89,90,116,117,140,141,160,161,274,275,323,324,353,354,377,378,408,409,428,429,466,467,486,487,519,520,540,541,570,571,590,591,621,622,646,647,674,675,694,695,714,715,744,745,776,777,796,797,816,817,836,837,863,864,898,899,918,919,938,939,973,974,993,994,1013,1014,1035,1036,1055,1056,1075,1076,1105,1106,1135,1136,1155,1156,1184,1185,1249,1250,1294,1295,1315,1316,1335,1336,1424,1425,1444,1445,1477,1478,1504,1505,1525,1526,1551,1552,1571,1572,1591,1592,1611,1612,1634,1635,1660,1661,1680,1681,1700,1701,1737,1738,1757,1758,1777,1778,1851,1852,1951,1952,2013,2014],"frontend-concepts",{id:11,data:13,body:23,filePath:24,digest:25,rendered:26},{author:14,pubDatetime:15,title:16,featured:17,draft:17,tags:18,description:22},"陈广亮",["Date","2019-06-01T02:00:00.000Z"],"前端概念汇总",false,[19,20,21],"前端","JavaScript","CSS","常见前端概念速查：HTTP/HTTPS、JS 技巧、浏览器机制、CSS 技巧等。","## 恶魔 Zalgo\n\n既可能同步也可能异步调用你的回调函数。\n\n## 鸭子模型\n\n如果它看起来像只鸭子，叫起来像鸭子，那它一定就是只鸭子。\n\n## HTTP vs HTTPS\n\n- HTTP：明文传输，运行在 TCP 之上\n- HTTPS：SSL/TLS 加密，添加了加密和认证机制\n- HTTP/2：多路复用，一个 TCP 连接传输所有请求\n\n## 实用 CSS 技巧\n\n1. `attr()` 抓取 `data-*` 属性\n2. `position: sticky` 粘性定位\n3. `text-align-last` 对齐两端文本\n4. `writing-mode` 排版竖文\n5. `object-fit` 规定图像尺寸\n6. `transform` 描绘 1px 边框\n7. `filter: grayscale(1)` 开启悼念模式\n8. `:valid` 和 `:invalid` 校验表单\n9. `:focus-within` 分发冒泡响应","src/data/blog/frontend-concepts.md","598a3e57b843daaf",{html:27,metadata:28},"<h2 id=\"恶魔-zalgo\">恶魔 Zalgo</h2>\n<p>既可能同步也可能异步调用你的回调函数。</p>\n<h2 id=\"鸭子模型\">鸭子模型</h2>\n<p>如果它看起来像只鸭子，叫起来像鸭子，那它一定就是只鸭子。</p>\n<h2 id=\"http-vs-https\">HTTP vs HTTPS</h2>\n<ul>\n<li>HTTP：明文传输，运行在 TCP 之上</li>\n<li>HTTPS：SSL/TLS 加密，添加了加密和认证机制</li>\n<li>HTTP/2：多路复用，一个 TCP 连接传输所有请求</li>\n</ul>\n<h2 id=\"实用-css-技巧\">实用 CSS 技巧</h2>\n<ol>\n<li><code>attr()</code> 抓取 <code>data-*</code> 属性</li>\n<li><code>position: sticky</code> 粘性定位</li>\n<li><code>text-align-last</code> 对齐两端文本</li>\n<li><code>writing-mode</code> 排版竖文</li>\n<li><code>object-fit</code> 规定图像尺寸</li>\n<li><code>transform</code> 描绘 1px 边框</li>\n<li><code>filter: grayscale(1)</code> 开启悼念模式</li>\n<li><code>:valid</code> 和 <code>:invalid</code> 校验表单</li>\n<li><code>:focus-within</code> 分发冒泡响应</li>\n</ol>",{headings:29,localImagePaths:42,remoteImagePaths:43,frontmatter:44,imagePaths:47},[30,34,36,39],{depth:31,slug:32,text:33},2,"恶魔-zalgo","恶魔 Zalgo",{depth:31,slug:35,text:35},"鸭子模型",{depth:31,slug:37,text:38},"http-vs-https","HTTP vs HTTPS",{depth:31,slug:40,text:41},"实用-css-技巧","实用 CSS 技巧",[],[],{author:14,pubDatetime:45,title:16,slug:11,featured:17,draft:17,tags:46,description:22},["Date","2019-06-01T02:00:00.000Z"],[19,20,21],[],"array-foreach-polyfill",{id:48,data:50,body:56,filePath:57,digest:58,rendered:59},{author:14,pubDatetime:51,title:52,featured:17,draft:17,tags:53,description:55},["Date","2016-06-01T02:00:00.000Z"],"Array forEach 在 IE 低版本的兼容",[20,54],"兼容性","forEach polyfill 实现与 jQuery each 方法对比。","IE8 及以前没有 `forEach`，核心 polyfill：\n\n```js\nif (!Array.prototype.forEach) {\n  Array.prototype.forEach = function (callback, thisArg) {\n    var O = Object(this);\n    var len = O.length >>> 0;\n    var k = 0;\n    while (k < len) {\n      if (k in O) {\n        callback.call(thisArg, O[k], k, O);\n      }\n      k++;\n    }\n  };\n}\n```\n\n**注意**：jQuery 的 `each` 方法回调参数顺序与 `forEach` 相反——先 `index` 后 `elem`。","src/data/blog/array-foreach-polyfill.md","0e075818517b9b90",{html:60,metadata:61},"<p>IE8 及以前没有 <code>forEach</code>，核心 polyfill：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">!</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\">Array</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#7FDBCA\">prototype</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">forEach</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\">  Array</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#7FDBCA\">prototype</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">forEach</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> function</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">callback</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> thisArg</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    var</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> O</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> Object</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#41EEC6;--shiki-dark-font-style:italic\">this</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> len</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> O</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">length</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> >>></span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 0</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> k</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 0</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    while</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">k</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> &#x3C;</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> len</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">      if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">k</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> in</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\"> O</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">        callback</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">call</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">thisArg</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\"> O</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">k</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> k</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\"> O</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">      k</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">++</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  };</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span></code></pre>\n<p><strong>注意</strong>：jQuery 的 <code>each</code> 方法回调参数顺序与 <code>forEach</code> 相反——先 <code>index</code> 后 <code>elem</code>。</p>",{headings:62,localImagePaths:63,remoteImagePaths:64,frontmatter:65,imagePaths:68},[],[],[],{author:14,pubDatetime:66,title:52,slug:48,featured:17,draft:17,tags:67,description:55},["Date","2016-06-01T02:00:00.000Z"],[20,54],[],"checkbox-indeterminate",{id:69,data:71,body:76,filePath:77,digest:78,rendered:79},{author:14,pubDatetime:72,title:73,featured:17,draft:17,tags:74,description:75},["Date","2016-01-10T02:00:00.000Z"],"Checkbox 模糊状态（indeterminate）",[20,21],"checkbox 的 indeterminate 属性实现半选状态。","Checkbox 有一个模糊状态（上面显示一条横线），通过 `indeterminate` 属性实现：\n\n```js\ninput.indeterminate = true;\n\n// jQuery\ninput.prop(\"indeterminate\", true);\n```\n\n`indeterminate` 属性只能使用 JS 来设置，不能通过 HTML 属性设置。","src/data/blog/checkbox-indeterminate.md","6e4d4aa4be6bd2f0",{html:80,metadata:81},"<p>Checkbox 有一个模糊状态（上面显示一条横线），通过 <code>indeterminate</code> 属性实现：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">input</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">indeterminate</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\"> true</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// jQuery</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">input</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">prop</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">indeterminate</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\"> true</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span></code></pre>\n<p><code>indeterminate</code> 属性只能使用 JS 来设置，不能通过 HTML 属性设置。</p>",{headings:82,localImagePaths:83,remoteImagePaths:84,frontmatter:85,imagePaths:88},[],[],[],{author:14,pubDatetime:86,title:73,slug:69,featured:17,draft:17,tags:87,description:75},["Date","2016-01-10T02:00:00.000Z"],[20,21],[],"es6-generator-and-co",{id:89,data:91,body:97,filePath:98,digest:99,rendered:100},{author:14,pubDatetime:92,title:93,featured:17,draft:17,tags:94,description:96},["Date","2016-03-15T02:00:00.000Z"],"ES6 Generator 与 co 模块",[20,95],"ES6","理解 ES6 Generator 的基本特性以及 tj 大神的 co 模块原理。","## Generator 特性\n\n举个例子：\n\n```js\nfunction* foo() {\n  yield 4;\n  var res = yield 2;\n  console.log(\"res:\", res);\n  return 5;\n}\n\nvar g = foo();\ng.next(1); // { value: 4, done: false }\ng.next(2); // { value: 2, done: false }\ng.next(3); // res:3 { value: 5, done: true }\n```\n\n几点注意：\n\n1. 调用 `foo()` 时，函数体中的逻辑并不会执行，直到调用 `g.next()` 时才会执行\n2. 调用 `g.next()` 时返回 `{ value: *, done: * }`\n3. 当 `done` 为 `false` 时，表示函数逻辑还未执行完\n4. 最后一次返回 `return` 语句的结果，`done` 为 `true`\n5. `var res = yield 2` 这句只执行了后面半段就暂停了，等到再次调用 `g.next(3)` 时才会将参数赋给 `res`\n\n## co 模块原理\n\ntj 大神的 co 模块就是建立在这些特性上的，核心思想是：\n\n1. Generator 函数中 yield 一个异步操作\n2. 异步操作完成后，将结果通过 `next()` 传回 Generator\n3. 递归执行直到 Generator 完成\n\n这种模式让异步代码看起来像同步代码，后来 ES7 的 `async/await` 正是基于这个思想的语法糖。","src/data/blog/es6-generator-and-co.md","12bdf5a16e086a66",{html:101,metadata:102},"<h2 id=\"generator-特性\">Generator 特性</h2>\n<p>举个例子：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function*</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> foo</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">()</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  yield</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 4</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> res</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> yield</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 2</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">  console</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">log</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">res:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> res</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  return</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 5</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> g</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> foo</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">g</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">next</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// { value: 4, done: false }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">g</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">next</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">2</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// { value: 2, done: false }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">g</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">next</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">3</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// res:3 { value: 5, done: true }</span></span></code></pre>\n<p>几点注意：</p>\n<ol>\n<li>调用 <code>foo()</code> 时，函数体中的逻辑并不会执行，直到调用 <code>g.next()</code> 时才会执行</li>\n<li>调用 <code>g.next()</code> 时返回 <code>{ value: *, done: * }</code></li>\n<li>当 <code>done</code> 为 <code>false</code> 时，表示函数逻辑还未执行完</li>\n<li>最后一次返回 <code>return</code> 语句的结果，<code>done</code> 为 <code>true</code></li>\n<li><code>var res = yield 2</code> 这句只执行了后面半段就暂停了，等到再次调用 <code>g.next(3)</code> 时才会将参数赋给 <code>res</code></li>\n</ol>\n<h2 id=\"co-模块原理\">co 模块原理</h2>\n<p>tj 大神的 co 模块就是建立在这些特性上的，核心思想是：</p>\n<ol>\n<li>Generator 函数中 yield 一个异步操作</li>\n<li>异步操作完成后，将结果通过 <code>next()</code> 传回 Generator</li>\n<li>递归执行直到 Generator 完成</li>\n</ol>\n<p>这种模式让异步代码看起来像同步代码，后来 ES7 的 <code>async/await</code> 正是基于这个思想的语法糖。</p>",{headings:103,localImagePaths:110,remoteImagePaths:111,frontmatter:112,imagePaths:115},[104,107],{depth:31,slug:105,text:106},"generator-特性","Generator 特性",{depth:31,slug:108,text:109},"co-模块原理","co 模块原理",[],[],{author:14,pubDatetime:113,title:93,slug:89,featured:17,draft:17,tags:114,description:96},["Date","2016-03-15T02:00:00.000Z"],[20,95],[],"aws-setup",{id:116,data:118,body:125,filePath:126,digest:127,rendered:128},{author:14,pubDatetime:119,title:120,featured:17,draft:17,tags:121,description:124},["Date","2019-07-01T02:00:00.000Z"],"AWS 服务器搭建笔记",[122,123],"Linux","运维","AWS EC2 实例创建、SSH 配置与基础环境搭建。","## 步骤\n\n1. 注册 AWS，创建 Ubuntu 18 实例\n2. 连接：`ssh -i \"xx.pem\" ubuntu@ec2-xxx.compute.amazonaws.com`\n3. 修改 SSH 配置，启用密码登录并更改端口\n4. 安装必要软件\n\n```bash\nsudo vim /etc/ssh/sshd_config\n# Port 22 → Port 1234\n# PasswordAuthentication no → yes\npasswd ubuntu\nservice ssh restart\n```","src/data/blog/aws-shadowsocks.md","8d36f34b7cfd2154",{html:129,metadata:130},"<h2 id=\"步骤\">步骤</h2>\n<ol>\n<li>注册 AWS，创建 Ubuntu 18 实例</li>\n<li>连接：<code>ssh -i \"xx.pem\" ubuntu@ec2-xxx.compute.amazonaws.com</code></li>\n<li>修改 SSH 配置，启用密码登录并更改端口</li>\n<li>安装必要软件</li>\n</ol>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">sudo</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> vim</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> /etc/ssh/sshd_config</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># Port 22 → Port 1234</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># PasswordAuthentication no → yes</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">passwd</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> ubuntu</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">service</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> ssh</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> restart</span></span></code></pre>",{headings:131,localImagePaths:134,remoteImagePaths:135,frontmatter:136,imagePaths:139},[132],{depth:31,slug:133,text:133},"步骤",[],[],{author:14,pubDatetime:137,title:120,slug:116,featured:17,draft:17,tags:138,description:124},["Date","2019-07-01T02:00:00.000Z"],[122,123],[],"es7-rest-spread",{id:140,data:142,body:147,filePath:148,digest:149,rendered:150},{author:14,pubDatetime:143,title:144,featured:17,draft:17,tags:145,description:146},["Date","2017-01-15T02:00:00.000Z"],"ES7 Rest/Spread 运算符在对象中的应用",[20,95],"对象的 Rest 解构赋值和扩展运算符的妙用。","ES7 提案将 Rest/Spread 运算符引入对象：\n\n```js\nlet { x, y, ...z } = { x: 1, y: 2, a: 3, b: 4 };\n// x: 1, y: 2, z: { a: 3, b: 4 }\n```\n\n在 Redux 中常见的用法：\n\n```js\nlet state = { a: 1, b: 1 };\nconsole.log({ ...state, b: 2 }); // {a: 1, b: 2}\n// 等价于\nObject.assign({}, state, { b: 2 });\n```\n\n原理很简单：`{ ...state, b: 2 }` → `{ a: 1, b: 1, b: 2 }` → `{ a: 1, b: 2 }`","src/data/blog/es7-rest-spread.md","9afa1b148e2987e5",{html:151,metadata:152},"<p>ES7 提案将 Rest/Spread 运算符引入对象：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> x</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> y</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> ...</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">z</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> }</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> x</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> y</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 2</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> a</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 3</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> b</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 4</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> }</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// x: 1, y: 2, z: { a: 3, b: 4 }</span></span></code></pre>\n<p>在 Redux 中常见的用法：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> state</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> a</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> b</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> }</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">console</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">log</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">({ </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">...</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">state</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> b</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 2</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> }); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// {a: 1, b: 2}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 等价于</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">Object</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">assign</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">({}</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> state</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { b</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 2</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> });</span></span></code></pre>\n<p>原理很简单：<code>{ ...state, b: 2 }</code> → <code>{ a: 1, b: 1, b: 2 }</code> → <code>{ a: 1, b: 2 }</code></p>",{headings:153,localImagePaths:154,remoteImagePaths:155,frontmatter:156,imagePaths:159},[],[],[],{author:14,pubDatetime:157,title:144,slug:140,featured:17,draft:17,tags:158,description:146},["Date","2017-01-15T02:00:00.000Z"],[20,95],[],"ai-agent-tools-landscape-2026",{id:160,data:162,body:171,filePath:172,digest:173,rendered:174},{author:14,pubDatetime:163,title:164,featured:165,draft:17,tags:166,description:170},["Date","2026-02-12T04:00:00.000Z"],"AI Agent 开发者工具全景 2026",true,[167,168,169],"AI","Agent","工具","2026年初，GitHub Trending 上 AI Agent 项目集中爆发。本文梳理当前 Agent 开发者工具生态全景，从框架、Coding Agent 到基础设施协议，分析这波浪潮的走向。","## 引子：当 GitHub Trending 被 Agent 占领\n\n打开这周的 GitHub Trending，你会发现一个有趣的现象：排行榜上几乎一半的项目都和 AI Agent 有关。\n\nShannon —— 一个全自动的 AI 黑客，在 XBOW 基准测试上跑出了 96.15% 的漏洞发现成功率。GitHub 官方的 `gh-aw`（Agentic Workflows）悄然上线。字节跳动的 UI-TARS 把多模态 Agent 搬上了桌面。微软的 RD-Agent 要让 AI 驱动研发全流程。还有一堆围绕 Claude Code 生态的项目 —— `claude-mem`、`claude-code-hooks-mastery`、`claude-skills` —— 正在把 Coding Agent 从\"能用\"推向\"好用\"。\n\n这不是偶然。2025 年大家忙着验证 Agent 到底能不能用，2026 年一开年，焦点已经转到基础设施建设上了。\n\n这篇文章梳理一下当前 Agent 开发者工具的全貌，帮你理清这个变化很快的生态。\n\n## 一、Agent 框架：从百花齐放到各据山头\n\nAgent 框架是最早成熟的一层。两年下来，格局基本定了。\n\n### LangChain / LangGraph\n\nLangChain 仍然是生态最完整的框架。但真正值得关注的是 LangGraph —— 它用图（Graph）结构来编排 Agent 的执行流程，比起早期 LangChain 的链式调用，表达能力强了几个数量级。\n\n```python\nfrom langgraph.graph import StateGraph\n\n# 定义 Agent 状态机\ngraph = StateGraph(AgentState)\ngraph.add_node(\"research\", research_agent)\ngraph.add_node(\"write\", writing_agent)\ngraph.add_node(\"review\", review_agent)\ngraph.add_edge(\"research\", \"write\")\ngraph.add_edge(\"write\", \"review\")\ngraph.add_conditional_edges(\"review\", quality_check, {\n    \"pass\": END,\n    \"revise\": \"write\"\n})\n```\n\n适合场景：需要精细控制 Agent 执行流程的复杂应用。\n\n### CrewAI\n\n如果 LangGraph 是\"编程式\"的 Agent 编排，CrewAI 就是\"声明式\"的。你定义角色（Agent）、任务（Task）和流程（Process），框架帮你处理协作细节。2026 年初 CrewAI 已经发展到 v1.x 稳定版，加入了内存管理和工具复用机制。\n\n适合场景：多 Agent 角色扮演协作，比如\"研究员 + 写手 + 审稿人\"的内容生产流水线。\n\n### AutoGen (Microsoft)\n\n微软的 AutoGen 走的是另一条路 —— 对话驱动的多 Agent 协作。Agent 之间通过消息传递来协调，更接近人类团队的协作方式。AutoGen Studio 提供了可视化界面，降低了上手门槛。\n\n适合场景：需要 Agent 之间进行复杂对话和协商的场景。\n\n### Dify / Coze\n\nDify 和 Coze（字节跳动）走低代码/无代码路线。可视化工作流编辑器，不写代码也能搭 Agent 应用。Dify 开源，Coze 商业化，2026 年两者都加了 MCP 协议支持。\n\n适合场景：快速原型、业务人员自建 Agent 应用。\n\n### 框架层的判断\n\n框架之争基本结束了。开发者选 LangGraph 或 CrewAI 深入就行。产品经理或业务人员，Dify / Coze 更实际。框架本身不再是壁垒，关键看你用框架做了什么。\n\n## 二、Coding Agent：开发者的第二大脑\n\nCoding Agent 大概是 Agent 领域里最先落地的品类。2026 年初，这个赛道已经卷得不行。\n\n### Claude Code\n\nAnthropic 的 Claude Code 是目前终端 Coding Agent 里最好用的。它直接跑在终端里，理解整个代码库，能执行命令、操作 Git、重构代码。\n\n```bash\n# 安装\ncurl -fsSL https://claude.ai/install.sh | bash\n\n# 在项目目录直接使用\ncd my-project\nclaude\n> 把这个 REST API 改成 GraphQL，保持所有测试通过\n```\n\nClaude Code 真正有意思的地方是它开始有自己的插件生态了。本周 Trending 上就有三个相关项目：\n\n- **claude-mem**（[@thedotmack](https://github.com/thedotmack/claude-mem)）：自动记录 Claude Code 的每次会话，用 AI 压缩后在未来会话中注入相关上下文。解决了 Agent \"金鱼记忆\"的问题。\n- **claude-code-hooks-mastery**（[@disler](https://github.com/disler/claude-code-hooks-mastery)）：系统教你掌握 Claude Code 的 Hooks 机制，本周涨了 642 星。Hooks 让你能在 Claude Code 的执行流程中插入自定义逻辑。\n- **claude-skills**（[@Jeffallan](https://github.com/Jeffallan/claude-skills)）：66 个专业技能包，把 Claude Code 变成全栈开发的专家搭档。\n\n这些社区项目集中冒出来，说明 Claude Code 正在从工具变成平台。\n\n### Cursor / Windsurf\n\nCursor 和 Windsurf 走的是 IDE 路线。Cursor 基于 VS Code，把 AI 深度集成进编辑体验。Windsurf（Codeium 出品）则强调\"Flow\"模式 —— AI 和你交替编辑，像双人编程一样流畅。\n\n两者共同点：以文件为中心，以编辑器为主场。适合习惯 IDE 工作流的开发者。\n\n### OpenAI Codex CLI / GitHub Copilot Agent\n\nOpenAI 的 Codex CLI 走的是和 Claude Code 类似的终端路线，但更强调与 GitHub 生态的整合。本周 Trending 上出现的 `openai/skills`（Skills Catalog for Codex）就是 OpenAI 在构建 Codex 技能生态的证据。\n\nGitHub Copilot 则在往 Agent 方向进化。`github/gh-aw`（Agentic Workflows）的出现意味着 Copilot 不再只是自动补全，而是能执行跨文件、跨仓库的复杂工作流。\n\n### Coding Agent 的判断\n\nCoding Agent 赛道的竞争焦点已经从\"谁的补全更准\"转向了：上下文窗口和代码库理解、工具链整合（终端、Git、CI/CD）、生态可扩展性（插件/技能），还有编辑体验本身。\n\n目前的局面：Claude Code 在工具链和生态上领先，Cursor 编辑体验最好，Copilot 靠 GitHub 原生整合吃天然红利。\n\n## 三、垂直领域 Agent：术业有专攻\n\n本周 Trending 上还冒出几个垂直领域的 Agent，挺有意思：\n\n### Shannon —— AI 安全渗透测试\n\n[KeygraphHQ/shannon](https://github.com/KeygraphHQ/shannon) 是一个全自动的 Web 应用安全测试 Agent。96.15% 的漏洞发现率不是靠暴力扫描，而是靠 Agent 像人类黑客一样理解应用逻辑、构造攻击路径。这类 Agent 正在改变安全行业的工作方式。\n\n### UI-TARS —— 多模态桌面 Agent\n\n字节跳动的 [UI-TARS](https://github.com/bytedance/UI-TARS) 做的是\"看屏幕操作电脑\"。它有两个项目：底层模型（UI-TARS）和桌面应用（UI-TARS-desktop）。后者定位为\"开源的多模态 AI Agent 基础设施\"，连接前沿 AI 模型和桌面操作。\n\n这个方向挺有意思。Agent 能看懂 GUI 并操作的话，理论上任何软件都能变成 Agent 的工具。\n\n### RD-Agent —— 研发自动化\n\n微软的 [RD-Agent](https://github.com/microsoft/RD-Agent) 做研发流程自动化，用 AI 驱动数据和模型的迭代。\n\n### Dexter / TradingAgents-CN —— 金融 Agent\n\n金融是 Agent 落地最积极的垂直领域之一。[virattt/dexter](https://github.com/virattt/dexter) 做深度金融研究，[TradingAgents-CN](https://github.com/hsliuping/TradingAgents-CN) 是中文金融交易的多 Agent 框架。\n\n## 四、Agent 基础设施：真正的战场\n\n框架和应用是上层建筑，基础设施协议才是地基。2026 年这一层正在快速成型。\n\n### MCP（Model Context Protocol）\n\nAnthropic 主导的 MCP 协议，我认为是 2025-2026 年 Agent 领域最重要的基础设施。\n\nMCP 要解决的问题很直接：LLM 应用怎么标准化地连接外部数据源和工具？\n\n```\n┌─────────────┐     MCP      ┌─────────────┐\n│  LLM 应用    │◄────────────►│  MCP Server  │\n│ (Claude Code │   标准协议    │  (GitHub,    │\n│  Cursor 等)  │              │   DB, API)   │\n└─────────────┘              └─────────────┘\n```\n\n到 2026 年 2 月，MCP 已经有了 10 种语言的 SDK（TypeScript、Python、Java、Kotlin、C#、Go、PHP、Ruby、Rust、Swift），几乎覆盖了所有主流开发语言。这种广泛的语言支持本身就说明了行业的认可度。\n\nMCP 的价值很朴素：以前每个 Agent 框架都自己搞一套工具调用机制，现在有统一标准了。像 HTTP 之于 Web，不性感，但没它不行。\n\n### A2A（Agent2Agent Protocol）\n\n如果 MCP 解决的是\"Agent 如何使用工具\"，那 Google 主导的 A2A 协议解决的是\"Agent 如何和 Agent 对话\"。\n\nA2A 让不同框架、不同公司的 Agent 能发现彼此的能力，协商交互方式，在长期任务上安全协作，而且不暴露内部状态、记忆或工具。\n\n最后这点我觉得设计得很聪明。A2A 把 Agent 当作\"不透明的参与者\"，不是能随意翻看内部状态的工具。就像你跟同事合作，不需要读对方的大脑，沟通就够了。\n\n```\n┌─────────┐  A2A  ┌─────────┐  A2A  ┌─────────┐\n│ Agent A  │◄────►│ Agent B  │◄────►│ Agent C  │\n│(LangGraph)│      │ (CrewAI) │      │  (ADK)   │\n└─────────┘       └─────────┘      └─────────┘\n     │                 │                 │\n     │ MCP             │ MCP             │ MCP\n     ▼                 ▼                 ▼\n  [Tools]           [Tools]          [Tools]\n```\n\nMCP + A2A 构成了 Agent 基础设施的两根柱子：一个管 Agent 怎么用工具，一个管 Agent 之间怎么对话。\n\n### Tool Use 的标准化\n\n除了协议层，Tool Use（工具调用）本身也在标准化。各大模型提供商（Anthropic、OpenAI、Google）的 Function Calling / Tool Use API 已经趋同。这意味着同一套工具定义可以在不同模型之间复用，降低了锁定风险。\n\n## 五、生态工具：让 Agent \"可用\"变\"好用\"\n\n本周 Trending 上还有一类项目值得看看，它们不是 Agent 本身，而是让 Agent 更好用的周边工具。\n\n### 记忆管理\n\n`claude-mem` 解决跨会话记忆问题。类似项目在各框架都有。这里说的记忆不是保存聊天记录那么简单，包括自动压缩提取关键信息、按上下文检索相关记忆、区分短期工作记忆和长期知识。\n\n### Hooks 和扩展机制\n\n`claude-code-hooks-mastery` 涨星这么快，说明开发者确实想自定义 Agent 行为。Hooks 让你在 Agent 执行的关键节点插入自己的逻辑，比如提交前自动跑 lint，调 API 前做安全审查。\n\n### 技能包和知识注入\n\n`claude-skills` 和 `openai/skills` 走同一个路子：把领域知识打包成可复用的\"技能\"注入 Agent。比微调模型轻量得多，也更灵活。\n\n### 本地知识搜索\n\n`tobi/qmd` 是本地文档搜索引擎，完全离线运行。不是所有数据都适合传到云端，这类工具就派上用场了。\n\n## 六、趋势判断：Agent 开发正在走向哪里\n\n综合上面这些，我觉得 Agent 开发生态正在发生几个明显的转变：\n\n### 1. 从\"框架竞争\"到\"协议竞争\"\n\n2024-2025 年，大家比的是谁的 Agent 框架更好用。2026 年，竞争焦点转向了基础设施协议。MCP 和 A2A 的出现意味着 Agent 生态开始有了\"公共基础设施\"。\n\n这很像互联网早期从各种专有协议走向 TCP/IP + HTTP 的过程。协议标准化了，应用层的创新自然就多了。\n\n### 2. 从\"通用 Agent\"到\"专业 Agent + 协作\"\n\n早期大家都想做一个\"什么都能干\"的通用 Agent。现在的趋势是：做一个领域里最专业的 Agent（安全的 Shannon、金融的 Dexter、研发的 RD-Agent），然后通过 A2A 协议让它们协作。\n\n说白了就是软件工程的老道理：单一职责加松耦合。\n\n### 3. 从\"产品\"到\"平台\"\n\nClaude Code、Codex 都在从产品变成平台。插件系统、Hooks 机制、技能包，这些都是平台化的信号。第三方生态开始围绕你建设的那一刻，你就不只是产品了。\n\n## 结语：我的预测\n\n站在 2026 年 2 月，说几个我的判断：\n\n1. **MCP 会成为事实标准**。10 种语言 SDK 已经形成飞轮效应，后来者很难再搞替代协议了。\n\n2. **Coding Agent 年底会成为多数开发者的日常工具**。不一定是 Claude Code 或 Cursor，但某种形式的 Coding Agent 会跟 Git 一样普遍。\n\n3. **垂直领域 Agent 是下一波创业机会**。框架和基础设施成熟之后，商业价值在垂直应用里。安全、金融、医疗、法律，每个领域都会跑出来自己的头部 Agent。\n\n4. **Agent 可观测性会成为新课题**。Agent 自主跑复杂任务时，你得能监控、审计、回放它的行为。这可能催生一个全新的工具品类。\n\nAgent 生态今年会快速发展，不是因为某个模型突然变强了，而是围绕 Agent 的基础设施终于在成型。管道铺好了，水自然就流了。\n\n---\n\n*如果你也在做 Agent 相关的开发，欢迎在评论区交流你的工具选型经验。*","src/data/blog/ai-agent-tools-landscape-2026.md","c7e42d2051f9b9c3",{html:175,metadata:176},"<h2 id=\"引子当-github-trending-被-agent-占领\">引子：当 GitHub Trending 被 Agent 占领</h2>\n<p>打开这周的 GitHub Trending，你会发现一个有趣的现象：排行榜上几乎一半的项目都和 AI Agent 有关。</p>\n<p>Shannon —— 一个全自动的 AI 黑客，在 XBOW 基准测试上跑出了 96.15% 的漏洞发现成功率。GitHub 官方的 <code>gh-aw</code>（Agentic Workflows）悄然上线。字节跳动的 UI-TARS 把多模态 Agent 搬上了桌面。微软的 RD-Agent 要让 AI 驱动研发全流程。还有一堆围绕 Claude Code 生态的项目 —— <code>claude-mem</code>、<code>claude-code-hooks-mastery</code>、<code>claude-skills</code> —— 正在把 Coding Agent 从”能用”推向”好用”。</p>\n<p>这不是偶然。2025 年大家忙着验证 Agent 到底能不能用，2026 年一开年，焦点已经转到基础设施建设上了。</p>\n<p>这篇文章梳理一下当前 Agent 开发者工具的全貌，帮你理清这个变化很快的生态。</p>\n<h2 id=\"一agent-框架从百花齐放到各据山头\">一、Agent 框架：从百花齐放到各据山头</h2>\n<p>Agent 框架是最早成熟的一层。两年下来，格局基本定了。</p>\n<h3 id=\"langchain--langgraph\">LangChain / LangGraph</h3>\n<p>LangChain 仍然是生态最完整的框架。但真正值得关注的是 LangGraph —— 它用图（Graph）结构来编排 Agent 的执行流程，比起早期 LangChain 的链式调用，表达能力强了几个数量级。</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"python\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> langgraph</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">graph </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> StateGraph</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 定义 Agent 状态机</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">graph </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#6F42C1;--shiki-dark:#B2CCD6\"> StateGraph</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">AgentState</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">graph</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-dark:#B2CCD6\">add_node</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">research</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D9F5DD\">,</span><span style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\"> research_agent</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">graph</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-dark:#B2CCD6\">add_node</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">write</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D9F5DD\">,</span><span style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\"> writing_agent</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">graph</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-dark:#B2CCD6\">add_node</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">review</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D9F5DD\">,</span><span style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\"> review_agent</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">graph</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-dark:#B2CCD6\">add_edge</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">research</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D9F5DD\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">write</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">graph</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-dark:#B2CCD6\">add_edge</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">write</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D9F5DD\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">review</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">graph</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-dark:#B2CCD6\">add_conditional_edges</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">review</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D9F5DD\">,</span><span style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\"> quality_check</span><span style=\"--shiki-light:#212121;--shiki-dark:#D9F5DD\">,</span><span style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">    \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">pass</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">: END,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">    \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">revise</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">: </span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">write</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">}</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)</span></span></code></pre>\n<p>适合场景：需要精细控制 Agent 执行流程的复杂应用。</p>\n<h3 id=\"crewai\">CrewAI</h3>\n<p>如果 LangGraph 是”编程式”的 Agent 编排，CrewAI 就是”声明式”的。你定义角色（Agent）、任务（Task）和流程（Process），框架帮你处理协作细节。2026 年初 CrewAI 已经发展到 v1.x 稳定版，加入了内存管理和工具复用机制。</p>\n<p>适合场景：多 Agent 角色扮演协作，比如”研究员 + 写手 + 审稿人”的内容生产流水线。</p>\n<h3 id=\"autogen-microsoft\">AutoGen (Microsoft)</h3>\n<p>微软的 AutoGen 走的是另一条路 —— 对话驱动的多 Agent 协作。Agent 之间通过消息传递来协调，更接近人类团队的协作方式。AutoGen Studio 提供了可视化界面，降低了上手门槛。</p>\n<p>适合场景：需要 Agent 之间进行复杂对话和协商的场景。</p>\n<h3 id=\"dify--coze\">Dify / Coze</h3>\n<p>Dify 和 Coze（字节跳动）走低代码/无代码路线。可视化工作流编辑器，不写代码也能搭 Agent 应用。Dify 开源，Coze 商业化，2026 年两者都加了 MCP 协议支持。</p>\n<p>适合场景：快速原型、业务人员自建 Agent 应用。</p>\n<h3 id=\"框架层的判断\">框架层的判断</h3>\n<p>框架之争基本结束了。开发者选 LangGraph 或 CrewAI 深入就行。产品经理或业务人员，Dify / Coze 更实际。框架本身不再是壁垒，关键看你用框架做了什么。</p>\n<h2 id=\"二coding-agent开发者的第二大脑\">二、Coding Agent：开发者的第二大脑</h2>\n<p>Coding Agent 大概是 Agent 领域里最先落地的品类。2026 年初，这个赛道已经卷得不行。</p>\n<h3 id=\"claude-code\">Claude Code</h3>\n<p>Anthropic 的 Claude Code 是目前终端 Coding Agent 里最好用的。它直接跑在终端里，理解整个代码库，能执行命令、操作 Git、重构代码。</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 安装</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">curl</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\"> -fsSL</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> https://claude.ai/install.sh</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> |</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> bash</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 在项目目录直接使用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">cd</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> my-project</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">claude</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> 把这个 REST API 改成 GraphQL，保持所有测试通过</span></span></code></pre>\n<p>Claude Code 真正有意思的地方是它开始有自己的插件生态了。本周 Trending 上就有三个相关项目：</p>\n<ul>\n<li><strong>claude-mem</strong>（<a href=\"https://github.com/thedotmack/claude-mem\">@thedotmack</a>）：自动记录 Claude Code 的每次会话，用 AI 压缩后在未来会话中注入相关上下文。解决了 Agent “金鱼记忆”的问题。</li>\n<li><strong>claude-code-hooks-mastery</strong>（<a href=\"https://github.com/disler/claude-code-hooks-mastery\">@disler</a>）：系统教你掌握 Claude Code 的 Hooks 机制，本周涨了 642 星。Hooks 让你能在 Claude Code 的执行流程中插入自定义逻辑。</li>\n<li><strong>claude-skills</strong>（<a href=\"https://github.com/Jeffallan/claude-skills\">@Jeffallan</a>）：66 个专业技能包，把 Claude Code 变成全栈开发的专家搭档。</li>\n</ul>\n<p>这些社区项目集中冒出来，说明 Claude Code 正在从工具变成平台。</p>\n<h3 id=\"cursor--windsurf\">Cursor / Windsurf</h3>\n<p>Cursor 和 Windsurf 走的是 IDE 路线。Cursor 基于 VS Code，把 AI 深度集成进编辑体验。Windsurf（Codeium 出品）则强调”Flow”模式 —— AI 和你交替编辑，像双人编程一样流畅。</p>\n<p>两者共同点：以文件为中心，以编辑器为主场。适合习惯 IDE 工作流的开发者。</p>\n<h3 id=\"openai-codex-cli--github-copilot-agent\">OpenAI Codex CLI / GitHub Copilot Agent</h3>\n<p>OpenAI 的 Codex CLI 走的是和 Claude Code 类似的终端路线，但更强调与 GitHub 生态的整合。本周 Trending 上出现的 <code>openai/skills</code>（Skills Catalog for Codex）就是 OpenAI 在构建 Codex 技能生态的证据。</p>\n<p>GitHub Copilot 则在往 Agent 方向进化。<code>github/gh-aw</code>（Agentic Workflows）的出现意味着 Copilot 不再只是自动补全，而是能执行跨文件、跨仓库的复杂工作流。</p>\n<h3 id=\"coding-agent-的判断\">Coding Agent 的判断</h3>\n<p>Coding Agent 赛道的竞争焦点已经从”谁的补全更准”转向了：上下文窗口和代码库理解、工具链整合（终端、Git、CI/CD）、生态可扩展性（插件/技能），还有编辑体验本身。</p>\n<p>目前的局面：Claude Code 在工具链和生态上领先，Cursor 编辑体验最好，Copilot 靠 GitHub 原生整合吃天然红利。</p>\n<h2 id=\"三垂直领域-agent术业有专攻\">三、垂直领域 Agent：术业有专攻</h2>\n<p>本周 Trending 上还冒出几个垂直领域的 Agent，挺有意思：</p>\n<h3 id=\"shannon--ai-安全渗透测试\">Shannon —— AI 安全渗透测试</h3>\n<p><a href=\"https://github.com/KeygraphHQ/shannon\">KeygraphHQ/shannon</a> 是一个全自动的 Web 应用安全测试 Agent。96.15% 的漏洞发现率不是靠暴力扫描，而是靠 Agent 像人类黑客一样理解应用逻辑、构造攻击路径。这类 Agent 正在改变安全行业的工作方式。</p>\n<h3 id=\"ui-tars--多模态桌面-agent\">UI-TARS —— 多模态桌面 Agent</h3>\n<p>字节跳动的 <a href=\"https://github.com/bytedance/UI-TARS\">UI-TARS</a> 做的是”看屏幕操作电脑”。它有两个项目：底层模型（UI-TARS）和桌面应用（UI-TARS-desktop）。后者定位为”开源的多模态 AI Agent 基础设施”，连接前沿 AI 模型和桌面操作。</p>\n<p>这个方向挺有意思。Agent 能看懂 GUI 并操作的话，理论上任何软件都能变成 Agent 的工具。</p>\n<h3 id=\"rd-agent--研发自动化\">RD-Agent —— 研发自动化</h3>\n<p>微软的 <a href=\"https://github.com/microsoft/RD-Agent\">RD-Agent</a> 做研发流程自动化，用 AI 驱动数据和模型的迭代。</p>\n<h3 id=\"dexter--tradingagents-cn--金融-agent\">Dexter / TradingAgents-CN —— 金融 Agent</h3>\n<p>金融是 Agent 落地最积极的垂直领域之一。<a href=\"https://github.com/virattt/dexter\">virattt/dexter</a> 做深度金融研究，<a href=\"https://github.com/hsliuping/TradingAgents-CN\">TradingAgents-CN</a> 是中文金融交易的多 Agent 框架。</p>\n<h2 id=\"四agent-基础设施真正的战场\">四、Agent 基础设施：真正的战场</h2>\n<p>框架和应用是上层建筑，基础设施协议才是地基。2026 年这一层正在快速成型。</p>\n<h3 id=\"mcpmodel-context-protocol\">MCP（Model Context Protocol）</h3>\n<p>Anthropic 主导的 MCP 协议，我认为是 2025-2026 年 Agent 领域最重要的基础设施。</p>\n<p>MCP 要解决的问题很直接：LLM 应用怎么标准化地连接外部数据源和工具？</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"plaintext\"><code><span class=\"line\"><span>┌─────────────┐     MCP      ┌─────────────┐</span></span>\n<span class=\"line\"><span>│  LLM 应用    │◄────────────►│  MCP Server  │</span></span>\n<span class=\"line\"><span>│ (Claude Code │   标准协议    │  (GitHub,    │</span></span>\n<span class=\"line\"><span>│  Cursor 等)  │              │   DB, API)   │</span></span>\n<span class=\"line\"><span>└─────────────┘              └─────────────┘</span></span></code></pre>\n<p>到 2026 年 2 月，MCP 已经有了 10 种语言的 SDK（TypeScript、Python、Java、Kotlin、C#、Go、PHP、Ruby、Rust、Swift），几乎覆盖了所有主流开发语言。这种广泛的语言支持本身就说明了行业的认可度。</p>\n<p>MCP 的价值很朴素：以前每个 Agent 框架都自己搞一套工具调用机制，现在有统一标准了。像 HTTP 之于 Web，不性感，但没它不行。</p>\n<h3 id=\"a2aagent2agent-protocol\">A2A（Agent2Agent Protocol）</h3>\n<p>如果 MCP 解决的是”Agent 如何使用工具”，那 Google 主导的 A2A 协议解决的是”Agent 如何和 Agent 对话”。</p>\n<p>A2A 让不同框架、不同公司的 Agent 能发现彼此的能力，协商交互方式，在长期任务上安全协作，而且不暴露内部状态、记忆或工具。</p>\n<p>最后这点我觉得设计得很聪明。A2A 把 Agent 当作”不透明的参与者”，不是能随意翻看内部状态的工具。就像你跟同事合作，不需要读对方的大脑，沟通就够了。</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"plaintext\"><code><span class=\"line\"><span>┌─────────┐  A2A  ┌─────────┐  A2A  ┌─────────┐</span></span>\n<span class=\"line\"><span>│ Agent A  │◄────►│ Agent B  │◄────►│ Agent C  │</span></span>\n<span class=\"line\"><span>│(LangGraph)│      │ (CrewAI) │      │  (ADK)   │</span></span>\n<span class=\"line\"><span>└─────────┘       └─────────┘      └─────────┘</span></span>\n<span class=\"line\"><span>     │                 │                 │</span></span>\n<span class=\"line\"><span>     │ MCP             │ MCP             │ MCP</span></span>\n<span class=\"line\"><span>     ▼                 ▼                 ▼</span></span>\n<span class=\"line\"><span>  [Tools]           [Tools]          [Tools]</span></span></code></pre>\n<p>MCP + A2A 构成了 Agent 基础设施的两根柱子：一个管 Agent 怎么用工具，一个管 Agent 之间怎么对话。</p>\n<h3 id=\"tool-use-的标准化\">Tool Use 的标准化</h3>\n<p>除了协议层，Tool Use（工具调用）本身也在标准化。各大模型提供商（Anthropic、OpenAI、Google）的 Function Calling / Tool Use API 已经趋同。这意味着同一套工具定义可以在不同模型之间复用，降低了锁定风险。</p>\n<h2 id=\"五生态工具让-agent-可用变好用\">五、生态工具：让 Agent “可用”变”好用”</h2>\n<p>本周 Trending 上还有一类项目值得看看，它们不是 Agent 本身，而是让 Agent 更好用的周边工具。</p>\n<h3 id=\"记忆管理\">记忆管理</h3>\n<p><code>claude-mem</code> 解决跨会话记忆问题。类似项目在各框架都有。这里说的记忆不是保存聊天记录那么简单，包括自动压缩提取关键信息、按上下文检索相关记忆、区分短期工作记忆和长期知识。</p>\n<h3 id=\"hooks-和扩展机制\">Hooks 和扩展机制</h3>\n<p><code>claude-code-hooks-mastery</code> 涨星这么快，说明开发者确实想自定义 Agent 行为。Hooks 让你在 Agent 执行的关键节点插入自己的逻辑，比如提交前自动跑 lint，调 API 前做安全审查。</p>\n<h3 id=\"技能包和知识注入\">技能包和知识注入</h3>\n<p><code>claude-skills</code> 和 <code>openai/skills</code> 走同一个路子：把领域知识打包成可复用的”技能”注入 Agent。比微调模型轻量得多，也更灵活。</p>\n<h3 id=\"本地知识搜索\">本地知识搜索</h3>\n<p><code>tobi/qmd</code> 是本地文档搜索引擎，完全离线运行。不是所有数据都适合传到云端，这类工具就派上用场了。</p>\n<h2 id=\"六趋势判断agent-开发正在走向哪里\">六、趋势判断：Agent 开发正在走向哪里</h2>\n<p>综合上面这些，我觉得 Agent 开发生态正在发生几个明显的转变：</p>\n<h3 id=\"1-从框架竞争到协议竞争\">1. 从”框架竞争”到”协议竞争”</h3>\n<p>2024-2025 年，大家比的是谁的 Agent 框架更好用。2026 年，竞争焦点转向了基础设施协议。MCP 和 A2A 的出现意味着 Agent 生态开始有了”公共基础设施”。</p>\n<p>这很像互联网早期从各种专有协议走向 TCP/IP + HTTP 的过程。协议标准化了，应用层的创新自然就多了。</p>\n<h3 id=\"2-从通用-agent到专业-agent--协作\">2. 从”通用 Agent”到”专业 Agent + 协作”</h3>\n<p>早期大家都想做一个”什么都能干”的通用 Agent。现在的趋势是：做一个领域里最专业的 Agent（安全的 Shannon、金融的 Dexter、研发的 RD-Agent），然后通过 A2A 协议让它们协作。</p>\n<p>说白了就是软件工程的老道理：单一职责加松耦合。</p>\n<h3 id=\"3-从产品到平台\">3. 从”产品”到”平台”</h3>\n<p>Claude Code、Codex 都在从产品变成平台。插件系统、Hooks 机制、技能包，这些都是平台化的信号。第三方生态开始围绕你建设的那一刻，你就不只是产品了。</p>\n<h2 id=\"结语我的预测\">结语：我的预测</h2>\n<p>站在 2026 年 2 月，说几个我的判断：</p>\n<ol>\n<li>\n<p><strong>MCP 会成为事实标准</strong>。10 种语言 SDK 已经形成飞轮效应，后来者很难再搞替代协议了。</p>\n</li>\n<li>\n<p><strong>Coding Agent 年底会成为多数开发者的日常工具</strong>。不一定是 Claude Code 或 Cursor，但某种形式的 Coding Agent 会跟 Git 一样普遍。</p>\n</li>\n<li>\n<p><strong>垂直领域 Agent 是下一波创业机会</strong>。框架和基础设施成熟之后，商业价值在垂直应用里。安全、金融、医疗、法律，每个领域都会跑出来自己的头部 Agent。</p>\n</li>\n<li>\n<p><strong>Agent 可观测性会成为新课题</strong>。Agent 自主跑复杂任务时，你得能监控、审计、回放它的行为。这可能催生一个全新的工具品类。</p>\n</li>\n</ol>\n<p>Agent 生态今年会快速发展，不是因为某个模型突然变强了，而是围绕 Agent 的基础设施终于在成型。管道铺好了，水自然就流了。</p>\n<hr>\n<p><em>如果你也在做 Agent 相关的开发，欢迎在评论区交流你的工具选型经验。</em></p>",{headings:177,localImagePaths:268,remoteImagePaths:269,frontmatter:270,imagePaths:273},[178,181,184,188,191,194,197,199,202,205,208,211,214,217,220,223,226,229,232,235,238,241,244,246,249,251,253,256,259,262,265],{depth:31,slug:179,text:180},"引子当-github-trending-被-agent-占领","引子：当 GitHub Trending 被 Agent 占领",{depth:31,slug:182,text:183},"一agent-框架从百花齐放到各据山头","一、Agent 框架：从百花齐放到各据山头",{depth:185,slug:186,text:187},3,"langchain--langgraph","LangChain / LangGraph",{depth:185,slug:189,text:190},"crewai","CrewAI",{depth:185,slug:192,text:193},"autogen-microsoft","AutoGen (Microsoft)",{depth:185,slug:195,text:196},"dify--coze","Dify / Coze",{depth:185,slug:198,text:198},"框架层的判断",{depth:31,slug:200,text:201},"二coding-agent开发者的第二大脑","二、Coding Agent：开发者的第二大脑",{depth:185,slug:203,text:204},"claude-code","Claude Code",{depth:185,slug:206,text:207},"cursor--windsurf","Cursor / Windsurf",{depth:185,slug:209,text:210},"openai-codex-cli--github-copilot-agent","OpenAI Codex CLI / GitHub Copilot Agent",{depth:185,slug:212,text:213},"coding-agent-的判断","Coding Agent 的判断",{depth:31,slug:215,text:216},"三垂直领域-agent术业有专攻","三、垂直领域 Agent：术业有专攻",{depth:185,slug:218,text:219},"shannon--ai-安全渗透测试","Shannon —— AI 安全渗透测试",{depth:185,slug:221,text:222},"ui-tars--多模态桌面-agent","UI-TARS —— 多模态桌面 Agent",{depth:185,slug:224,text:225},"rd-agent--研发自动化","RD-Agent —— 研发自动化",{depth:185,slug:227,text:228},"dexter--tradingagents-cn--金融-agent","Dexter / TradingAgents-CN —— 金融 Agent",{depth:31,slug:230,text:231},"四agent-基础设施真正的战场","四、Agent 基础设施：真正的战场",{depth:185,slug:233,text:234},"mcpmodel-context-protocol","MCP（Model Context Protocol）",{depth:185,slug:236,text:237},"a2aagent2agent-protocol","A2A（Agent2Agent Protocol）",{depth:185,slug:239,text:240},"tool-use-的标准化","Tool Use 的标准化",{depth:31,slug:242,text:243},"五生态工具让-agent-可用变好用","五、生态工具：让 Agent “可用”变”好用”",{depth:185,slug:245,text:245},"记忆管理",{depth:185,slug:247,text:248},"hooks-和扩展机制","Hooks 和扩展机制",{depth:185,slug:250,text:250},"技能包和知识注入",{depth:185,slug:252,text:252},"本地知识搜索",{depth:31,slug:254,text:255},"六趋势判断agent-开发正在走向哪里","六、趋势判断：Agent 开发正在走向哪里",{depth:185,slug:257,text:258},"1-从框架竞争到协议竞争","1. 从”框架竞争”到”协议竞争”",{depth:185,slug:260,text:261},"2-从通用-agent到专业-agent--协作","2. 从”通用 Agent”到”专业 Agent + 协作”",{depth:185,slug:263,text:264},"3-从产品到平台","3. 从”产品”到”平台”",{depth:31,slug:266,text:267},"结语我的预测","结语：我的预测",[],[],{author:14,pubDatetime:271,title:164,slug:160,featured:165,draft:17,tags:272,description:170},["Date","2026-02-12T04:00:00.000Z"],[167,168,169],[],"blog-deploy-optimization",{id:274,data:276,body:283,filePath:284,digest:285,rendered:286},{author:14,pubDatetime:277,title:278,featured:165,draft:17,tags:279,description:282},["Date","2026-02-11T13:00:00.000Z"],"博客部署流程优化：从服务器构建到本地构建的进化",[123,280,281],"前端工程化","自动化","记录博客部署流程从服务器端构建到本地构建+GitHub传输的优化历程，解决服务器资源不足的问题。","## 问题背景\n\n最近维护 Astro 博客时碰到一个问题：服务器资源不够，构建直接挂了。\n\n### 原来流程的问题\n\n```bash\n# 旧流程：直接服务器构建\n本地修改 → rsync 源码到服务器 → 服务器 npm run build → 部署\n```\n\n具体来说：\n- 服务器只有 1GB RAM\n- Astro 构建要生成 OG 图片，吃内存\n- 构建动不动就崩溃或超时\n- 部署成功率很低\n\n## 解决方案\n\n### 新流程设计\n\n```bash\n# 新流程：本地构建 + GitHub 传输\n本地构建 → 推送到 GitHub（含构建产物） → 服务器拉取并部署\n```\n\n### 具体实现\n\n**1. 修改 .gitignore**\n```bash\n# 允许构建产物进入版本控制\n# dist/ -- 注释掉，允许提交构建产物到 GitHub\n```\n\n**2. 部署脚本优化**\n```bash\n#!/bin/bash\necho \"🚀 生产环境部署流程（本地构建→GitHub→服务器）...\"\n\n# 1. 本地构建\nnpm run build\n\n# 2. 提交构建产物到 GitHub\ngit add .\ngit commit -m \"Auto deploy with build: $(date '+%Y-%m-%d %H:%M:%S')\"\ngit push origin main\n\n# 3. 服务器拉取并部署\nssh server << 'EOF'\n    cd /var/www/source\n    git pull origin main\n    cp -r dist/* /var/www/html/\nEOF\n```\n\n## 效果\n\n改完之后：\n- 构建跑在本地 Mac 上，内存随便用，再也不崩了\n- 服务器只做文件复制，部署几秒钟搞定\n- 构建产物在 GitHub 上有完整备份，回滚随时可以\n- 服务器挂了也不怕，重新 git pull 就恢复\n\n### 一键部署体验\n```bash\n# 一键部署\n./deploy-production.sh\n\n# 自动完成：\n# 1. ✅ 本地构建完成\n# 2. ✅ 构建产物已推送到 GitHub  \n# 3. ✅ 服务器已拉取并部署\n```\n\n## 技术细节\n\n### Astro 构建干了什么\n- 预渲染所有页面为静态 HTML\n- 每篇文章生成 Open Graph 图片（这是吃内存的大头）\n- Pagefind 生成搜索索引\n- 压缩合并静态资源\n\n### 服务器配置\n```nginx\n# Nginx 配置优化\nlocation / {\n    try_files $uri $uri/ =404;\n    \n    # 静态资源缓存\n    location ~* \\.(js|css|png|jpg|jpeg|gif|webp|svg)$ {\n        expires 1y;\n        add_header Cache-Control \"public, immutable\";\n    }\n}\n```\n\n## 顺手做的优化\n\n缓存策略也一起配了。Cloudflare 做 CDN，静态资源设 1 年过期（反正文件名带 hash），部署后 Cloudflare 清一下缓存就行。\n\n### 验证\n```bash\n# 部署状态检查\ncurl -I https://chenguangliang.com\n# 性能监控  \nlighthouse https://chenguangliang.com\n```\n\n## 总结\n\n说白了就是一件事：服务器太弱就别在上面构建，本地构建完推上去就行。Git 做增量传输，GitHub 做版本管理，服务器只负责 serve 静态文件。\n\n简单的方案往往最靠谱。","src/data/blog/blog-deploy-optimization.md","f86ef4f1779a1a6f",{html:287,metadata:288},"<h2 id=\"问题背景\">问题背景</h2>\n<p>最近维护 Astro 博客时碰到一个问题：服务器资源不够，构建直接挂了。</p>\n<h3 id=\"原来流程的问题\">原来流程的问题</h3>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 旧流程：直接服务器构建</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">本地修改</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> →</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> rsync</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> 源码到服务器</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> →</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> 服务器</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> npm</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> run</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> build</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> →</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> 部署</span></span></code></pre>\n<p>具体来说：</p>\n<ul>\n<li>服务器只有 1GB RAM</li>\n<li>Astro 构建要生成 OG 图片，吃内存</li>\n<li>构建动不动就崩溃或超时</li>\n<li>部署成功率很低</li>\n</ul>\n<h2 id=\"解决方案\">解决方案</h2>\n<h3 id=\"新流程设计\">新流程设计</h3>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 新流程：本地构建 + GitHub 传输</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">本地构建</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> →</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> 推送到</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> GitHub（含构建产物）</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> →</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> 服务器拉取并部署</span></span></code></pre>\n<h3 id=\"具体实现\">具体实现</h3>\n<p><strong>1. 修改 .gitignore</strong></p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 允许构建产物进入版本控制</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># dist/ -- 注释掉，允许提交构建产物到 GitHub</span></span></code></pre>\n<p><strong>2. 部署脚本优化</strong></p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">#!/bin/bash</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">echo</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">🚀 生产环境部署流程（本地构建→GitHub→服务器）...</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 1. 本地构建</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">npm</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> run</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> build</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 2. 提交构建产物到 GitHub</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">git</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> add</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> .</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">git</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> commit</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\"> -m</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">Auto deploy with build: $(</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">date</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">+%Y-%m-%d %H:%M:%S</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">)</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">git</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> push</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> origin</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> main</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 3. 服务器拉取并部署</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">ssh</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> server</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> &#x3C;&#x3C;</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> 'EOF'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">    cd /var/www/source</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">    git pull origin main</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">    cp -r dist/* /var/www/html/</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">EOF</span></span></code></pre>\n<h2 id=\"效果\">效果</h2>\n<p>改完之后：</p>\n<ul>\n<li>构建跑在本地 Mac 上，内存随便用，再也不崩了</li>\n<li>服务器只做文件复制，部署几秒钟搞定</li>\n<li>构建产物在 GitHub 上有完整备份，回滚随时可以</li>\n<li>服务器挂了也不怕，重新 git pull 就恢复</li>\n</ul>\n<h3 id=\"一键部署体验\">一键部署体验</h3>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 一键部署</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">./deploy-production.sh</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 自动完成：</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 1. ✅ 本地构建完成</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 2. ✅ 构建产物已推送到 GitHub  </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 3. ✅ 服务器已拉取并部署</span></span></code></pre>\n<h2 id=\"技术细节\">技术细节</h2>\n<h3 id=\"astro-构建干了什么\">Astro 构建干了什么</h3>\n<ul>\n<li>预渲染所有页面为静态 HTML</li>\n<li>每篇文章生成 Open Graph 图片（这是吃内存的大头）</li>\n<li>Pagefind 生成搜索索引</li>\n<li>压缩合并静态资源</li>\n</ul>\n<h3 id=\"服务器配置\">服务器配置</h3>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"nginx\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># Nginx 配置优化</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">location</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> / {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    try_files </span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">$</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">uri</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> $</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">uri</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">/ </span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">=404</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    # 静态资源缓存</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    location</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> ~*</span><span style=\"--shiki-light:#22863A;--shiki-dark:#5CA7E4\"> \\.(js|css|png|jpg|jpeg|gif|webp|svg)$ </span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">        expires </span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">1y;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">        add_header </span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">Cache-Control </span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">\"public, immutable\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span></code></pre>\n<h2 id=\"顺手做的优化\">顺手做的优化</h2>\n<p>缓存策略也一起配了。Cloudflare 做 CDN，静态资源设 1 年过期（反正文件名带 hash），部署后 Cloudflare 清一下缓存就行。</p>\n<h3 id=\"验证\">验证</h3>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 部署状态检查</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">curl</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\"> -I</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> https://chenguangliang.com</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 性能监控  </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">lighthouse</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> https://chenguangliang.com</span></span></code></pre>\n<h2 id=\"总结\">总结</h2>\n<p>说白了就是一件事：服务器太弱就别在上面构建，本地构建完推上去就行。Git 做增量传输，GitHub 做版本管理，服务器只负责 serve 静态文件。</p>\n<p>简单的方案往往最靠谱。</p>",{headings:289,localImagePaths:317,remoteImagePaths:318,frontmatter:319,imagePaths:322},[290,292,294,296,298,300,302,304,306,309,311,313,315],{depth:31,slug:291,text:291},"问题背景",{depth:185,slug:293,text:293},"原来流程的问题",{depth:31,slug:295,text:295},"解决方案",{depth:185,slug:297,text:297},"新流程设计",{depth:185,slug:299,text:299},"具体实现",{depth:31,slug:301,text:301},"效果",{depth:185,slug:303,text:303},"一键部署体验",{depth:31,slug:305,text:305},"技术细节",{depth:185,slug:307,text:308},"astro-构建干了什么","Astro 构建干了什么",{depth:185,slug:310,text:310},"服务器配置",{depth:31,slug:312,text:312},"顺手做的优化",{depth:185,slug:314,text:314},"验证",{depth:31,slug:316,text:316},"总结",[],[],{author:14,pubDatetime:320,title:278,slug:274,featured:165,draft:17,tags:321,description:282},["Date","2026-02-11T13:00:00.000Z"],[123,280,281],[],"function-scope-block-scope",{id:323,data:325,body:330,filePath:331,digest:332,rendered:333},{author:14,pubDatetime:326,title:327,featured:17,draft:17,tags:328,description:329},["Date","2019-08-10T02:00:00.000Z"],"函数作用域和块作用域",[20],"最小暴露原则、IIFE、块作用域（let/const/try-catch）详解。","## 最小暴露原则\n\n应该最小限度地暴露必要内容，将其他内容\"隐藏\"起来。\n\n## IIFE 的特殊用途\n\n### 重置 undefined（ES3 中 undefined 可以赋值）\n\n```js\n(function IIFE(undefined) {\n  var a;\n  if (a === undefined) {\n    console.log(\"Undefined is safe here!\");\n  }\n})();\n```\n\n## 块作用域\n\n- `try/catch` 的 catch 分句会创建块作用域\n- `let` 将变量绑定到所在的 `{}` 块中\n- `const` 创建块级常量\n\n```js\nif (true) {\n  {\n    let i = 11;\n    var s = 11;\n  }\n  // console.log(i); // ReferenceError\n  console.log(s); // 11\n}\n```\n\n块作用域有助于垃圾回收——闭包不会意外保留大对象。","src/data/blog/function-scope-block-scope.md","23d9610adfc84563",{html:334,metadata:335},"<h2 id=\"最小暴露原则\">最小暴露原则</h2>\n<p>应该最小限度地暴露必要内容，将其他内容”隐藏”起来。</p>\n<h2 id=\"iife-的特殊用途\">IIFE 的特殊用途</h2>\n<h3 id=\"重置-undefinedes3-中-undefined-可以赋值\">重置 undefined（ES3 中 undefined 可以赋值）</h3>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> IIFE</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">undefined</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> a</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">a</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ===</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\"> undefined</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">    console</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">log</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">Undefined is safe here!</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">})();</span></span></code></pre>\n<h2 id=\"块作用域\">块作用域</h2>\n<ul>\n<li><code>try/catch</code> 的 catch 分句会创建块作用域</li>\n<li><code>let</code> 将变量绑定到所在的 <code>{}</code> 块中</li>\n<li><code>const</code> 创建块级常量</li>\n</ul>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\">true</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    let</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> i</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 11</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> s</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 11</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  // console.log(i);</span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"> // ReferenceError</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">  console</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">log</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">s</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 11</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span></code></pre>\n<p>块作用域有助于垃圾回收——闭包不会意外保留大对象。</p>",{headings:336,localImagePaths:347,remoteImagePaths:348,frontmatter:349,imagePaths:352},[337,339,342,345],{depth:31,slug:338,text:338},"最小暴露原则",{depth:31,slug:340,text:341},"iife-的特殊用途","IIFE 的特殊用途",{depth:185,slug:343,text:344},"重置-undefinedes3-中-undefined-可以赋值","重置 undefined（ES3 中 undefined 可以赋值）",{depth:31,slug:346,text:346},"块作用域",[],[],{author:14,pubDatetime:350,title:327,slug:323,featured:17,draft:17,tags:351,description:329},["Date","2019-08-10T02:00:00.000Z"],[20],[],"git-hooks-eslint",{id:353,data:355,body:361,filePath:362,digest:363,rendered:364},{author:14,pubDatetime:356,title:357,featured:17,draft:17,tags:358,description:360},["Date","2018-08-15T02:00:00.000Z"],"如何在 git commit 时添加 ESLint 校验",[359,280],"Git","使用 pre-commit 和 lint-staged 在提交时自动运行 ESLint。","## 方案：pre-commit + lint-staged\n\n```bash\nnpm install pre-commit lint-staged --save-dev\n```\n\npackage.json 配置：\n\n```json\n{\n  \"scripts\": {\n    \"lint:staged\": \"lint-staged\"\n  },\n  \"lint-staged\": {\n    \"linters\": {\n      \"*.js\": [\"eslint --ignore-path .gitignore --fix\"]\n    }\n  },\n  \"pre-commit\": \"lint:staged\"\n}\n```\n\n`--ignore-path .gitignore` 建议使用，特殊需求可以用 `.eslintignore`。","src/data/blog/git-hooks-eslint.md","6f956fcd699109f1",{html:365,metadata:366},"<h2 id=\"方案pre-commit--lint-staged\">方案：pre-commit + lint-staged</h2>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">npm</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> install</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> pre-commit</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> lint-staged</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\"> --save-dev</span></span></code></pre>\n<p>package.json 配置：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"json\"><code><span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">  \"scripts\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">    \"lint:staged\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#C789D6\">lint-staged</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">  \"lint-staged\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">    \"linters\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">      \"*.js\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#C789D6\">eslint --ignore-path .gitignore --fix</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">  \"pre-commit\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#C789D6\">lint:staged</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span></code></pre>\n<p><code>--ignore-path .gitignore</code> 建议使用，特殊需求可以用 <code>.eslintignore</code>。</p>",{headings:367,localImagePaths:371,remoteImagePaths:372,frontmatter:373,imagePaths:376},[368],{depth:31,slug:369,text:370},"方案pre-commit--lint-staged","方案：pre-commit + lint-staged",[],[],{author:14,pubDatetime:374,title:357,slug:353,featured:17,draft:17,tags:375,description:360},["Date","2018-08-15T02:00:00.000Z"],[359,280],[],"go-learning-notes",{id:377,data:379,body:385,filePath:386,digest:387,rendered:388},{author:14,pubDatetime:380,title:381,featured:17,draft:17,tags:382,description:384},["Date","2019-08-01T02:00:00.000Z"],"Go 学习笔记",[383],"Go","Go 语言基础：变量定义、array、slice、map 等核心概念。","## 环境配置\n\n```bash\nexport GOPATH=$HOME/go\nexport GOBIN=$HOME/go/bin\nexport PATH=\"$GOPATH/bin:$PATH\"\n```\n\n## 变量定义\n\n```go\nvar vname1, vname2 type\nvname1, vname2 := v1, v2  // 简短声明\n\n// iota 枚举\nconst (\n    a = iota  // 0\n    b = \"B\"\n    c = iota  // 2\n)\n```\n\n## Slice\n\nslice 是引用类型，修改会影响所有引用：\n\n```go\narray := [10]byte{'a','b','c','d','e','f','g','h','i','j'}\naSlice := array[:3]  // a,b,c\nbSlice := array[5:]  // f,g,h,i,j\n```\n\n## Map\n\n```go\nnumbers := make(map[string]int)\nnumbers[\"one\"] = 1\nnumbers[\"ten\"] = 10\n```\n\nmap 是无序的、引用类型，不是 thread-safe。","src/data/blog/go-learning-notes.md","f0e70ecd5f432c52",{html:389,metadata:390},"<h2 id=\"环境配置\">环境配置</h2>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">export</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> GOPATH</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">$HOME</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">/</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">go</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">export</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> GOBIN</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">$HOME</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">/</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">go</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">/</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">bin</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">export</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> PATH</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#C5E478\">$GOPATH</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">/bin:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#C5E478\">$PATH</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span></span></code></pre>\n<h2 id=\"变量定义\">变量定义</h2>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"go\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> vname1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, </span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">vname2</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> type</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">vname1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, </span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">vname2</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> :=</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> v1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, </span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">v2</span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  // 简短声明</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// iota 枚举</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">const</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\">    a</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\"> iota</span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  // 0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\">    b</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">B</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\">    c</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\"> iota</span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  // 2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span></span></code></pre>\n<h2 id=\"slice\">Slice</h2>\n<p>slice 是引用类型，修改会影响所有引用：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"go\"><code><span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">array</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> :=</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">10</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">byte</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">{</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">a</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">b</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">c</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">d</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">e</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">f</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">g</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">h</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">i</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">j</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">aSlice</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> :=</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> array</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">3</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]  </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// a,b,c</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">bSlice</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> :=</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> array</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">5</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">:]  </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// f,g,h,i,j</span></span></code></pre>\n<h2 id=\"map\">Map</h2>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"go\"><code><span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">numbers</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> :=</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> make</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">map</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">string</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">int</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">numbers</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">one</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">] </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">numbers</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">ten</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">] </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 10</span></span></code></pre>\n<p>map 是无序的、引用类型，不是 thread-safe。</p>",{headings:391,localImagePaths:402,remoteImagePaths:403,frontmatter:404,imagePaths:407},[392,394,396,399],{depth:31,slug:393,text:393},"环境配置",{depth:31,slug:395,text:395},"变量定义",{depth:31,slug:397,text:398},"slice","Slice",{depth:31,slug:400,text:401},"map","Map",[],[],{author:14,pubDatetime:405,title:381,slug:377,featured:17,draft:17,tags:406,description:384},["Date","2019-08-01T02:00:00.000Z"],[383],[],"git-shell-error",{id:408,data:410,body:415,filePath:416,digest:417,rendered:418},{author:14,pubDatetime:411,title:412,featured:17,draft:17,tags:413,description:414},["Date","2015-04-15T02:00:00.000Z"],"Git Shell Error in Windows 修复",[359],"Git command could not be found 的修复方法。","错误：`git command could not be found. please create an alias or add it to your path`\n\n修复步骤：\n1. 关闭 Git Shell\n2. 打开 GitHub Desktop，让它完成 post installation\n3. 重新打开 Git Shell","src/data/blog/git-shell-error.md","b62a8a48a3753774",{html:419,metadata:420},"<p>错误：<code>git command could not be found. please create an alias or add it to your path</code></p>\n<p>修复步骤：</p>\n<ol>\n<li>关闭 Git Shell</li>\n<li>打开 GitHub Desktop，让它完成 post installation</li>\n<li>重新打开 Git Shell</li>\n</ol>",{headings:421,localImagePaths:422,remoteImagePaths:423,frontmatter:424,imagePaths:427},[],[],[],{author:14,pubDatetime:425,title:412,slug:408,featured:17,draft:17,tags:426,description:414},["Date","2015-04-15T02:00:00.000Z"],[359],[],"iterator",{id:428,data:430,body:435,filePath:436,digest:437,rendered:438},{author:14,pubDatetime:431,title:432,featured:17,draft:17,tags:433,description:434},["Date","2018-09-01T02:00:00.000Z"],"ES6 Iterator 遍历器详解",[20,95],"Iterator 接口原理，for...of 循环，以及让普通对象可迭代的四种方式。","Iterator 是一种接口，为各种不同的数据结构提供统一的访问机制。它也是解构赋值、扩展运算符、Generator、for...of 的实现基础。\n\n## 原生具备 Iterator 的数据结构\n\nArray、Map、Set、String、TypedArray、arguments、NodeList\n\n## 让对象支持 for...of\n\n### 方式一：实现 Symbol.iterator\n\n```js\nclass RangeIterator {\n  constructor(start, stop) {\n    this.value = start;\n    this.stop = stop;\n  }\n  [Symbol.iterator]() { return this; }\n  next() {\n    if (this.value < this.stop) {\n      return { done: false, value: this.value++ };\n    }\n    return { done: true, value: undefined };\n  }\n}\n\nfor (var value of new RangeIterator(0, 3)) {\n  console.log(value); // 0, 1, 2\n}\n```\n\n### 方式二：借用 Array 的迭代器\n\n```js\nlet iterable = {\n  0: \"a\", 1: \"b\", 2: \"c\",\n  length: 3,\n  [Symbol.iterator]: Array.prototype[Symbol.iterator],\n};\n```\n\n### 方式三：Generator 函数\n\n```js\nlet obj = {\n  *[Symbol.iterator]() {\n    yield \"hello\";\n    yield \"world\";\n  },\n};\n```\n\n### 方式四：Object.keys 遍历\n\n```js\nfor (var key of Object.keys(someObject)) {\n  console.log(key + \": \" + someObject[key]);\n}\n```","src/data/blog/iterator.md","ba60035c7c6dd9d3",{html:439,metadata:440},"<p>Iterator 是一种接口，为各种不同的数据结构提供统一的访问机制。它也是解构赋值、扩展运算符、Generator、for…of 的实现基础。</p>\n<h2 id=\"原生具备-iterator-的数据结构\">原生具备 Iterator 的数据结构</h2>\n<p>Array、Map、Set、String、TypedArray、arguments、NodeList</p>\n<h2 id=\"让对象支持-forof\">让对象支持 for…of</h2>\n<h3 id=\"方式一实现-symboliterator\">方式一：实现 Symbol.iterator</h3>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">class</span><span style=\"--shiki-light:#6F42C1;--shiki-dark:#FFCB8B\"> RangeIterator</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#82AAFF\">  constructor</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">start</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> stop</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#41EEC6;--shiki-dark-font-style:italic\">    this</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">value</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> start</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#41EEC6;--shiki-dark-font-style:italic\">    this</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">stop</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> stop</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  [</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">Symbol</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">iterator</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">()</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">return</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#41EEC6;--shiki-dark-font-style:italic\"> this</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">  next</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">()</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#41EEC6;--shiki-dark-font-style:italic\">this</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">value</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> &#x3C;</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#41EEC6;--shiki-dark-font-style:italic\"> this</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">stop</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">      return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { done</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\"> false</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> value</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#41EEC6;--shiki-dark-font-style:italic\"> this</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">value</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">++</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> };</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { done</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\"> true</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> value</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\"> undefined</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> };</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">for</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> value</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> of</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> new</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> RangeIterator</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">0</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 3</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">  console</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">log</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">value</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 0, 1, 2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span></code></pre>\n<h3 id=\"方式二借用-array-的迭代器\">方式二：借用 Array 的迭代器</h3>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> iterable</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">  0</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">a</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">b</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 2</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">c</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  length</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 3</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  [</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">Symbol</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic\">iterator</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> Array</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">prototype</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">Symbol</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic\">iterator</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">}</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span></code></pre>\n<h3 id=\"方式三generator-函数\">方式三：Generator 函数</h3>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">let</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> obj</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  *</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">Symbol</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic\">iterator</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">()</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    yield</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">hello</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    yield</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">world</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">  }</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">}</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span></code></pre>\n<h3 id=\"方式四objectkeys-遍历\">方式四：Object.keys 遍历</h3>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">for</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> key</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> of</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> Object</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">keys</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">someObject</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">  console</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">log</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">key</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> +</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">: </span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> +</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> someObject</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">key</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span></code></pre>",{headings:441,localImagePaths:460,remoteImagePaths:461,frontmatter:462,imagePaths:465},[442,445,448,451,454,457],{depth:31,slug:443,text:444},"原生具备-iterator-的数据结构","原生具备 Iterator 的数据结构",{depth:31,slug:446,text:447},"让对象支持-forof","让对象支持 for…of",{depth:185,slug:449,text:450},"方式一实现-symboliterator","方式一：实现 Symbol.iterator",{depth:185,slug:452,text:453},"方式二借用-array-的迭代器","方式二：借用 Array 的迭代器",{depth:185,slug:455,text:456},"方式三generator-函数","方式三：Generator 函数",{depth:185,slug:458,text:459},"方式四objectkeys-遍历","方式四：Object.keys 遍历",[],[],{author:14,pubDatetime:463,title:432,slug:428,featured:17,draft:17,tags:464,description:434},["Date","2018-09-01T02:00:00.000Z"],[20,95],[],"js-arguments",{id:466,data:468,body:473,filePath:474,digest:475,rendered:476},{author:14,pubDatetime:469,title:470,featured:17,draft:17,tags:471,description:472},["Date","2016-05-15T02:00:00.000Z"],"function arguments 参数同步机制",[20],"arguments 与输入参数的同步关系。","```js\n!(function (a, b) {\n  arguments[0] = 11;\n  alert(a); // 11\n})(1, 2);\n\n!(function (a, b) {\n  arguments[1] = 11;\n  alert(b); // undefined\n})(1);\n```\n\n结论：`arguments` 在函数调用时与输入参数做匹配，值同步。但 `arguments` 扩展不会影响原本没有匹配的参数。","src/data/blog/js-arguments.md","363e309ff4e69837",{html:477,metadata:478},"<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">!</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">a</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> b</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">  arguments</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">0</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">] </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 11</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">  alert</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">a</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 11</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">})(</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">1</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 2</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">!</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">a</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> b</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">  arguments</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">] </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 11</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">  alert</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">b</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// undefined</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">})(</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span></code></pre>\n<p>结论：<code>arguments</code> 在函数调用时与输入参数做匹配，值同步。但 <code>arguments</code> 扩展不会影响原本没有匹配的参数。</p>",{headings:479,localImagePaths:480,remoteImagePaths:481,frontmatter:482,imagePaths:485},[],[],[],{author:14,pubDatetime:483,title:470,slug:466,featured:17,draft:17,tags:484,description:472},["Date","2016-05-15T02:00:00.000Z"],[20],[],"http-cache",{id:486,data:488,body:496,filePath:497,digest:498,rendered:499},{author:14,pubDatetime:489,title:490,featured:165,draft:17,tags:491,description:495},["Date","2019-08-23T02:00:00.000Z"],"HTTP 缓存机制详解",[492,493,494],"HTTP","浏览器","性能优化","深入理解 HTTP 强缓存与协商缓存的工作原理。","## HTTP 缓存分为强缓存与协商缓存\n\n### 强缓存\n\n强缓存表示直接使用缓存中的资源，不发请求，主要值有 Expires 和 Cache-Control。\n\n表现为请求状态码 200，size: (memory cache / disk cache)\n\n- **memory cache**：资源在内存中，读取时间几乎为 0，关闭页面时资源释放，下次打开如果再次命中强缓存就是 disk cache\n- **disk cache**：资源在磁盘中，毫秒级读取时间\n\n### 协商缓存\n\n如果未能从强缓存中读取资源，则发送请求到服务器，判断协商缓存（Last-Modified/If-Modified-Since，ETag/If-None-Match）\n\n- 协商缓存命中返回 **304**，不下载资源，使用缓存资源\n- 协商缓存未命中返回 **200**，下载资源，更新缓存\n\n### 缓存方式演进\n\n1. **无缓存** — 每次从服务器获取资源。缺点：浪费流量和时间\n\n2. **全量缓存** — 每次请求使用缓存资源。缺点：资源更新后浏览器无法感知\n\n3. **Expires** — response header 中返回 GMT 格式的过期时间。缺点：客户端时间可以任意修改\n\n4. **Cache-Control** — `Cache-Control: max-age=10`（秒），过期后重新下载资源并重置过期时间\n\n> 以上为强缓存，缺点为过期后需要重新下载资源，无论资源有没有更新\n\n5. **Last-Modified** — 第一次请求文件时返回 Last-Modified（GMT 时间），强缓存失效时，request header 带上 If-Modified-Since（等于上一次请求的 Last-Modified）\n\n6. **ETag** — 服务器为资源生成唯一标识，请求时通过 If-None-Match 比对\n\n### 总结\n\n合理使用 HTTP 缓存是前端性能优化的基础。理解强缓存和协商缓存的区别，才能在实际项目中做出正确的缓存策略。","src/data/blog/http-cache.md","89ac76b840387e55",{html:500,metadata:501},"<h2 id=\"http-缓存分为强缓存与协商缓存\">HTTP 缓存分为强缓存与协商缓存</h2>\n<h3 id=\"强缓存\">强缓存</h3>\n<p>强缓存表示直接使用缓存中的资源，不发请求，主要值有 Expires 和 Cache-Control。</p>\n<p>表现为请求状态码 200，size: (memory cache / disk cache)</p>\n<ul>\n<li><strong>memory cache</strong>：资源在内存中，读取时间几乎为 0，关闭页面时资源释放，下次打开如果再次命中强缓存就是 disk cache</li>\n<li><strong>disk cache</strong>：资源在磁盘中，毫秒级读取时间</li>\n</ul>\n<h3 id=\"协商缓存\">协商缓存</h3>\n<p>如果未能从强缓存中读取资源，则发送请求到服务器，判断协商缓存（Last-Modified/If-Modified-Since，ETag/If-None-Match）</p>\n<ul>\n<li>协商缓存命中返回 <strong>304</strong>，不下载资源，使用缓存资源</li>\n<li>协商缓存未命中返回 <strong>200</strong>，下载资源，更新缓存</li>\n</ul>\n<h3 id=\"缓存方式演进\">缓存方式演进</h3>\n<ol>\n<li>\n<p><strong>无缓存</strong> — 每次从服务器获取资源。缺点：浪费流量和时间</p>\n</li>\n<li>\n<p><strong>全量缓存</strong> — 每次请求使用缓存资源。缺点：资源更新后浏览器无法感知</p>\n</li>\n<li>\n<p><strong>Expires</strong> — response header 中返回 GMT 格式的过期时间。缺点：客户端时间可以任意修改</p>\n</li>\n<li>\n<p><strong>Cache-Control</strong> — <code>Cache-Control: max-age=10</code>（秒），过期后重新下载资源并重置过期时间</p>\n</li>\n</ol>\n<blockquote>\n<p>以上为强缓存，缺点为过期后需要重新下载资源，无论资源有没有更新</p>\n</blockquote>\n<ol start=\"5\">\n<li>\n<p><strong>Last-Modified</strong> — 第一次请求文件时返回 Last-Modified（GMT 时间），强缓存失效时，request header 带上 If-Modified-Since（等于上一次请求的 Last-Modified）</p>\n</li>\n<li>\n<p><strong>ETag</strong> — 服务器为资源生成唯一标识，请求时通过 If-None-Match 比对</p>\n</li>\n</ol>\n<h3 id=\"总结\">总结</h3>\n<p>合理使用 HTTP 缓存是前端性能优化的基础。理解强缓存和协商缓存的区别，才能在实际项目中做出正确的缓存策略。</p>",{headings:502,localImagePaths:513,remoteImagePaths:514,frontmatter:515,imagePaths:518},[503,506,508,510,512],{depth:31,slug:504,text:505},"http-缓存分为强缓存与协商缓存","HTTP 缓存分为强缓存与协商缓存",{depth:185,slug:507,text:507},"强缓存",{depth:185,slug:509,text:509},"协商缓存",{depth:185,slug:511,text:511},"缓存方式演进",{depth:185,slug:316,text:316},[],[],{author:14,pubDatetime:516,title:490,slug:486,featured:165,draft:17,tags:517,description:495},["Date","2019-08-23T02:00:00.000Z"],[492,493,494],[],"harpjs",{id:519,data:521,body:527,filePath:528,digest:529,rendered:530},{author:14,pubDatetime:522,title:523,featured:17,draft:17,tags:524,description:526},["Date","2017-01-01T02:00:00.000Z"],"Harp.js 静态网站生成器",[525],"Node.js","Harp.js 简介及使用注意事项。","[Harp.js](http://harpjs.com) 是一个静态网站生成器。\n\n坑：编译后不会建对应 URL 的目录文件，需要自己建对应文件夹及 `index.html`。","src/data/blog/harpjs.md","6adfffcb09af0b0c",{html:531,metadata:532},"<p><a href=\"http://harpjs.com\">Harp.js</a> 是一个静态网站生成器。</p>\n<p>坑：编译后不会建对应 URL 的目录文件，需要自己建对应文件夹及 <code>index.html</code>。</p>",{headings:533,localImagePaths:534,remoteImagePaths:535,frontmatter:536,imagePaths:539},[],[],[],{author:14,pubDatetime:537,title:523,slug:519,featured:17,draft:17,tags:538,description:526},["Date","2017-01-01T02:00:00.000Z"],[525],[],"js-array-methods",{id:540,data:542,body:547,filePath:548,digest:549,rendered:550},{author:14,pubDatetime:543,title:544,featured:17,draft:17,tags:545,description:546},["Date","2015-09-15T02:00:00.000Z"],"JS Array 方法大全",[20],"详解 JS 数组的所有方法，哪些会改变原数组，哪些不会。","## 栈、队列方法（改变原数组）\n\n```js\n// a = [1,2,3,4]\na.push(5, 6); // a: [1,2,3,4,5,6], 返回 6 (length)\na.pop(); // a: [1,2,3], 返回 4\na.unshift(5, 6); // a: [5,6,1,2,3,4], 返回 6\na.shift(); // a: [2,3,4], 返回 1\n```\n\n## 操作方法\n\n```js\na.concat([5]); // 不改变原数组，返回 [4,3,2,1,5]\na.slice(1); // 不改变原数组\na.splice(0, 1); // 改变原数组，删除操作\na.splice(1, 0, \"a\"); // 插入操作\na.splice(1, 1, \"a\", \"b\"); // 替换操作\n```\n\n## 迭代方法（IE9+）\n\n- `forEach` — 无返回值，相当于 for 循环\n- `every` — 每一项都返回 true，则返回 true\n- `some` — 任一项返回 true，则返回 true\n- `filter` — 返回函数返回 true 的项组成的数组\n- `map` — 返回每次函数调用返回值组成的数组\n\n## 归并方法\n\n```js\na = [1, 2, 3, 4];\na.reduce(function (prev, cur) {\n  return prev + cur;\n}, 5); // 15\n```\n\n**总结**：会改变原数组的方法：`pop, push, shift, unshift, splice, reverse, sort`","src/data/blog/js-array-methods.md","3446cae2a68881f0",{html:551,metadata:552},"<h2 id=\"栈队列方法改变原数组\">栈、队列方法（改变原数组）</h2>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// a = [1,2,3,4]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">a</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">push</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">5</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 6</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// a: [1,2,3,4,5,6], 返回 6 (length)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">a</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">pop</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// a: [1,2,3], 返回 4</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">a</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">unshift</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">5</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 6</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// a: [5,6,1,2,3,4], 返回 6</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">a</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">shift</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// a: [2,3,4], 返回 1</span></span></code></pre>\n<h2 id=\"操作方法\">操作方法</h2>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">a</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">concat</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">([</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">5</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 不改变原数组，返回 [4,3,2,1,5]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">a</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">slice</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 不改变原数组</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">a</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">splice</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">0</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 改变原数组，删除操作</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">a</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">splice</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">1</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 0</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">a</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 插入操作</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">a</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">splice</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">1</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">a</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">b</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 替换操作</span></span></code></pre>\n<h2 id=\"迭代方法ie9\">迭代方法（IE9+）</h2>\n<ul>\n<li><code>forEach</code> — 无返回值，相当于 for 循环</li>\n<li><code>every</code> — 每一项都返回 true，则返回 true</li>\n<li><code>some</code> — 任一项返回 true，则返回 true</li>\n<li><code>filter</code> — 返回函数返回 true 的项组成的数组</li>\n<li><code>map</code> — 返回每次函数调用返回值组成的数组</li>\n</ul>\n<h2 id=\"归并方法\">归并方法</h2>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">a</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">1</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 2</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 3</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 4</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">];</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">a</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">reduce</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">prev</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> cur</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> prev</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> +</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> cur</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 5</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 15</span></span></code></pre>\n<p><strong>总结</strong>：会改变原数组的方法：<code>pop, push, shift, unshift, splice, reverse, sort</code></p>",{headings:553,localImagePaths:564,remoteImagePaths:565,frontmatter:566,imagePaths:569},[554,557,559,562],{depth:31,slug:555,text:556},"栈队列方法改变原数组","栈、队列方法（改变原数组）",{depth:31,slug:558,text:558},"操作方法",{depth:31,slug:560,text:561},"迭代方法ie9","迭代方法（IE9+）",{depth:31,slug:563,text:563},"归并方法",[],[],{author:14,pubDatetime:567,title:544,slug:540,featured:17,draft:17,tags:568,description:546},["Date","2015-09-15T02:00:00.000Z"],[20],[],"js-chain-add",{id:570,data:572,body:577,filePath:578,digest:579,rendered:580},{author:14,pubDatetime:573,title:574,featured:17,draft:17,tags:575,description:576},["Date","2016-04-15T02:00:00.000Z"],"实现链式函数 add",[20],"利用 valueOf 实现 add(1)(2)(3) == 6 的链式调用。","要求：\n\n```js\nadd(1) == 1;\nadd(1)(2) == 3;\nadd(1)(2)(3) == 6;\n```\n\n`add(1)` 必须返回函数才能链式调用，而函数做比较时会调用 `valueOf()`：\n\n```js\nfunction add(n) {\n  var fn = function (x) {\n    return add(n + x);\n  };\n  fn.valueOf = function () {\n    return n;\n  };\n  return fn;\n}\n```","src/data/blog/js-chain-add.md","993bd4cc3f090dd2",{html:581,metadata:582},"<p>要求：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">add</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">==</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">add</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)(</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">2</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">==</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 3</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">add</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)(</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">2</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)(</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">3</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">==</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 6</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span></code></pre>\n<p><code>add(1)</code> 必须返回函数才能链式调用，而函数做比较时会调用 <code>valueOf()</code>：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> add</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">n</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  var</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> fn</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> function</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D7DBE0;--shiki-dark-font-style:italic\">x</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> add</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">n</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> +</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> x</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">  }</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">  fn</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">valueOf</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> function</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> ()</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> n</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  };</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> fn</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span></code></pre>",{headings:583,localImagePaths:584,remoteImagePaths:585,frontmatter:586,imagePaths:589},[],[],[],{author:14,pubDatetime:587,title:574,slug:570,featured:17,draft:17,tags:588,description:576},["Date","2016-04-15T02:00:00.000Z"],[20],[],"hello-world",{id:590,data:592,body:598,filePath:599,digest:600,rendered:601},{author:14,pubDatetime:593,title:594,featured:165,draft:17,tags:595,description:597},["Date","2026-02-11T05:00:00.000Z"],"Hello World - 博客新生",[596],"随笔","博客从 React 迁移到 Astro，记录这次重生之旅。","## 你好，新世界\n\n这是我的技术博客的全新开始。\n\n2015 年用 React + Webpack 搭了第一版博客，写了不少技术笔记。从 ES6 Generator 到 PWA，从 Webpack 4 到各种前端概念，那个项目跟了我很多年。\n\n现在换个新的。\n\n## 为什么选择 Astro\n\n选 [Astro](https://astro.build/) 的理由：\n\n1. 博客不需要客户端 JS 运行时，纯静态 HTML 加载快\n2. 写文章就是写 `.md` 文件\n3. TypeScript、Tailwind CSS、自动 OG 图片生成都有\n4. 默认零 JS，需要交互的地方再加\n\n比原来的 React + Webpack 方案，页面体积小了一个数量级。首屏加载快了很多，肉眼可感的那种。\n\n## 关于我\n\n我是陈广亮，前端工程师。这个博客主要写：\n\n- JavaScript / TypeScript\n- 前端工程化\n- Web 性能优化\n- 新技术学习笔记\n- 偶尔写写 Go 和后端的东西\n\n## 旧文迁移\n\n之前博客里的一些文章会慢慢搬过来，ES6 Generator、HTTP 缓存、Webpack 4 升级这些。\n\n就这样，开写。👋","src/data/blog/hello-world.md","8a1ed9011c3fad9a",{html:602,metadata:603},"<h2 id=\"你好新世界\">你好，新世界</h2>\n<p>这是我的技术博客的全新开始。</p>\n<p>2015 年用 React + Webpack 搭了第一版博客，写了不少技术笔记。从 ES6 Generator 到 PWA，从 Webpack 4 到各种前端概念，那个项目跟了我很多年。</p>\n<p>现在换个新的。</p>\n<h2 id=\"为什么选择-astro\">为什么选择 Astro</h2>\n<p>选 <a href=\"https://astro.build/\">Astro</a> 的理由：</p>\n<ol>\n<li>博客不需要客户端 JS 运行时，纯静态 HTML 加载快</li>\n<li>写文章就是写 <code>.md</code> 文件</li>\n<li>TypeScript、Tailwind CSS、自动 OG 图片生成都有</li>\n<li>默认零 JS，需要交互的地方再加</li>\n</ol>\n<p>比原来的 React + Webpack 方案，页面体积小了一个数量级。首屏加载快了很多，肉眼可感的那种。</p>\n<h2 id=\"关于我\">关于我</h2>\n<p>我是陈广亮，前端工程师。这个博客主要写：</p>\n<ul>\n<li>JavaScript / TypeScript</li>\n<li>前端工程化</li>\n<li>Web 性能优化</li>\n<li>新技术学习笔记</li>\n<li>偶尔写写 Go 和后端的东西</li>\n</ul>\n<h2 id=\"旧文迁移\">旧文迁移</h2>\n<p>之前博客里的一些文章会慢慢搬过来，ES6 Generator、HTTP 缓存、Webpack 4 升级这些。</p>\n<p>就这样，开写。👋</p>",{headings:604,localImagePaths:615,remoteImagePaths:616,frontmatter:617,imagePaths:620},[605,608,611,613],{depth:31,slug:606,text:607},"你好新世界","你好，新世界",{depth:31,slug:609,text:610},"为什么选择-astro","为什么选择 Astro",{depth:31,slug:612,text:612},"关于我",{depth:31,slug:614,text:614},"旧文迁移",[],[],{author:14,pubDatetime:618,title:594,slug:590,featured:165,draft:17,tags:619,description:597},["Date","2026-02-11T05:00:00.000Z"],[596],[],"js-constructor-return",{id:621,data:623,body:628,filePath:629,digest:630,rendered:631},{author:14,pubDatetime:624,title:625,featured:17,draft:17,tags:626,description:627},["Date","2015-10-15T02:00:00.000Z"],"JS 函数返回值与 new 操作符",[20],"构造函数返回值对 new 操作符创建实例的影响。","## new 操作符的步骤\n\n1. 创建一个新对象\n2. 将构造函数的作用域赋给新对象\n3. 执行构造函数中的代码\n4. 返回新对象\n\n## 返回值的影响\n\n如果返回值是原始类型（String/Boolean/Number/Null/Undefined），**不影响** new 的结果：\n\n```js\nfunction T() {\n  this.a = 1;\n  return 1; // 不影响\n}\nnew T(); // T {a: 1}\n```\n\n如果返回值是引用类型（Object/Array/Date/RegExp/Function），new 返回的就是该返回值：\n\n```js\nfunction T() {\n  this.a = 1;\n  return new Date();\n}\nnew T(); // Date 对象，不是 T 的实例\n```\n\n**特别注意**：`new Boolean(true)`、`new Number(1)`、`new String(\"a\")` 也是对象！\n\n```js\nfunction T() {\n  this.a = 1;\n  return new Boolean(true);\n}\nnew T(); // Boolean {true}，不是 T 的实例\n```","src/data/blog/js-constructor-return.md","d2b7c4f2d56299ad",{html:632,metadata:633},"<h2 id=\"new-操作符的步骤\">new 操作符的步骤</h2>\n<ol>\n<li>创建一个新对象</li>\n<li>将构造函数的作用域赋给新对象</li>\n<li>执行构造函数中的代码</li>\n<li>返回新对象</li>\n</ol>\n<h2 id=\"返回值的影响\">返回值的影响</h2>\n<p>如果返回值是原始类型（String/Boolean/Number/Null/Undefined），<strong>不影响</strong> new 的结果：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> T</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">()</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#41EEC6;--shiki-dark-font-style:italic\">  this</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">a</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  return</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 不影响</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">new</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> T</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// T {a: 1}</span></span></code></pre>\n<p>如果返回值是引用类型（Object/Array/Date/RegExp/Function），new 返回的就是该返回值：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> T</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">()</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#41EEC6;--shiki-dark-font-style:italic\">  this</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">a</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  return</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> new</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> Date</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">new</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> T</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// Date 对象，不是 T 的实例</span></span></code></pre>\n<p><strong>特别注意</strong>：<code>new Boolean(true)</code>、<code>new Number(1)</code>、<code>new String(\"a\")</code> 也是对象！</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> T</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">()</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#41EEC6;--shiki-dark-font-style:italic\">  this</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">a</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  return</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> new</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> Boolean</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\">true</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">new</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> T</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// Boolean {true}，不是 T 的实例</span></span></code></pre>",{headings:634,localImagePaths:640,remoteImagePaths:641,frontmatter:642,imagePaths:645},[635,638],{depth:31,slug:636,text:637},"new-操作符的步骤","new 操作符的步骤",{depth:31,slug:639,text:639},"返回值的影响",[],[],{author:14,pubDatetime:643,title:625,slug:621,featured:17,draft:17,tags:644,description:627},["Date","2015-10-15T02:00:00.000Z"],[20],[],"js-equality-operators",{id:646,data:648,body:653,filePath:654,digest:655,rendered:656},{author:14,pubDatetime:649,title:650,featured:17,draft:17,tags:651,description:652},["Date","2015-08-01T02:00:00.000Z"],"JS 运算符 == 与 ===",[20],"深入理解 JS 中 == 和 === 的区别与类型转换规则。","## `==` 运算符规则\n\n1. 如果有一个操作数是布尔值，则先转换为数值：`false → 0, true → 1`\n2. 如果一个操作数为字符串，另一个为数值，则将字符串用 `Number()` 转换\n3. 如果一个操作数是对象，另一个不是，则调用对象的 `valueOf()` 方法\n\n```js\ntrue == 1; // true\n\"1\" == 1; // true (Number(\"1\") == 1)\n\"1a\" == 1; // false (Number(\"1a\") → NaN)\n```\n\n## 特殊规则\n\n1. `null == undefined` → `true`\n2. `null` 和 `undefined` 比较前不转换\n3. 如果有一个操作数是 `NaN` 则恒返回 `false`\n4. 如果两个操作数都是对象，则比较是否是同一个引用\n\n```js\nnew Boolean(true) == true; // true (调用 valueOf)\nnew Boolean(true) == new Boolean(true); // false (不同对象)\n```\n\n## `===`\n\n不进行类型转换，直接比较值和类型。","src/data/blog/js-equality-operators.md","01dcb70356e02609",{html:657,metadata:658},"<h2 id=\"-运算符规则\"><code>==</code> 运算符规则</h2>\n<ol>\n<li>如果有一个操作数是布尔值，则先转换为数值：<code>false → 0, true → 1</code></li>\n<li>如果一个操作数为字符串，另一个为数值，则将字符串用 <code>Number()</code> 转换</li>\n<li>如果一个操作数是对象，另一个不是，则调用对象的 <code>valueOf()</code> 方法</li>\n</ol>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\">true</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ==</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// true</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">1</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ==</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// true (Number(\"1\") == 1)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">1a</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ==</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// false (Number(\"1a\") → NaN)</span></span></code></pre>\n<h2 id=\"特殊规则\">特殊规则</h2>\n<ol>\n<li><code>null == undefined</code> → <code>true</code></li>\n<li><code>null</code> 和 <code>undefined</code> 比较前不转换</li>\n<li>如果有一个操作数是 <code>NaN</code> 则恒返回 <code>false</code></li>\n<li>如果两个操作数都是对象，则比较是否是同一个引用</li>\n</ol>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">new</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> Boolean</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\">true</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">==</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\"> true</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// true (调用 valueOf)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">new</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> Boolean</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\">true</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">==</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> new</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> Boolean</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\">true</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// false (不同对象)</span></span></code></pre>\n<h2 id=\"\"><code>===</code></h2>\n<p>不进行类型转换，直接比较值和类型。</p>",{headings:659,localImagePaths:668,remoteImagePaths:669,frontmatter:670,imagePaths:673},[660,663,665],{depth:31,slug:661,text:662},"-运算符规则","== 运算符规则",{depth:31,slug:664,text:664},"特殊规则",{depth:31,slug:666,text:667},"","===",[],[],{author:14,pubDatetime:671,title:650,slug:646,featured:17,draft:17,tags:672,description:652},["Date","2015-08-01T02:00:00.000Z"],[20],[],"js-for-loop-trick",{id:674,data:676,body:681,filePath:682,digest:683,rendered:684},{author:14,pubDatetime:677,title:678,featured:17,draft:17,tags:679,description:680},["Date","2015-11-15T02:00:00.000Z"],"一个有趣的 for 循环用法",[20],"Object.keys polyfill 中的 for 循环妙用。","`Object.keys` 用来获取对象所有可枚举属性，兼容 IE8-：\n\n```js\nObject.keys =\n  Object.keys ||\n  function (obj) {\n    var a = [];\n    for (a[a.length] in obj);\n    return a;\n  };\n```\n\n`for (a[a.length] in obj)` — 每次迭代时，将属性名赋给 `a[a.length]`，自动追加到数组末尾。\n\n另外，`Object.getOwnPropertyNames(obj)` 可获取所有实例属性（无论是否可枚举）：\n\n```js\nArray.test = function () {};\nObject.keys(Array); // [\"test\"]\nObject.getOwnPropertyNames(Array); // [\"length\", \"name\", ..., \"test\"]\n```","src/data/blog/js-for-loop-trick.md","702b41c18969ecb2",{html:685,metadata:686},"<p><code>Object.keys</code> 用来获取对象所有可枚举属性，兼容 IE8-：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">Object</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">keys</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">  Object</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">keys</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ||</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  function</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">obj</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> a</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [];</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    for</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">a</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">a</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#7FDBCA\">length</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">] </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">in</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> obj</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> a</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  };</span></span></code></pre>\n<p><code>for (a[a.length] in obj)</code> — 每次迭代时，将属性名赋给 <code>a[a.length]</code>，自动追加到数组末尾。</p>\n<p>另外，<code>Object.getOwnPropertyNames(obj)</code> 可获取所有实例属性（无论是否可枚举）：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">Array</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">test</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> function</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> ()</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {};</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">Object</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">keys</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">Array</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// [\"test\"]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">Object</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">getOwnPropertyNames</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">Array</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// [\"length\", \"name\", ..., \"test\"]</span></span></code></pre>",{headings:687,localImagePaths:688,remoteImagePaths:689,frontmatter:690,imagePaths:693},[],[],[],{author:14,pubDatetime:691,title:678,slug:674,featured:17,draft:17,tags:692,description:680},["Date","2015-11-15T02:00:00.000Z"],[20],[],"js-hoisting",{id:694,data:696,body:701,filePath:702,digest:703,rendered:704},{author:14,pubDatetime:697,title:698,featured:17,draft:17,tags:699,description:700},["Date","2016-07-01T02:00:00.000Z"],"深入理解函数声明提升与变量声明提升",[20],"通过两个例子深入理解 JS 的声明提升机制。","```js\nvar foo = 1;\n(function () {\n  console.log(foo); // undefined（变量提升）\n  var foo = 2;\n})();\n```\n\n```js\nvar a = 1;\nfunction b() {\n  a = 10;\n  return;\n  function a() {} // 函数声明提升，a 变成局部变量\n}\nb();\nalert(a); // 1\n```\n\n第二个例子中，`function a() {}` 被提升到 `b()` 内部顶部，所以 `a = 10` 修改的是局部的 `a`，而非全局的。","src/data/blog/js-hoisting.md","3795bb35c4a720ed",{html:705,metadata:706},"<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> foo</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> ()</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">  console</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">log</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">foo</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// undefined（变量提升）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> foo</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 2</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">})();</span></span></code></pre>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> a</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> b</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">()</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">  a</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 10</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  function</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> a</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">()</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {} </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 函数声明提升，a 变成局部变量</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">b</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">alert</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">a</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 1</span></span></code></pre>\n<p>第二个例子中，<code>function a() {}</code> 被提升到 <code>b()</code> 内部顶部，所以 <code>a = 10</code> 修改的是局部的 <code>a</code>，而非全局的。</p>",{headings:707,localImagePaths:708,remoteImagePaths:709,frontmatter:710,imagePaths:713},[],[],[],{author:14,pubDatetime:711,title:698,slug:694,featured:17,draft:17,tags:712,description:700},["Date","2016-07-01T02:00:00.000Z"],[20],[],"js-dedup-string",{id:714,data:716,body:722,filePath:723,digest:724,rendered:725},{author:14,pubDatetime:717,title:718,featured:17,draft:17,tags:719,description:721},["Date","2015-08-15T02:00:00.000Z"],"JS 字符串去重的三种方法",[20,720],"算法","使用正则、hash、数组三种方式去除字符串中的重复单词。","去除以空格分割的字符串重复部分。\n\n## 方法一：正则去重\n\n```js\nfunction removeRepeat(str) {\n  return str\n    .replace(/(^|\\s)(\\S+)(?=\\s(?:\\S+\\s)*\\2(?:\\s|$))/g, \"\")\n    .trim();\n}\nremoveRepeat(\"a b c a b e\"); // \"c a b e\"\n```\n\n## 方法二：hash 去重\n\n```js\nfunction removeRepeat(str) {\n  var obj = {}, set = \"\";\n  str.replace(/\\S+/g, function (w) {\n    if (!obj[w]) {\n      set += w + \" \";\n      obj[w] = 1;\n    }\n  });\n  return set.trim();\n}\nremoveRepeat(\"a b c a b e\"); // \"a b c e\"\n```\n\n## 方法三：数组去重\n\n```js\nfunction removeRepeat(str) {\n  var a = str.split(/\\s+/g);\n  a.sort();\n  for (var i = a.length - 1; i > 0; --i) {\n    if (a[i] == a[i - 1]) a.splice(i, 1);\n  }\n  return a.join(\" \");\n}\n```","src/data/blog/js-dedup-string.md","4f62888514b7484c",{html:726,metadata:727},"<p>去除以空格分割的字符串重复部分。</p>\n<h2 id=\"方法一正则去重\">方法一：正则去重</h2>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> removeRepeat</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">str</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> str</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    .</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">replace</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#22863A;--shiki-dark:#5CA7E4\">(</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">^</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">|</span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">\\s</span><span style=\"--shiki-light:#22863A;--shiki-dark:#5CA7E4\">)(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">\\S</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">+</span><span style=\"--shiki-light:#22863A;--shiki-dark:#5CA7E4\">)(?=</span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">\\s</span><span style=\"--shiki-light:#22863A;--shiki-dark:#5CA7E4\">(?:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">\\S</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">+</span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">\\s</span><span style=\"--shiki-light:#22863A;--shiki-dark:#5CA7E4\">)</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">*</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#5CA7E4\">\\2</span><span style=\"--shiki-light:#22863A;--shiki-dark:#5CA7E4\">(?:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">\\s</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">|</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">$</span><span style=\"--shiki-light:#22863A;--shiki-dark:#5CA7E4\">))</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#5CA7E4\">g</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    .</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">trim</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">removeRepeat</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">a b c a b e</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// \"c a b e\"</span></span></code></pre>\n<h2 id=\"方法二hash-去重\">方法二：hash 去重</h2>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> removeRepeat</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">str</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> obj</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {}</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> set</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">  str</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">replace</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">\\S</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">+</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#5CA7E4\">g</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> function</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">w</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">!</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">obj</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">w</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">      set</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> +=</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> w</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> +</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">      obj</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">w</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">] </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  });</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  return</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> set</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">trim</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">removeRepeat</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">a b c a b e</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// \"a b c e\"</span></span></code></pre>\n<h2 id=\"方法三数组去重\">方法三：数组去重</h2>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> removeRepeat</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">str</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> a</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> str</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">split</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">\\s</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">+</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#5CA7E4\">g</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">  a</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">sort</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  for</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> i</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> a</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">length</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> -</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; </span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">i</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ></span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 0</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">--</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">i</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">a</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">i</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">] </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">==</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> a</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">i</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> -</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]) </span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">a</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">splice</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">i</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  return</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> a</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">join</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span></code></pre>",{headings:728,localImagePaths:738,remoteImagePaths:739,frontmatter:740,imagePaths:743},[729,732,735],{depth:31,slug:730,text:731},"方法一正则去重","方法一：正则去重",{depth:31,slug:733,text:734},"方法二hash-去重","方法二：hash 去重",{depth:31,slug:736,text:737},"方法三数组去重","方法三：数组去重",[],[],{author:14,pubDatetime:741,title:718,slug:714,featured:17,draft:17,tags:742,description:721},["Date","2015-08-15T02:00:00.000Z"],[20,720],[],"js-module-systems",{id:744,data:746,body:751,filePath:752,digest:753,rendered:754},{author:14,pubDatetime:747,title:748,featured:17,draft:17,tags:749,description:750},["Date","2018-09-15T02:00:00.000Z"],"JS 模块规范：CommonJS、AMD、CMD、ES Module",[20,280],"浅析 CommonJS、AMD、CMD、ES6 Module 的区别。","## CommonJS（Node.js）\n- 同步加载，适合服务器端\n- 输出的是值的**拷贝**\n\n## AMD（RequireJS）\n- 异步加载，初始定义所有依赖模块\n\n## CMD（SeaJS）\n- 依赖就近，用的时候再 require\n- AMD 和 CMD 最大区别是对依赖模块的**执行时机**不同\n\n## ES6 Module\n- 输出的是值的**引用**，编译时输出接口\n- 静态分析，支持 Tree Shaking\n\n```js\nconst foo = 10;\nexport { foo as default }; // foo 更新会影响 default\nexport default foo; // foo 更新不影响 default\n```","src/data/blog/js-module-systems.md","44d39e14afc65148",{html:755,metadata:756},"<h2 id=\"commonjsnodejs\">CommonJS（Node.js）</h2>\n<ul>\n<li>同步加载，适合服务器端</li>\n<li>输出的是值的<strong>拷贝</strong></li>\n</ul>\n<h2 id=\"amdrequirejs\">AMD（RequireJS）</h2>\n<ul>\n<li>异步加载，初始定义所有依赖模块</li>\n</ul>\n<h2 id=\"cmdseajs\">CMD（SeaJS）</h2>\n<ul>\n<li>依赖就近，用的时候再 require</li>\n<li>AMD 和 CMD 最大区别是对依赖模块的<strong>执行时机</strong>不同</li>\n</ul>\n<h2 id=\"es6-module\">ES6 Module</h2>\n<ul>\n<li>输出的是值的<strong>引用</strong>，编译时输出接口</li>\n<li>静态分析，支持 Tree Shaking</li>\n</ul>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> foo</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 10</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">export</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { </span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">foo</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> as</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> default</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> }; </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// foo 更新会影响 default</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">export</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> default</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> foo</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// foo 更新不影响 default</span></span></code></pre>",{headings:757,localImagePaths:770,remoteImagePaths:771,frontmatter:772,imagePaths:775},[758,761,764,767],{depth:31,slug:759,text:760},"commonjsnodejs","CommonJS（Node.js）",{depth:31,slug:762,text:763},"amdrequirejs","AMD（RequireJS）",{depth:31,slug:765,text:766},"cmdseajs","CMD（SeaJS）",{depth:31,slug:768,text:769},"es6-module","ES6 Module",[],[],{author:14,pubDatetime:773,title:748,slug:744,featured:17,draft:17,tags:774,description:750},["Date","2018-09-15T02:00:00.000Z"],[20,280],[],"js-once",{id:776,data:778,body:783,filePath:784,digest:785,rendered:786},{author:14,pubDatetime:779,title:780,featured:17,draft:17,tags:781,description:782},["Date","2015-05-10T02:00:00.000Z"],"实现 once 函数",[20],"用闭包实现只能调用一次的函数。","写一个函数，可以生成只能调用一次的函数——一个简单的闭包应用。\n\n```js\nlogOnce = once(console.log);\nlogOnce(\"foo\"); // -> \"foo\"\nlogOnce(\"bar\"); // -> no effect\n```\n\n实现：\n\n```js\nfunction once(fn) {\n  var flag = true;\n  return function () {\n    if (flag) {\n      flag = false;\n      return fn.apply(this, arguments);\n    }\n    return;\n  };\n}\n```","src/data/blog/js-once.md","92e76e954051d4b3",{html:787,metadata:788},"<p>写一个函数，可以生成只能调用一次的函数——一个简单的闭包应用。</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">logOnce</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> once</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">console</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">log</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">logOnce</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">foo</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// -> \"foo\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">logOnce</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">bar</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// -> no effect</span></span></code></pre>\n<p>实现：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> once</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">fn</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> flag</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FF5874;--shiki-dark-font-style:italic\"> true</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  return</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> function</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> ()</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">flag</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">      flag</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\"> false</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">      return</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> fn</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">apply</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#41EEC6;--shiki-dark-font-style:italic\">this</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> arguments</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  };</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span></code></pre>",{headings:789,localImagePaths:790,remoteImagePaths:791,frontmatter:792,imagePaths:795},[],[],[],{author:14,pubDatetime:793,title:780,slug:776,featured:17,draft:17,tags:794,description:782},["Date","2015-05-10T02:00:00.000Z"],[20],[],"js-named-function-expression",{id:796,data:798,body:803,filePath:804,digest:805,rendered:806},{author:14,pubDatetime:799,title:800,featured:17,draft:17,tags:801,description:802},["Date","2016-08-01T02:00:00.000Z"],"JS 具名函数与匿名函数的差异",[20],"具名函数表达式与函数声明在作用域中的不同行为。","```js\n// 具名函数表达式：A 在内部是只读的\n(function A() {\n  console.log(A); // [Function A]\n  A = 1;\n  console.log(window.A); // undefined\n  console.log(A); // [Function A]  （赋值无效）\n})();\n\n// 函数声明\nfunction A() {\n  console.log(A); // [Function A]\n  A = 1;\n  console.log(window.A); // 1\n  console.log(A); // 1\n}\nA();\n```","src/data/blog/js-named-function-expression.md","e0a7166a6ff97cfb",{html:807,metadata:808},"<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 具名函数表达式：A 在内部是只读的</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> A</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">()</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">  console</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">log</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\">A</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// [Function A]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\">  A</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">  console</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">log</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">window</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\">A</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// undefined</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">  console</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">log</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\">A</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// [Function A]  （赋值无效）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">})();</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 函数声明</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> A</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">()</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">  console</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">log</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\">A</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// [Function A]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\">  A</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">  console</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">log</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">window</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\">A</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">  console</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">log</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\">A</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">A</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();</span></span></code></pre>",{headings:809,localImagePaths:810,remoteImagePaths:811,frontmatter:812,imagePaths:815},[],[],[],{author:14,pubDatetime:813,title:800,slug:796,featured:17,draft:17,tags:814,description:802},["Date","2016-08-01T02:00:00.000Z"],[20],[],"js-power-set",{id:816,data:818,body:823,filePath:824,digest:825,rendered:826},{author:14,pubDatetime:819,title:820,featured:17,draft:17,tags:821,description:822},["Date","2015-03-10T02:00:00.000Z"],"JS 实现排列组合数组",[20,720],"使用 reduce 实现数组的排列组合（幂集）","首先介绍个网站 [codewars](http://www.codewars.com/r/eVdvRA) 一个编码社区，做题升级跟玩游戏一样，在获得乐趣的同时还能得到很大的提升。\n\n题目：写一个方法输出所有的可能的子数组，就是排列组合了\n\n```js\npower([1, 2, 3]); // => [[], [1], [2], [1, 2], [3], [1, 3], [2, 3], [1, 2, 3]]\n```\n\n大神的代码：\n\n```js\nfunction power(s) {\n  return s.reduce(function (p, e) {\n    return p.concat(\n      p.map(function (sub) {\n        return sub.concat([e]);\n      })\n    );\n  }, [[]]);\n}\n```\n\n每次循环取源数组一个数，对结果数组（初始化 `[[]]`）的每个子项做 concat，并添加到结果数组中：\n\n```\n[[]]\n[[], [1]]\n[[], [1], [2], [1,2]]\n[[], [1], [2], [1,2], [3], [1,3], [2,3], [1,2,3]]\n```","src/data/blog/js-power-set.md","cf767bccaf5a2dd7",{html:827,metadata:828},"<p>首先介绍个网站 <a href=\"http://www.codewars.com/r/eVdvRA\">codewars</a> 一个编码社区，做题升级跟玩游戏一样，在获得乐趣的同时还能得到很大的提升。</p>\n<p>题目：写一个方法输出所有的可能的子数组，就是排列组合了</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">power</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">([</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">1</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 2</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 3</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// => [[], [1], [2], [1, 2], [3], [1, 3], [2, 3], [1, 2, 3]]</span></span></code></pre>\n<p>大神的代码：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> power</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">s</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  return</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> s</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">reduce</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">p</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> e</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> p</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">concat</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">      p</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">map</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">sub</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        return</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> sub</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">concat</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">([</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">e</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      })</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    );</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [[]]);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span></code></pre>\n<p>每次循环取源数组一个数，对结果数组（初始化 <code>[[]]</code>）的每个子项做 concat，并添加到结果数组中：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"plaintext\"><code><span class=\"line\"><span>[[]]</span></span>\n<span class=\"line\"><span>[[], [1]]</span></span>\n<span class=\"line\"><span>[[], [1], [2], [1,2]]</span></span>\n<span class=\"line\"><span>[[], [1], [2], [1,2], [3], [1,3], [2,3], [1,2,3]]</span></span></code></pre>",{headings:829,localImagePaths:830,remoteImagePaths:831,frontmatter:832,imagePaths:835},[],[],[],{author:14,pubDatetime:833,title:820,slug:816,featured:17,draft:17,tags:834,description:822},["Date","2015-03-10T02:00:00.000Z"],[20,720],[],"js-memoization",{id:836,data:838,body:843,filePath:844,digest:845,rendered:846},{author:14,pubDatetime:839,title:840,featured:17,draft:17,tags:841,description:842},["Date","2015-11-01T02:00:00.000Z"],"JS 性能优化：记忆（memoization）",[20,494],"函数记忆化技术，避免重复运算提升性能。","函数可以将先前操作的结果记录在某个对象里，从而避免无谓的重复运算。\n\n## 普通阶乘\n\n```js\nfunction factorial(n) {\n  if (n == 0) return 1;\n  return n * factorial(n - 1);\n}\n\nfor (var i = 0; i < 10; i++) {\n  factorial(i); // 共运行 55 次\n}\n```\n\n## 带记忆的阶乘\n\n```js\nvar factorial = (function () {\n  var cache = [1];\n  var fac = function (n) {\n    if (!cache.hasOwnProperty(n)) {\n      cache[n] = n * fac(n - 1);\n    }\n    return cache[n];\n  };\n  return fac;\n})();\n// 共运行 19 次，直接调用 10 次 + 自调用 9 次\n```\n\n## 通用 memoizer\n\n```js\nvar memoizer = function (cache, fn) {\n  cache = cache || [];\n  var recur = function (n) {\n    if (!cache.hasOwnProperty(n)) {\n      cache[n] = fn(recur, n);\n    }\n    return cache[n];\n  };\n  return recur;\n};\n\n// 阶乘\nvar factorial = memoizer([1, 1], function (recur, n) {\n  return n * recur(n - 1);\n});\n\n// 斐波那契\nvar fibonacci = memoizer([0, 1], function (recur, n) {\n  return recur(n - 1) + recur(n - 2);\n});\n```","src/data/blog/js-memoization.md","33c2dc059c58f270",{html:847,metadata:848},"<p>函数可以将先前操作的结果记录在某个对象里，从而避免无谓的重复运算。</p>\n<h2 id=\"普通阶乘\">普通阶乘</h2>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> factorial</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">n</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">n</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ==</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 0</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">return</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> n</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> *</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> factorial</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">n</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> -</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">for</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> i</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 0</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; </span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">i</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> &#x3C;</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 10</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; </span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">i</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">++</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">  factorial</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">i</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 共运行 55 次</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span></code></pre>\n<h2 id=\"带记忆的阶乘\">带记忆的阶乘</h2>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> factorial</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> ()</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> cache</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  var</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> fac</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> function</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D7DBE0;--shiki-dark-font-style:italic\">n</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">!</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">cache</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">hasOwnProperty</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">n</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">))</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">      cache</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">n</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> n</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> *</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> fac</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">n</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> -</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">    }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> cache</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">n</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">  };</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> fac</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">}</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 共运行 19 次，直接调用 10 次 + 自调用 9 次</span></span></code></pre>\n<h2 id=\"通用-memoizer\">通用 memoizer</h2>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">var</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> memoizer</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> function</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D7DBE0;--shiki-dark-font-style:italic\">cache</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D7DBE0;--shiki-dark-font-style:italic\"> fn</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">  cache</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> cache</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ||</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> []</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  var</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> recur</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> function</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D7DBE0;--shiki-dark-font-style:italic\">n</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">!</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">cache</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">hasOwnProperty</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">n</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">))</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">      cache</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">n</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> fn</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">recur</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> n</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">    }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> cache</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">n</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">  };</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> recur</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">}</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 阶乘</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> factorial</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> memoizer</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">([</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">1</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> function</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D7DBE0;--shiki-dark-font-style:italic\">recur</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D7DBE0;--shiki-dark-font-style:italic\"> n</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> n</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> *</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> recur</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">n</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> -</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">}</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 斐波那契</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> fibonacci</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> memoizer</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">([</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">0</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> function</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D7DBE0;--shiki-dark-font-style:italic\">recur</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D7DBE0;--shiki-dark-font-style:italic\"> n</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  return</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> recur</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">n</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> -</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> +</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> recur</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">n</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> -</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 2</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">}</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span></code></pre>",{headings:849,localImagePaths:857,remoteImagePaths:858,frontmatter:859,imagePaths:862},[850,852,854],{depth:31,slug:851,text:851},"普通阶乘",{depth:31,slug:853,text:853},"带记忆的阶乘",{depth:31,slug:855,text:856},"通用-memoizer","通用 memoizer",[],[],{author:14,pubDatetime:860,title:840,slug:836,featured:17,draft:17,tags:861,description:842},["Date","2015-11-01T02:00:00.000Z"],[20,494],[],"js-repeat",{id:863,data:865,body:870,filePath:871,digest:872,rendered:873},{author:14,pubDatetime:866,title:867,featured:17,draft:17,tags:868,description:869},["Date","2015-03-15T02:00:00.000Z"],"JS repeat 方法的演变历史",[20],"字符串重复方法的多种实现，从 join 到二分法递归。","repeat 方法：将一个字符串重复自身 N 次，如 `repeat(\"ruby\", 2)` 得到 `rubyruby`。\n\n## 版本1：利用空数组 join\n\n```js\nfunction repeat(target, n) {\n  return new Array(n + 1).join(target);\n}\n```\n\n## 版本2：类数组对象 + call\n\n```js\nfunction repeat(target, n) {\n  return Array.prototype.join.call({ length: n + 1 }, target);\n}\n```\n\n## 版本3：闭包缓存\n\n```js\nvar repeat = (function () {\n  var join = Array.prototype.join,\n    obj = {};\n  return function (target, n) {\n    obj.length = n + 1;\n    return join.call(obj, target);\n  };\n})();\n```\n\n## 版本4：二分法\n\n```js\nfunction repeat(target, n) {\n  var s = target,\n    total = [];\n  while (n > 0) {\n    if (n % 2 == 1) total[total.length] = s;\n    if (n == 1) break;\n    s += s;\n    n = n >> 1;\n  }\n  return total.join(\"\");\n}\n```\n\n## 版本7：递归（上乘方案）\n\n```js\nfunction repeat(target, n) {\n  if (n == 1) return target;\n  var s = repeat(target, Math.floor(n / 2));\n  s += s;\n  if (n % 2) s += target;\n  return s;\n}\n```","src/data/blog/js-repeat.md","dc705a1f23f04064",{html:874,metadata:875},"<p>repeat 方法：将一个字符串重复自身 N 次，如 <code>repeat(\"ruby\", 2)</code> 得到 <code>rubyruby</code>。</p>\n<h2 id=\"版本1利用空数组-join\">版本1：利用空数组 join</h2>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> repeat</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">target</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> n</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  return</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> new</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> Array</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">n</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> +</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">join</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">target</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span></code></pre>\n<h2 id=\"版本2类数组对象--call\">版本2：类数组对象 + call</h2>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> repeat</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">target</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> n</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  return</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\"> Array</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#7FDBCA\">prototype</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic\">join</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">call</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">({ length</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> n</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> +</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> }</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> target</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span></code></pre>\n<h2 id=\"版本3闭包缓存\">版本3：闭包缓存</h2>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> repeat</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> ()</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> join</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> Array</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">prototype</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic\">join</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">    obj</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {};</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  return</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> function</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D7DBE0;--shiki-dark-font-style:italic\">target</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D7DBE0;--shiki-dark-font-style:italic\"> n</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">    obj</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">length</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> n</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> +</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> join</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">call</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">obj</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> target</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">  };</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">}</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)();</span></span></code></pre>\n<h2 id=\"版本4二分法\">版本4：二分法</h2>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> repeat</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">target</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> n</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> s</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> target</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">    total</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [];</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  while</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">n</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ></span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 0</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">n</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> %</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 2</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ==</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) </span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">total</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">total</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#7FDBCA\">length</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">] </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> s</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">n</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ==</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">break</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">    s</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> +=</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> s</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">    n</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> n</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> >></span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  return</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> total</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">join</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span></code></pre>\n<h2 id=\"版本7递归上乘方案\">版本7：递归（上乘方案）</h2>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> repeat</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">target</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> n</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">n</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ==</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> target</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> s</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> repeat</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">target</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> Math</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">floor</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">n</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> /</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 2</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">));</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">  s</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> +=</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> s</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">n</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> %</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 2</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) </span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">s</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> +=</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> target</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> s</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span></code></pre>",{headings:876,localImagePaths:892,remoteImagePaths:893,frontmatter:894,imagePaths:897},[877,880,883,886,889],{depth:31,slug:878,text:879},"版本1利用空数组-join","版本1：利用空数组 join",{depth:31,slug:881,text:882},"版本2类数组对象--call","版本2：类数组对象 + call",{depth:31,slug:884,text:885},"版本3闭包缓存","版本3：闭包缓存",{depth:31,slug:887,text:888},"版本4二分法","版本4：二分法",{depth:31,slug:890,text:891},"版本7递归上乘方案","版本7：递归（上乘方案）",[],[],{author:14,pubDatetime:895,title:867,slug:863,featured:17,draft:17,tags:896,description:869},["Date","2015-03-15T02:00:00.000Z"],[20],[],"js-strict-mode-check",{id:898,data:900,body:905,filePath:906,digest:907,rendered:908},{author:14,pubDatetime:901,title:902,featured:17,draft:17,tags:903,description:904},["Date","2016-03-01T02:00:00.000Z"],"JS 判断浏览器是否支持严格模式",[20],"利用严格模式下 this 为 undefined 的特性来判断。","严格模式中函数内 `this` 为 `undefined`：\n\n```js\nvar hasStrictMode = (function () {\n  \"use strict\";\n  return this == undefined;\n})();\n```\n\n另外，一个忽略 new 操作符的技巧：\n\n```js\nfunction P() {\n  if (!(this instanceof P)) return new P();\n}\n```","src/data/blog/js-strict-mode-check.md","18dc065be1e69942",{html:909,metadata:910},"<p>严格模式中函数内 <code>this</code> 为 <code>undefined</code>：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> hasStrictMode</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> ()</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">  \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">use strict</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  return</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#41EEC6;--shiki-dark-font-style:italic\"> this</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ==</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> undefined</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">}</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)();</span></span></code></pre>\n<p>另外，一个忽略 new 操作符的技巧：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> P</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">()</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">!</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#41EEC6;--shiki-dark-font-style:italic\">this</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> instanceof</span><span style=\"--shiki-light:#6F42C1;--shiki-dark:#FFCB8B\"> P</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)) </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">return</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> new</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> P</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span></code></pre>",{headings:911,localImagePaths:912,remoteImagePaths:913,frontmatter:914,imagePaths:917},[],[],[],{author:14,pubDatetime:915,title:902,slug:898,featured:17,draft:17,tags:916,description:904},["Date","2016-03-01T02:00:00.000Z"],[20],[],"js-type-conversion",{id:918,data:920,body:925,filePath:926,digest:927,rendered:928},{author:14,pubDatetime:921,title:922,featured:17,draft:17,tags:923,description:924},["Date","2016-02-15T02:00:00.000Z"],"JS 类型转换：对象转原始值",[20],"深入理解 JS 中对象转换成原始值的过程。","对象转换成原始值的过程：\n\n1. 如果对象有 `valueOf()` 方法并返回原始值，则调用\n2. 否则调用 `toString()` 方法\n3. 否则抛出类型异常\n\n```js\nfunction T() {}\nT.prototype.valueOf = function () {\n  return \"a\";\n};\nnew T() == \"a\"; // true\n\nT.prototype.valueOf = function () {\n  return {};\n};\nT.prototype.toString = function () {\n  return \"b\";\n};\nnew T() == \"b\"; // true\n```\n\n**注意**：Date 类型转换成原始值只使用 `toString()` 方法。","src/data/blog/js-type-conversion.md","b3c3e9435cc6731e",{html:929,metadata:930},"<p>对象转换成原始值的过程：</p>\n<ol>\n<li>如果对象有 <code>valueOf()</code> 方法并返回原始值，则调用</li>\n<li>否则调用 <code>toString()</code> 方法</li>\n<li>否则抛出类型异常</li>\n</ol>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> T</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">()</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\">T</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#7FDBCA\">prototype</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">valueOf</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> function</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> ()</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  return</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">a</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">};</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">new</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> T</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">() </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">==</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">a</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// true</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\">T</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#7FDBCA\">prototype</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">valueOf</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> function</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> ()</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {};</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">};</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\">T</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#7FDBCA\">prototype</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">toString</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> function</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> ()</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  return</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">b</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">};</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">new</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> T</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">() </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">==</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">b</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// true</span></span></code></pre>\n<p><strong>注意</strong>：Date 类型转换成原始值只使用 <code>toString()</code> 方法。</p>",{headings:931,localImagePaths:932,remoteImagePaths:933,frontmatter:934,imagePaths:937},[],[],[],{author:14,pubDatetime:935,title:922,slug:918,featured:17,draft:17,tags:936,description:924},["Date","2016-02-15T02:00:00.000Z"],[20],[],"js-structured-clone",{id:938,data:940,body:946,filePath:947,digest:948,rendered:949},{author:14,pubDatetime:941,title:942,featured:165,draft:17,tags:943,description:945},["Date","2026-02-11T06:00:00.000Z"],"告别 JSON.parse(JSON.stringify()) — 原生深拷贝 structuredClone",[20,944],"Web API","JavaScript 终于有了原生深拷贝方法 structuredClone，来看看它解决了哪些痛点。","## 深拷贝的老办法\n\n在 JavaScript 中深拷贝一个对象，最常见的\"hack\"写法是：\n\n```js\nconst copy = JSON.parse(JSON.stringify(original));\n```\n\n这个方法简单粗暴，但有一堆坑：\n\n```js\nconst obj = {\n  date: new Date(),\n  regex: /test/gi,\n  map: new Map([[\"key\", \"value\"]]),\n  set: new Set([1, 2, 3]),\n  undef: undefined,\n  fn: () => \"hello\",\n  nan: NaN,\n  infinity: Infinity,\n};\n\nconst copy = JSON.parse(JSON.stringify(obj));\nconsole.log(copy);\n// {\n//   date: \"2026-02-11T06:00:00.000Z\",  ← 变成了字符串\n//   regex: {},                           ← 丢失了\n//   map: {},                             ← 丢失了\n//   set: {},                             ← 丢失了\n//                                        ← undefined 直接消失\n//                                        ← 函数直接消失\n//   nan: null,                           ← 变成了 null\n//   infinity: null                       ← 变成了 null\n// }\n```\n\n还有一个致命问题 —— 循环引用直接报错：\n\n```js\nconst a = { name: \"a\" };\na.self = a;\nJSON.parse(JSON.stringify(a)); // ❌ TypeError: Converting circular structure to JSON\n```\n\n## structuredClone 登场\n\n`structuredClone()` 是浏览器和 Node.js (v17+) 提供的**原生深拷贝**方法：\n\n```js\nconst original = {\n  date: new Date(),\n  regex: /test/gi,\n  map: new Map([[\"key\", \"value\"]]),\n  set: new Set([1, 2, 3]),\n  nested: { deep: { value: 42 } },\n  arr: [1, [2, [3]]],\n};\n\nconst copy = structuredClone(original);\n\ncopy.nested.deep.value = 0;\nconsole.log(original.nested.deep.value); // 42 ✅ 互不影响\n\ncopy.date instanceof Date; // true ✅ 类型保留\ncopy.regex instanceof RegExp; // true ✅\ncopy.map instanceof Map; // true ✅\ncopy.set instanceof Set; // true ✅\n```\n\n循环引用也能正确处理：\n\n```js\nconst a = { name: \"a\" };\na.self = a;\nconst b = structuredClone(a); // ✅ 正常工作\nb.self === b; // true（引用指向拷贝后的自身）\n```\n\n## 支持的类型\n\nstructuredClone 使用的是 [结构化克隆算法](https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Structured_clone_algorithm)，支持绝大多数内置类型：\n\n| 类型 | JSON 方式 | structuredClone |\n|------|-----------|-----------------|\n| Date | ❌ 变字符串 | ✅ |\n| RegExp | ❌ 变 `{}` | ✅ |\n| Map / Set | ❌ 变 `{}` | ✅ |\n| ArrayBuffer | ❌ | ✅ |\n| undefined | ❌ 丢失 | ✅ |\n| NaN / Infinity | ❌ 变 null | ✅ |\n| 循环引用 | ❌ 报错 | ✅ |\n\n## 不支持什么\n\n有几种东西是 structuredClone **无法克隆**的：\n\n```js\n// ❌ 函数\nstructuredClone({ fn: () => {} });\n// DOMException: () => {} could not be cloned.\n\n// ❌ DOM 节点\nstructuredClone(document.body);\n\n// ❌ 原型链（拷贝后丢失）\nclass Dog {\n  bark() { return \"woof\"; }\n}\nconst dog = new Dog();\nconst cloned = structuredClone(dog);\ncloned instanceof Dog; // false\ncloned.bark; // undefined\n```\n\n所以如果你的对象包含函数或需要保留原型链，structuredClone 不适用。\n\n## 一个实用技巧：transferable objects\n\nstructuredClone 支持第二个参数 `transfer`，可以\"移交\"而不是\"复制\"某些对象（如 ArrayBuffer），避免内存翻倍：\n\n```js\nconst buffer = new ArrayBuffer(1024 * 1024); // 1MB\nconst copy = structuredClone(buffer, { transfer: [buffer] });\n\nconsole.log(buffer.byteLength); // 0 ← 原始的被清空了\nconsole.log(copy.byteLength); // 1048576 ← 数据转移到了 copy\n```\n\n这在处理大型二进制数据时非常有用。\n\n## 兼容性\n\n- Chrome 98+, Firefox 94+, Safari 15.4+, Node.js 17+\n- 2026 年的今天，基本可以放心使用\n\n## 总结\n\n| 场景 | 推荐方案 |\n|------|---------|\n| 简单对象，无特殊类型 | `JSON.parse(JSON.stringify())` 仍然可用 |\n| 包含 Date/Map/Set/循环引用 | `structuredClone()` |\n| 需要保留原型链/函数 | 手写递归或 lodash `_.cloneDeep()` |\n\n以后深拷贝，先想想 `structuredClone` 吧。","src/data/blog/js-structured-clone.md","913d55e4151f4075",{html:950,metadata:951},"<h2 id=\"深拷贝的老办法\">深拷贝的老办法</h2>\n<p>在 JavaScript 中深拷贝一个对象，最常见的”hack”写法是：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> copy</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> JSON</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">parse</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">JSON</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">stringify</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">original</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">));</span></span></code></pre>\n<p>这个方法简单粗暴，但有一堆坑：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> obj</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  date</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> new</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> Date</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  regex</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> /</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#5CA7E4;--shiki-dark-font-style:italic\">test</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#5CA7E4\">gi</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  map</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> new</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> Map</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">([[</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">key</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">value</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]])</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  set</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> new</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> Set</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">([</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">1</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 2</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 3</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">])</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  undef</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> undefined</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">  fn</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> ()</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">hello</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  nan</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> NaN</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  infinity</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> Infinity</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">}</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> copy</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> JSON</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">parse</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">JSON</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">stringify</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">obj</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">));</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">console</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">log</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">copy</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">//   date: \"2026-02-11T06:00:00.000Z\",  ← 变成了字符串</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">//   regex: {},                           ← 丢失了</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">//   map: {},                             ← 丢失了</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">//   set: {},                             ← 丢失了</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">//                                        ← undefined 直接消失</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">//                                        ← 函数直接消失</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">//   nan: null,                           ← 变成了 null</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">//   infinity: null                       ← 变成了 null</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// }</span></span></code></pre>\n<p>还有一个致命问题 —— 循环引用直接报错：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> a</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> name</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">a</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> }</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">a</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">self</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> a</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\">JSON</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">parse</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\">JSON</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">stringify</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">a</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// ❌ TypeError: Converting circular structure to JSON</span></span></code></pre>\n<h2 id=\"structuredclone-登场\">structuredClone 登场</h2>\n<p><code>structuredClone()</code> 是浏览器和 Node.js (v17+) 提供的<strong>原生深拷贝</strong>方法：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> original</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  date</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> new</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> Date</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  regex</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> /</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#5CA7E4;--shiki-dark-font-style:italic\">test</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#5CA7E4\">gi</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  map</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> new</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> Map</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">([[</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">key</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">value</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]])</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  set</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> new</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> Set</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">([</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">1</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 2</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 3</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">])</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  nested</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> deep</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> value</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 42</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> }</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> }</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  arr</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">1</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">2</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">3</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]]]</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">}</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> copy</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> structuredClone</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">original</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">copy</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic\">nested</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic\">deep</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">value</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 0</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">console</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">log</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">original</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic\">nested</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic\">deep</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">value</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 42 ✅ 互不影响</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">copy</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">date</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> instanceof</span><span style=\"--shiki-light:#6F42C1;--shiki-dark:#FFCB8B\"> Date</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// true ✅ 类型保留</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">copy</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">regex</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> instanceof</span><span style=\"--shiki-light:#6F42C1;--shiki-dark:#FFCB8B\"> RegExp</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// true ✅</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">copy</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">map</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> instanceof</span><span style=\"--shiki-light:#6F42C1;--shiki-dark:#FFCB8B\"> Map</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// true ✅</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">copy</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">set</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> instanceof</span><span style=\"--shiki-light:#6F42C1;--shiki-dark:#FFCB8B\"> Set</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// true ✅</span></span></code></pre>\n<p>循环引用也能正确处理：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> a</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> name</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">a</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> }</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">a</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">self</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> a</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> b</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> structuredClone</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">a</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// ✅ 正常工作</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">b</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">self</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ===</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> b</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// true（引用指向拷贝后的自身）</span></span></code></pre>\n<h2 id=\"支持的类型\">支持的类型</h2>\n<p>structuredClone 使用的是 <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Structured_clone_algorithm\">结构化克隆算法</a>，支持绝大多数内置类型：</p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<table><thead><tr><th>类型</th><th>JSON 方式</th><th>structuredClone</th></tr></thead><tbody><tr><td>Date</td><td>❌ 变字符串</td><td>✅</td></tr><tr><td>RegExp</td><td>❌ 变 <code>{}</code></td><td>✅</td></tr><tr><td>Map / Set</td><td>❌ 变 <code>{}</code></td><td>✅</td></tr><tr><td>ArrayBuffer</td><td>❌</td><td>✅</td></tr><tr><td>undefined</td><td>❌ 丢失</td><td>✅</td></tr><tr><td>NaN / Infinity</td><td>❌ 变 null</td><td>✅</td></tr><tr><td>循环引用</td><td>❌ 报错</td><td>✅</td></tr></tbody></table>\n<h2 id=\"不支持什么\">不支持什么</h2>\n<p>有几种东西是 structuredClone <strong>无法克隆</strong>的：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// ❌ 函数</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">structuredClone</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">({ </span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">fn</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> ()</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {} });</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// DOMException: () => {} could not be cloned.</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// ❌ DOM 节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">structuredClone</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">document</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">body</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// ❌ 原型链（拷贝后丢失）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">class</span><span style=\"--shiki-light:#6F42C1;--shiki-dark:#FFCB8B\"> Dog</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">  bark</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">()</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">return</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">woof</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> dog</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> new</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> Dog</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> cloned</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> structuredClone</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">dog</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">cloned</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> instanceof</span><span style=\"--shiki-light:#6F42C1;--shiki-dark:#FFCB8B\"> Dog</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// false</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">cloned</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">bark</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// undefined</span></span></code></pre>\n<p>所以如果你的对象包含函数或需要保留原型链，structuredClone 不适用。</p>\n<h2 id=\"一个实用技巧transferable-objects\">一个实用技巧：transferable objects</h2>\n<p>structuredClone 支持第二个参数 <code>transfer</code>，可以”移交”而不是”复制”某些对象（如 ArrayBuffer），避免内存翻倍：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> buffer</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> new</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> ArrayBuffer</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">1024</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> *</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1024</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 1MB</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> copy</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> structuredClone</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">buffer</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> transfer</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">buffer</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> }</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">console</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">log</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">buffer</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">byteLength</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 0 ← 原始的被清空了</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">console</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">log</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">copy</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">byteLength</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 1048576 ← 数据转移到了 copy</span></span></code></pre>\n<p>这在处理大型二进制数据时非常有用。</p>\n<h2 id=\"兼容性\">兼容性</h2>\n<ul>\n<li>Chrome 98+, Firefox 94+, Safari 15.4+, Node.js 17+</li>\n<li>2026 年的今天，基本可以放心使用</li>\n</ul>\n<h2 id=\"总结\">总结</h2>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<table><thead><tr><th>场景</th><th>推荐方案</th></tr></thead><tbody><tr><td>简单对象，无特殊类型</td><td><code>JSON.parse(JSON.stringify())</code> 仍然可用</td></tr><tr><td>包含 Date/Map/Set/循环引用</td><td><code>structuredClone()</code></td></tr><tr><td>需要保留原型链/函数</td><td>手写递归或 lodash <code>_.cloneDeep()</code></td></tr></tbody></table>\n<p>以后深拷贝，先想想 <code>structuredClone</code> 吧。</p>",{headings:952,localImagePaths:967,remoteImagePaths:968,frontmatter:969,imagePaths:972},[953,955,958,960,962,965,966],{depth:31,slug:954,text:954},"深拷贝的老办法",{depth:31,slug:956,text:957},"structuredclone-登场","structuredClone 登场",{depth:31,slug:959,text:959},"支持的类型",{depth:31,slug:961,text:961},"不支持什么",{depth:31,slug:963,text:964},"一个实用技巧transferable-objects","一个实用技巧：transferable objects",{depth:31,slug:54,text:54},{depth:31,slug:316,text:316},[],[],{author:14,pubDatetime:970,title:942,slug:938,featured:165,draft:17,tags:971,description:945},["Date","2026-02-11T06:00:00.000Z"],[20,944],[],"js-with-keyword",{id:973,data:975,body:980,filePath:981,digest:982,rendered:983},{author:14,pubDatetime:976,title:977,featured:17,draft:17,tags:978,description:979},["Date","2016-08-15T02:00:00.000Z"],"JS with 关键字的坑",[20],"with 创建新的词法作用域，可能导致变量泄漏到全局。","```js\nfunction foo(obj) {\n  with (obj) {\n    a = 2;\n  }\n}\n\nvar o1 = { a: 3 };\nvar o2 = { b: 3 };\n\nfoo(o1);\nconsole.log(o1.a); // 2\n\nfoo(o2);\nconsole.log(o2.a); // undefined\nconsole.log(a); // 2 — a 泄漏到全局！\n```\n\n`with` 在当前位置建立一个新的词法作用域，不会在目标对象中新建属性。严格模式下完全不起作用，不建议使用。","src/data/blog/js-with-keyword.md","46a3a1ab48e96c91",{html:984,metadata:985},"<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> foo</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">obj</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  with</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">obj</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">    a</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 2</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> o1</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> a</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 3</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> }</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> o2</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> b</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 3</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> }</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">foo</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">o1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">console</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">log</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">o1</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">a</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 2</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">foo</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">o2</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">console</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">log</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">o2</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">a</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// undefined</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">console</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">log</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">a</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 2 — a 泄漏到全局！</span></span></code></pre>\n<p><code>with</code> 在当前位置建立一个新的词法作用域，不会在目标对象中新建属性。严格模式下完全不起作用，不建议使用。</p>",{headings:986,localImagePaths:987,remoteImagePaths:988,frontmatter:989,imagePaths:992},[],[],[],{author:14,pubDatetime:990,title:977,slug:973,featured:17,draft:17,tags:991,description:979},["Date","2016-08-15T02:00:00.000Z"],[20],[],"js-xml-parse",{id:993,data:995,body:1000,filePath:1001,digest:1002,rendered:1003},{author:14,pubDatetime:996,title:997,featured:17,draft:17,tags:998,description:999},["Date","2015-07-20T02:00:00.000Z"],"JS 解析 XML 兼容 IE 与其他浏览器",[20,54],"IE 使用 ActiveXObject，其他浏览器使用 DOMParser 解析 XML 的兼容方案。","IE 中使用 `ActiveXObject` 的 `loadXML` 方法解析 XML，其他浏览器可以使用 `DOMParser`。\n\n```js\nfunction loadXml(text) {\n  var XMLDoc = null;\n  if (window.ActiveXObject) {\n    XMLDoc = new ActiveXObject(\"MSXML2.DOMDocument.6.0\");\n    XMLDoc.async = false;\n    XMLDoc.validateOnParse = true;\n    XMLDoc.loadXML(text);\n  } else {\n    var parseXml = new DOMParser();\n    XMLDoc = parseXml.parseFromString(text, \"text/xml\");\n    Node.prototype.selectSingleNode = function (node) {\n      if (this.getElementsByTagName(node).length) {\n        var child = this.getElementsByTagName(node)[0];\n        child.text = child.innerHTML;\n        return child;\n      }\n      return null;\n    };\n  }\n  return XMLDoc;\n}\n\nvar XMLDoc = loadXml(\"<doc><test>ttt</test></doc>\");\nvar text = XMLDoc.documentElement.selectSingleNode(\"test\").text; // \"ttt\"\n```","src/data/blog/js-xml-parse.md","19737d4d4e5c49eb",{html:1004,metadata:1005},"<p>IE 中使用 <code>ActiveXObject</code> 的 <code>loadXML</code> 方法解析 XML，其他浏览器可以使用 <code>DOMParser</code>。</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> loadXml</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">text</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> XMLDoc</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FF5874;--shiki-dark-font-style:italic\"> null</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">window</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">ActiveXObject</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">    XMLDoc</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> new</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> ActiveXObject</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">MSXML2.DOMDocument.6.0</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">    XMLDoc</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">async</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\"> false</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">    XMLDoc</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">validateOnParse</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\"> true</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">    XMLDoc</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">loadXML</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">text</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  } </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">else</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> parseXml</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> new</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> DOMParser</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">    XMLDoc</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> parseXml</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">parseFromString</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">text</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">text/xml</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\">    Node</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#7FDBCA\">prototype</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">selectSingleNode</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> function</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">node</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">      if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#41EEC6;--shiki-dark-font-style:italic\">this</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">getElementsByTagName</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">node</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#7FDBCA\">length</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">        var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> child</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#41EEC6;--shiki-dark-font-style:italic\"> this</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">getElementsByTagName</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">node</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)[</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">0</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">];</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">        child</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">text</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> child</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">innerHTML</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> child</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">      return</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\"> null</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    };</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> XMLDoc</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> XMLDoc</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> loadXml</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">&#x3C;doc>&#x3C;test>ttt&#x3C;/test>&#x3C;/doc></span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> text</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> XMLDoc</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic\">documentElement</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">selectSingleNode</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">test</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic\">text</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// \"ttt\"</span></span></code></pre>",{headings:1006,localImagePaths:1007,remoteImagePaths:1008,frontmatter:1009,imagePaths:1012},[],[],[],{author:14,pubDatetime:1010,title:997,slug:993,featured:17,draft:17,tags:1011,description:999},["Date","2015-07-20T02:00:00.000Z"],[20,54],[],"mysql-to-sqlite",{id:1013,data:1015,body:1021,filePath:1022,digest:1023,rendered:1024},{author:14,pubDatetime:1016,title:1017,featured:17,draft:17,tags:1018,description:1020},["Date","2016-09-01T02:00:00.000Z"],"MySQL 更换 SQLite 记录",[525,1019],"数据库","博客从 MySQL 迁移到 SQLite 的全过程，省了 48 元/月。","阿里云 MySQL 到期了，续费 48 元/月，果断换 SQLite。\n\n## 步骤\n\n1. 备份阿里云 MySQL 实例（导出 SQL 文件）\n2. 处理 SQL 语句中的类型差异\n3. 生成 SQLite db 文件\n4. 修改项目中的 SQL 语句\n\n```js\n// Koa 框架中使用 sqlite3\nvar res = yield new Promise(function (resolve, reject) {\n  self.db.run(\n    \"insert into comments values (?,?,?,?,?,?,?)\",\n    [null, comment.blogID, comment.name, comment.email, comment.content, comment.addTime, comment.relID]\n  );\n  self.db.get(\n    \"select * from comments where blogID = ? and name = ?\",\n    [comment.blogID, comment.name],\n    function (err, rows) { resolve(rows); }\n  );\n});\n```\n\n省了 48 元/月 ^_^","src/data/blog/mysql-to-sqlite.md","9b7ab15663465e44",{html:1025,metadata:1026},"<p>阿里云 MySQL 到期了，续费 48 元/月，果断换 SQLite。</p>\n<h2 id=\"步骤\">步骤</h2>\n<ol>\n<li>备份阿里云 MySQL 实例（导出 SQL 文件）</li>\n<li>处理 SQL 语句中的类型差异</li>\n<li>生成 SQLite db 文件</li>\n<li>修改项目中的 SQL 语句</li>\n</ol>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// Koa 框架中使用 sqlite3</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> res</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> yield</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> new</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\"> Promise</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D7DBE0;--shiki-dark-font-style:italic\">resolve</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D7DBE0;--shiki-dark-font-style:italic\"> reject</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">  self</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic\">db</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">run</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">    \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">insert into comments values (?,?,?,?,?,?,?)</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    [</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FF5874;--shiki-dark-font-style:italic\">null</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> comment</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic\">blogID</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> comment</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic\">name</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> comment</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic\">email</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> comment</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic\">content</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> comment</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic\">addTime</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> comment</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic\">relID</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  )</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">  self</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic\">db</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">get</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">    \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">select * from comments where blogID = ? and name = ?</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    [</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">comment</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic\">blogID</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> comment</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic\">name</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    function</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D7DBE0;--shiki-dark-font-style:italic\">err</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D7DBE0;--shiki-dark-font-style:italic\"> rows</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> resolve</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">rows</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">;</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  )</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">}</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span></code></pre>\n<p>省了 48 元/月 ^_^</p>",{headings:1027,localImagePaths:1029,remoteImagePaths:1030,frontmatter:1031,imagePaths:1034},[1028],{depth:31,slug:133,text:133},[],[],{author:14,pubDatetime:1032,title:1017,slug:1013,featured:17,draft:17,tags:1033,description:1020},["Date","2016-09-01T02:00:00.000Z"],[525,1019],[],"node-feedly-rss",{id:1035,data:1037,body:1042,filePath:1043,digest:1044,rendered:1045},{author:14,pubDatetime:1038,title:1039,featured:17,draft:17,tags:1040,description:1041},["Date","2015-09-01T02:00:00.000Z"],"Node 中使用 Feedly 与 RSS",[525],"在 Node.js 博客中添加 RSS 订阅功能，接入 Feedly。","使用 [node-rss](https://github.com/dylang/node-rss) 生成 RSS XML：\n\n```js\nexports.feed = function* () {\n  var feed = new rss({\n    title: \"陈佳人\",\n    description: \"人生是一场独自修行的道路\",\n    feed_url: \"http://renjm.com/feed\",\n    site_url: \"http://renjm.com\",\n  });\n\n  var blogs = yield blogDB.getBlogs();\n  blogs.forEach(function (v) {\n    feed.item({\n      title: v.title,\n      description: v.realContent,\n      url: \"http://renjm.com/blog/\" + v.id,\n      date: v.addTime,\n    });\n  });\n\n  this.body = feed.xml();\n  this.type = \"text/xml\";\n};\n```","src/data/blog/node-feedly-rss.md","6f49da5a0a8df919",{html:1046,metadata:1047},"<p>使用 <a href=\"https://github.com/dylang/node-rss\">node-rss</a> 生成 RSS XML：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\">exports</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">feed</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> function*</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> ()</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> feed</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> new</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> rss</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    title</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">陈佳人</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    description</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">人生是一场独自修行的道路</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    feed_url</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">http://renjm.com/feed</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    site_url</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">http://renjm.com</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">  }</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> blogs</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> yield</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> blogDB</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">getBlogs</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">  blogs</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">forEach</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">v</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">    feed</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">item</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">({</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      title</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> v</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">title</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      description</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> v</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">realContent</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      url</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">http://renjm.com/blog/</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> +</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> v</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">id</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      date</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> v</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">addTime</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    });</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  });</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#41EEC6;--shiki-dark-font-style:italic\">  this</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">body</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> feed</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">xml</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#41EEC6;--shiki-dark-font-style:italic\">  this</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">type</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">text/xml</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">};</span></span></code></pre>",{headings:1048,localImagePaths:1049,remoteImagePaths:1050,frontmatter:1051,imagePaths:1054},[],[],[],{author:14,pubDatetime:1052,title:1039,slug:1035,featured:17,draft:17,tags:1053,description:1041},["Date","2015-09-01T02:00:00.000Z"],[525],[],"knapsack-problem",{id:1055,data:1057,body:1062,filePath:1063,digest:1064,rendered:1065},{author:14,pubDatetime:1058,title:1059,featured:17,draft:17,tags:1060,description:1061},["Date","2016-07-15T02:00:00.000Z"],"背包问题 JS 实现",[20,720],"0/1 背包问题的 JavaScript 动态规划实现。","物品列表 `[[重量, 价值], ...]`，背包承重 10，求最大价值：\n\n```js\nvar items = [\n  [2, 5],\n  [3, 1],\n  [5, 4],\n  [6, 10],\n];\n\nfunction knapsack(capacity, items) {\n  var res = [];\n  for (var i = 0; i <= capacity; i++) res[i] = 0;\n  for (var i = 0; i < items.length; i++) {\n    for (var j = capacity; j > items[i][0]; j--) {\n      res[j] = Math.max(res[j], res[j - items[i][0]] + items[i][1]);\n    }\n  }\n  return res[capacity];\n}\n\nknapsack(10, items); // 15\n```","src/data/blog/knapsack-problem.md","e95b3160087ae7b1",{html:1066,metadata:1067},"<p>物品列表 <code>[[重量, 价值], ...]</code>，背包承重 10，求最大价值：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> items</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  [</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">2</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 5</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  [</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">3</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  [</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">5</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 4</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  [</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">6</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 10</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">];</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> knapsack</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">capacity</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> items</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> res</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [];</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  for</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> i</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 0</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; </span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">i</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> &#x3C;=</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> capacity</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; </span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">i</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">++</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) </span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">res</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">i</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">] </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 0</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  for</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> i</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 0</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; </span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">i</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> &#x3C;</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> items</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#7FDBCA\">length</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; </span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">i</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">++</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    for</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> j</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> capacity</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; </span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">j</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> items</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">i</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">][</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">0</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]; </span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">j</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">--</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">      res</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">j</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">] </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> Math</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">max</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">res</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">j</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> res</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">j</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> -</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> items</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">i</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">][</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">0</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]] </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">+</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> items</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">i</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">][</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> res</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">capacity</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">];</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">knapsack</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">10</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> items</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 15</span></span></code></pre>",{headings:1068,localImagePaths:1069,remoteImagePaths:1070,frontmatter:1071,imagePaths:1074},[],[],[],{author:14,pubDatetime:1072,title:1059,slug:1055,featured:17,draft:17,tags:1073,description:1061},["Date","2016-07-15T02:00:00.000Z"],[20,720],[],"node-forever",{id:1075,data:1077,body:1082,filePath:1083,digest:1084,rendered:1085},{author:14,pubDatetime:1078,title:1079,featured:17,draft:17,tags:1080,description:1081},["Date","2015-04-01T02:00:00.000Z"],"Node forever 进程管理",[525],"使用 forever 管理 Node.js 进程，包括 koa 的和谐模式启动。","forever 是 Node 用来启动、停止服务的一个小工具。\n\n## 安装\n\n```bash\nnpm install forever -g\n```\n\n## 启动\n\n```bash\nforever app.js\n```\n\n## Koa 启动（需要 harmony 模式）\n\n```bash\nforever start -c \"node --harmony\" app.js\n```\n\n## Tips\n\n如果遇到 `Error: listen EADDRINUSE`，说明端口已被占用：\n\n```bash\nforever list\nforever stop app.js\n```","src/data/blog/node-forever.md","917b10fb7b599441",{html:1086,metadata:1087},"<p>forever 是 Node 用来启动、停止服务的一个小工具。</p>\n<h2 id=\"安装\">安装</h2>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">npm</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> install</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> forever</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\"> -g</span></span></code></pre>\n<h2 id=\"启动\">启动</h2>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">forever</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> app.js</span></span></code></pre>\n<h2 id=\"koa-启动需要-harmony-模式\">Koa 启动（需要 harmony 模式）</h2>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">forever</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> start</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\"> -c</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">node --harmony</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> app.js</span></span></code></pre>\n<h2 id=\"tips\">Tips</h2>\n<p>如果遇到 <code>Error: listen EADDRINUSE</code>，说明端口已被占用：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">forever</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> list</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">forever</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> stop</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> app.js</span></span></code></pre>",{headings:1088,localImagePaths:1099,remoteImagePaths:1100,frontmatter:1101,imagePaths:1104},[1089,1091,1093,1096],{depth:31,slug:1090,text:1090},"安装",{depth:31,slug:1092,text:1092},"启动",{depth:31,slug:1094,text:1095},"koa-启动需要-harmony-模式","Koa 启动（需要 harmony 模式）",{depth:31,slug:1097,text:1098},"tips","Tips",[],[],{author:14,pubDatetime:1102,title:1079,slug:1075,featured:17,draft:17,tags:1103,description:1081},["Date","2015-04-01T02:00:00.000Z"],[525],[],"node-markdown",{id:1105,data:1107,body:1113,filePath:1114,digest:1115,rendered:1116},{author:14,pubDatetime:1108,title:1109,featured:17,draft:17,tags:1110,description:1112},["Date","2015-06-15T02:00:00.000Z"],"Node 中使用 Markdown 与 highlight.js",[525,1111],"Markdown","在 Node.js 中使用 marked 解析 Markdown，配合 highlight.js 实现代码高亮。","## 基础：使用 marked\n\n```js\nvar md = require(\"marked\");\nblogs.forEach(function (v, i) {\n  v.content = md(v.content);\n});\n```\n\n## 引入 highlight.js\n\n参照 marked 官方示例引入 highlight.js：\n\n```js\nmarked.setOptions({\n  highlight: function (code) {\n    return require(\"highlight.js\").highlightAuto(code).value;\n  },\n});\n```\n\n## 添加行号（参考 hexo 源码）\n\n```js\nhighlight: function (code) {\n  var compiled = require('highlight.js').highlightAuto(code).value;\n  var lines = compiled.split('\\n'),\n    numbers = '', content = '';\n\n  lines.forEach(function(item, i){\n    numbers += '<div class=\"line\">' + (i + 1) + '</div>';\n    content += '<div class=\"line\">' + item + '</div>';\n  });\n\n  return '<figure class=\"highlight\"><table><tr>' +\n    '<td class=\"gutter\"><pre>' + numbers + '</pre></td>' +\n    '<td class=\"code\"><pre>' + content + '</pre></td>' +\n    '</tr></table></figure>';\n}\n```","src/data/blog/node-markdown.md","a290e92698a361bc",{html:1117,metadata:1118},"<h2 id=\"基础使用-marked\">基础：使用 marked</h2>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> md</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> require</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">marked</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">blogs</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">forEach</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">v</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> i</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">  v</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">content</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> md</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">v</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">content</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">});</span></span></code></pre>\n<h2 id=\"引入-highlightjs\">引入 highlight.js</h2>\n<p>参照 marked 官方示例引入 highlight.js：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">marked</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">setOptions</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">({</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">  highlight</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> function</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">code</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> require</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">highlight.js</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">highlightAuto</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">code</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">value</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">});</span></span></code></pre>\n<h2 id=\"添加行号参考-hexo-源码\">添加行号（参考 hexo 源码）</h2>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">highlight</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> function</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">code</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> compiled</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> require</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">highlight.js</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">highlightAuto</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">code</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic\">value</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> lines</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> compiled</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">split</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#F78C6C\">\\n</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">    numbers</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> ''</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> content</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> ''</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">  lines</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">forEach</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">item</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> i</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">    numbers</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> +=</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">&#x3C;div class=\"line\"></span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> +</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">i</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> +</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">+</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">&#x3C;/div></span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">    content</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> +=</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">&#x3C;div class=\"line\"></span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> +</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> item</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> +</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">&#x3C;/div></span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  });</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  return</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">&#x3C;figure class=\"highlight\">&#x3C;table>&#x3C;tr></span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> +</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">    '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">&#x3C;td class=\"gutter\">&#x3C;pre></span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> +</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> numbers</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> +</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">&#x3C;/pre>&#x3C;/td></span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> +</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">    '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">&#x3C;td class=\"code\">&#x3C;pre></span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> +</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> content</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> +</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">&#x3C;/pre>&#x3C;/td></span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> +</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">    '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">&#x3C;/tr>&#x3C;/table>&#x3C;/figure></span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span></code></pre>",{headings:1119,localImagePaths:1129,remoteImagePaths:1130,frontmatter:1131,imagePaths:1134},[1120,1123,1126],{depth:31,slug:1121,text:1122},"基础使用-marked","基础：使用 marked",{depth:31,slug:1124,text:1125},"引入-highlightjs","引入 highlight.js",{depth:31,slug:1127,text:1128},"添加行号参考-hexo-源码","添加行号（参考 hexo 源码）",[],[],{author:14,pubDatetime:1132,title:1109,slug:1105,featured:17,draft:17,tags:1133,description:1112},["Date","2015-06-15T02:00:00.000Z"],[525,1111],[],"npm-useful-commands",{id:1135,data:1137,body:1142,filePath:1143,digest:1144,rendered:1145},{author:14,pubDatetime:1138,title:1139,featured:17,draft:17,tags:1140,description:1141},["Date","2018-08-01T02:00:00.000Z"],"npm 高效但非常用命令整理",[525,280],"npm list、npm outdated、npm prune、npm-check 等实用命令。","- `npm list --depth 0` — 只显示第一层依赖\n- `npm list --global` — 列出全局安装的模块\n- `npm search node` — 搜索 npm 仓库\n- `npm outdated` — 检查依赖是否有新版本\n- `npm prune` — 检查 node_modules 中未在 package.json 中声明的模块\n- `npm-check` — 第三方工具，检查依赖更新、缺失、错误及未使用情况\n\n```bash\nnpm install npm-check -g\nnpm-check\n```","src/data/blog/npm-useful-commands.md","0bb84952d0e90bc2",{html:1146,metadata:1147},"<ul>\n<li><code>npm list --depth 0</code> — 只显示第一层依赖</li>\n<li><code>npm list --global</code> — 列出全局安装的模块</li>\n<li><code>npm search node</code> — 搜索 npm 仓库</li>\n<li><code>npm outdated</code> — 检查依赖是否有新版本</li>\n<li><code>npm prune</code> — 检查 node_modules 中未在 package.json 中声明的模块</li>\n<li><code>npm-check</code> — 第三方工具，检查依赖更新、缺失、错误及未使用情况</li>\n</ul>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">npm</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> install</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> npm-check</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\"> -g</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">npm-check</span></span></code></pre>",{headings:1148,localImagePaths:1149,remoteImagePaths:1150,frontmatter:1151,imagePaths:1154},[],[],[],{author:14,pubDatetime:1152,title:1139,slug:1135,featured:17,draft:17,tags:1153,description:1141},["Date","2018-08-01T02:00:00.000Z"],[525,280],[],"null-vs-undefined",{id:1155,data:1157,body:1162,filePath:1163,digest:1164,rendered:1165},{author:14,pubDatetime:1158,title:1159,featured:17,draft:17,tags:1160,description:1161},["Date","2016-04-01T02:00:00.000Z"],"null 与 undefined 的区别",[20],"详解 null 和 undefined 的定义、转义、判定和用法差异。","## 定义\n\n- `null`：关键字，表示\"空值\"，`typeof null` 返回 `\"object\"`\n- `undefined`：预定义全局变量，`typeof undefined` 返回 `\"undefined\"`\n\n## 转义\n\n```js\n!!null; // false\n!!undefined; // false\nNumber(null); // 0\nNumber(undefined); // NaN\nnull == undefined; // true\nnull === undefined; // false\n```\n\n## 判定\n\n```js\nvar isNull = function (obj) { return obj === null; };\nvar isUndefined = function (obj) { return obj === void 0; };\n```\n\n## undefined 的典型场景\n\n1. 变量声明未赋值\n2. 函数参数未提供\n3. 对象属性未赋值\n4. 函数无返回值\n5. 解构赋值时触发默认值（`null` 不会触发默认值）\n\n```js\nconst { a = \"a\", b = \"b\" } = { a: null };\n// a → null, b → \"b\"\n```","src/data/blog/null-vs-undefined.md","9a6f14eca9ff2cd0",{html:1166,metadata:1167},"<h2 id=\"定义\">定义</h2>\n<ul>\n<li><code>null</code>：关键字，表示”空值”，<code>typeof null</code> 返回 <code>\"object\"</code></li>\n<li><code>undefined</code>：预定义全局变量，<code>typeof undefined</code> 返回 <code>\"undefined\"</code></li>\n</ul>\n<h2 id=\"转义\">转义</h2>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">!!</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\">null</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// false</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">!!</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\">undefined</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// false</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Number</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\">null</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Number</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\">undefined</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// NaN</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\">null</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ==</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\"> undefined</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// true</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\">null</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ===</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\"> undefined</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// false</span></span></code></pre>\n<h2 id=\"判定\">判定</h2>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">var</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> isNull</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> function</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D7DBE0;--shiki-dark-font-style:italic\">obj</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> obj</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ===</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FF5874;--shiki-dark-font-style:italic\"> null</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">;</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> }</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">var</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> isUndefined</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> function</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D7DBE0;--shiki-dark-font-style:italic\">obj</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> obj</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ===</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> void</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 0</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">;</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> }</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span></code></pre>\n<h2 id=\"undefined-的典型场景\">undefined 的典型场景</h2>\n<ol>\n<li>变量声明未赋值</li>\n<li>函数参数未提供</li>\n<li>对象属性未赋值</li>\n<li>函数无返回值</li>\n<li>解构赋值时触发默认值（<code>null</code> 不会触发默认值）</li>\n</ol>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> a</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">a</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> b</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">b</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> }</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> a</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FF5874;--shiki-dark-font-style:italic\"> null</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> }</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// a → null, b → \"b\"</span></span></code></pre>",{headings:1168,localImagePaths:1178,remoteImagePaths:1179,frontmatter:1180,imagePaths:1183},[1169,1171,1173,1175],{depth:31,slug:1170,text:1170},"定义",{depth:31,slug:1172,text:1172},"转义",{depth:31,slug:1174,text:1174},"判定",{depth:31,slug:1176,text:1177},"undefined-的典型场景","undefined 的典型场景",[],[],{author:14,pubDatetime:1181,title:1159,slug:1155,featured:17,draft:17,tags:1182,description:1161},["Date","2016-04-01T02:00:00.000Z"],[20],[],"openclaw-getting-started",{id:1184,data:1186,body:1193,filePath:1194,digest:1195,rendered:1196},{author:14,pubDatetime:1187,title:1188,featured:165,draft:17,tags:1189,description:1192},["Date","2026-02-12T16:40:00.000Z"],"OpenClaw 入门实战：5分钟搭建你的自托管 AI 助手",[1190,167,1191],"OpenClaw","自托管","OpenClaw 是个强大的自托管 AI 代理网关，让你用 Telegram 等 App 随时随地调用 Claude。本文带你从零开始，5分钟搭建第一个 AI bot。","最近在研究如何更高效地使用 AI 助手，发现了一个很有意思的开源项目：**OpenClaw**。它能让你在 Telegram、WhatsApp、Discord 等各种 App 里直接跟 Claude 对话，而且完全由你自己掌控。今天就来分享一下如何从零搭建你的第一个 OpenClaw AI 助手。\n\n## OpenClaw 是什么？\n\n简单说，**OpenClaw 是一个自托管的 AI 代理网关**。它帮你把 Claude、GPT 等 AI 模型接入到各种消息平台，让你可以像跟朋友聊天一样跟 AI 交互。\n\n### 核心特性\n\n- **多渠道支持**：Telegram、WhatsApp、Discord、Slack 等主流平台\n- **自托管架构**：所有数据留在你自己的服务器上\n- **灵活配置**：支持多个 Agent、自定义工具、记忆管理\n- **开箱即用**：内置 Web 控制面板，配置简单\n\n### 为什么选择自托管？\n\n很多人可能会问：市面上已经有 ChatGPT、Claude.ai 这些现成服务了，为什么还要自己搭建？\n\n**数据隐私**：所有对话记录、配置信息都存储在你自己的设备上，不会被第三方收集。\n\n**完全可控**：想换模型就换模型，想接入哪个平台就接入哪个平台，不受平台限制。\n\n**成本透明**：直接调用 API，按实际用量付费，不用担心订阅费用。\n\n**功能自由**：可以自定义工具、配置记忆系统、接入本地服务，玩法更多。\n\n对于开发者和注重隐私的用户来说，自托管是个更好的选择。\n\n## 快速安装（macOS）\n\n下面以 macOS 为例，演示如何安装 OpenClaw。其他系统的安装方法类似，可以参考[官方文档](https://openclaw.ai/install)。\n\n### 前置条件\n\n在开始之前，确保你的系统满足以下条件：\n\n1. **Node.js 22+**：OpenClaw 基于 Node.js 运行\n   ```bash\n   node --version  # 检查版本，应该 >= 22\n   ```\n   如果版本不够，建议用 [nvm](https://github.com/nvm-sh/nvm) 安装最新版。\n\n2. **Anthropic API Key**：你需要一个 Claude 的 API 密钥\n   - 前往 [Anthropic Console](https://console.anthropic.com/) 注册账号\n   - 在 API Keys 页面创建新密钥\n   - 记下这个密钥，稍后会用到\n\n### 一键安装\n\nOpenClaw 提供了非常方便的一键安装脚本：\n\n```bash\ncurl -fsSL https://openclaw.ai/install.sh | bash\n```\n\n这个脚本会自动下载并安装 OpenClaw CLI。安装完成后，验证一下：\n\n```bash\nopenclaw --version\n```\n\n### 运行配置向导\n\n安装好之后，运行配置向导来初始化你的 Gateway：\n\n```bash\nopenclaw onboard --install-daemon\n```\n\n向导会引导你完成以下配置：\n\n1. **选择模型提供商**：选择 Anthropic（Claude）\n2. **输入 API Key**：粘贴你刚才获取的 Anthropic API Key\n3. **配置 Gateway 端口**：默认 18789，一般不用改\n4. **选择渠道**：暂时先跳过，我们后面手动配置 Telegram\n\n向导运行完成后，OpenClaw Gateway 会自动启动。\n\n## 配置你的第一个 Telegram Bot\n\n接下来是最有趣的部分：创建一个 Telegram bot，让它接入你的 OpenClaw Gateway。\n\n### 1. 通过 @BotFather 创建 Bot\n\n打开 Telegram，搜索 **@BotFather**（Telegram 官方的 bot 管理工具），然后：\n\n1. 发送 `/newbot` 命令\n2. 输入你的 bot 名称，比如：`My OpenClaw Assistant`\n3. 输入 bot 的用户名（必须以 `bot` 结尾），比如：`my_openclaw_bot`\n4. 创建成功后，**BotFather 会给你一个 Token**，类似：\n   ```\n   7123456789:AAHdqTcvCH1vGWJxfSeofSAs0K5PALDsaw\n   ```\n   **务必保存好这个 Token**！\n\n### 2. 配置 OpenClaw\n\n现在需要把你的 Telegram bot 接入 OpenClaw。编辑配置文件：\n\n```bash\nopenclaw config edit\n```\n\n在配置文件中找到 `channels.telegram` 部分，添加你的 bot 配置：\n\n```yaml\nchannels:\n  telegram:\n    enabled: true\n    accounts:\n      - id: my-bot\n        token: \"7123456789:AAHdqTcvCH1vGWJxfSeofSAs0K5PALDsaw\"\n        agent: main\n```\n\n**参数说明**：\n- `id`：给这个 bot 取个内部标识符，随便起名\n- `token`：刚才从 BotFather 获得的 bot token\n- `agent`：指定使用哪个 Agent（默认的 `main` agent 就够用）\n\n保存配置后，重启 Gateway 让配置生效：\n\n```bash\nopenclaw gateway restart\n```\n\n### 3. 启动验证\n\n检查 Gateway 状态，确保一切正常：\n\n```bash\nopenclaw gateway status\n```\n\n你应该能看到类似这样的输出：\n\n```\n✓ Gateway is running\n  PID: 12345\n  Port: 18789\n  Uptime: 5s\n```\n\n## 测试你的 Bot\n\n现在万事俱备，来测试一下你的 AI 助手吧！\n\n### 发送第一条消息\n\n1. 打开 Telegram，搜索你刚才创建的 bot（用户名）\n2. 点击 **Start** 或发送 `/start`\n3. 发送一条消息，比如：`你好，介绍一下你自己`\n\n如果一切顺利，你的 bot 应该会回复你！这就是 Claude 通过 OpenClaw Gateway 在响应。\n\n### 查看实时日志\n\n想看到 Gateway 内部发生了什么？打开日志监控：\n\n```bash\nopenclaw logs --follow\n```\n\n这会实时显示所有请求、响应、错误信息，方便调试。\n\n### 使用 Web 控制面板\n\nOpenClaw 还提供了一个很实用的 Web 控制面板。打开浏览器访问：\n\n```\nhttp://localhost:18789\n```\n\n在控制面板里，你可以：\n\n- 查看所有对话历史\n- 手动测试对话（不需要通过 Telegram）\n- 查看系统状态和配置\n- 管理多个 Agent\n\n这是最方便的调试工具，强烈推荐试试。\n\n## 常见问题\n\n**Q: Bot 没有回复怎么办？**\n\n检查以下几点：\n1. `openclaw gateway status` 确认 Gateway 正在运行\n2. `openclaw logs --follow` 查看是否有错误信息\n3. 确认 Telegram token 配置正确\n4. 确认 Anthropic API Key 有效且有余额\n\n**Q: 想让 Bot 更智能怎么办？**\n\nOpenClaw 支持自定义 Agent 配置，可以给 Agent 添加记忆、工具、自定义 prompt 等。这些高级功能我会在下一篇文章详细介绍。\n\n**Q: 可以同时配置多个 Bot 吗？**\n\n当然可以！在 `channels.telegram.accounts` 数组里添加多个配置即可，每个 bot 可以指定不同的 agent。\n\n## 下一步\n\n恭喜你！现在你已经成功搭建了一个完全由你掌控的 AI 助手。\n\n如果你想进一步探索 OpenClaw 的强大功能，可以关注我接下来的系列文章：\n\n- **多 Agent 配置**：为不同场景创建专用助手（工作、娱乐、学习）\n- **工具集成**：让 AI 能执行命令、搜索网页、管理文件\n- **记忆系统**：让 AI 记住你的偏好和历史对话\n\n也可以直接查看 [OpenClaw 官方文档](https://openclaw.ai/) 了解更多高级用法。\n\n如果在搭建过程中遇到任何问题，欢迎在评论区留言交流。\n\n---\n\n**相关资源**：\n- OpenClaw 官网：https://openclaw.ai/\n- GitHub 仓库：https://github.com/openclaw/openclaw\n- 官方文档：https://openclaw.ai/docs\n- Anthropic API：https://console.anthropic.com/","src/data/blog/openclaw-getting-started.md","d8888dfacbe8acb6",{html:1197,metadata:1198},"<p>最近在研究如何更高效地使用 AI 助手，发现了一个很有意思的开源项目：<strong>OpenClaw</strong>。它能让你在 Telegram、WhatsApp、Discord 等各种 App 里直接跟 Claude 对话，而且完全由你自己掌控。今天就来分享一下如何从零搭建你的第一个 OpenClaw AI 助手。</p>\n<h2 id=\"openclaw-是什么\">OpenClaw 是什么？</h2>\n<p>简单说，<strong>OpenClaw 是一个自托管的 AI 代理网关</strong>。它帮你把 Claude、GPT 等 AI 模型接入到各种消息平台，让你可以像跟朋友聊天一样跟 AI 交互。</p>\n<h3 id=\"核心特性\">核心特性</h3>\n<ul>\n<li><strong>多渠道支持</strong>：Telegram、WhatsApp、Discord、Slack 等主流平台</li>\n<li><strong>自托管架构</strong>：所有数据留在你自己的服务器上</li>\n<li><strong>灵活配置</strong>：支持多个 Agent、自定义工具、记忆管理</li>\n<li><strong>开箱即用</strong>：内置 Web 控制面板，配置简单</li>\n</ul>\n<h3 id=\"为什么选择自托管\">为什么选择自托管？</h3>\n<p>很多人可能会问：市面上已经有 ChatGPT、Claude.ai 这些现成服务了，为什么还要自己搭建？</p>\n<p><strong>数据隐私</strong>：所有对话记录、配置信息都存储在你自己的设备上，不会被第三方收集。</p>\n<p><strong>完全可控</strong>：想换模型就换模型，想接入哪个平台就接入哪个平台，不受平台限制。</p>\n<p><strong>成本透明</strong>：直接调用 API，按实际用量付费，不用担心订阅费用。</p>\n<p><strong>功能自由</strong>：可以自定义工具、配置记忆系统、接入本地服务，玩法更多。</p>\n<p>对于开发者和注重隐私的用户来说，自托管是个更好的选择。</p>\n<h2 id=\"快速安装macos\">快速安装（macOS）</h2>\n<p>下面以 macOS 为例，演示如何安装 OpenClaw。其他系统的安装方法类似，可以参考<a href=\"https://openclaw.ai/install\">官方文档</a>。</p>\n<h3 id=\"前置条件\">前置条件</h3>\n<p>在开始之前，确保你的系统满足以下条件：</p>\n<ol>\n<li>\n<p><strong>Node.js 22+</strong>：OpenClaw 基于 Node.js 运行</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">node</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\"> --version</span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  # 检查版本，应该 >= 22</span></span></code></pre>\n<p>如果版本不够，建议用 <a href=\"https://github.com/nvm-sh/nvm\">nvm</a> 安装最新版。</p>\n</li>\n<li>\n<p><strong>Anthropic API Key</strong>：你需要一个 Claude 的 API 密钥</p>\n<ul>\n<li>前往 <a href=\"https://console.anthropic.com/\">Anthropic Console</a> 注册账号</li>\n<li>在 API Keys 页面创建新密钥</li>\n<li>记下这个密钥，稍后会用到</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"一键安装\">一键安装</h3>\n<p>OpenClaw 提供了非常方便的一键安装脚本：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">curl</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\"> -fsSL</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> https://openclaw.ai/install.sh</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> |</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> bash</span></span></code></pre>\n<p>这个脚本会自动下载并安装 OpenClaw CLI。安装完成后，验证一下：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">openclaw</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\"> --version</span></span></code></pre>\n<h3 id=\"运行配置向导\">运行配置向导</h3>\n<p>安装好之后，运行配置向导来初始化你的 Gateway：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">openclaw</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> onboard</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\"> --install-daemon</span></span></code></pre>\n<p>向导会引导你完成以下配置：</p>\n<ol>\n<li><strong>选择模型提供商</strong>：选择 Anthropic（Claude）</li>\n<li><strong>输入 API Key</strong>：粘贴你刚才获取的 Anthropic API Key</li>\n<li><strong>配置 Gateway 端口</strong>：默认 18789，一般不用改</li>\n<li><strong>选择渠道</strong>：暂时先跳过，我们后面手动配置 Telegram</li>\n</ol>\n<p>向导运行完成后，OpenClaw Gateway 会自动启动。</p>\n<h2 id=\"配置你的第一个-telegram-bot\">配置你的第一个 Telegram Bot</h2>\n<p>接下来是最有趣的部分：创建一个 Telegram bot，让它接入你的 OpenClaw Gateway。</p>\n<h3 id=\"1-通过-botfather-创建-bot\">1. 通过 @BotFather 创建 Bot</h3>\n<p>打开 Telegram，搜索 <strong>@BotFather</strong>（Telegram 官方的 bot 管理工具），然后：</p>\n<ol>\n<li>发送 <code>/newbot</code> 命令</li>\n<li>输入你的 bot 名称，比如：<code>My OpenClaw Assistant</code></li>\n<li>输入 bot 的用户名（必须以 <code>bot</code> 结尾），比如：<code>my_openclaw_bot</code></li>\n<li>创建成功后，<strong>BotFather 会给你一个 Token</strong>，类似：\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"plaintext\"><code><span class=\"line\"><span>7123456789:AAHdqTcvCH1vGWJxfSeofSAs0K5PALDsaw</span></span></code></pre>\n<strong>务必保存好这个 Token</strong>！</li>\n</ol>\n<h3 id=\"2-配置-openclaw\">2. 配置 OpenClaw</h3>\n<p>现在需要把你的 Telegram bot 接入 OpenClaw。编辑配置文件：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">openclaw</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> config</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> edit</span></span></code></pre>\n<p>在配置文件中找到 <code>channels.telegram</code> 部分，添加你的 bot 配置：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"yaml\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">channels</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">  telegram</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">    enabled</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\"> true</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">    accounts</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      - </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">id</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\"> my-bot</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">        token</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">7123456789:AAHdqTcvCH1vGWJxfSeofSAs0K5PALDsaw</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">        agent</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\"> main</span></span></code></pre>\n<p><strong>参数说明</strong>：</p>\n<ul>\n<li><code>id</code>：给这个 bot 取个内部标识符，随便起名</li>\n<li><code>token</code>：刚才从 BotFather 获得的 bot token</li>\n<li><code>agent</code>：指定使用哪个 Agent（默认的 <code>main</code> agent 就够用）</li>\n</ul>\n<p>保存配置后，重启 Gateway 让配置生效：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">openclaw</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> gateway</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> restart</span></span></code></pre>\n<h3 id=\"3-启动验证\">3. 启动验证</h3>\n<p>检查 Gateway 状态，确保一切正常：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">openclaw</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> gateway</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> status</span></span></code></pre>\n<p>你应该能看到类似这样的输出：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"plaintext\"><code><span class=\"line\"><span>✓ Gateway is running</span></span>\n<span class=\"line\"><span>  PID: 12345</span></span>\n<span class=\"line\"><span>  Port: 18789</span></span>\n<span class=\"line\"><span>  Uptime: 5s</span></span></code></pre>\n<h2 id=\"测试你的-bot\">测试你的 Bot</h2>\n<p>现在万事俱备，来测试一下你的 AI 助手吧！</p>\n<h3 id=\"发送第一条消息\">发送第一条消息</h3>\n<ol>\n<li>打开 Telegram，搜索你刚才创建的 bot（用户名）</li>\n<li>点击 <strong>Start</strong> 或发送 <code>/start</code></li>\n<li>发送一条消息，比如：<code>你好，介绍一下你自己</code></li>\n</ol>\n<p>如果一切顺利，你的 bot 应该会回复你！这就是 Claude 通过 OpenClaw Gateway 在响应。</p>\n<h3 id=\"查看实时日志\">查看实时日志</h3>\n<p>想看到 Gateway 内部发生了什么？打开日志监控：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">openclaw</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> logs</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\"> --follow</span></span></code></pre>\n<p>这会实时显示所有请求、响应、错误信息，方便调试。</p>\n<h3 id=\"使用-web-控制面板\">使用 Web 控制面板</h3>\n<p>OpenClaw 还提供了一个很实用的 Web 控制面板。打开浏览器访问：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"plaintext\"><code><span class=\"line\"><span>http://localhost:18789</span></span></code></pre>\n<p>在控制面板里，你可以：</p>\n<ul>\n<li>查看所有对话历史</li>\n<li>手动测试对话（不需要通过 Telegram）</li>\n<li>查看系统状态和配置</li>\n<li>管理多个 Agent</li>\n</ul>\n<p>这是最方便的调试工具，强烈推荐试试。</p>\n<h2 id=\"常见问题\">常见问题</h2>\n<p><strong>Q: Bot 没有回复怎么办？</strong></p>\n<p>检查以下几点：</p>\n<ol>\n<li><code>openclaw gateway status</code> 确认 Gateway 正在运行</li>\n<li><code>openclaw logs --follow</code> 查看是否有错误信息</li>\n<li>确认 Telegram token 配置正确</li>\n<li>确认 Anthropic API Key 有效且有余额</li>\n</ol>\n<p><strong>Q: 想让 Bot 更智能怎么办？</strong></p>\n<p>OpenClaw 支持自定义 Agent 配置，可以给 Agent 添加记忆、工具、自定义 prompt 等。这些高级功能我会在下一篇文章详细介绍。</p>\n<p><strong>Q: 可以同时配置多个 Bot 吗？</strong></p>\n<p>当然可以！在 <code>channels.telegram.accounts</code> 数组里添加多个配置即可，每个 bot 可以指定不同的 agent。</p>\n<h2 id=\"下一步\">下一步</h2>\n<p>恭喜你！现在你已经成功搭建了一个完全由你掌控的 AI 助手。</p>\n<p>如果你想进一步探索 OpenClaw 的强大功能，可以关注我接下来的系列文章：</p>\n<ul>\n<li><strong>多 Agent 配置</strong>：为不同场景创建专用助手（工作、娱乐、学习）</li>\n<li><strong>工具集成</strong>：让 AI 能执行命令、搜索网页、管理文件</li>\n<li><strong>记忆系统</strong>：让 AI 记住你的偏好和历史对话</li>\n</ul>\n<p>也可以直接查看 <a href=\"https://openclaw.ai/\">OpenClaw 官方文档</a> 了解更多高级用法。</p>\n<p>如果在搭建过程中遇到任何问题，欢迎在评论区留言交流。</p>\n<hr>\n<p><strong>相关资源</strong>：</p>\n<ul>\n<li>OpenClaw 官网：<a href=\"https://openclaw.ai/\">https://openclaw.ai/</a></li>\n<li>GitHub 仓库：<a href=\"https://github.com/openclaw/openclaw\">https://github.com/openclaw/openclaw</a></li>\n<li>官方文档：<a href=\"https://openclaw.ai/docs\">https://openclaw.ai/docs</a></li>\n<li>Anthropic API：<a href=\"https://console.anthropic.com/\">https://console.anthropic.com/</a></li>\n</ul>",{headings:1199,localImagePaths:1243,remoteImagePaths:1244,frontmatter:1245,imagePaths:1248},[1200,1203,1205,1208,1211,1213,1215,1217,1220,1223,1226,1229,1232,1234,1236,1239,1241],{depth:31,slug:1201,text:1202},"openclaw-是什么","OpenClaw 是什么？",{depth:185,slug:1204,text:1204},"核心特性",{depth:185,slug:1206,text:1207},"为什么选择自托管","为什么选择自托管？",{depth:31,slug:1209,text:1210},"快速安装macos","快速安装（macOS）",{depth:185,slug:1212,text:1212},"前置条件",{depth:185,slug:1214,text:1214},"一键安装",{depth:185,slug:1216,text:1216},"运行配置向导",{depth:31,slug:1218,text:1219},"配置你的第一个-telegram-bot","配置你的第一个 Telegram Bot",{depth:185,slug:1221,text:1222},"1-通过-botfather-创建-bot","1. 通过 @BotFather 创建 Bot",{depth:185,slug:1224,text:1225},"2-配置-openclaw","2. 配置 OpenClaw",{depth:185,slug:1227,text:1228},"3-启动验证","3. 启动验证",{depth:31,slug:1230,text:1231},"测试你的-bot","测试你的 Bot",{depth:185,slug:1233,text:1233},"发送第一条消息",{depth:185,slug:1235,text:1235},"查看实时日志",{depth:185,slug:1237,text:1238},"使用-web-控制面板","使用 Web 控制面板",{depth:31,slug:1240,text:1240},"常见问题",{depth:31,slug:1242,text:1242},"下一步",[],[],{author:14,pubDatetime:1246,title:1188,slug:1184,featured:165,draft:17,tags:1247,description:1192},["Date","2026-02-12T16:40:00.000Z"],[1190,167,1191],[],"online-tools",{id:1249,data:1251,body:1256,filePath:1257,digest:1258,rendered:1259},{author:14,pubDatetime:1252,title:1253,featured:165,draft:17,tags:1254,description:1255},["Date","2026-02-11T10:00:00.000Z"],"博客上线两款实用在线工具：二维码生成器 & CSV 转 JSON",[169,19],"介绍博客新上线的两款纯前端在线工具——二维码生成/解析和 CSV 转 JSON 转换器。","## 工具上线了！\n\n技术博客不只有文章，也可以有实用的小工具。今天上线两款纯前端在线工具，无需安装、无需注册、数据不上传服务器，打开浏览器就能用。\n\n👉 [工具入口](/tools)\n\n---\n\n## 1. 📱 二维码生成 & 解析\n\n**地址**: [/tools/qrcode](/tools/qrcode)\n\n### 能做什么？\n\n**生成二维码**：输入任意文本或 URL，实时生成二维码图片，支持一键下载 PNG。\n\n**解析二维码**：上传一张二维码图片，自动识别并显示内容。扫码枪坏了？截图上传就行。\n\n### 使用场景\n\n- 快速生成 Wi-Fi 分享二维码\n- 把一段文本编码成二维码传给同事\n- 拿到一张二维码截图，不想掏手机扫——直接上传解析\n- 生成 URL 短链接的二维码\n\n### 技术实现\n\n纯前端实现，使用 [qrcode](https://github.com/soldair/node-qrcode) 生成、[jsQR](https://github.com/cozmo/jsQR) 解析。所有计算都在浏览器本地完成，**你的数据不会离开你的设备**。\n\n---\n\n## 2. 📊 CSV 转 JSON\n\n**地址**: [/tools/csv-to-json](/tools/csv-to-json)\n\n### 能做什么？\n\n将 CSV 数据实时转换为 JSON 格式。支持两种模式：\n\n**普通模式**：CSV 的每一行转为一个 JSON 对象，首行作为字段名。\n\n```\nname,age,city\nAlice,30,Beijing\nBob,25,Shanghai\n```\n\n输出：\n\n```json\n[\n  { \"name\": \"Alice\", \"age\": \"30\", \"city\": \"Beijing\" },\n  { \"name\": \"Bob\", \"age\": \"25\", \"city\": \"Shanghai\" }\n]\n```\n\n**Key 模式**（首列为 `key` 时自动触发）：每一列生成一个独立的 JSON 文件，key 列的值作为键名。这个模式对**国际化（i18n）场景**特别好用：\n\n```\nkey,en,zh,ja\nlogout,Logout,登出,ログアウト\nlogin,Login,登入,ログイン\n```\n\n自动生成三个文件：\n\n**en.json**\n```json\n{ \"logout\": \"Logout\", \"login\": \"Login\" }\n```\n\n**zh.json**\n```json\n{ \"logout\": \"登出\", \"login\": \"登入\" }\n```\n\n**ja.json**\n```json\n{ \"logout\": \"ログアウト\", \"login\": \"ログイン\" }\n```\n\n每个文件支持**单独复制**和**单独下载**，也可以一键**全部下载**。\n\n### 使用场景\n\n- 后端给了 CSV 数据，前端需要 JSON 格式\n- 多语言翻译表 → 直接生成各语言的 i18n JSON 文件\n- Excel 导出的 CSV → 快速转为 API Mock 数据\n- 自定义分隔符（支持 Tab、分号等）\n\n### 技术实现\n\n同样是纯前端，支持文件上传和手动输入。CSV 解析处理了引号转义、自定义分隔符等边界情况。\n\n---\n\n## 为什么做纯前端工具？\n\n1. **隐私安全** — 数据不离开浏览器，不经过任何服务器\n2. **零依赖** — 不需要安装任何东西，打开就用\n3. **离线可用** — 加载完页面后断网也能正常使用\n4. **响应快** — 没有网络请求，转换是实时的\n\n后续还会陆续增加更多实用工具，有什么需求欢迎留言！\n\n👉 [立即使用](/tools)","src/data/blog/online-tools.md","ae2913249f72e2d9",{html:1260,metadata:1261},"<h2 id=\"工具上线了\">工具上线了！</h2>\n<p>技术博客不只有文章，也可以有实用的小工具。今天上线两款纯前端在线工具，无需安装、无需注册、数据不上传服务器，打开浏览器就能用。</p>\n<p>👉 <a href=\"/tools\">工具入口</a></p>\n<hr>\n<h2 id=\"1--二维码生成--解析\">1. 📱 二维码生成 &#x26; 解析</h2>\n<p><strong>地址</strong>: <a href=\"/tools/qrcode\">/tools/qrcode</a></p>\n<h3 id=\"能做什么\">能做什么？</h3>\n<p><strong>生成二维码</strong>：输入任意文本或 URL，实时生成二维码图片，支持一键下载 PNG。</p>\n<p><strong>解析二维码</strong>：上传一张二维码图片，自动识别并显示内容。扫码枪坏了？截图上传就行。</p>\n<h3 id=\"使用场景\">使用场景</h3>\n<ul>\n<li>快速生成 Wi-Fi 分享二维码</li>\n<li>把一段文本编码成二维码传给同事</li>\n<li>拿到一张二维码截图，不想掏手机扫——直接上传解析</li>\n<li>生成 URL 短链接的二维码</li>\n</ul>\n<h3 id=\"技术实现\">技术实现</h3>\n<p>纯前端实现，使用 <a href=\"https://github.com/soldair/node-qrcode\">qrcode</a> 生成、<a href=\"https://github.com/cozmo/jsQR\">jsQR</a> 解析。所有计算都在浏览器本地完成，<strong>你的数据不会离开你的设备</strong>。</p>\n<hr>\n<h2 id=\"2--csv-转-json\">2. 📊 CSV 转 JSON</h2>\n<p><strong>地址</strong>: <a href=\"/tools/csv-to-json\">/tools/csv-to-json</a></p>\n<h3 id=\"能做什么-1\">能做什么？</h3>\n<p>将 CSV 数据实时转换为 JSON 格式。支持两种模式：</p>\n<p><strong>普通模式</strong>：CSV 的每一行转为一个 JSON 对象，首行作为字段名。</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"plaintext\"><code><span class=\"line\"><span>name,age,city</span></span>\n<span class=\"line\"><span>Alice,30,Beijing</span></span>\n<span class=\"line\"><span>Bob,25,Shanghai</span></span></code></pre>\n<p>输出：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"json\"><code><span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  { </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">\"name\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#C789D6\">Alice</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> \"age\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#C789D6\">30</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> \"city\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#C789D6\">Beijing</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> }</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  { </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">\"name\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#C789D6\">Bob</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> \"age\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#C789D6\">25</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> \"city\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#C789D6\">Shanghai</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]</span></span></code></pre>\n<p><strong>Key 模式</strong>（首列为 <code>key</code> 时自动触发）：每一列生成一个独立的 JSON 文件，key 列的值作为键名。这个模式对<strong>国际化（i18n）场景</strong>特别好用：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"plaintext\"><code><span class=\"line\"><span>key,en,zh,ja</span></span>\n<span class=\"line\"><span>logout,Logout,登出,ログアウト</span></span>\n<span class=\"line\"><span>login,Login,登入,ログイン</span></span></code></pre>\n<p>自动生成三个文件：</p>\n<p><strong>en.json</strong></p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"json\"><code><span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">{ </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">\"logout\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#C789D6\">Logout</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> \"login\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#C789D6\">Login</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> }</span></span></code></pre>\n<p><strong>zh.json</strong></p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"json\"><code><span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">{ </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">\"logout\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#C789D6\">登出</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> \"login\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#C789D6\">登入</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> }</span></span></code></pre>\n<p><strong>ja.json</strong></p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"json\"><code><span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">{ </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">\"logout\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#C789D6\">ログアウト</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> \"login\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#C789D6\">ログイン</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> }</span></span></code></pre>\n<p>每个文件支持<strong>单独复制</strong>和<strong>单独下载</strong>，也可以一键<strong>全部下载</strong>。</p>\n<h3 id=\"使用场景-1\">使用场景</h3>\n<ul>\n<li>后端给了 CSV 数据，前端需要 JSON 格式</li>\n<li>多语言翻译表 → 直接生成各语言的 i18n JSON 文件</li>\n<li>Excel 导出的 CSV → 快速转为 API Mock 数据</li>\n<li>自定义分隔符（支持 Tab、分号等）</li>\n</ul>\n<h3 id=\"技术实现-1\">技术实现</h3>\n<p>同样是纯前端，支持文件上传和手动输入。CSV 解析处理了引号转义、自定义分隔符等边界情况。</p>\n<hr>\n<h2 id=\"为什么做纯前端工具\">为什么做纯前端工具？</h2>\n<ol>\n<li><strong>隐私安全</strong> — 数据不离开浏览器，不经过任何服务器</li>\n<li><strong>零依赖</strong> — 不需要安装任何东西，打开就用</li>\n<li><strong>离线可用</strong> — 加载完页面后断网也能正常使用</li>\n<li><strong>响应快</strong> — 没有网络请求，转换是实时的</li>\n</ol>\n<p>后续还会陆续增加更多实用工具，有什么需求欢迎留言！</p>\n<p>👉 <a href=\"/tools\">立即使用</a></p>",{headings:1262,localImagePaths:1288,remoteImagePaths:1289,frontmatter:1290,imagePaths:1293},[1263,1266,1269,1272,1274,1276,1279,1281,1283,1285],{depth:31,slug:1264,text:1265},"工具上线了","工具上线了！",{depth:31,slug:1267,text:1268},"1--二维码生成--解析","1. 📱 二维码生成 & 解析",{depth:185,slug:1270,text:1271},"能做什么","能做什么？",{depth:185,slug:1273,text:1273},"使用场景",{depth:185,slug:1275,text:1275},"技术实现",{depth:31,slug:1277,text:1278},"2--csv-转-json","2. 📊 CSV 转 JSON",{depth:185,slug:1280,text:1271},"能做什么-1",{depth:185,slug:1282,text:1273},"使用场景-1",{depth:185,slug:1284,text:1275},"技术实现-1",{depth:31,slug:1286,text:1287},"为什么做纯前端工具","为什么做纯前端工具？",[],[],{author:14,pubDatetime:1291,title:1253,slug:1249,featured:165,draft:17,tags:1292,description:1255},["Date","2026-02-11T10:00:00.000Z"],[169,19],[],"polyfill-number-isnan",{id:1294,data:1296,body:1302,filePath:1303,digest:1304,rendered:1305},{author:14,pubDatetime:1297,title:1298,featured:17,draft:17,tags:1299,description:1301},["Date","2018-07-01T02:00:00.000Z"],"Polyfill 学习：Number.isNaN",[20,1300],"polyfill","利用 NaN 不等于自身的特性实现 Number.isNaN。","NaN 是唯一一个不等于自身的值：\n\n```js\nif (!Number.isNaN) {\n  Number.isNaN = function (n) {\n    return n !== n;\n  };\n}\n```\n\n注意 `window.isNaN('a')` 返回 `true`，而 `Number.isNaN('a')` 返回 `false`。","src/data/blog/polyfill-number-isnan.md","0332bb3949ef6a4b",{html:1306,metadata:1307},"<p>NaN 是唯一一个不等于自身的值：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">!</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">Number</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">isNaN</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">  Number</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">isNaN</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> function</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">n</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> n</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> !==</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> n</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  };</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span></code></pre>\n<p>注意 <code>window.isNaN('a')</code> 返回 <code>true</code>，而 <code>Number.isNaN('a')</code> 返回 <code>false</code>。</p>",{headings:1308,localImagePaths:1309,remoteImagePaths:1310,frontmatter:1311,imagePaths:1314},[],[],[],{author:14,pubDatetime:1312,title:1298,slug:1294,featured:17,draft:17,tags:1313,description:1301},["Date","2018-07-01T02:00:00.000Z"],[20,1300],[],"polyfill-object-is",{id:1315,data:1317,body:1322,filePath:1323,digest:1324,rendered:1325},{author:14,pubDatetime:1318,title:1319,featured:17,draft:17,tags:1320,description:1321},["Date","2019-08-15T02:00:00.000Z"],"Polyfill 学习：Object.is",[20,1300],"Object.is 解决了 0 === -0 和 NaN !== NaN 的问题。","`===` 的两个坑：\n\n```js\n0 === -0; // true\nNaN === NaN; // false\n```\n\nPolyfill：\n\n```js\nif (!Object.is) {\n  Object.is = function (v1, v2) {\n    // 检查 -0\n    if (v1 === 0 && v2 === 0) {\n      return 1 / v1 === 1 / v2;\n    }\n    // 检查 NaN\n    if (v1 !== v1) {\n      return v2 !== v2;\n    }\n    return v1 === v2;\n  };\n}\n```","src/data/blog/polyfill-object-is.md","8fe503d750037a88",{html:1326,metadata:1327},"<p><code>===</code> 的两个坑：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">0</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ===</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> -</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">0</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// true</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\">NaN</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ===</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\"> NaN</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// false</span></span></code></pre>\n<p>Polyfill：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">!</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">Object</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">is</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">  Object</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">is</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> function</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">v1</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> v2</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 检查 -0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">v1</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ===</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 0</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> &#x26;&#x26;</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> v2</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ===</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 0</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">      return</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> /</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> v1</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ===</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> /</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> v2</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 检查 NaN</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">v1</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> !==</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> v1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">      return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> v2</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> !==</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> v2</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> v1</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ===</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> v2</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  };</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span></code></pre>",{headings:1328,localImagePaths:1329,remoteImagePaths:1330,frontmatter:1331,imagePaths:1334},[],[],[],{author:14,pubDatetime:1332,title:1319,slug:1315,featured:17,draft:17,tags:1333,description:1321},["Date","2019-08-15T02:00:00.000Z"],[20,1300],[],"openclaw-multi-agent-guide",{id:1335,data:1337,body:1343,filePath:1344,digest:1345,rendered:1346},{author:14,pubDatetime:1338,title:1339,featured:165,draft:17,tags:1340,description:1342},["Date","2026-02-12T16:45:00.000Z"],"OpenClaw 多 Agent 配置实战：踩坑指南与最佳实践",[1190,167,1341],"配置","配置 OpenClaw 多 Agent 和 Telegram 多账号有不少坑。本文基于实战经验，总结所有常见问题和解决方案，让你少走弯路。","如果你已经用了一段时间 OpenClaw，肯定会遇到这样的需求：我需要一个专门写博客的 AI 助手，一个写小说的，一个做代码开发的……每个都有独立的角色定位、工作目录和配置。这就是多 Agent 配置要解决的问题。\n\n本文不是理论教程，而是实战踩坑记录。我会告诉你配置过程中会遇到哪些坑，为什么会踩坑，以及怎么避免和解决。\n\n## 为什么需要多 Agent\n\n**场景隔离**。不同的工作场景需要不同的 AI 助手：\n\n- **博客助手**：专注于技术写作，熟悉你的博客部署流程，有独立的文章草稿目录\n- **小说助手**：创意写作风格，管理小说章节和人物设定，不需要访问技术代码\n- **开发助手**：熟悉代码规范，可以执行敏感命令，但不应该访问私人笔记\n- **家庭助手**：绑定到家庭 WhatsApp 群，只能访问受限的工具集，保护隐私\n\n**独立配置**。每个 Agent 有自己的：\n- **Workspace**：独立的工作目录，互不干扰\n- **SOUL.md**：独立的角色定位和性格设定\n- **Model**：可以给不同 Agent 配置不同模型（Opus 做深度思考，Sonnet 做日常聊天）\n- **Tool Policy**：限制某些 Agent 的工具权限（比如家庭助手不能执行 shell 命令）\n\n**账号路由**。多个 Telegram bot 或 WhatsApp 账号，路由到不同的 Agent，一个 Gateway 管理所有账号。\n\n举个例子，你可能会配置这样的 Agent：\n- `main`：日常聊天，全功能\n- `work`：工作场景，可以访问项目文档\n- `creative`：创作助手，专注于写作\n- `coding`：开发助手，执行代码相关任务\n\n## 多 Agent 配置流程\n\n### 1. 创建 Agent\n\n```bash\n# 创建一个新 Agent\nopenclaw agents add blog --workspace ~/.openclaw/workspace-blog\n\n# 验证创建结果\nopenclaw agents list\n```\n\n这会在配置文件中添加：\n\n```json5\n{\n  agents: {\n    list: [\n      {\n        id: \"main\",\n        default: true,\n        workspace: \"~/.openclaw/workspace\",\n      },\n      {\n        id: \"blog\",\n        workspace: \"~/.openclaw/workspace-blog\",\n      },\n    ],\n  },\n}\n```\n\n### 2. 设置模型\n\n**⚠️ 第一个坑：模型 ID 格式**\n\n配置模型时，要用**别名**，不要带日期后缀！\n\n```bash\n# ✅ 正确：使用别名\nopenclaw config patch agents.list.1.model \"anthropic/claude-sonnet-4-5\"\n\n# ❌ 错误：带日期后缀的完整 ID\nopenclaw config patch agents.list.1.model \"anthropic/claude-sonnet-4-20250514\"\n```\n\n**为什么？**\n\n带日期的 ID 会在新版本发布时失效。别名（如 `claude-sonnet-4-5`）会自动指向最新版本。\n\n验证配置：\n\n```bash\nopenclaw config get agents.list.1.model\n# 应该输出：anthropic/claude-sonnet-4-5\n```\n\n### 3. 编写 SOUL.md 定义角色\n\n每个 Agent 的 workspace 下创建 `SOUL.md`，定义它的角色：\n\n```bash\ncd ~/.openclaw/workspace-blog\n```\n\n创建 `SOUL.md`：\n\n```markdown\n# SOUL.md - 工作助手\n\n你是工作助手，帮助处理日常工作任务。\n\n## 角色定位\n- 专注于工作场景，风格专业高效\n- 熟悉常用开发工具和工作流程\n- 所有重要操作需要确认后执行\n\n## 工作流程\n1. 接收任务需求\n2. 分析任务并制定执行计划\n3. 执行任务\n4. 汇报结果\n\n## 工作规范\n- 代码示例要完整可用\n- 文档结构清晰\n- 操作前确认权限\n```\n\n**⚠️ 第二个坑：不要创建 BOOTSTRAP.md**\n\n如果你手动创建了 `BOOTSTRAP.md`，Agent 会一直卡在 bootstrapping 状态！\n\n**为什么？**\n\n`BOOTSTRAP.md` 是 Agent 的\"初始化任务清单\"。Agent 启动后会执行里面的指令，执行完才会删除这个文件。如果你手动创建了这个文件但内容不完整，Agent 会不断尝试执行，永远无法进入正常状态。\n\n**解决方法：**\n\n```bash\n# 如果发现 Agent 卡住了，检查是否有 BOOTSTRAP.md\nls ~/.openclaw/workspace-blog/BOOTSTRAP.md\n\n# 如果存在，直接删除\nrm ~/.openclaw/workspace-blog/BOOTSTRAP.md\n\n# 重启 Gateway\nopenclaw gateway restart\n```\n\n### 4. 测试 Agent\n\n```bash\n# 列出所有 Agent\nopenclaw agents list\n\n# 查看 Agent 详细配置\nopenclaw config get agents.list.1\n\n# 重启 Gateway 让配置生效\nopenclaw gateway restart\n```\n\n## Telegram 多账号配置\n\n多 Agent 的典型用法是配置多个 Telegram bot，每个 bot 路由到不同的 Agent。\n\n### 1. 创建 Telegram Bot\n\n在 Telegram 找 [@BotFather](https://t.me/BotFather)，创建 bot：\n\n```\n/newbot\n```\n\n按提示输入名称和用户名，获得 token（类似 `1234567890:ABCdefGHIjklMNOpqrsTUVwxyz`）。\n\n假设你创建了两个 bot：\n- `@MyMainBot` → token1\n- `@MyWorkBot` → token2\n\n### 2. 配置多账号\n\n编辑 `~/.openclaw/openclaw.json`（或用 `openclaw config patch`）：\n\n```json5\n{\n  channels: {\n    telegram: {\n      accounts: {\n        main: {\n          token: \"token1\",\n          dmPolicy: \"allowlist\",\n          allowFrom: [\"123456789\"], // 你的 Telegram user ID\n        },\n        blog: {\n          token: \"token2\",\n          dmPolicy: \"allowlist\",\n          allowFrom: [\"123456789\"],\n        },\n      },\n    },\n  },\n}\n```\n\n**⚠️ 第三个坑：dmPolicy 默认值**\n\n如果不设置 `dmPolicy`，默认是 `pairing`，这意味着用户必须先执行 `/pair` 命令才能聊天。但如果配置有问题，`/pair` 可能也不会响应，消息会被**静默丢弃**！\n\n**解决方法：**\n\n明确设置 `dmPolicy: \"allowlist\"`，并配置 `allowFrom` 列表：\n\n```json5\n{\n  dmPolicy: \"allowlist\",\n  allowFrom: [\"123456789\", \"987654321\"], // 允许的 user ID 列表\n}\n```\n\n获取你的 Telegram user ID：给 [@userinfobot](https://t.me/userinfobot) 发消息。\n\n### 3. 配置路由规则\n\n添加 `bindings` 将不同的 Telegram 账号路由到不同的 Agent：\n\n```json5\n{\n  bindings: [\n    {\n      agentId: \"main\",\n      match: { channel: \"telegram\", accountId: \"main\" },\n    },\n    {\n      agentId: \"blog\",\n      match: { channel: \"telegram\", accountId: \"blog\" },\n    },\n  ],\n}\n```\n\n**路由规则优先级**：\n1. `peer` 精确匹配（具体的 DM 或群组 ID）\n2. `accountId` 匹配（哪个 Telegram 账号）\n3. `channel` 匹配（哪个平台）\n4. 默认 Agent（`default: true` 或列表中第一个）\n\n### 4. 重启 Gateway\n\n```bash\nopenclaw gateway restart --reason \"添加新 Telegram bot\"\n```\n\n测试：给两个 bot 发 `/start`，应该分别收到来自不同 Agent 的回复。\n\n## 常见问题与解决\n\n### 问题 1：config.patch 把配置冲掉了\n\n**现象：**\n\n我想给 `telegram.accounts` 添加一个新账号，执行：\n\n```bash\nopenclaw config patch channels.telegram.accounts.blog '{\"token\":\"xxx\"}'\n```\n\n结果其他账号的配置全没了！\n\n**原因：**\n\n`config.patch` 对**嵌套对象**是**整体替换**，不是增量修改！\n\n如果配置是：\n\n```json5\n{\n  channels: {\n    telegram: {\n      accounts: {\n        main: {...},\n        novel: {...},\n      },\n    },\n  },\n}\n```\n\n执行 `patch channels.telegram.accounts.blog {...}` 会导致：\n\n```json5\n{\n  channels: {\n    telegram: {\n      accounts: {\n        blog: {...}, // 只剩这一个！\n      },\n    },\n  },\n}\n```\n\n**解决方法：**\n\npatch 时带上**完整的对象**：\n\n```bash\n# ❌ 错误：只 patch 一个子项\nopenclaw config patch channels.telegram.accounts.blog '{\"token\":\"xxx\"}'\n\n# ✅ 正确：patch 整个 accounts 对象\nopenclaw config patch channels.telegram.accounts '{\n  \"main\": {\"token\":\"token1\", \"dmPolicy\":\"allowlist\", \"allowFrom\":[\"123456789\"]},\n  \"blog\": {\"token\":\"token2\", \"dmPolicy\":\"allowlist\", \"allowFrom\":[\"123456789\"]}\n}'\n```\n\n同样适用于 `bindings`、`agents.list` 等数组或对象。\n\n**最佳实践：**\n\n配置变更前，先导出当前配置：\n\n```bash\n# 导出当前配置\nopenclaw config get channels.telegram.accounts > telegram-accounts-backup.json\n\n# 编辑后再 patch 回去\nopenclaw config patch channels.telegram.accounts \"$(cat telegram-accounts-edited.json)\"\n```\n\n### 问题 2：Telegram bot 不响应消息\n\n**现象：**\n\n给 bot 发 `/start` 或任何消息，都没有回复。\n\n**可能的原因 1：dmPolicy 配置问题**\n\n检查配置：\n\n```bash\nopenclaw config get channels.telegram.accounts.blog.dmPolicy\n```\n\n如果是 `pairing` 或未设置，改成 `allowlist`：\n\n```bash\nopenclaw config patch channels.telegram.accounts.blog.dmPolicy '\"allowlist\"'\nopenclaw config patch channels.telegram.accounts.blog.allowFrom '[\"123456789\"]'\nopenclaw gateway restart\n```\n\n**可能的原因 2：Telegram 409 冲突**\n\n**症状：** 日志中有 `getUpdates conflict (409)` 错误。\n\n**原因：** 同一个 bot token 被多个实例同时使用！常见场景：\n- OpenClaw.app (GUI) 和 CLI gateway 同时运行\n- 两个 terminal 同时启动了 gateway\n\n**检查：**\n\n```bash\nps aux | grep -i openclaw\n```\n\n如果看到多个进程（GUI app 和 CLI gateway），说明冲突了。\n\n**解决方法：**\n\n1. 退出 OpenClaw.app (GUI)\n2. 重启 CLI gateway：\n\n```bash\nopenclaw gateway restart --reason \"清除 Telegram bot 冲突\"\n```\n\n**教训：**\n\n同一个 Telegram bot token **只能被一个 Gateway 实例使用**。如果要切换 GUI/CLI，必须先停掉其中一个。\n\n### 问题 3：绑定规则不生效\n\n**现象：**\n\n配置了 `bindings`，但消息还是路由到了错误的 Agent。\n\n**检查绑定：**\n\n```bash\nopenclaw agents list --bindings\n```\n\n**常见错误：**\n\n1. **顺序错误**：更具体的规则要放在前面\n\n```json5\n// ❌ 错误：通配规则在前，精确规则在后\nbindings: [\n  { agentId: \"main\", match: { channel: \"telegram\" } }, // 会匹配所有 telegram 消息\n  { agentId: \"blog\", match: { channel: \"telegram\", accountId: \"blog\" } }, // 永远不会执行\n]\n\n// ✅ 正确：精确规则在前\nbindings: [\n  { agentId: \"blog\", match: { channel: \"telegram\", accountId: \"blog\" } },\n  { agentId: \"main\", match: { channel: \"telegram\", accountId: \"main\" } },\n]\n```\n\n2. **accountId 拼写错误**：检查是否与 `channels.telegram.accounts` 中的 key 一致\n\n```bash\n# 列出所有配置的账号\nopenclaw config get channels.telegram.accounts | jq 'keys'\n```\n\n### 问题 4：Agent 配置变更后不生效\n\n**解决方法：**\n\nGateway 需要重启才能加载新配置：\n\n```bash\nopenclaw gateway restart --reason \"更新 Agent 配置\"\n```\n\n检查 Agent 是否正常启动：\n\n```bash\nopenclaw status --deep\n```\n\n如果看到某个 Agent 状态异常，查看日志：\n\n```bash\ntail -n 100 ~/.openclaw/gateway.err.log\n```\n\n### 问题 5：配置了嵌套对象，但只有部分生效\n\n**现象：**\n\n我在顶层配置了 `channels.telegram.dmPolicy`，为什么某个账号还是用了不同的策略？\n\n**原因：**\n\n配置有**继承关系**，account 级别的配置会**覆盖**顶层配置：\n\n```json5\n{\n  channels: {\n    telegram: {\n      dmPolicy: \"allowlist\", // 顶层默认\n      allowFrom: [\"123456789\"],\n      accounts: {\n        main: {\n          token: \"token1\",\n          // 继承顶层的 dmPolicy 和 allowFrom\n        },\n        public: {\n          token: \"token2\",\n          dmPolicy: \"pairing\", // 覆盖顶层配置\n        },\n      },\n    },\n  },\n}\n```\n\n**最佳实践：**\n\n- 如果所有账号都用相同策略，配置在顶层\n- 如果某个账号需要不同策略，在 account 级别覆盖\n- 明确写出每个 account 的 `dmPolicy`，避免继承混淆\n\n## 最佳实践\n\n### 1. 配置变更前先审查\n\n**教训：** 我曾因为没仔细审查 patch 命令，把所有 Telegram 账号配置冲掉，导致所有 bot 连接中断。\n\n**规则：**\n- 任何 `config.patch`、`gateway restart`、模型变更等操作，**先审查一遍**\n- 嵌套对象（`bindings`、`accounts`）必须带完整列表\n- 有疑问先导出当前配置对比\n\n```bash\n# 变更前备份\nopenclaw config get > openclaw-config-backup.json\n\n# 变更后对比\nopenclaw config get > openclaw-config-new.json\ndiff openclaw-config-backup.json openclaw-config-new.json\n```\n\n### 2. 使用 status --deep 诊断\n\n```bash\nopenclaw status --deep\n```\n\n输出包括：\n- 每个 Agent 的状态\n- Channel 连接状态\n- 最近的错误日志\n\n如果某个 Agent 或 Channel 异常，会直接显示。\n\n### 3. 查看错误日志\n\n```bash\n# 实时查看日志\ntail -f ~/.openclaw/gateway.err.log\n\n# 搜索特定错误\ngrep -i \"error\\|conflict\\|fail\" ~/.openclaw/gateway.err.log | tail -n 50\n```\n\n常见错误关键词：\n- `409 conflict`：Telegram bot 冲突\n- `unauthorized`：token 错误或过期\n- `dmPolicy`：消息被访问控制策略拦截\n- `binding`：路由规则问题\n\n### 4. 分阶段配置\n\n不要一次性配置所有 Agent 和 Channel，容易出错且难以排查。\n\n**推荐流程：**\n\n1. 先配置一个新 Agent（不配置 Telegram），本地测试\n2. Agent 正常后，添加一个 Telegram bot，测试路由\n3. 验证通过后，再添加其他 Agent 和 bot\n4. 每次变更后，验证所有已有功能正常\n\n### 5. 文档化你的配置\n\n在 workspace 下创建 `SETUP.md`，记录：\n- 每个 Agent 的用途和配置\n- Telegram bot 对应关系\n- 特殊配置的原因\n\n```markdown\n# SETUP.md\n\n## Agents\n- main: 日常聊天，全功能，Telegram @MyMainBot\n- blog: 技术写作，workspace-blog，Telegram @MyWorkBot\n- novel: 小说创作，workspace-novel，仅本地使用\n\n## Telegram Bots\n- @MyMainBot (123456789): main agent\n- @MyWorkBot (987654321): work agent\n\n## 特殊配置\n- work agent 的 dmPolicy 设为 allowlist，只允许授权用户访问\n- main agent 启用了 heartbeat，定期检查日程\n```\n\n## 总结\n\nOpenClaw 多 Agent 配置不复杂，但有几个容易踩的坑：\n\n1. **config.patch 陷阱**：嵌套对象是整体替换，不是增量修改\n2. **模型 ID**：用别名（`claude-sonnet-4-5`），不要带日期\n3. **BOOTSTRAP.md**：不要手动创建，会导致 Agent 卡住\n4. **dmPolicy**：默认是 `pairing`，建议改成 `allowlist`\n5. **Telegram 409**：同一个 bot token 只能被一个 Gateway 使用\n6. **配置继承**：account 级别配置会覆盖顶层配置\n\n**核心原则：**\n- 配置前先备份\n- 变更后先验证\n- 出问题先看日志\n- 分阶段逐步配置\n\n希望这篇文章能帮你少走弯路。如果还有其他问题，欢迎在评论区讨论！","src/data/blog/openclaw-multi-agent-guide.md","bdbdc3754001835c",{html:1347,metadata:1348},"<p>如果你已经用了一段时间 OpenClaw，肯定会遇到这样的需求：我需要一个专门写博客的 AI 助手，一个写小说的，一个做代码开发的……每个都有独立的角色定位、工作目录和配置。这就是多 Agent 配置要解决的问题。</p>\n<p>本文不是理论教程，而是实战踩坑记录。我会告诉你配置过程中会遇到哪些坑，为什么会踩坑，以及怎么避免和解决。</p>\n<h2 id=\"为什么需要多-agent\">为什么需要多 Agent</h2>\n<p><strong>场景隔离</strong>。不同的工作场景需要不同的 AI 助手：</p>\n<ul>\n<li><strong>博客助手</strong>：专注于技术写作，熟悉你的博客部署流程，有独立的文章草稿目录</li>\n<li><strong>小说助手</strong>：创意写作风格，管理小说章节和人物设定，不需要访问技术代码</li>\n<li><strong>开发助手</strong>：熟悉代码规范，可以执行敏感命令，但不应该访问私人笔记</li>\n<li><strong>家庭助手</strong>：绑定到家庭 WhatsApp 群，只能访问受限的工具集，保护隐私</li>\n</ul>\n<p><strong>独立配置</strong>。每个 Agent 有自己的：</p>\n<ul>\n<li><strong>Workspace</strong>：独立的工作目录，互不干扰</li>\n<li><strong>SOUL.md</strong>：独立的角色定位和性格设定</li>\n<li><strong>Model</strong>：可以给不同 Agent 配置不同模型（Opus 做深度思考，Sonnet 做日常聊天）</li>\n<li><strong>Tool Policy</strong>：限制某些 Agent 的工具权限（比如家庭助手不能执行 shell 命令）</li>\n</ul>\n<p><strong>账号路由</strong>。多个 Telegram bot 或 WhatsApp 账号，路由到不同的 Agent，一个 Gateway 管理所有账号。</p>\n<p>举个例子，你可能会配置这样的 Agent：</p>\n<ul>\n<li><code>main</code>：日常聊天，全功能</li>\n<li><code>work</code>：工作场景，可以访问项目文档</li>\n<li><code>creative</code>：创作助手，专注于写作</li>\n<li><code>coding</code>：开发助手，执行代码相关任务</li>\n</ul>\n<h2 id=\"多-agent-配置流程\">多 Agent 配置流程</h2>\n<h3 id=\"1-创建-agent\">1. 创建 Agent</h3>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 创建一个新 Agent</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">openclaw</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> agents</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> add</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> blog</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\"> --workspace</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> ~/.openclaw/workspace-blog</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 验证创建结果</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">openclaw</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> agents</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> list</span></span></code></pre>\n<p>这会在配置文件中添加：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"json5\"><code><span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">  agents</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">    list</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">        id</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">main</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">        default</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\"> true</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">        workspace</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">~/.openclaw/workspace</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      }</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">        id</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">blog</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">        workspace</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">~/.openclaw/workspace-blog</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      }</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    ]</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span></code></pre>\n<h3 id=\"2-设置模型\">2. 设置模型</h3>\n<p><strong>⚠️ 第一个坑：模型 ID 格式</strong></p>\n<p>配置模型时，要用<strong>别名</strong>，不要带日期后缀！</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># ✅ 正确：使用别名</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">openclaw</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> config</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> patch</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> agents.list.1.model</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">anthropic/claude-sonnet-4-5</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># ❌ 错误：带日期后缀的完整 ID</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">openclaw</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> config</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> patch</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> agents.list.1.model</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">anthropic/claude-sonnet-4-20250514</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span></span></code></pre>\n<p><strong>为什么？</strong></p>\n<p>带日期的 ID 会在新版本发布时失效。别名（如 <code>claude-sonnet-4-5</code>）会自动指向最新版本。</p>\n<p>验证配置：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">openclaw</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> config</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> get</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> agents.list.1.model</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 应该输出：anthropic/claude-sonnet-4-5</span></span></code></pre>\n<h3 id=\"3-编写-soulmd-定义角色\">3. 编写 SOUL.md 定义角色</h3>\n<p>每个 Agent 的 workspace 下创建 <code>SOUL.md</code>，定义它的角色：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">cd</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> ~/.openclaw/workspace-blog</span></span></code></pre>\n<p>创建 <code>SOUL.md</code>：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"markdown\"><code><span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#82B1FF;--shiki-dark-font-weight:inherit\"># SOUL.md - 工作助手</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">你是工作助手，帮助处理日常工作任务。</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#82B1FF;--shiki-dark-font-weight:inherit\">## 角色定位</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">-</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> 专注于工作场景，风格专业高效</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">-</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> 熟悉常用开发工具和工作流程</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">-</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> 所有重要操作需要确认后执行</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#82B1FF;--shiki-dark-font-weight:inherit\">## 工作流程</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">1.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> 接收任务需求</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">2.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> 分析任务并制定执行计划</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">3.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> 执行任务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">4.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> 汇报结果</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#82B1FF;--shiki-dark-font-weight:inherit\">## 工作规范</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">-</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> 代码示例要完整可用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">-</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> 文档结构清晰</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">-</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> 操作前确认权限</span></span></code></pre>\n<p><strong>⚠️ 第二个坑：不要创建 BOOTSTRAP.md</strong></p>\n<p>如果你手动创建了 <code>BOOTSTRAP.md</code>，Agent 会一直卡在 bootstrapping 状态！</p>\n<p><strong>为什么？</strong></p>\n<p><code>BOOTSTRAP.md</code> 是 Agent 的”初始化任务清单”。Agent 启动后会执行里面的指令，执行完才会删除这个文件。如果你手动创建了这个文件但内容不完整，Agent 会不断尝试执行，永远无法进入正常状态。</p>\n<p><strong>解决方法：</strong></p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 如果发现 Agent 卡住了，检查是否有 BOOTSTRAP.md</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">ls</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> ~/.openclaw/workspace-blog/BOOTSTRAP.md</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 如果存在，直接删除</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">rm</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> ~/.openclaw/workspace-blog/BOOTSTRAP.md</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 重启 Gateway</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">openclaw</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> gateway</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> restart</span></span></code></pre>\n<h3 id=\"4-测试-agent\">4. 测试 Agent</h3>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 列出所有 Agent</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">openclaw</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> agents</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> list</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 查看 Agent 详细配置</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">openclaw</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> config</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> get</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> agents.list.1</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 重启 Gateway 让配置生效</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">openclaw</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> gateway</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> restart</span></span></code></pre>\n<h2 id=\"telegram-多账号配置\">Telegram 多账号配置</h2>\n<p>多 Agent 的典型用法是配置多个 Telegram bot，每个 bot 路由到不同的 Agent。</p>\n<h3 id=\"1-创建-telegram-bot\">1. 创建 Telegram Bot</h3>\n<p>在 Telegram 找 <a href=\"https://t.me/BotFather\">@BotFather</a>，创建 bot：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"plaintext\"><code><span class=\"line\"><span>/newbot</span></span></code></pre>\n<p>按提示输入名称和用户名，获得 token（类似 <code>1234567890:ABCdefGHIjklMNOpqrsTUVwxyz</code>）。</p>\n<p>假设你创建了两个 bot：</p>\n<ul>\n<li><code>@MyMainBot</code> → token1</li>\n<li><code>@MyWorkBot</code> → token2</li>\n</ul>\n<h3 id=\"2-配置多账号\">2. 配置多账号</h3>\n<p>编辑 <code>~/.openclaw/openclaw.json</code>（或用 <code>openclaw config patch</code>）：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"json5\"><code><span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">  channels</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">    telegram</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">      accounts</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">        main</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">          token</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">token1</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">          dmPolicy</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">allowlist</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">          allowFrom</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">123456789</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"> // 你的 Telegram user ID</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        }</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">        blog</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">          token</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">token2</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">          dmPolicy</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">allowlist</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">          allowFrom</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">123456789</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        }</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      }</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    }</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span></code></pre>\n<p><strong>⚠️ 第三个坑：dmPolicy 默认值</strong></p>\n<p>如果不设置 <code>dmPolicy</code>，默认是 <code>pairing</code>，这意味着用户必须先执行 <code>/pair</code> 命令才能聊天。但如果配置有问题，<code>/pair</code> 可能也不会响应，消息会被<strong>静默丢弃</strong>！</p>\n<p><strong>解决方法：</strong></p>\n<p>明确设置 <code>dmPolicy: \"allowlist\"</code>，并配置 <code>allowFrom</code> 列表：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"json5\"><code><span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">  dmPolicy</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">allowlist</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">  allowFrom</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">123456789</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">987654321</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"> // 允许的 user ID 列表</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span></code></pre>\n<p>获取你的 Telegram user ID：给 <a href=\"https://t.me/userinfobot\">@userinfobot</a> 发消息。</p>\n<h3 id=\"3-配置路由规则\">3. 配置路由规则</h3>\n<p>添加 <code>bindings</code> 将不同的 Telegram 账号路由到不同的 Agent：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"json5\"><code><span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">  bindings</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">      agentId</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">main</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">      match</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { </span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">channel</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">telegram</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> accountId</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">main</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> }</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    }</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">      agentId</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">blog</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">      match</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { </span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">channel</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">telegram</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> accountId</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">blog</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> }</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    }</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  ]</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span></code></pre>\n<p><strong>路由规则优先级</strong>：</p>\n<ol>\n<li><code>peer</code> 精确匹配（具体的 DM 或群组 ID）</li>\n<li><code>accountId</code> 匹配（哪个 Telegram 账号）</li>\n<li><code>channel</code> 匹配（哪个平台）</li>\n<li>默认 Agent（<code>default: true</code> 或列表中第一个）</li>\n</ol>\n<h3 id=\"4-重启-gateway\">4. 重启 Gateway</h3>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">openclaw</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> gateway</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> restart</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\"> --reason</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">添加新 Telegram bot</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span></span></code></pre>\n<p>测试：给两个 bot 发 <code>/start</code>，应该分别收到来自不同 Agent 的回复。</p>\n<h2 id=\"常见问题与解决\">常见问题与解决</h2>\n<h3 id=\"问题-1configpatch-把配置冲掉了\">问题 1：config.patch 把配置冲掉了</h3>\n<p><strong>现象：</strong></p>\n<p>我想给 <code>telegram.accounts</code> 添加一个新账号，执行：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">openclaw</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> config</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> patch</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> channels.telegram.accounts.blog</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">{\"token\":\"xxx\"}</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span></span></code></pre>\n<p>结果其他账号的配置全没了！</p>\n<p><strong>原因：</strong></p>\n<p><code>config.patch</code> 对<strong>嵌套对象</strong>是<strong>整体替换</strong>，不是增量修改！</p>\n<p>如果配置是：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"json5\"><code><span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">  channels</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">    telegram</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">      accounts</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">        main</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#FFFFFF\">...</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">        novel</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#FFFFFF\">...</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      }</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    }</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span></code></pre>\n<p>执行 <code>patch channels.telegram.accounts.blog {...}</code> 会导致：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"json5\"><code><span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">  channels</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">    telegram</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">      accounts</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">        blog</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#FFFFFF\">...</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"> // 只剩这一个！</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      }</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    }</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span></code></pre>\n<p><strong>解决方法：</strong></p>\n<p>patch 时带上<strong>完整的对象</strong>：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># ❌ 错误：只 patch 一个子项</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">openclaw</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> config</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> patch</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> channels.telegram.accounts.blog</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">{\"token\":\"xxx\"}</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># ✅ 正确：patch 整个 accounts 对象</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">openclaw</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> config</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> patch</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> channels.telegram.accounts</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">  \"main\": {\"token\":\"token1\", \"dmPolicy\":\"allowlist\", \"allowFrom\":[\"123456789\"]},</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">  \"blog\": {\"token\":\"token2\", \"dmPolicy\":\"allowlist\", \"allowFrom\":[\"123456789\"]}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">}</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span></span></code></pre>\n<p>同样适用于 <code>bindings</code>、<code>agents.list</code> 等数组或对象。</p>\n<p><strong>最佳实践：</strong></p>\n<p>配置变更前，先导出当前配置：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 导出当前配置</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">openclaw</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> config</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> get</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> channels.telegram.accounts</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> ></span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> telegram-accounts-backup.json</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 编辑后再 patch 回去</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">openclaw</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> config</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> patch</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> channels.telegram.accounts</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">$(</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">cat</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> telegram-accounts-edited.json</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">)</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span></span></code></pre>\n<h3 id=\"问题-2telegram-bot-不响应消息\">问题 2：Telegram bot 不响应消息</h3>\n<p><strong>现象：</strong></p>\n<p>给 bot 发 <code>/start</code> 或任何消息，都没有回复。</p>\n<p><strong>可能的原因 1：dmPolicy 配置问题</strong></p>\n<p>检查配置：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">openclaw</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> config</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> get</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> channels.telegram.accounts.blog.dmPolicy</span></span></code></pre>\n<p>如果是 <code>pairing</code> 或未设置，改成 <code>allowlist</code>：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">openclaw</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> config</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> patch</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> channels.telegram.accounts.blog.dmPolicy</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">\"allowlist\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">openclaw</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> config</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> patch</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> channels.telegram.accounts.blog.allowFrom</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">[\"123456789\"]</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">openclaw</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> gateway</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> restart</span></span></code></pre>\n<p><strong>可能的原因 2：Telegram 409 冲突</strong></p>\n<p><strong>症状：</strong> 日志中有 <code>getUpdates conflict (409)</code> 错误。</p>\n<p><strong>原因：</strong> 同一个 bot token 被多个实例同时使用！常见场景：</p>\n<ul>\n<li>OpenClaw.app (GUI) 和 CLI gateway 同时运行</li>\n<li>两个 terminal 同时启动了 gateway</li>\n</ul>\n<p><strong>检查：</strong></p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">ps</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> aux</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> |</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> grep</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\"> -i</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> openclaw</span></span></code></pre>\n<p>如果看到多个进程（GUI app 和 CLI gateway），说明冲突了。</p>\n<p><strong>解决方法：</strong></p>\n<ol>\n<li>退出 OpenClaw.app (GUI)</li>\n<li>重启 CLI gateway：</li>\n</ol>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">openclaw</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> gateway</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> restart</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\"> --reason</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">清除 Telegram bot 冲突</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span></span></code></pre>\n<p><strong>教训：</strong></p>\n<p>同一个 Telegram bot token <strong>只能被一个 Gateway 实例使用</strong>。如果要切换 GUI/CLI，必须先停掉其中一个。</p>\n<h3 id=\"问题-3绑定规则不生效\">问题 3：绑定规则不生效</h3>\n<p><strong>现象：</strong></p>\n<p>配置了 <code>bindings</code>，但消息还是路由到了错误的 Agent。</p>\n<p><strong>检查绑定：</strong></p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">openclaw</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> agents</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> list</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\"> --bindings</span></span></code></pre>\n<p><strong>常见错误：</strong></p>\n<ol>\n<li><strong>顺序错误</strong>：更具体的规则要放在前面</li>\n</ol>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"json5\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// ❌ 错误：通配规则在前，精确规则在后</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">bindings: [</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  { </span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">agentId</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">main</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> match</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { </span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">channel</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">telegram</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> } }</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"> // 会匹配所有 telegram 消息</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  { </span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">agentId</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">blog</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> match</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { </span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">channel</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">telegram</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> accountId</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">blog</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> } }</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"> // 永远不会执行</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// ✅ 正确：精确规则在前</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">bindings: [</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  { </span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">agentId</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">blog</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> match</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { </span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">channel</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">telegram</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> accountId</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">blog</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> } }</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  { </span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">agentId</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">main</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> match</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { </span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">channel</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">telegram</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> accountId</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">main</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> } }</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]</span></span></code></pre>\n<ol start=\"2\">\n<li><strong>accountId 拼写错误</strong>：检查是否与 <code>channels.telegram.accounts</code> 中的 key 一致</li>\n</ol>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 列出所有配置的账号</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">openclaw</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> config</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> get</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> channels.telegram.accounts</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> |</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> jq</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">keys</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span></span></code></pre>\n<h3 id=\"问题-4agent-配置变更后不生效\">问题 4：Agent 配置变更后不生效</h3>\n<p><strong>解决方法：</strong></p>\n<p>Gateway 需要重启才能加载新配置：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">openclaw</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> gateway</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> restart</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\"> --reason</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">更新 Agent 配置</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span></span></code></pre>\n<p>检查 Agent 是否正常启动：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">openclaw</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> status</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\"> --deep</span></span></code></pre>\n<p>如果看到某个 Agent 状态异常，查看日志：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">tail</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\"> -n</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 100</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> ~/.openclaw/gateway.err.log</span></span></code></pre>\n<h3 id=\"问题-5配置了嵌套对象但只有部分生效\">问题 5：配置了嵌套对象，但只有部分生效</h3>\n<p><strong>现象：</strong></p>\n<p>我在顶层配置了 <code>channels.telegram.dmPolicy</code>，为什么某个账号还是用了不同的策略？</p>\n<p><strong>原因：</strong></p>\n<p>配置有<strong>继承关系</strong>，account 级别的配置会<strong>覆盖</strong>顶层配置：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"json5\"><code><span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">  channels</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">    telegram</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">      dmPolicy</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">allowlist</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"> // 顶层默认</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">      allowFrom</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">123456789</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">      accounts</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">        main</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">          token</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">token1</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">          // 继承顶层的 dmPolicy 和 allowFrom</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        }</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">        public</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">          token</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">token2</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">          dmPolicy</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">pairing</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"> // 覆盖顶层配置</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        }</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      }</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    }</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span></code></pre>\n<p><strong>最佳实践：</strong></p>\n<ul>\n<li>如果所有账号都用相同策略，配置在顶层</li>\n<li>如果某个账号需要不同策略，在 account 级别覆盖</li>\n<li>明确写出每个 account 的 <code>dmPolicy</code>，避免继承混淆</li>\n</ul>\n<h2 id=\"最佳实践\">最佳实践</h2>\n<h3 id=\"1-配置变更前先审查\">1. 配置变更前先审查</h3>\n<p><strong>教训：</strong> 我曾因为没仔细审查 patch 命令，把所有 Telegram 账号配置冲掉，导致所有 bot 连接中断。</p>\n<p><strong>规则：</strong></p>\n<ul>\n<li>任何 <code>config.patch</code>、<code>gateway restart</code>、模型变更等操作，<strong>先审查一遍</strong></li>\n<li>嵌套对象（<code>bindings</code>、<code>accounts</code>）必须带完整列表</li>\n<li>有疑问先导出当前配置对比</li>\n</ul>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 变更前备份</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">openclaw</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> config</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> get</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> ></span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> openclaw-config-backup.json</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 变更后对比</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">openclaw</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> config</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> get</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> ></span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> openclaw-config-new.json</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">diff</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> openclaw-config-backup.json</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> openclaw-config-new.json</span></span></code></pre>\n<h3 id=\"2-使用-status-deep-诊断\">2. 使用 status —deep 诊断</h3>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">openclaw</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> status</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\"> --deep</span></span></code></pre>\n<p>输出包括：</p>\n<ul>\n<li>每个 Agent 的状态</li>\n<li>Channel 连接状态</li>\n<li>最近的错误日志</li>\n</ul>\n<p>如果某个 Agent 或 Channel 异常，会直接显示。</p>\n<h3 id=\"3-查看错误日志\">3. 查看错误日志</h3>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 实时查看日志</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">tail</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\"> -f</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> ~/.openclaw/gateway.err.log</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 搜索特定错误</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">grep</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\"> -i</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">error\\|conflict\\|fail</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> ~/.openclaw/gateway.err.log</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> |</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> tail</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\"> -n</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 50</span></span></code></pre>\n<p>常见错误关键词：</p>\n<ul>\n<li><code>409 conflict</code>：Telegram bot 冲突</li>\n<li><code>unauthorized</code>：token 错误或过期</li>\n<li><code>dmPolicy</code>：消息被访问控制策略拦截</li>\n<li><code>binding</code>：路由规则问题</li>\n</ul>\n<h3 id=\"4-分阶段配置\">4. 分阶段配置</h3>\n<p>不要一次性配置所有 Agent 和 Channel，容易出错且难以排查。</p>\n<p><strong>推荐流程：</strong></p>\n<ol>\n<li>先配置一个新 Agent（不配置 Telegram），本地测试</li>\n<li>Agent 正常后，添加一个 Telegram bot，测试路由</li>\n<li>验证通过后，再添加其他 Agent 和 bot</li>\n<li>每次变更后，验证所有已有功能正常</li>\n</ol>\n<h3 id=\"5-文档化你的配置\">5. 文档化你的配置</h3>\n<p>在 workspace 下创建 <code>SETUP.md</code>，记录：</p>\n<ul>\n<li>每个 Agent 的用途和配置</li>\n<li>Telegram bot 对应关系</li>\n<li>特殊配置的原因</li>\n</ul>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"markdown\"><code><span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#82B1FF;--shiki-dark-font-weight:inherit\"># SETUP.md</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#82B1FF;--shiki-dark-font-weight:inherit\">## Agents</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">-</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> main: 日常聊天，全功能，Telegram @MyMainBot</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">-</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> blog: 技术写作，workspace-blog，Telegram @MyWorkBot</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">-</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> novel: 小说创作，workspace-novel，仅本地使用</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#82B1FF;--shiki-dark-font-weight:inherit\">## Telegram Bots</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">-</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> @MyMainBot (123456789): main agent</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">-</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> @MyWorkBot (987654321): work agent</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#82B1FF;--shiki-dark-font-weight:inherit\">## 特殊配置</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">-</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> work agent 的 dmPolicy 设为 allowlist，只允许授权用户访问</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">-</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> main agent 启用了 heartbeat，定期检查日程</span></span></code></pre>\n<h2 id=\"总结\">总结</h2>\n<p>OpenClaw 多 Agent 配置不复杂，但有几个容易踩的坑：</p>\n<ol>\n<li><strong>config.patch 陷阱</strong>：嵌套对象是整体替换，不是增量修改</li>\n<li><strong>模型 ID</strong>：用别名（<code>claude-sonnet-4-5</code>），不要带日期</li>\n<li><strong>BOOTSTRAP.md</strong>：不要手动创建，会导致 Agent 卡住</li>\n<li><strong>dmPolicy</strong>：默认是 <code>pairing</code>，建议改成 <code>allowlist</code></li>\n<li><strong>Telegram 409</strong>：同一个 bot token 只能被一个 Gateway 使用</li>\n<li><strong>配置继承</strong>：account 级别配置会覆盖顶层配置</li>\n</ol>\n<p><strong>核心原则：</strong></p>\n<ul>\n<li>配置前先备份</li>\n<li>变更后先验证</li>\n<li>出问题先看日志</li>\n<li>分阶段逐步配置</li>\n</ul>\n<p>希望这篇文章能帮你少走弯路。如果还有其他问题，欢迎在评论区讨论！</p>",{headings:1349,localImagePaths:1418,remoteImagePaths:1419,frontmatter:1420,imagePaths:1423},[1350,1353,1356,1359,1362,1365,1368,1371,1374,1377,1380,1383,1385,1388,1391,1394,1397,1400,1402,1405,1408,1411,1414,1417],{depth:31,slug:1351,text:1352},"为什么需要多-agent","为什么需要多 Agent",{depth:31,slug:1354,text:1355},"多-agent-配置流程","多 Agent 配置流程",{depth:185,slug:1357,text:1358},"1-创建-agent","1. 创建 Agent",{depth:185,slug:1360,text:1361},"2-设置模型","2. 设置模型",{depth:185,slug:1363,text:1364},"3-编写-soulmd-定义角色","3. 编写 SOUL.md 定义角色",{depth:185,slug:1366,text:1367},"4-测试-agent","4. 测试 Agent",{depth:31,slug:1369,text:1370},"telegram-多账号配置","Telegram 多账号配置",{depth:185,slug:1372,text:1373},"1-创建-telegram-bot","1. 创建 Telegram Bot",{depth:185,slug:1375,text:1376},"2-配置多账号","2. 配置多账号",{depth:185,slug:1378,text:1379},"3-配置路由规则","3. 配置路由规则",{depth:185,slug:1381,text:1382},"4-重启-gateway","4. 重启 Gateway",{depth:31,slug:1384,text:1384},"常见问题与解决",{depth:185,slug:1386,text:1387},"问题-1configpatch-把配置冲掉了","问题 1：config.patch 把配置冲掉了",{depth:185,slug:1389,text:1390},"问题-2telegram-bot-不响应消息","问题 2：Telegram bot 不响应消息",{depth:185,slug:1392,text:1393},"问题-3绑定规则不生效","问题 3：绑定规则不生效",{depth:185,slug:1395,text:1396},"问题-4agent-配置变更后不生效","问题 4：Agent 配置变更后不生效",{depth:185,slug:1398,text:1399},"问题-5配置了嵌套对象但只有部分生效","问题 5：配置了嵌套对象，但只有部分生效",{depth:31,slug:1401,text:1401},"最佳实践",{depth:185,slug:1403,text:1404},"1-配置变更前先审查","1. 配置变更前先审查",{depth:185,slug:1406,text:1407},"2-使用-status-deep-诊断","2. 使用 status —deep 诊断",{depth:185,slug:1409,text:1410},"3-查看错误日志","3. 查看错误日志",{depth:185,slug:1412,text:1413},"4-分阶段配置","4. 分阶段配置",{depth:185,slug:1415,text:1416},"5-文档化你的配置","5. 文档化你的配置",{depth:31,slug:316,text:316},[],[],{author:14,pubDatetime:1421,title:1339,slug:1335,featured:165,draft:17,tags:1422,description:1342},["Date","2026-02-12T16:45:00.000Z"],[1190,167,1341],[],"promises-problem",{id:1424,data:1426,body:1431,filePath:1432,digest:1433,rendered:1434},{author:14,pubDatetime:1427,title:1428,featured:17,draft:17,tags:1429,description:1430},["Date","2016-09-15T02:00:00.000Z"],"我们在使用 Promises 时常犯的错误",[20],"四种 Promise then 写法的区别。","下面四种 Promise 写法的区别：\n\n```js\n// 1. 返回新 Promise\ndoSomething().then(function () {\n  return doSomethingElse();\n});\n\n// 2. 忽略返回值\ndoSomething().then(function () {\n  doSomethingElse();\n});\n\n// 3. 立即执行\ndoSomething().then(doSomethingElse());\n\n// 4. 传递函数引用\ndoSomething().then(doSomethingElse);\n```\n\n推荐阅读：\n- [中文版](http://fex.baidu.com/blog/2015/07/we-have-a-problem-with-promises/)\n- [原文](http://pouchdb.com/2015/05/18/we-have-a-problem-with-promises.html)","src/data/blog/promises-problem.md","37aaaabd11940312",{html:1435,metadata:1436},"<p>下面四种 Promise 写法的区别：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 1. 返回新 Promise</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">doSomething</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">then</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> ()</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  return</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> doSomethingElse</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">});</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 2. 忽略返回值</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">doSomething</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">then</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> ()</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">  doSomethingElse</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">});</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 3. 立即执行</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">doSomething</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">then</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">doSomethingElse</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">());</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 4. 传递函数引用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">doSomething</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">then</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">doSomethingElse</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span></code></pre>\n<p>推荐阅读：</p>\n<ul>\n<li><a href=\"http://fex.baidu.com/blog/2015/07/we-have-a-problem-with-promises/\">中文版</a></li>\n<li><a href=\"http://pouchdb.com/2015/05/18/we-have-a-problem-with-promises.html\">原文</a></li>\n</ul>",{headings:1437,localImagePaths:1438,remoteImagePaths:1439,frontmatter:1440,imagePaths:1443},[],[],[],{author:14,pubDatetime:1441,title:1428,slug:1424,featured:17,draft:17,tags:1442,description:1430},["Date","2016-09-15T02:00:00.000Z"],[20],[],"pwa-intro",{id:1444,data:1446,body:1452,filePath:1453,digest:1454,rendered:1455},{author:14,pubDatetime:1447,title:1448,featured:17,draft:17,tags:1449,description:1451},["Date","2018-06-20T02:00:00.000Z"],"PWA 入门与实践",[1450,19,494],"PWA","Progressive Web App 核心技术介绍与实践踩坑记录。","## 什么是 PWA\n\nProgressive Web App（渐进式 Web 应用）是提升 Web App 体验的一种方法，能给用户接近原生应用的体验。\n\n### 三大特点\n\n1. **可靠** — 即使在不稳定的网络环境下，也能瞬间加载并展现（Service Worker）\n2. **体验** — 快速响应，平滑的动画（App Shell 模式）\n3. **粘性** — 可以添加到桌面，支持离线通知（Web App Manifest）\n\n### Service Worker 快速实现\n\n推荐使用 [offline-plugin](https://github.com/NekR/offline-plugin)：\n\n```js\n// webpack.config.js\nvar OfflinePlugin = require(\"offline-plugin\");\nmodule.exports = {\n  plugins: [new OfflinePlugin({ Caches: \"all\" })],\n};\n\n// index.js\nimport * as OfflinePluginRuntime from \"offline-plugin/runtime\";\nOfflinePluginRuntime.install();\n```\n\n### 踩坑记录\n\n1. iOS 桌面 icon 实现依然使用 `<link>` 标签，不支持 manifest\n2. 全站必须使用 HTTPS\n3. `manifest.json` 配置的 `start_url` 必须在 Service Worker 缓存列表中，否则无法离线使用\n\n### 推荐阅读\n\n- [下一代 Web 应用模型 — Progressive Web App](https://huangxuan.me/2017/02/09/nextgen-web-pwa/)\n- [饿了么的 PWA 升级实践](https://huangxuan.me/2017/07/12/upgrading-eleme-to-pwa/)","src/data/blog/pwa-intro.md","79fd19da0932a080",{html:1456,metadata:1457},"<h2 id=\"什么是-pwa\">什么是 PWA</h2>\n<p>Progressive Web App（渐进式 Web 应用）是提升 Web App 体验的一种方法，能给用户接近原生应用的体验。</p>\n<h3 id=\"三大特点\">三大特点</h3>\n<ol>\n<li><strong>可靠</strong> — 即使在不稳定的网络环境下，也能瞬间加载并展现（Service Worker）</li>\n<li><strong>体验</strong> — 快速响应，平滑的动画（App Shell 模式）</li>\n<li><strong>粘性</strong> — 可以添加到桌面，支持离线通知（Web App Manifest）</li>\n</ol>\n<h3 id=\"service-worker-快速实现\">Service Worker 快速实现</h3>\n<p>推荐使用 <a href=\"https://github.com/NekR/offline-plugin\">offline-plugin</a>：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// webpack.config.js</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> OfflinePlugin</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> require</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">offline-plugin</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\">module</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\">exports</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  plugins</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">new</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> OfflinePlugin</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">({ Caches</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">all</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> })]</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// index.js</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\"> *</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> as</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> OfflinePluginRuntime </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">offline-plugin/runtime</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">OfflinePluginRuntime</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">install</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();</span></span></code></pre>\n<h3 id=\"踩坑记录\">踩坑记录</h3>\n<ol>\n<li>iOS 桌面 icon 实现依然使用 <code>&#x3C;link></code> 标签，不支持 manifest</li>\n<li>全站必须使用 HTTPS</li>\n<li><code>manifest.json</code> 配置的 <code>start_url</code> 必须在 Service Worker 缓存列表中，否则无法离线使用</li>\n</ol>\n<h3 id=\"推荐阅读\">推荐阅读</h3>\n<ul>\n<li><a href=\"https://huangxuan.me/2017/02/09/nextgen-web-pwa/\">下一代 Web 应用模型 — Progressive Web App</a></li>\n<li><a href=\"https://huangxuan.me/2017/07/12/upgrading-eleme-to-pwa/\">饿了么的 PWA 升级实践</a></li>\n</ul>",{headings:1458,localImagePaths:1471,remoteImagePaths:1472,frontmatter:1473,imagePaths:1476},[1459,1462,1464,1467,1469],{depth:31,slug:1460,text:1461},"什么是-pwa","什么是 PWA",{depth:185,slug:1463,text:1463},"三大特点",{depth:185,slug:1465,text:1466},"service-worker-快速实现","Service Worker 快速实现",{depth:185,slug:1468,text:1468},"踩坑记录",{depth:185,slug:1470,text:1470},"推荐阅读",[],[],{author:14,pubDatetime:1474,title:1448,slug:1444,featured:17,draft:17,tags:1475,description:1451},["Date","2018-06-20T02:00:00.000Z"],[1450,19,494],[],"react-router4-upgrade",{id:1477,data:1479,body:1485,filePath:1486,digest:1487,rendered:1488},{author:14,pubDatetime:1480,title:1481,featured:17,draft:17,tags:1482,description:1484},["Date","2018-05-01T02:00:00.000Z"],"React Router 4 升级指南",[1483,19],"React","react-router 升级到 4.x 的具体步骤与踩坑记录。","## 需要的包\n\n```js\n\"query-string\": \"5.1.1\",\n\"react-router-dom\": \"4.3.1\",\n\"connected-react-router\": \"5.0.1\",\n```\n\n## 关键变更\n\n1. **react-router 4 不再 parse location.search**，需要手动用 `query-string` 解析\n2. **没有 `params` / `routeParams`** 了，改用 `match.params`\n3. **Route 写法变化**：使用 `<Route path=\"/home\" render={...} />`\n4. **history 独立管理**：`import createHistory from 'history/createBrowserHistory'`\n\n## 业务代码迁移\n\n```js\n// 之前\nimport { browserHistory } from \"react-router\";\nbrowserHistory.push(\"xxx\");\n\n// 之后\nimport history from \"js/redux/middleware/history\";\nhistory.push(\"xxx\");\n```","src/data/blog/react-router4-upgrade.md","22ae91b3e1b20e51",{html:1489,metadata:1490},"<h2 id=\"需要的包\">需要的包</h2>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">query-string</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">: </span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">5.1.1</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">react-router-dom</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">: </span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">4.3.1</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">connected-react-router</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">: </span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">5.0.1</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span></code></pre>\n<h2 id=\"关键变更\">关键变更</h2>\n<ol>\n<li><strong>react-router 4 不再 parse location.search</strong>，需要手动用 <code>query-string</code> 解析</li>\n<li><strong>没有 <code>params</code> / <code>routeParams</code></strong> 了，改用 <code>match.params</code></li>\n<li><strong>Route 写法变化</strong>：使用 <code>&#x3C;Route path=\"/home\" render={...} /></code></li>\n<li><strong>history 独立管理</strong>：<code>import createHistory from 'history/createBrowserHistory'</code></li>\n</ol>\n<h2 id=\"业务代码迁移\">业务代码迁移</h2>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 之前</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { browserHistory } </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">react-router</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">browserHistory</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">push</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">xxx</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 之后</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> history </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">js/redux/middleware/history</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">history</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">push</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">xxx</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span></code></pre>",{headings:1491,localImagePaths:1498,remoteImagePaths:1499,frontmatter:1500,imagePaths:1503},[1492,1494,1496],{depth:31,slug:1493,text:1493},"需要的包",{depth:31,slug:1495,text:1495},"关键变更",{depth:31,slug:1497,text:1497},"业务代码迁移",[],[],{author:14,pubDatetime:1501,title:1481,slug:1477,featured:17,draft:17,tags:1502,description:1484},["Date","2018-05-01T02:00:00.000Z"],[1483,19],[],"regex-basics",{id:1504,data:1506,body:1512,filePath:1513,digest:1514,rendered:1515},{author:14,pubDatetime:1507,title:1508,featured:17,draft:17,tags:1509,description:1511},["Date","2015-10-01T02:00:00.000Z"],"正则表达式：元字符 \\b 与注意事项",[20,1510],"正则表达式","正则表达式元字符 \\b 的使用注意事项。","元字符 `\\b` 匹配单词的开始或结束。\n\n```js\n/^\\b\\S*$/.test(\"test\"); // true\n/^\\b\\S*$/.test(\"test test\"); // false\n```\n\n注意 `\\b` 的匹配项是 `[0-9A-Z_a-z]`（数字、大小写字母及下划线），所以要注意单词前后的特殊字符：\n\n```js\n/\\btest\\b/.test(\"@test\"); // true\n/\\btest\\b/.test(\"test\"); // true\n```","src/data/blog/regex-basics.md","f9d561f64e6e811f",{html:1516,metadata:1517},"<p>元字符 <code>\\b</code> 匹配单词的开始或结束。</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">^\\b</span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">\\S</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">*</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">$</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">test</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">test</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// true</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">^\\b</span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">\\S</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">*</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">$</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">test</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">test test</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// false</span></span></code></pre>\n<p>注意 <code>\\b</code> 的匹配项是 <code>[0-9A-Z_a-z]</code>（数字、大小写字母及下划线），所以要注意单词前后的特殊字符：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">\\b</span><span style=\"--shiki-light:#22863A;--shiki-dark:#5CA7E4\">test</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">\\b</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">test</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">@test</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// true</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">\\b</span><span style=\"--shiki-light:#22863A;--shiki-dark:#5CA7E4\">test</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">\\b</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">test</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">test</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// true</span></span></code></pre>",{headings:1518,localImagePaths:1519,remoteImagePaths:1520,frontmatter:1521,imagePaths:1524},[],[],[],{author:14,pubDatetime:1522,title:1508,slug:1504,featured:17,draft:17,tags:1523,description:1511},["Date","2015-10-01T02:00:00.000Z"],[20,1510],[],"regex-code-style-convert",{id:1525,data:1527,body:1532,filePath:1533,digest:1534,rendered:1535},{author:14,pubDatetime:1528,title:1529,featured:17,draft:17,tags:1530,description:1531},["Date","2015-12-01T02:00:00.000Z"],"正则表达式：代码风格互转",[20,1510],"驼峰、连字符、下划线三种代码风格的正则互转。","三种常见命名风格：\n\n- 驼峰风格：`testTest`\n- 连字风格：`test-test`\n- 下划线风格：`test_test`\n\n## 转驼峰\n\n```js\nfunction camelize(target) {\n  return target.replace(/[_-][^_-]/g, function (match) {\n    return match.charAt(1).toUpperCase();\n  });\n}\ncamelize(\"te-pp\"); // \"tePp\"\n```\n\n## 转下划线\n\n```js\nfunction underscored(target) {\n  return target\n    .replace(/([a-z\\d])([A-Z])/g, \"$1_$2\")\n    .replace(/-/g, \"_\")\n    .toLowerCase();\n}\n```\n\n## 转连字符\n\n```js\nfunction dasherize(target) {\n  return target\n    .replace(/([a-z\\d])([A-Z])/g, \"$1_$2\")\n    .replace(/_/g, \"-\")\n    .toLowerCase();\n}\n```","src/data/blog/regex-code-style-convert.md","2b077e028ccc8d94",{html:1536,metadata:1537},"<p>三种常见命名风格：</p>\n<ul>\n<li>驼峰风格：<code>testTest</code></li>\n<li>连字风格：<code>test-test</code></li>\n<li>下划线风格：<code>test_test</code></li>\n</ul>\n<h2 id=\"转驼峰\">转驼峰</h2>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> camelize</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">target</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  return</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> target</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">replace</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">[_-][</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">^</span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">_-]</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#5CA7E4\">g</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> function</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">match</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> match</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">charAt</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">toUpperCase</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  });</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">camelize</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">te-pp</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// \"tePp\"</span></span></code></pre>\n<h2 id=\"转下划线\">转下划线</h2>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> underscored</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">target</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> target</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    .</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">replace</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#22863A;--shiki-dark:#5CA7E4\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">[a-z\\d]</span><span style=\"--shiki-light:#22863A;--shiki-dark:#5CA7E4\">)(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">[A-Z]</span><span style=\"--shiki-light:#22863A;--shiki-dark:#5CA7E4\">)</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#5CA7E4\">g</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">$1_$2</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    .</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">replace</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#22863A;--shiki-dark:#5CA7E4\">-</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#5CA7E4\">g</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">_</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    .</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">toLowerCase</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span></code></pre>\n<h2 id=\"转连字符\">转连字符</h2>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> dasherize</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">target</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> target</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    .</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">replace</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#22863A;--shiki-dark:#5CA7E4\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">[a-z\\d]</span><span style=\"--shiki-light:#22863A;--shiki-dark:#5CA7E4\">)(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">[A-Z]</span><span style=\"--shiki-light:#22863A;--shiki-dark:#5CA7E4\">)</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#5CA7E4\">g</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">$1_$2</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    .</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">replace</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#22863A;--shiki-dark:#5CA7E4\">_</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#5CA7E4\">g</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">-</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    .</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">toLowerCase</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span></code></pre>",{headings:1538,localImagePaths:1545,remoteImagePaths:1546,frontmatter:1547,imagePaths:1550},[1539,1541,1543],{depth:31,slug:1540,text:1540},"转驼峰",{depth:31,slug:1542,text:1542},"转下划线",{depth:31,slug:1544,text:1544},"转连字符",[],[],{author:14,pubDatetime:1548,title:1529,slug:1525,featured:17,draft:17,tags:1549,description:1531},["Date","2015-12-01T02:00:00.000Z"],[20,1510],[],"roman-numerals",{id:1551,data:1553,body:1558,filePath:1559,digest:1560,rendered:1561},{author:14,pubDatetime:1554,title:1555,featured:17,draft:17,tags:1556,description:1557},["Date","2016-05-01T02:00:00.000Z"],"罗马数字解析",[20,720],"JS 实现罗马数字与阿拉伯数字互转。","```js\nvar res = {\n  M: 1000, CM: 900, D: 500, CD: 400, C: 100, XC: 90,\n  L: 50, XL: 40, X: 10, IX: 9, V: 5, IV: 4, I: 1,\n};\n\n// 罗马数字 → 数字\nfunction solution(s) {\n  var v = 0;\n  for (var i in res) {\n    while (s.substr(0, i.length) == i) {\n      s = s.substr(i.length);\n      v += res[i];\n    }\n  }\n  return v;\n}\n\n// 数字 → 罗马数字\nfunction toRoman(v) {\n  var s = \"\";\n  for (var i in res) {\n    while (v >= res[i]) {\n      s += i;\n      v -= res[i];\n    }\n  }\n  return s;\n}\n\nsolution(\"XXI\"); // 21\ntoRoman(21); // \"XXI\"\n```","src/data/blog/roman-numerals.md","7a4a92263008f0ee",{html:1562,metadata:1563},"<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> res</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  M</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1000</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> CM</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 900</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> D</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 500</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> CD</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 400</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> C</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 100</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> XC</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 90</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  L</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 50</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> XL</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 40</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> X</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 10</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> IX</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 9</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> V</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 5</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> IV</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 4</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> I</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">}</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 罗马数字 → 数字</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> solution</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">s</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> v</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 0</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  for</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> i</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> in</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> res</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    while</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">s</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">substr</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">0</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> i</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#7FDBCA\">length</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">==</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> i</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">      s</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> s</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">substr</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">i</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#7FDBCA\">length</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">      v</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> +=</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> res</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">i</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">];</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> v</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 数字 → 罗马数字</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> toRoman</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">v</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> s</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  for</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> i</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> in</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> res</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    while</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">v</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> >=</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> res</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">i</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">      s</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> +=</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> i</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">      v</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> -=</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> res</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">i</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">];</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> s</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">solution</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">XXI</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 21</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">toRoman</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">21</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// \"XXI\"</span></span></code></pre>",{headings:1564,localImagePaths:1565,remoteImagePaths:1566,frontmatter:1567,imagePaths:1570},[],[],[],{author:14,pubDatetime:1568,title:1555,slug:1551,featured:17,draft:17,tags:1569,description:1557},["Date","2016-05-01T02:00:00.000Z"],[20,720],[],"string-concat-apply",{id:1571,data:1573,body:1578,filePath:1579,digest:1580,rendered:1581},{author:14,pubDatetime:1574,title:1575,featured:17,draft:17,tags:1576,description:1577},["Date","2016-02-01T02:00:00.000Z"],"String.concat 与 apply 的妙用",[20],"使用 apply 将数组中的字符串一次性拼接。","将字符串 `\"a\"` 连接数组 `[\"b\", \"c\"]` 里的所有字符串：\n\n```js\n// 文艺解法\nString.prototype.concat.apply(\"a\", [\"b\", \"c\"]); // \"abc\"\n\n// 普通解法\n[\"a\", \"b\", \"c\"].join(\"\"); // \"abc\"\n```","src/data/blog/string-concat-apply.md","d368f5103dd7d28f",{html:1582,metadata:1583},"<p>将字符串 <code>\"a\"</code> 连接数组 <code>[\"b\", \"c\"]</code> 里的所有字符串：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 文艺解法</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\">String</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#7FDBCA\">prototype</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic\">concat</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">apply</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">a</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">b</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">c</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// \"abc\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 普通解法</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">a</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">b</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">c</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">join</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// \"abc\"</span></span></code></pre>",{headings:1584,localImagePaths:1585,remoteImagePaths:1586,frontmatter:1587,imagePaths:1590},[],[],[],{author:14,pubDatetime:1588,title:1575,slug:1571,featured:17,draft:17,tags:1589,description:1577},["Date","2016-02-01T02:00:00.000Z"],[20],[],"string-indexof-bitwise",{id:1591,data:1593,body:1598,filePath:1599,digest:1600,rendered:1601},{author:14,pubDatetime:1594,title:1595,featured:17,draft:17,tags:1596,description:1597},["Date","2016-01-20T02:00:00.000Z"],"用按位非 ~ 简化 indexOf 判断",[20],"利用按位非操作符简化 indexOf 的判断写法。","`~` 按位非操作符：对任一数值 x 进行按位非的结果为 `-(x + 1)`。\n\n所以 `~(-1) === 0`，刚好是 falsy 值！\n\n```js\n// 常用写法\nif (\"abc\".indexOf(\"b\") > -1) {\n}\n\n// 简化写法\nif (~\"abc\".indexOf(\"b\")) {\n}\n```","src/data/blog/string-indexof-bitwise.md","f832fc79d8794b92",{html:1602,metadata:1603},"<p><code>~</code> 按位非操作符：对任一数值 x 进行按位非的结果为 <code>-(x + 1)</code>。</p>\n<p>所以 <code>~(-1) === 0</code>，刚好是 falsy 值！</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 常用写法</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">abc</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">indexOf</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">b</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">></span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> -</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 简化写法</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">~</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">abc</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">indexOf</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">b</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span></code></pre>",{headings:1604,localImagePaths:1605,remoteImagePaths:1606,frontmatter:1607,imagePaths:1610},[],[],[],{author:14,pubDatetime:1608,title:1595,slug:1591,featured:17,draft:17,tags:1609,description:1597},["Date","2016-01-20T02:00:00.000Z"],[20],[],"regex-clone",{id:1611,data:1613,body:1618,filePath:1619,digest:1620,rendered:1621},{author:14,pubDatetime:1614,title:1615,featured:17,draft:17,tags:1616,description:1617},["Date","2015-12-15T02:00:00.000Z"],"正则表达式的复制与 lastIndex",[20,1510],"复制正则表达式时需要注意 lastIndex 属性。","```js\nRegExp.prototype.clone = function () {\n  var ret = new RegExp(this);\n  ret.lastIndex = this.lastIndex;\n  return ret;\n};\n```\n\n## lastIndex 属性\n\n只有设置了全局标志 `g` 的正则才有这个属性，表示从字符串的第几个字符开始匹配。\n\n```js\nvar re = /te/g;\nre.test(\"test\"); // true, lastIndex: 2\nre.test(\"test\"); // false, lastIndex: 0（超出后重置）\nre.test(\"test\"); // true\n```\n\n复制正则表达式时需要复制 `lastIndex` 属性，否则会影响使用。","src/data/blog/regex-clone.md","fabec22e30bea973",{html:1622,metadata:1623},"<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\">RegExp</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#7FDBCA\">prototype</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">clone</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> function</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> ()</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> ret</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> new</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> RegExp</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#41EEC6;--shiki-dark-font-style:italic\">this</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">  ret</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">lastIndex</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#41EEC6;--shiki-dark-font-style:italic\"> this</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">lastIndex</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> ret</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">};</span></span></code></pre>\n<h2 id=\"lastindex-属性\">lastIndex 属性</h2>\n<p>只有设置了全局标志 <code>g</code> 的正则才有这个属性，表示从字符串的第几个字符开始匹配。</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> re</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> /</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#5CA7E4;--shiki-dark-font-style:italic\">te</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#5CA7E4\">g</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">re</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">test</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">test</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// true, lastIndex: 2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">re</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">test</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">test</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// false, lastIndex: 0（超出后重置）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">re</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">test</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">test</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// true</span></span></code></pre>\n<p>复制正则表达式时需要复制 <code>lastIndex</code> 属性，否则会影响使用。</p>",{headings:1624,localImagePaths:1628,remoteImagePaths:1629,frontmatter:1630,imagePaths:1633},[1625],{depth:31,slug:1626,text:1627},"lastindex-属性","lastIndex 属性",[],[],{author:14,pubDatetime:1631,title:1615,slug:1611,featured:17,draft:17,tags:1632,description:1617},["Date","2015-12-15T02:00:00.000Z"],[20,1510],[],"symbol-toprimitive",{id:1634,data:1636,body:1641,filePath:1642,digest:1643,rendered:1644},{author:14,pubDatetime:1637,title:1638,featured:17,draft:17,tags:1639,description:1640},["Date","2019-09-15T02:00:00.000Z"],"Symbol.toPrimitive 与 JS 加法运算",[20,95],"深入理解 Symbol.toPrimitive、对象到原始值的转换，以及 [] + {} 的奥秘。","## Symbol.toPrimitive\n\n```js\nvar obj = {\n  [Symbol.toPrimitive](hint) {\n    if (hint == \"number\") return 10;\n    if (hint == \"string\") return \"hello\";\n    return true;\n  },\n};\n\n+obj; // 10 (hint: \"number\")\n`${obj}`; // \"hello\" (hint: \"string\")\nobj + \"\"; // \"true\" (hint: \"default\")\n```\n\n## `[] + {}` vs `{} + []`\n\n```js\n[] + {};\n// [].toString() + {}.toString() → \"\" + \"[object Object]\" → \"[object Object]\"\n\n{} + [];\n// {} 被解析为代码块，变成 +[] → +(\"\") → 0\n```\n\n所以 `{} + [] != [] + {}`（`0 != \"[object Object]\"`）。","src/data/blog/symbol-toprimitive.md","0d6ee19f1ddf16c8",{html:1645,metadata:1646},"<h2 id=\"symboltoprimitive\">Symbol.toPrimitive</h2>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> obj</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  [</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">Symbol</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic\">toPrimitive</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D7DBE0;--shiki-dark-font-style:italic\">hint</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">hint</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ==</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">number</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> return</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 10</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">hint</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ==</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">string</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> return</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">hello</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FF5874;--shiki-dark-font-style:italic\"> true</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">  }</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">}</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">+</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">obj</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 10 (hint: \"number\")</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">${</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">obj</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">}</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// \"hello\" (hint: \"string\")</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">obj</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> +</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// \"true\" (hint: \"default\")</span></span></code></pre>\n<h2 id=\"---vs--\"><code>[] + {}</code> vs <code>{} + []</code></h2>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[] </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">+</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {};</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// [].toString() + {}.toString() → \"\" + \"[object Object]\" → \"[object Object]\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">{} </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">+</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [];</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// {} 被解析为代码块，变成 +[] → +(\"\") → 0</span></span></code></pre>\n<p>所以 <code>{} + [] != [] + {}</code>（<code>0 != \"[object Object]\"</code>）。</p>",{headings:1647,localImagePaths:1654,remoteImagePaths:1655,frontmatter:1656,imagePaths:1659},[1648,1651],{depth:31,slug:1649,text:1650},"symboltoprimitive","Symbol.toPrimitive",{depth:31,slug:1652,text:1653},"---vs--","[] + {} vs {} + []",[],[],{author:14,pubDatetime:1657,title:1638,slug:1634,featured:17,draft:17,tags:1658,description:1640},["Date","2019-09-15T02:00:00.000Z"],[20,95],[],"topological-sort",{id:1660,data:1662,body:1667,filePath:1668,digest:1669,rendered:1670},{author:14,pubDatetime:1663,title:1664,featured:17,draft:17,tags:1665,description:1666},["Date","2019-09-01T02:00:00.000Z"],"拓扑排序",[383,720],"用 Go 语言深度优先搜索实现拓扑排序。","拓扑排序是将有向无环图（DAG）的所有顶点排成线性序列，使得边 (u,v) 中 u 出现在 v 之前。\n\n```go\nfunc topoSort(m map[string][]string) []string {\n    var order []string\n    seen := make(map[string]bool)\n    var visitAll func(items []string)\n    visitAll = func(items []string) {\n        for _, item := range items {\n            if !seen[item] {\n                seen[item] = true\n                visitAll(m[item])\n                order = append(order, item)\n            }\n        }\n    }\n    var keys []string\n    for key := range m {\n        keys = append(keys, key)\n    }\n    sort.Strings(keys)\n    visitAll(keys)\n    return order\n}\n```\n\n深度优先搜索：沿着树的深度遍历节点，尽可能深地搜索分支。当所有边都已探寻，搜索回溯到起始节点。","src/data/blog/topological-sort.md","70500e31ea4bee64",{html:1671,metadata:1672},"<p>拓扑排序是将有向无环图（DAG）的所有顶点排成线性序列，使得边 (u,v) 中 u 出现在 v 之前。</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"go\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">func</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> topoSort</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">m</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> map</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">string</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">][]</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">string</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) []</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">string</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> order</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> []</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">string</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    seen</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> :=</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> make</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">map</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">string</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">bool</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> visitAll</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> func</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">items</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> []</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">string</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    visitAll</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> func</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">items</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> []</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">string</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        for</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> _</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, </span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">item</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> :=</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> range</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> items</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">            if</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> !</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">seen</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">item</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">] {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">                seen</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">item</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">] </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\"> true</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">                visitAll</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">m</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">item</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">])</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">                order</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> append</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">order</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, </span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">item</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">            }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> keys</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> []</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">string</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    for</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> key</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> :=</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> range</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> m</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">        keys</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> append</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">keys</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">, </span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">key</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">    sort</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">Strings</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">keys</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">    visitAll</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">keys</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\"> order</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span></code></pre>\n<p>深度优先搜索：沿着树的深度遍历节点，尽可能深地搜索分支。当所有边都已探寻，搜索回溯到起始节点。</p>",{headings:1673,localImagePaths:1674,remoteImagePaths:1675,frontmatter:1676,imagePaths:1679},[],[],[],{author:14,pubDatetime:1677,title:1664,slug:1660,featured:17,draft:17,tags:1678,description:1666},["Date","2019-09-01T02:00:00.000Z"],[383,720],[],"txt-newline",{id:1680,data:1682,body:1687,filePath:1688,digest:1689,rendered:1690},{author:14,pubDatetime:1683,title:1684,featured:17,draft:17,tags:1685,description:1686},["Date","2015-06-01T02:00:00.000Z"],"文本复制换行问题",[20],"文本复制到 txt 丢失换行格式的解决方法。","文本复制到 txt 时会丢失换行格式，程序员的解决方式：\n\n```js\ntext.replace(/\\n/g, \"\\r\\n\");\n```","src/data/blog/txt-newline.md","e082951e593b13a0",{html:1691,metadata:1692},"<p>文本复制到 txt 时会丢失换行格式，程序员的解决方式：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">text</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">replace</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">\\n</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#5CA7E4\">g</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#F78C6C\">\\r\\n</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span></code></pre>",{headings:1693,localImagePaths:1694,remoteImagePaths:1695,frontmatter:1696,imagePaths:1699},[],[],[],{author:14,pubDatetime:1697,title:1684,slug:1680,featured:17,draft:17,tags:1698,description:1686},["Date","2015-06-01T02:00:00.000Z"],[20],[],"webpack4-upgrade",{id:1700,data:1702,body:1708,filePath:1709,digest:1710,rendered:1711},{author:14,pubDatetime:1703,title:1704,featured:17,draft:17,tags:1705,description:1707},["Date","2018-09-10T02:00:00.000Z"],"Webpack 4 升级指南",[1706,280],"Webpack","Webpack 3 升级到 Webpack 4 的关键改动整理。","## 推荐工具\n\n- [npm check](https://segmentfault.com/a/1190000011085967) — 检查依赖更新\n- [npm outdated](https://docs.npmjs.com/cli/outdated) — 查看过时依赖\n\n## 关键改动\n\n### 1. 新增 mode 配置\n\n通过 `mode` 参数设置为 `development`、`production` 或 `none`，启用对应环境下的内置优化。默认值为 `production`。\n\n### 2. CommonsChunkPlugin → splitChunks\n\n```js\noptimization: {\n  splitChunks: {\n    chunks: 'all'\n  }\n}\n```\n\n### 3. 优化 chunk 打包 hash\n\n```js\noptimization: {\n  runtimeChunk: 'single',\n},\nplugins: [\n  new webpack.HashedModuleIdsPlugin(),\n]\n```\n\n### 4. extract-text-webpack-plugin → mini-css-extract-plugin\n\n```js\nconst MiniCssExtractPlugin = require(\"mini-css-extract-plugin\");\nconst devMode = process.env.NODE_ENV !== \"production\";\n\nmodule.exports = {\n  plugins: [\n    new MiniCssExtractPlugin({\n      filename: devMode ? \"[name].css\" : \"[name].[contenthash].css\",\n      chunkFilename: devMode ? \"[id].css\" : \"[id].[contenthash].css\",\n    }),\n  ],\n  module: {\n    rules: [\n      {\n        test: /\\.(sa|sc|c)ss$/,\n        use: [\n          devMode ? \"style-loader\" : MiniCssExtractPlugin.loader,\n          \"css-loader\",\n          \"postcss-loader\",\n          \"sass-loader\",\n        ],\n      },\n    ],\n  },\n};\n```\n\n> **注意**：不能同时使用 `style-loader` 和 `MiniCssExtractPlugin.loader`。","src/data/blog/webpack4-upgrade.md","6773ed67eb343ec8",{html:1712,metadata:1713},"<h2 id=\"推荐工具\">推荐工具</h2>\n<ul>\n<li><a href=\"https://segmentfault.com/a/1190000011085967\">npm check</a> — 检查依赖更新</li>\n<li><a href=\"https://docs.npmjs.com/cli/outdated\">npm outdated</a> — 查看过时依赖</li>\n</ul>\n<h2 id=\"关键改动\">关键改动</h2>\n<h3 id=\"1-新增-mode-配置\">1. 新增 mode 配置</h3>\n<p>通过 <code>mode</code> 参数设置为 <code>development</code>、<code>production</code> 或 <code>none</code>，启用对应环境下的内置优化。默认值为 <code>production</code>。</p>\n<h3 id=\"2-commonschunkplugin--splitchunks\">2. CommonsChunkPlugin → splitChunks</h3>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">optimization</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  splitChunks</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    chunks</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">all</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span></code></pre>\n<h3 id=\"3-优化-chunk-打包-hash\">3. 优化 chunk 打包 hash</h3>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">optimization</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  runtimeChunk</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">single</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">plugins</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">  new</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> webpack</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">HashedModuleIdsPlugin</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]</span></span></code></pre>\n<h3 id=\"4-extract-text-webpack-plugin--mini-css-extract-plugin\">4. extract-text-webpack-plugin → mini-css-extract-plugin</h3>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> MiniCssExtractPlugin</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> require</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">mini-css-extract-plugin</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> devMode</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> process</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic\">env</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">NODE_ENV</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> !==</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">production</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\">module</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\">exports</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  plugins</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">    new</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> MiniCssExtractPlugin</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">({</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      filename</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> devMode</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ?</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">[name].css</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> :</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">[name].[contenthash].css</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      chunkFilename</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> devMode</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ?</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">[id].css</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> :</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">[id].[contenthash].css</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    })</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  ]</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  module</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    rules</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        test</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> /</span><span style=\"--shiki-light:#22863A;--shiki-dark:#F78C6C\">\\.</span><span style=\"--shiki-light:#22863A;--shiki-dark:#5CA7E4\">(sa</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">|</span><span style=\"--shiki-light:#22863A;--shiki-dark:#5CA7E4\">sc</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">|</span><span style=\"--shiki-light:#22863A;--shiki-dark:#5CA7E4\">c)ss</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">$</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        use</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">          devMode</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ?</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">style-loader</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> :</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> MiniCssExtractPlugin</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">loader</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">          \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">css-loader</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">          \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">postcss-loader</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">          \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">sass-loader</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        ]</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      }</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    ]</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">};</span></span></code></pre>\n<blockquote>\n<p><strong>注意</strong>：不能同时使用 <code>style-loader</code> 和 <code>MiniCssExtractPlugin.loader</code>。</p>\n</blockquote>",{headings:1714,localImagePaths:1731,remoteImagePaths:1732,frontmatter:1733,imagePaths:1736},[1715,1717,1719,1722,1725,1728],{depth:31,slug:1716,text:1716},"推荐工具",{depth:31,slug:1718,text:1718},"关键改动",{depth:185,slug:1720,text:1721},"1-新增-mode-配置","1. 新增 mode 配置",{depth:185,slug:1723,text:1724},"2-commonschunkplugin--splitchunks","2. CommonsChunkPlugin → splitChunks",{depth:185,slug:1726,text:1727},"3-优化-chunk-打包-hash","3. 优化 chunk 打包 hash",{depth:185,slug:1729,text:1730},"4-extract-text-webpack-plugin--mini-css-extract-plugin","4. extract-text-webpack-plugin → mini-css-extract-plugin",[],[],{author:14,pubDatetime:1734,title:1704,slug:1700,featured:17,draft:17,tags:1735,description:1707},["Date","2018-09-10T02:00:00.000Z"],[1706,280],[],"underscore-pluck",{id:1737,data:1739,body:1744,filePath:1745,digest:1746,rendered:1747},{author:14,pubDatetime:1740,title:1741,featured:17,draft:17,tags:1742,description:1743},["Date","2016-06-15T02:00:00.000Z"],"Underscore pluck 方法",[20],"Underscore.js 的 pluck 方法快速提取对象数组中的某个属性。","```js\nvar stooges = [\n  { name: \"moe\", age: 40 },\n  { name: \"larry\", age: 50 },\n  { name: \"curly\", age: 60 },\n];\n\n_.pluck(stooges, \"age\"); // [40, 50, 60]\n_.max(_.pluck(stooges, \"age\")); // 60\n_.max(stooges, \"age\"); // {name: 'curly', age: 60}\n```","src/data/blog/underscore-pluck.md","9e54625c36c718a9",{html:1748,metadata:1749},"<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">var</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> stooges</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  {</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> name</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">moe</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> age</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 40</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> }</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  {</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> name</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">larry</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> age</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 50</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> }</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  {</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> name</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">curly</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> age</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 60</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> }</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">];</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">_</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">pluck</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">stooges</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">age</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// [40, 50, 60]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">_</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">max</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">_</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">pluck</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">stooges</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">age</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 60</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">_</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">max</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">stooges</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">age</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// {name: 'curly', age: 60}</span></span></code></pre>",{headings:1750,localImagePaths:1751,remoteImagePaths:1752,frontmatter:1753,imagePaths:1756},[],[],[],{author:14,pubDatetime:1754,title:1741,slug:1737,featured:17,draft:17,tags:1755,description:1743},["Date","2016-06-15T02:00:00.000Z"],[20],[],"window-open-cross-origin",{id:1757,data:1759,body:1764,filePath:1765,digest:1766,rendered:1767},{author:14,pubDatetime:1760,title:1761,featured:17,draft:17,tags:1762,description:1763},["Date","2015-05-20T02:00:00.000Z"],"window.showModalDialog 与 window.open 跨域方案",[20,54],"Chrome 不支持 showModalDialog，使用 postMessage 解决跨域通信。","Chrome 不支持 `showModalDialog`，使用 `window.open` 代替。跨域场景下用 `postMessage`：\n\n```js\n// 父页面\nwindow.addEventListener(\"message\", function (e) {\n  if (e.data == \"closed\") {\n    // 处理返回值\n  }\n});\n\n// 子页面\nwindow.opener.postMessage(\"closed\", \"*\");\nwindow.close();\n```\n\nFirefox、Safari、Opera、IE9+ 均支持 `postMessage`。","src/data/blog/window-open-cross-origin.md","fe129daa612f6833",{html:1768,metadata:1769},"<p>Chrome 不支持 <code>showModalDialog</code>，使用 <code>window.open</code> 代替。跨域场景下用 <code>postMessage</code>：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 父页面</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">window</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">addEventListener</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">message</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> function</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">e</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">e</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">data</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ==</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">closed</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 处理返回值</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">});</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 子页面</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">window</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic\">opener</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">postMessage</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">closed</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">*</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">window</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">close</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();</span></span></code></pre>\n<p>Firefox、Safari、Opera、IE9+ 均支持 <code>postMessage</code>。</p>",{headings:1770,localImagePaths:1771,remoteImagePaths:1772,frontmatter:1773,imagePaths:1776},[],[],[],{author:14,pubDatetime:1774,title:1761,slug:1757,featured:17,draft:17,tags:1775,description:1763},["Date","2015-05-20T02:00:00.000Z"],[20,54],[],"ai-agent-frontend-workflow-part4",{id:1777,data:1779,body:1785,filePath:1786,digest:1787,rendered:1788},{author:14,pubDatetime:1780,title:1781,featured:165,draft:17,tags:1782,description:1784},["Date","2026-02-16T10:00:00.000Z"],"AI Agent 前端工作流（四）：未来展望与开源工具全景",[167,168,1783,19],"开源","系列完结篇。从 Copilot 到 Autonomous Agent，从闭源到开源，本文梳理 AI Agent 发展趋势，对比主流工具，探讨开发者角色转变。附完整学习路线。","## 系列回顾：我们走到了哪里\n\n过去三篇文章，我们从 AI Agent 辅助前端开发的基础用法，到实战技巧，再到高级工作流设计，基本把这个话题拆解透了：\n\n- **第一篇**讲了如何用 Cursor、Claude Code 等工具快速搭建前端项目，AI 从代码补全升级到需求理解。\n- **第二篇**深入到实战场景：组件生成、样式调试、API 对接，以及如何通过 Prompt Engineering 提高 AI 输出质量。\n- **第三篇**探讨高级工作流：多 Agent 协作、工具链集成、自动化测试和部署。\n\n如果用一张图总结完整的 AI Agent 前端工作流：\n\n```\n需求输入 → AI 理解 → 架构设计 → 代码生成 → 样式调整 → 测试验证 → 部署上线\n    ↓          ↓         ↓          ↓         ↓         ↓          ↓\n  语音/文字  Claude   v0.dev    Cursor   Tailwind  Vitest    CI/CD\n           Sonnet              Code              Playwright\n```\n\n这套流程在 2026 年初已经相当成熟。但技术不会停在这里。这篇完结篇，我们聊聊 AI Agent 接下来会往哪儿走，开发者该如何准备，以及有哪些开源工具值得关注。\n\n## 发展趋势：下一代 Agent 长什么样\n\n### 1. 从 Copilot 到 Autonomous Agent\n\n**2023 年：**GitHub Copilot 引领的\"智能补全\"时代。你写一半代码，AI 猜出下半部分。\n\n**2024 年：**Cursor、Claude Code 的\"对话式编程\"。你用自然语言描述需求，AI 帮你写整个函数或组件。\n\n**2026 年：**真正的自主 Agent（Autonomous Agent）。你给它一个模糊目标，它自己规划任务、调用工具、验证结果、迭代优化。\n\n举个例子，用当前的 Claude Code：\n\n```bash\n# 你给的指令\n\"把这个 React 项目的登录页改成支持 OAuth，保持现有样式\"\n\n# Agent 的执行流程（自主决策）\n1. 分析现有代码结构 → 发现用的是 JWT\n2. 搜索 OAuth 库文档 → 选择 next-auth\n3. 安装依赖 → npm install next-auth\n4. 修改 API 路由 → 添加 OAuth provider\n5. 更新前端组件 → 保持原有 Tailwind 样式\n6. 运行测试 → 发现 CORS 问题\n7. 修复配置 → 再次测试通过\n8. 提交代码 → 生成 commit message\n```\n\n整个过程你不需要干预。Agent 自己识别问题、找资料、改代码、测试验证。这不是科幻，OpenHands、Devin 已经在做这件事了。\n\n### 2. Multimodal Agent：从设计稿到代码一步到位\n\n**现状：**v0.dev 能根据截图生成 UI，但需要你手动调整样式细节。\n\n**未来：**直接拿 Figma 设计稿，AI 不仅生成像素级精准的 UI，还包括交互逻辑、状态管理、API 对接。\n\n字节跳动的 **UI-TARS** 已经在这个方向上发力。它能理解设计稿的视觉层次、组件语义，甚至推断出用户交互流程。\n\n```bash\n# 未来的工作流\n1. 设计师完成 Figma 设计\n2. 导出设计稿 URL\n3. Agent 读取设计稿 → 自动生成 React + TypeScript 项目\n4. 包含 responsive 布局、dark mode、accessibility\n5. 前端代码直接可用\n```\n\n前端开发的重心会从\"实现设计\"转向\"设计交互体验\"和\"优化性能\"。\n\n### 3. Agent 协作：多个 Agent 分工合作\n\n一个复杂前端项目，单个 Agent 搞不定。未来是多 Agent 团队协作：\n\n- **架构 Agent**：负责技术选型、项目结构设计\n- **UI Agent**：专注组件开发和样式\n- **Logic Agent**：处理业务逻辑和状态管理\n- **Test Agent**：编写测试用例、发现 bug\n- **DevOps Agent**：负责 CI/CD 和部署\n\n用 **CrewAI** 或 **AutoGen** 可以实现这种协作：\n\n```python\nfrom crewai import Agent, Task, Crew\n\n# 定义 Agent 团队\narchitect = Agent(\n    role=\"架构师\",\n    goal=\"设计可扩展的前端架构\",\n    backstory=\"精通 Next.js、React 生态\"\n)\n\nui_developer = Agent(\n    role=\"UI 开发\",\n    goal=\"实现像素级精准的界面\",\n    tools=[v0_tool, tailwind_tool]\n)\n\n# 定义协作任务\ntask1 = Task(\n    description=\"分析需求，设计项目结构\",\n    agent=architect\n)\n\ntask2 = Task(\n    description=\"根据架构，实现 UI 组件\",\n    agent=ui_developer,\n    context=[task1]  # 依赖架构 Agent 的输出\n)\n\n# 执行协作\ncrew = Crew(agents=[architect, ui_developer], tasks=[task1, task2])\ncrew.kickoff()\n```\n\n### 4. 本地化趋势：开源模型 + 边缘计算\n\n云服务很方便，但有三个问题：**成本、隐私、网络依赖**。\n\n开源模型（DeepSeek R1、Qwen 2.5、Llama 3）性能已经接近 GPT-4，跑在本地完全可行。配合 **Ollama** 或 **LM Studio**，在 Mac Studio 或 4090 显卡上跑 33B 模型毫无压力。\n\n```bash\n# 本地运行 DeepSeek R1\nollama pull deepseek-r1:33b\nollama run deepseek-r1:33b\n\n# 配合 Continue.dev 使用\n# 在 VSCode 中，设置模型为 ollama/deepseek-r1:33b\n```\n\n本地 Agent 的好处：\n- **零 API 成本**：跑满 GPU 也不花钱\n- **隐私保护**：代码不离开本地网络\n- **离线可用**：飞机上、咖啡厅都能继续工作\n\n## 开发者角色转变：从\"码农\"到\"AI 编排者\"\n\n### 未来需要什么技能\n\n**过去（2020）：**会写代码就够了。React、Vue、TypeScript 熟练，你就是前端工程师。\n\n**现在（2026）：**写代码只是基础。更重要的是：\n\n1. **Prompt Engineering**：怎么把需求准确传达给 AI，怎么迭代 Prompt 优化输出质量。\n2. **架构设计**：AI 能生成代码，但架构决策还得你来。什么时候用 SSR、CSR、SSG？状态管理用 Zustand 还是 Redux？这些需要判断力。\n3. **工具链集成**：会用 Claude Code、Cursor 只是开始，能把它们和 CI/CD、测试框架、监控系统串起来才是核心竞争力。\n4. **Code Review 能力**：AI 生成的代码不一定最优，你得能快速识别问题，给出改进方向。\n\n### 哪些工作会被替代，哪些不会\n\n**会被替代：**\n- 重复性编码（CRUD、表单验证、API 封装）\n- 样式微调（改个颜色、调个间距）\n- 简单 bug 修复\n\n**不会被替代：**\n- 产品思维（用户真正需要什么？）\n- 性能优化（AI 生成的代码往往不是最优）\n- 复杂问题调试（网络问题、浏览器兼容性）\n- 团队协作和沟通\n\n### 个人建议\n\n1. **拥抱 AI，但别依赖它**：用 AI 提速，但要理解 AI 生成的每一行代码。\n2. **深入一个领域**：前端性能优化、可访问性、动画设计，选一个深入下去。AI 还做不好这些。\n3. **学习 Agent 工具**：至少熟练掌握一个 Coding Agent（Cursor 或 Claude Code）和一个 Agent 框架（LangGraph 或 CrewAI）。\n4. **培养产品思维**：技术是手段，解决用户问题才是目的。\n\n## 开源工具全景对比\n\n市面上 AI 辅助编码工具一大堆，怎么选？下面是详细对比：\n\n| 工具 | 类型 | 月费 | 优势 | 劣势 | 适用场景 |\n|------|------|------|------|------|----------|\n| **Claude Code** | CLI Agent | $20 (Pro) | 强大的代码理解，工具调用灵活，支持插件 | 云服务，成本较高，需要终端操作 | 全栈开发，重构大型项目 |\n| **Cursor** | IDE | $20 | 流畅的编辑体验，上下文感知强 | 闭源，订阅费用，依赖网络 | 日常编码，快速迭代 |\n| **GitHub Copilot** | IDE 插件 | $10 | 生态集成好，支持多 IDE | 补全为主，自主性弱 | 代码补全，小改动 |\n| **v0.dev** | Web | $20 (Pro) | UI 生成专业，Shadcn/ui 集成 | 仅限 UI，无业务逻辑 | 快速原型，设计验证 |\n| **Continue.dev** | 开源 IDE | 免费 | 支持本地模型，高度可自定义 | 需要自己配置 | 成本敏感，定制需求 |\n| **OpenHands** | 开源 Agent | 免费 | 完全开源，可本地部署 | 生态不成熟，稳定性待提升 | 隐私要求高，研究学习 |\n\n### Claude Code - 终端里的全栈助手\n\n**适合场景：**大型项目重构、全栈开发、需要工具调用（Git、数据库、API）。\n\n**实际使用：**\n\n```bash\n# 安装\ncurl -fsSL https://claude.ai/install.sh | bash\n\n# 项目中使用\ncd my-nextjs-app\nclaude\n\n> 帮我把这个项目从 Pages Router 迁移到 App Router，保持所有功能不变\n\n# Claude Code 会：\n# 1. 分析现有路由结构\n# 2. 创建 app 目录\n# 3. 迁移每个页面到 App Router\n# 4. 更新 API 路由\n# 5. 跑测试验证\n# 6. 提交 Git\n```\n\n**成本：**Claude Pro $20/月（无限对话）+ API 调用费用\n\n### Cursor - 最顺手的 AI IDE\n\n**适合场景：**日常编码，需要频繁编辑和迭代。\n\n**实际使用：**\n\n```typescript\n// 在 Cursor 中，按 Cmd+K 唤起 AI\n// 输入：生成一个支持拖拽排序的 Todo List 组件\n\n// AI 生成：\nimport { useState } from 'react';\nimport { DndContext, closestCenter } from '@dnd-kit/core';\nimport { arrayMove, SortableContext, useSortable } from '@dnd-kit/sortable';\n\nexport function TodoList() {\n  const [items, setItems] = useState(['Task 1', 'Task 2', 'Task 3']);\n  \n  const handleDragEnd = (event) => {\n    const { active, over } = event;\n    if (active.id !== over.id) {\n      setItems((items) => {\n        const oldIndex = items.indexOf(active.id);\n        const newIndex = items.indexOf(over.id);\n        return arrayMove(items, oldIndex, newIndex);\n      });\n    }\n  };\n\n  return (\n    <DndContext collisionDetection={closestCenter} onDragEnd={handleDragEnd}>\n      <SortableContext items={items}>\n        {items.map((item) => <SortableItem key={item} id={item} />)}\n      </SortableContext>\n    </DndContext>\n  );\n}\n```\n\n**成本：**$20/月（500 次高级补全）\n\n### Continue.dev - 开源的自由选择\n\n**适合场景：**想用本地模型，或者需要深度定制。\n\n**实际使用：**\n\n```bash\n# 安装 VSCode 插件\ncode --install-extension continue.continue\n\n# 配置 config.json（~/.continue/config.json）\n{\n  \"models\": [\n    {\n      \"title\": \"DeepSeek R1\",\n      \"provider\": \"ollama\",\n      \"model\": \"deepseek-r1:33b\"\n    }\n  ],\n  \"tabAutocompleteModel\": {\n    \"title\": \"Qwen 2.5 Coder\",\n    \"provider\": \"ollama\",\n    \"model\": \"qwen2.5-coder:7b\"\n  }\n}\n```\n\n**成本：**完全免费（需要自己跑模型）\n\n### OpenHands - 开源 Autonomous Agent\n\n**适合场景：**研究学习，隐私要求高，想要完全控制。\n\n**实际使用：**\n\n```bash\n# Docker 运行\ndocker run -it --rm \\\n  -v $(pwd):/workspace \\\n  ghcr.io/all-hands-ai/openhands:latest\n\n# 或本地安装\ngit clone https://github.com/All-Hands-AI/OpenHands.git\ncd OpenHands\nmake build\nmake run\n\n# 打开 Web UI：http://localhost:3000\n# 输入任务：\"创建一个 React + Vite + TypeScript 项目，包含 ESLint 和 Prettier\"\n```\n\n**GitHub：**[github.com/All-Hands-AI/OpenHands](https://github.com/All-Hands-AI/OpenHands)\n\n**成本：**免费，但需要自己配置 API Key 或本地模型\n\n## 动手实践建议\n\n### 新手入门路线\n\n**第 1 周：**熟悉基础工具\n- 安装 Cursor 或 GitHub Copilot\n- 尝试用 AI 生成简单组件（Button、Card）\n- 学习如何写好 Prompt（明确需求、提供上下文）\n\n**第 2-3 周：**实战项目\n- 用 v0.dev 生成一个 Landing Page\n- 用 Cursor 添加交互逻辑（表单验证、API 调用）\n- 部署到 Vercel 或 Netlify\n\n**第 4 周：**尝试 Autonomous Agent\n- 安装 Claude Code 或 OpenHands\n- 让 Agent 帮你重构一个旧项目\n- 观察 Agent 的决策过程，学习它的思路\n\n### 进阶学习资源\n\n**文档和教程：**\n- [Claude Code 官方文档](https://claude.ai/docs)\n- [Cursor Documentation](https://cursor.sh/docs)\n- [LangGraph Tutorials](https://langchain-ai.github.io/langgraph/)\n- [Continue.dev Guide](https://continue.dev/docs)\n\n**YouTube 频道：**\n- **AI Jason**：深入讲解 AI 编程技巧\n- **Fireship**：快速上手各种 AI 工具\n\n**书籍：**\n- _Prompt Engineering for Developers_（OpenAI 官方课程）\n- _Building LLM Apps_（O'Reilly）\n\n### 开源项目推荐\n\n**学习 Agent 架构：**\n- [OpenHands](https://github.com/All-Hands-AI/OpenHands) - 开源 Autonomous Agent\n- [CrewAI Examples](https://github.com/crewAIInc/crewAI-examples) - 多 Agent 协作案例\n\n**前端 AI 工具：**\n- [v0-generative-ui](https://github.com/vercel/ai) - Vercel AI SDK\n- [shadcn/ui](https://github.com/shadcn-ui/ui) - AI 友好的组件库\n\n**本地 LLM 工具：**\n- [Ollama](https://github.com/ollama/ollama) - 本地运行大模型\n- [LM Studio](https://lmstudio.ai) - 图形化本地模型管理\n\n## 总结：AI Agent 不是银弹，但值得全力投入\n\n写完这个系列，最大的感受是：**AI Agent 已经不是\"未来\"，而是\"现在\"。**\n\n它不是银弹。AI 生成的代码需要 Review，架构决策还得你来做，复杂 bug 还是要自己调试。但它确实能让你的开发效率提升 3-5 倍。\n\n**我的建议是：**\n\n1. **尽早上手**：别等工具\"完美\"再用，现在就开始，边用边学。\n2. **保持判断力**：AI 是工具，不是老师。理解它的输出，别盲目信任。\n3. **投资学习**：Prompt Engineering、Agent 框架、工具链集成，这些技能值得花时间深入。\n4. **关注开源**：闭源工具很好用，但开源生态才是长期趋势。\n\n2026 年，前端开发的门槛在降低，但天花板在升高。会用 AI 的人和不会用的人，差距会越拉越大。\n\n**行动起来，从今天开始。**\n\n---\n\n_系列完结。感谢阅读。如果这个系列对你有帮助，欢迎分享给更多开发者。_\n\n_有问题或建议，欢迎在评论区讨论，或者 Twitter 上找我：[@chenguangliang](https://twitter.com/chenguangliang)_","src/data/blog/ai-agent-frontend-workflow-part4.md","b5ef52067f6b3fe0",{html:1789,metadata:1790},"<h2 id=\"系列回顾我们走到了哪里\">系列回顾：我们走到了哪里</h2>\n<p>过去三篇文章，我们从 AI Agent 辅助前端开发的基础用法，到实战技巧，再到高级工作流设计，基本把这个话题拆解透了：</p>\n<ul>\n<li><strong>第一篇</strong>讲了如何用 Cursor、Claude Code 等工具快速搭建前端项目，AI 从代码补全升级到需求理解。</li>\n<li><strong>第二篇</strong>深入到实战场景：组件生成、样式调试、API 对接，以及如何通过 Prompt Engineering 提高 AI 输出质量。</li>\n<li><strong>第三篇</strong>探讨高级工作流：多 Agent 协作、工具链集成、自动化测试和部署。</li>\n</ul>\n<p>如果用一张图总结完整的 AI Agent 前端工作流：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"plaintext\"><code><span class=\"line\"><span>需求输入 → AI 理解 → 架构设计 → 代码生成 → 样式调整 → 测试验证 → 部署上线</span></span>\n<span class=\"line\"><span>    ↓          ↓         ↓          ↓         ↓         ↓          ↓</span></span>\n<span class=\"line\"><span>  语音/文字  Claude   v0.dev    Cursor   Tailwind  Vitest    CI/CD</span></span>\n<span class=\"line\"><span>           Sonnet              Code              Playwright</span></span></code></pre>\n<p>这套流程在 2026 年初已经相当成熟。但技术不会停在这里。这篇完结篇，我们聊聊 AI Agent 接下来会往哪儿走，开发者该如何准备，以及有哪些开源工具值得关注。</p>\n<h2 id=\"发展趋势下一代-agent-长什么样\">发展趋势：下一代 Agent 长什么样</h2>\n<h3 id=\"1-从-copilot-到-autonomous-agent\">1. 从 Copilot 到 Autonomous Agent</h3>\n<p>**2023 年：**GitHub Copilot 引领的”智能补全”时代。你写一半代码，AI 猜出下半部分。</p>\n<p>**2024 年：**Cursor、Claude Code 的”对话式编程”。你用自然语言描述需求，AI 帮你写整个函数或组件。</p>\n<p>**2026 年：**真正的自主 Agent（Autonomous Agent）。你给它一个模糊目标，它自己规划任务、调用工具、验证结果、迭代优化。</p>\n<p>举个例子，用当前的 Claude Code：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 你给的指令</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">\"把这个 React 项目的登录页改成支持 OAuth，保持现有样式\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># Agent 的执行流程（自主决策）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">1.</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> 分析现有代码结构</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> →</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> 发现用的是</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> JWT</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">2.</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> 搜索</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> OAuth</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> 库文档</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> →</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> 选择</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> next-auth</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">3.</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> 安装依赖</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> →</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> npm</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> install</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> next-auth</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">4.</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> 修改</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> API</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> 路由</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> →</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> 添加</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> OAuth</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> provider</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">5.</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> 更新前端组件</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> →</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> 保持原有</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> Tailwind</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> 样式</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">6.</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> 运行测试</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> →</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> 发现</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> CORS</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> 问题</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">7.</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> 修复配置</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> →</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> 再次测试通过</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">8.</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> 提交代码</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> →</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> 生成</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> commit</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> message</span></span></code></pre>\n<p>整个过程你不需要干预。Agent 自己识别问题、找资料、改代码、测试验证。这不是科幻，OpenHands、Devin 已经在做这件事了。</p>\n<h3 id=\"2-multimodal-agent从设计稿到代码一步到位\">2. Multimodal Agent：从设计稿到代码一步到位</h3>\n<p>**现状：**v0.dev 能根据截图生成 UI，但需要你手动调整样式细节。</p>\n<p>**未来：**直接拿 Figma 设计稿，AI 不仅生成像素级精准的 UI，还包括交互逻辑、状态管理、API 对接。</p>\n<p>字节跳动的 <strong>UI-TARS</strong> 已经在这个方向上发力。它能理解设计稿的视觉层次、组件语义，甚至推断出用户交互流程。</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 未来的工作流</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">1.</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> 设计师完成</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> Figma</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> 设计</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">2.</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> 导出设计稿</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> URL</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">3.</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> Agent</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> 读取设计稿</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> →</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> 自动生成</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> React</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> +</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> TypeScript</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> 项目</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">4.</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> 包含</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> responsive</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> 布局、dark</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> mode、accessibility</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">5.</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> 前端代码直接可用</span></span></code></pre>\n<p>前端开发的重心会从”实现设计”转向”设计交互体验”和”优化性能”。</p>\n<h3 id=\"3-agent-协作多个-agent-分工合作\">3. Agent 协作：多个 Agent 分工合作</h3>\n<p>一个复杂前端项目，单个 Agent 搞不定。未来是多 Agent 团队协作：</p>\n<ul>\n<li><strong>架构 Agent</strong>：负责技术选型、项目结构设计</li>\n<li><strong>UI Agent</strong>：专注组件开发和样式</li>\n<li><strong>Logic Agent</strong>：处理业务逻辑和状态管理</li>\n<li><strong>Test Agent</strong>：编写测试用例、发现 bug</li>\n<li><strong>DevOps Agent</strong>：负责 CI/CD 和部署</li>\n</ul>\n<p>用 <strong>CrewAI</strong> 或 <strong>AutoGen</strong> 可以实现这种协作：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"python\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> crewai </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> Agent</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> Task</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> Crew</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 定义 Agent 团队</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">architect </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#6F42C1;--shiki-dark:#B2CCD6\"> Agent</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#212121;--shiki-dark:#D7DBE0\">    role</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">架构师</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D9F5DD\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#212121;--shiki-dark:#D7DBE0\">    goal</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">设计可扩展的前端架构</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D9F5DD\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#212121;--shiki-dark:#D7DBE0\">    backstory</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">精通 Next.js、React 生态</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">ui_developer </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#6F42C1;--shiki-dark:#B2CCD6\"> Agent</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#212121;--shiki-dark:#D7DBE0\">    role</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">UI 开发</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D9F5DD\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#212121;--shiki-dark:#D7DBE0\">    goal</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">实现像素级精准的界面</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D9F5DD\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#212121;--shiki-dark:#D7DBE0\">    tools</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#212121;--shiki-dark:#D9F5DD\">[</span><span style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">v0_tool, tailwind_tool</span><span style=\"--shiki-light:#212121;--shiki-dark:#D9F5DD\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 定义协作任务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">task1 </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#6F42C1;--shiki-dark:#B2CCD6\"> Task</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#212121;--shiki-dark:#D7DBE0\">    description</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">分析需求，设计项目结构</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D9F5DD\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#212121;--shiki-dark:#D7DBE0\">    agent</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">architect</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">task2 </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#6F42C1;--shiki-dark:#B2CCD6\"> Task</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#212121;--shiki-dark:#D7DBE0\">    description</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">根据架构，实现 UI 组件</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D9F5DD\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#212121;--shiki-dark:#D7DBE0\">    agent</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">ui_developer</span><span style=\"--shiki-light:#212121;--shiki-dark:#D9F5DD\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#212121;--shiki-dark:#D7DBE0\">    context</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#212121;--shiki-dark:#D9F5DD\">[</span><span style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">task1</span><span style=\"--shiki-light:#212121;--shiki-dark:#D9F5DD\">]</span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  # 依赖架构 Agent 的输出</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 执行协作</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">crew </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#6F42C1;--shiki-dark:#B2CCD6\"> Crew</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#212121;--shiki-dark:#D7DBE0\">agents</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#212121;--shiki-dark:#D9F5DD\">[</span><span style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">architect, ui_developer</span><span style=\"--shiki-light:#212121;--shiki-dark:#D9F5DD\">],</span><span style=\"--shiki-light:#212121;--shiki-dark:#D7DBE0\"> tasks</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#212121;--shiki-dark:#D9F5DD\">[</span><span style=\"--shiki-light:#212121;--shiki-dark:#82AAFF\">task1, task2</span><span style=\"--shiki-light:#212121;--shiki-dark:#D9F5DD\">]</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">crew</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-dark:#B2CCD6\">kickoff</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">()</span></span></code></pre>\n<h3 id=\"4-本地化趋势开源模型--边缘计算\">4. 本地化趋势：开源模型 + 边缘计算</h3>\n<p>云服务很方便，但有三个问题：<strong>成本、隐私、网络依赖</strong>。</p>\n<p>开源模型（DeepSeek R1、Qwen 2.5、Llama 3）性能已经接近 GPT-4，跑在本地完全可行。配合 <strong>Ollama</strong> 或 <strong>LM Studio</strong>，在 Mac Studio 或 4090 显卡上跑 33B 模型毫无压力。</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 本地运行 DeepSeek R1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">ollama</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> pull</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> deepseek-r1:33b</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">ollama</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> run</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> deepseek-r1:33b</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 配合 Continue.dev 使用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 在 VSCode 中，设置模型为 ollama/deepseek-r1:33b</span></span></code></pre>\n<p>本地 Agent 的好处：</p>\n<ul>\n<li><strong>零 API 成本</strong>：跑满 GPU 也不花钱</li>\n<li><strong>隐私保护</strong>：代码不离开本地网络</li>\n<li><strong>离线可用</strong>：飞机上、咖啡厅都能继续工作</li>\n</ul>\n<h2 id=\"开发者角色转变从码农到ai-编排者\">开发者角色转变：从”码农”到”AI 编排者”</h2>\n<h3 id=\"未来需要什么技能\">未来需要什么技能</h3>\n<p>**过去（2020）：**会写代码就够了。React、Vue、TypeScript 熟练，你就是前端工程师。</p>\n<p>**现在（2026）：**写代码只是基础。更重要的是：</p>\n<ol>\n<li><strong>Prompt Engineering</strong>：怎么把需求准确传达给 AI，怎么迭代 Prompt 优化输出质量。</li>\n<li><strong>架构设计</strong>：AI 能生成代码，但架构决策还得你来。什么时候用 SSR、CSR、SSG？状态管理用 Zustand 还是 Redux？这些需要判断力。</li>\n<li><strong>工具链集成</strong>：会用 Claude Code、Cursor 只是开始，能把它们和 CI/CD、测试框架、监控系统串起来才是核心竞争力。</li>\n<li><strong>Code Review 能力</strong>：AI 生成的代码不一定最优，你得能快速识别问题，给出改进方向。</li>\n</ol>\n<h3 id=\"哪些工作会被替代哪些不会\">哪些工作会被替代，哪些不会</h3>\n<p><strong>会被替代：</strong></p>\n<ul>\n<li>重复性编码（CRUD、表单验证、API 封装）</li>\n<li>样式微调（改个颜色、调个间距）</li>\n<li>简单 bug 修复</li>\n</ul>\n<p><strong>不会被替代：</strong></p>\n<ul>\n<li>产品思维（用户真正需要什么？）</li>\n<li>性能优化（AI 生成的代码往往不是最优）</li>\n<li>复杂问题调试（网络问题、浏览器兼容性）</li>\n<li>团队协作和沟通</li>\n</ul>\n<h3 id=\"个人建议\">个人建议</h3>\n<ol>\n<li><strong>拥抱 AI，但别依赖它</strong>：用 AI 提速，但要理解 AI 生成的每一行代码。</li>\n<li><strong>深入一个领域</strong>：前端性能优化、可访问性、动画设计，选一个深入下去。AI 还做不好这些。</li>\n<li><strong>学习 Agent 工具</strong>：至少熟练掌握一个 Coding Agent（Cursor 或 Claude Code）和一个 Agent 框架（LangGraph 或 CrewAI）。</li>\n<li><strong>培养产品思维</strong>：技术是手段，解决用户问题才是目的。</li>\n</ol>\n<h2 id=\"开源工具全景对比\">开源工具全景对比</h2>\n<p>市面上 AI 辅助编码工具一大堆，怎么选？下面是详细对比：</p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<table><thead><tr><th>工具</th><th>类型</th><th>月费</th><th>优势</th><th>劣势</th><th>适用场景</th></tr></thead><tbody><tr><td><strong>Claude Code</strong></td><td>CLI Agent</td><td>$20 (Pro)</td><td>强大的代码理解，工具调用灵活，支持插件</td><td>云服务，成本较高，需要终端操作</td><td>全栈开发，重构大型项目</td></tr><tr><td><strong>Cursor</strong></td><td>IDE</td><td>$20</td><td>流畅的编辑体验，上下文感知强</td><td>闭源，订阅费用，依赖网络</td><td>日常编码，快速迭代</td></tr><tr><td><strong>GitHub Copilot</strong></td><td>IDE 插件</td><td>$10</td><td>生态集成好，支持多 IDE</td><td>补全为主，自主性弱</td><td>代码补全，小改动</td></tr><tr><td><strong>v0.dev</strong></td><td>Web</td><td>$20 (Pro)</td><td>UI 生成专业，Shadcn/ui 集成</td><td>仅限 UI，无业务逻辑</td><td>快速原型，设计验证</td></tr><tr><td><strong>Continue.dev</strong></td><td>开源 IDE</td><td>免费</td><td>支持本地模型，高度可自定义</td><td>需要自己配置</td><td>成本敏感，定制需求</td></tr><tr><td><strong>OpenHands</strong></td><td>开源 Agent</td><td>免费</td><td>完全开源，可本地部署</td><td>生态不成熟，稳定性待提升</td><td>隐私要求高，研究学习</td></tr></tbody></table>\n<h3 id=\"claude-code---终端里的全栈助手\">Claude Code - 终端里的全栈助手</h3>\n<p>**适合场景：**大型项目重构、全栈开发、需要工具调用（Git、数据库、API）。</p>\n<p><strong>实际使用：</strong></p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 安装</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">curl</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\"> -fsSL</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> https://claude.ai/install.sh</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> |</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> bash</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 项目中使用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">cd</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> my-nextjs-app</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">claude</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> 帮我把这个项目从 Pages Router 迁移到 App Router，保持所有功能不变</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># Claude Code 会：</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 1. 分析现有路由结构</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 2. 创建 app 目录</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 3. 迁移每个页面到 App Router</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 4. 更新 API 路由</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 5. 跑测试验证</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 6. 提交 Git</span></span></code></pre>\n<p>**成本：**Claude Pro $20/月（无限对话）+ API 调用费用</p>\n<h3 id=\"cursor---最顺手的-ai-ide\">Cursor - 最顺手的 AI IDE</h3>\n<p>**适合场景：**日常编码，需要频繁编辑和迭代。</p>\n<p><strong>实际使用：</strong></p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"typescript\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 在 Cursor 中，按 Cmd+K 唤起 AI</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 输入：生成一个支持拖拽排序的 Todo List 组件</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// AI 生成：</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { useState } </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">react</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { DndContext</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> closestCenter } </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">@dnd-kit/core</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { arrayMove</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> SortableContext</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> useSortable } </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">@dnd-kit/sortable</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">export</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> function</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> TodoList</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">()</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  const</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> [</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">items</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> setItems</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">]</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> useState</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">([</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">Task 1</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">Task 2</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">Task 3</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  const</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> handleDragEnd</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D7DBE0;--shiki-dark-font-style:italic\">event</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    const</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> active</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> over</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> }</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> event</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">active</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic\">id</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> !==</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> over</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic\">id</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">      setItems</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D7DBE0;--shiki-dark-font-style:italic\">items</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">        const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> oldIndex</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> items</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">indexOf</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">active</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic\">id</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">        const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> newIndex</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> items</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">indexOf</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">over</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic\">id</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        return</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> arrayMove</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">items</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> oldIndex</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> newIndex</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">      }</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">    }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">  }</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    &#x3C;</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">DndContext collisionDetection</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">{closestCenter} onDragEnd</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">{handleDragEnd}</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">      &#x3C;</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">SortableContext items</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">{items}</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        {</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">items</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">map</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">((</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">item</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> &#x3C;</span><span style=\"--shiki-light:#6F42C1;--shiki-dark:#FFCB8B\">SortableItem</span><span style=\"--shiki-light:#6F42C1;--shiki-dark:#FFCB8B\"> key</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">={item} </span><span style=\"--shiki-light:#6F42C1;--shiki-dark:#FFCB8B\">id</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">={item} />)}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">      &#x3C;/</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">SortableContext</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    &#x3C;/</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">DndContext</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  );</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span></code></pre>\n<p><strong>成本：</strong>$20/月（500 次高级补全）</p>\n<h3 id=\"continuedev---开源的自由选择\">Continue.dev - 开源的自由选择</h3>\n<p>**适合场景：**想用本地模型，或者需要深度定制。</p>\n<p><strong>实际使用：</strong></p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 安装 VSCode 插件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">code</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\"> --install-extension</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> continue.continue</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 配置 config.json（~/.continue/config.json）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">  \"models\"</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">      \"title\"</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">DeepSeek R1</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">      \"provider\"</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">ollama</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">      \"model\"</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">deepseek-r1:33b</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  ],</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">  \"tabAutocompleteModel\"</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">:</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">    \"title\"</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">Qwen 2.5 Coder</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">    \"provider\"</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">ollama</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">    \"model\"</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">qwen2.5-coder:7b</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span></code></pre>\n<p>**成本：**完全免费（需要自己跑模型）</p>\n<h3 id=\"openhands---开源-autonomous-agent\">OpenHands - 开源 Autonomous Agent</h3>\n<p>**适合场景：**研究学习，隐私要求高，想要完全控制。</p>\n<p><strong>实际使用：</strong></p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># Docker 运行</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">docker</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> run</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\"> -it</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\"> --rm</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#F78C6C\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\">  -v</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> $(</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">pwd</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">:/workspace</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#F78C6C\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">  ghcr.io/all-hands-ai/openhands:latest</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 或本地安装</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">git</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> clone</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> https://github.com/All-Hands-AI/OpenHands.git</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">cd</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> OpenHands</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">make</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> build</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">make</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> run</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 打开 Web UI：http://localhost:3000</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 输入任务：\"创建一个 React + Vite + TypeScript 项目，包含 ESLint 和 Prettier\"</span></span></code></pre>\n<p><strong>GitHub：</strong><a href=\"https://github.com/All-Hands-AI/OpenHands\">github.com/All-Hands-AI/OpenHands</a></p>\n<p>**成本：**免费，但需要自己配置 API Key 或本地模型</p>\n<h2 id=\"动手实践建议\">动手实践建议</h2>\n<h3 id=\"新手入门路线\">新手入门路线</h3>\n<p>**第 1 周：**熟悉基础工具</p>\n<ul>\n<li>安装 Cursor 或 GitHub Copilot</li>\n<li>尝试用 AI 生成简单组件（Button、Card）</li>\n<li>学习如何写好 Prompt（明确需求、提供上下文）</li>\n</ul>\n<p>**第 2-3 周：**实战项目</p>\n<ul>\n<li>用 v0.dev 生成一个 Landing Page</li>\n<li>用 Cursor 添加交互逻辑（表单验证、API 调用）</li>\n<li>部署到 Vercel 或 Netlify</li>\n</ul>\n<p>**第 4 周：**尝试 Autonomous Agent</p>\n<ul>\n<li>安装 Claude Code 或 OpenHands</li>\n<li>让 Agent 帮你重构一个旧项目</li>\n<li>观察 Agent 的决策过程，学习它的思路</li>\n</ul>\n<h3 id=\"进阶学习资源\">进阶学习资源</h3>\n<p><strong>文档和教程：</strong></p>\n<ul>\n<li><a href=\"https://claude.ai/docs\">Claude Code 官方文档</a></li>\n<li><a href=\"https://cursor.sh/docs\">Cursor Documentation</a></li>\n<li><a href=\"https://langchain-ai.github.io/langgraph/\">LangGraph Tutorials</a></li>\n<li><a href=\"https://continue.dev/docs\">Continue.dev Guide</a></li>\n</ul>\n<p><strong>YouTube 频道：</strong></p>\n<ul>\n<li><strong>AI Jason</strong>：深入讲解 AI 编程技巧</li>\n<li><strong>Fireship</strong>：快速上手各种 AI 工具</li>\n</ul>\n<p><strong>书籍：</strong></p>\n<ul>\n<li><em>Prompt Engineering for Developers</em>（OpenAI 官方课程）</li>\n<li><em>Building LLM Apps</em>（O’Reilly）</li>\n</ul>\n<h3 id=\"开源项目推荐\">开源项目推荐</h3>\n<p><strong>学习 Agent 架构：</strong></p>\n<ul>\n<li><a href=\"https://github.com/All-Hands-AI/OpenHands\">OpenHands</a> - 开源 Autonomous Agent</li>\n<li><a href=\"https://github.com/crewAIInc/crewAI-examples\">CrewAI Examples</a> - 多 Agent 协作案例</li>\n</ul>\n<p><strong>前端 AI 工具：</strong></p>\n<ul>\n<li><a href=\"https://github.com/vercel/ai\">v0-generative-ui</a> - Vercel AI SDK</li>\n<li><a href=\"https://github.com/shadcn-ui/ui\">shadcn/ui</a> - AI 友好的组件库</li>\n</ul>\n<p><strong>本地 LLM 工具：</strong></p>\n<ul>\n<li><a href=\"https://github.com/ollama/ollama\">Ollama</a> - 本地运行大模型</li>\n<li><a href=\"https://lmstudio.ai\">LM Studio</a> - 图形化本地模型管理</li>\n</ul>\n<h2 id=\"总结ai-agent-不是银弹但值得全力投入\">总结：AI Agent 不是银弹，但值得全力投入</h2>\n<p>写完这个系列，最大的感受是：<strong>AI Agent 已经不是”未来”，而是”现在”。</strong></p>\n<p>它不是银弹。AI 生成的代码需要 Review，架构决策还得你来做，复杂 bug 还是要自己调试。但它确实能让你的开发效率提升 3-5 倍。</p>\n<p><strong>我的建议是：</strong></p>\n<ol>\n<li><strong>尽早上手</strong>：别等工具”完美”再用，现在就开始，边用边学。</li>\n<li><strong>保持判断力</strong>：AI 是工具，不是老师。理解它的输出，别盲目信任。</li>\n<li><strong>投资学习</strong>：Prompt Engineering、Agent 框架、工具链集成，这些技能值得花时间深入。</li>\n<li><strong>关注开源</strong>：闭源工具很好用，但开源生态才是长期趋势。</li>\n</ol>\n<p>2026 年，前端开发的门槛在降低，但天花板在升高。会用 AI 的人和不会用的人，差距会越拉越大。</p>\n<p><strong>行动起来，从今天开始。</strong></p>\n<hr>\n<p><em>系列完结。感谢阅读。如果这个系列对你有帮助，欢迎分享给更多开发者。</em></p>\n<p><em>有问题或建议，欢迎在评论区讨论，或者 Twitter 上找我：<a href=\"https://twitter.com/chenguangliang\">@chenguangliang</a></em></p>",{headings:1791,localImagePaths:1845,remoteImagePaths:1846,frontmatter:1847,imagePaths:1850},[1792,1795,1798,1801,1804,1807,1810,1813,1815,1818,1820,1822,1825,1828,1831,1834,1836,1838,1840,1842],{depth:31,slug:1793,text:1794},"系列回顾我们走到了哪里","系列回顾：我们走到了哪里",{depth:31,slug:1796,text:1797},"发展趋势下一代-agent-长什么样","发展趋势：下一代 Agent 长什么样",{depth:185,slug:1799,text:1800},"1-从-copilot-到-autonomous-agent","1. 从 Copilot 到 Autonomous Agent",{depth:185,slug:1802,text:1803},"2-multimodal-agent从设计稿到代码一步到位","2. Multimodal Agent：从设计稿到代码一步到位",{depth:185,slug:1805,text:1806},"3-agent-协作多个-agent-分工合作","3. Agent 协作：多个 Agent 分工合作",{depth:185,slug:1808,text:1809},"4-本地化趋势开源模型--边缘计算","4. 本地化趋势：开源模型 + 边缘计算",{depth:31,slug:1811,text:1812},"开发者角色转变从码农到ai-编排者","开发者角色转变：从”码农”到”AI 编排者”",{depth:185,slug:1814,text:1814},"未来需要什么技能",{depth:185,slug:1816,text:1817},"哪些工作会被替代哪些不会","哪些工作会被替代，哪些不会",{depth:185,slug:1819,text:1819},"个人建议",{depth:31,slug:1821,text:1821},"开源工具全景对比",{depth:185,slug:1823,text:1824},"claude-code---终端里的全栈助手","Claude Code - 终端里的全栈助手",{depth:185,slug:1826,text:1827},"cursor---最顺手的-ai-ide","Cursor - 最顺手的 AI IDE",{depth:185,slug:1829,text:1830},"continuedev---开源的自由选择","Continue.dev - 开源的自由选择",{depth:185,slug:1832,text:1833},"openhands---开源-autonomous-agent","OpenHands - 开源 Autonomous Agent",{depth:31,slug:1835,text:1835},"动手实践建议",{depth:185,slug:1837,text:1837},"新手入门路线",{depth:185,slug:1839,text:1839},"进阶学习资源",{depth:185,slug:1841,text:1841},"开源项目推荐",{depth:31,slug:1843,text:1844},"总结ai-agent-不是银弹但值得全力投入","总结：AI Agent 不是银弹，但值得全力投入",[],[],{author:14,pubDatetime:1848,title:1781,slug:1777,featured:165,draft:17,tags:1849,description:1784},["Date","2026-02-16T10:00:00.000Z"],[167,168,1783,19],[],"ai-agent-frontend-workflow-part3",{id:1851,data:1853,body:1860,filePath:1861,digest:1862,rendered:1863},{author:14,pubDatetime:1854,title:1855,featured:165,draft:17,tags:1856,description:1859},["Date","2026-02-15T10:00:00.000Z"],"AI Agent 前端工作流（三）：成本优化与团队协作最佳实践",[167,168,1857,1858],"团队协作","成本优化","如何控制 AI Agent 的 Token 成本？如何处理模型幻觉？如何在团队中推广？本文分享实战优化策略和协作最佳实践，附真实成本数据。","## 前情回顾\n\n在本系列的前两篇文章中，我们探讨了如何利用 AI Agent 提升前端开发效率：\n\n- **第一篇**：介绍了如何使用 AI Agent 自动生成 React 组件、样式代码，以及如何通过精心设计的 Prompt 提高代码质量\n- **第二篇**：深入讲解了 AI Agent 在代码审查、自动化测试生成、以及 CI/CD 集成中的应用\n\n理论很美好，但当你真正在生产环境中落地 AI Agent 时，会遇到两个绕不开的核心问题：\n\n1. **成本控制**：每次调用 GPT-4 或 Claude 都在烧钱，如何优化？\n2. **团队协作**：个人玩得转，如何让整个团队用起来？\n\n今天这篇文章，我们就来解决这些实际落地中的硬核问题。\n\n## Token 成本控制策略\n\n### 成本构成分析\n\n以 Anthropic Claude 为例，成本主要由三部分构成：\n\n```\n总成本 = 输入 Token 成本 + 输出 Token 成本 + 缓存成本\n```\n\n**实际价格（Claude Sonnet 3.5）**：\n- 输入：$3 / 1M tokens\n- 输出：$15 / 1M tokens\n- 缓存写入：$3.75 / 1M tokens\n- 缓存读取：$0.30 / 1M tokens\n\n**一个真实的案例**：\n生成一个中等复杂度的 React 组件（约 200 行代码）：\n\n```\n输入：系统 Prompt (2k) + 需求描述 (500) + 上下文代码 (3k) = 5,500 tokens\n输出：生成代码 + 解释 = 1,200 tokens\n成本：(5,500 × $3 + 1,200 × $15) / 1,000,000 = $0.0345\n```\n\n看起来很便宜？但如果你每天生成 100 个组件，每月成本就是 **$103.5**。如果是大团队，成本会指数级上升。\n\n### 实战优化技巧\n\n#### 1. 精简 Prompt，去除冗余上下文\n\n**反面案例**（浪费 Token）：\n\n```javascript\nconst systemPrompt = `\n你是一个专业的前端开发工程师，精通 React、TypeScript、Tailwind CSS。\n请根据用户需求生成高质量的代码。注意代码规范、性能优化、可维护性。\n遵循以下原则：\n1. 使用函数式组件\n2. 合理使用 hooks\n3. 保持代码简洁\n4. 添加必要的注释\n5. 处理边界情况\n6. 确保类型安全\n7. 优化渲染性能\n8. 使用语义化标签\n... (省略 50 行废话)\n\n当前项目技术栈：React 18.2、TypeScript 5.0、Vite 4.3...\n当前文件：${整个文件的代码，包括导入、样式等}\n相关依赖文件：${所有依赖文件的完整代码}\n`;\n```\n\n**优化后**（节省 70% Token）：\n\n```javascript\nconst systemPrompt = `\nReact + TS 前端工程师。生成代码需：函数组件、类型安全、简洁。\n\n技术栈：React 18、TS 5、Tailwind\n相关类型：${仅提取必要的类型定义}\n`;\n```\n\n**节省效果**：从 3,000 tokens 降至 900 tokens，每次节省 **$0.0063**。\n\n#### 2. 使用 Prompt Caching（重要！）\n\nAnthropic 的 Prompt Caching 可以将重复的上下文缓存起来，后续调用只需付缓存读取费用（便宜 10 倍）。\n\n**代码示例**：\n\n```typescript\nimport Anthropic from \"@anthropic-ai/sdk\";\n\nconst client = new Anthropic({\n  apiKey: process.env.ANTHROPIC_API_KEY,\n});\n\nasync function generateComponent(requirement: string) {\n  const response = await client.messages.create({\n    model: \"claude-3-5-sonnet-20241022\",\n    max_tokens: 2048,\n    system: [\n      {\n        type: \"text\",\n        text: \"你是 React 前端专家，生成高质量组件代码。\",\n      },\n      {\n        type: \"text\",\n        text: `项目规范文档：\\n${projectGuidelines}`, // 长文档\n        cache_control: { type: \"ephemeral\" }, // 🔥 关键：标记为可缓存\n      },\n      {\n        type: \"text\",\n        text: `通用工具函数库：\\n${utilsCode}`,\n        cache_control: { type: \"ephemeral\" }, // 🔥 缓存工具库\n      },\n    ],\n    messages: [\n      {\n        role: \"user\",\n        content: requirement, // 每次变化的部分\n      },\n    ],\n  });\n\n  return response.content[0].text;\n}\n```\n\n**成本对比**（10 次调用，每次 5k 缓存内容）：\n\n| 方案 | 首次成本 | 后续成本（9次） | 总成本 |\n|------|---------|----------------|--------|\n| 无缓存 | $0.015 | $0.135 | $0.150 |\n| 有缓存 | $0.01875 | $0.0135 | $0.03225 |\n\n**节省 78.5%！**\n\n#### 3. 批处理策略\n\n不要每次生成一个组件就调用一次 API，而是批量处理：\n\n```typescript\n// ❌ 低效：每个组件单独调用\nfor (const component of components) {\n  await generateComponent(component.requirement);\n}\n\n// ✅ 高效：批量生成\nconst batch = components.slice(0, 5).map(c => c.requirement);\nconst prompt = `\n批量生成以下 5 个组件，每个组件用 --- 分隔：\n${batch.map((req, i) => `${i + 1}. ${req}`).join('\\n')}\n`;\nconst result = await generateComponents(prompt);\n```\n\n**节省效果**：减少 API 调用次数，节省 **40-60%** 的输入成本。\n\n#### 4. 模型选择：按需使用\n\n| 模型 | 输入价格 | 输出价格 | 适用场景 |\n|------|---------|---------|---------|\n| Opus | $15/1M | $75/1M | 复杂架构设计、重要代码审查 |\n| Sonnet | $3/1M | $15/1M | 日常组件生成、代码重构 |\n| Haiku | $0.25/1M | $1.25/1M | 简单格式化、代码补全 |\n\n**策略**：\n- 用 Haiku 做代码格式化、导入语句补全（成本降低 **90%**）\n- 用 Sonnet 做常规开发（性价比最优）\n- 用 Opus 做关键决策（准确性优先）\n\n```typescript\nconst MODEL_MAP = {\n  format: \"claude-3-haiku-20240307\",\n  component: \"claude-3-5-sonnet-20241022\",\n  architecture: \"claude-3-opus-20240229\",\n};\n\nfunction selectModel(taskType: keyof typeof MODEL_MAP) {\n  return MODEL_MAP[taskType];\n}\n```\n\n### 优化前后对比\n\n**优化前**（某团队真实数据）：\n- 月调用次数：15,000\n- 平均每次成本：$0.042\n- 月总成本：**$630**\n\n**优化后**：\n- 启用 Prompt Caching：节省 75%\n- 模型分级使用：节省 40%\n- 批处理：节省 50%\n- 月总成本：**$78.75**\n\n**节省 87.5%，年节省 $6,615！**\n\n## 如何处理模型幻觉\n\n### 什么是幻觉？\n\n**幻觉（Hallucination）**：AI 模型自信地输出错误或虚构的内容。\n\n### 前端开发中的常见幻觉案例\n\n#### 案例 1：虚构 API\n\n```typescript\n// 🚨 AI 生成的代码\nimport { useDebounce } from 'react-hooks-library'; // 这个库不存在！\n\nfunction SearchInput() {\n  const debouncedValue = useDebounce(value, 500);\n  // ...\n}\n```\n\n#### 案例 2：错误的类型定义\n\n```typescript\n// 🚨 AI 认为这个属性存在\ninterface User {\n  id: string;\n  emailVerifiedAt: Date; // 实际项目中没有这个字段\n}\n```\n\n#### 案例 3：过时的 API 用法\n\n```typescript\n// 🚨 React 18+ 已废弃 ReactDOM.render\nimport ReactDOM from 'react-dom';\n\nReactDOM.render(<App />, document.getElementById('root'));\n```\n\n### 应对策略\n\n#### 1. 增加自动验证步骤\n\n```typescript\n// validation-agent.ts\nimport { exec } from 'child_process';\nimport { promisify } from 'util';\n\nconst execAsync = promisify(exec);\n\nasync function validateGeneratedCode(code: string, filePath: string) {\n  // 写入临时文件\n  await fs.writeFile(filePath, code);\n\n  const checks = [];\n\n  // 1. TypeScript 类型检查\n  try {\n    await execAsync(`tsc --noEmit ${filePath}`);\n    checks.push({ name: 'TypeScript', status: 'pass' });\n  } catch (error) {\n    checks.push({ name: 'TypeScript', status: 'fail', error: error.stderr });\n  }\n\n  // 2. ESLint 检查\n  try {\n    await execAsync(`eslint ${filePath}`);\n    checks.push({ name: 'ESLint', status: 'pass' });\n  } catch (error) {\n    checks.push({ name: 'ESLint', status: 'fail', error: error.stdout });\n  }\n\n  // 3. 导入检查（是否有不存在的包）\n  const imports = code.match(/from ['\"](.+?)['\"]/g) || [];\n  for (const imp of imports) {\n    const pkg = imp.match(/from ['\"]([@\\w\\-/]+)/)?.[1];\n    if (pkg && !pkg.startsWith('.')) {\n      try {\n        require.resolve(pkg);\n        checks.push({ name: `Import: ${pkg}`, status: 'pass' });\n      } catch {\n        checks.push({ name: `Import: ${pkg}`, status: 'fail', error: 'Package not found' });\n      }\n    }\n  }\n\n  return checks;\n}\n\n// 使用示例\nconst generatedCode = await aiAgent.generateComponent(requirement);\nconst validation = await validateGeneratedCode(generatedCode, './temp.tsx');\n\nif (validation.some(c => c.status === 'fail')) {\n  // 将错误反馈给 AI，让它修复\n  const fixedCode = await aiAgent.fixCode(generatedCode, validation);\n}\n```\n\n#### 2. Few-shot Learning（提供正确示例）\n\n```typescript\nconst fewShotPrompt = `\n以下是正确的代码示例：\n\n示例 1：使用项目中实际存在的 hooks\n\\`\\`\\`typescript\nimport { useDebounce } from '@/hooks/useDebounce'; // ✅ 项目内的 hook\n\\`\\`\\`\n\n示例 2：正确的 User 类型定义\n\\`\\`\\`typescript\ninterface User {\n  id: string;\n  email: string;\n  name: string;\n  createdAt: string; // ✅ ISO 8601 字符串，不是 Date\n}\n\\`\\`\\`\n\n现在请生成：${requirement}\n`;\n```\n\n#### 3. 结果校验和人工审核\n\n```typescript\n// code-review-workflow.ts\nasync function codeGenerationWorkflow(requirement: string) {\n  // 1. 生成代码\n  const code = await aiAgent.generateComponent(requirement);\n\n  // 2. 自动验证\n  const validation = await validateGeneratedCode(code);\n\n  // 3. 风险评分\n  const riskScore = calculateRisk(validation);\n\n  if (riskScore < 30) {\n    // 低风险：自动合并\n    await commitCode(code);\n  } else if (riskScore < 70) {\n    // 中风险：创建 PR，等待审核\n    await createPullRequest(code, validation);\n  } else {\n    // 高风险：拒绝，要求人工介入\n    await notifyDeveloper({\n      message: '生成的代码风险过高，请人工检查',\n      code,\n      issues: validation.filter(v => v.status === 'fail'),\n    });\n  }\n}\n```\n\n## 团队协作最佳实践\n\n### 如何在团队中推广 AI Agent\n\n**分阶段推进**：\n\n1. **试点阶段**（1-2 周）\n   - 挑选 2-3 个技术能力强的开发者试用\n   - 收集反馈，优化 Prompt 和工作流\n   - 记录节省的时间和成本数据\n\n2. **小范围推广**（1 个月）\n   - 团队内培训（1 小时工作坊）\n   - 提供标准化的 Prompt 模板\n   - 建立反馈渠道\n\n3. **全面铺开**（2-3 个月）\n   - 纳入开发规范\n   - 定期分享最佳实践\n   - 持续优化\n\n### Prompt 版本管理\n\n将 Prompt 当作代码来管理：\n\n```bash\n# 项目结构\nprompts/\n  ├── component-generation.md\n  ├── code-review.md\n  ├── test-generation.md\n  └── version.json\n```\n\n**示例：`prompts/component-generation.md`**\n\n```markdown\n# Component Generation Prompt\n\nVersion: 2.1.0\nLast Updated: 2026-02-10\nAuthor: 陈广亮\n\n## System Prompt\n\n你是专业的 React + TypeScript 前端工程师。\n\n## Rules\n\n1. 必须使用函数式组件\n2. Props 必须有 TypeScript 类型定义\n3. 使用 Tailwind CSS（不使用内联样式）\n4. 导入路径使用 `@/` 别名\n\n## Example\n\n\\`\\`\\`typescript\n// ✅ 正确示例\nimport { FC } from 'react';\n\ninterface ButtonProps {\n  label: string;\n  onClick: () => void;\n}\n\nexport const Button: FC<ButtonProps> = ({ label, onClick }) => {\n  return (\n    <button\n      onClick={onClick}\n      className=\"px-4 py-2 bg-blue-500 text-white rounded\"\n    >\n      {label}\n    </button>\n  );\n};\n\\`\\`\\`\n\n## User Input\n\n${requirement}\n```\n\n**Git 管理**：\n\n```bash\ngit add prompts/\ngit commit -m \"feat(prompt): 优化组件生成 prompt，增加边界情况处理\"\ngit push origin main\n```\n\n### 建立团队 Prompt 库\n\n```typescript\n// prompt-manager.ts\nimport fs from 'fs/promises';\nimport path from 'path';\n\nclass PromptManager {\n  private promptsDir = './prompts';\n\n  async getPrompt(name: string, version?: string): Promise<string> {\n    const filePath = path.join(this.promptsDir, `${name}.md`);\n    const content = await fs.readFile(filePath, 'utf-8');\n\n    // 如果指定版本，从 Git 历史获取\n    if (version) {\n      const { exec } = require('child_process');\n      const { stdout } = await exec(\n        `git show ${version}:${filePath}`\n      );\n      return stdout;\n    }\n\n    return content;\n  }\n\n  async listPrompts(): Promise<string[]> {\n    const files = await fs.readdir(this.promptsDir);\n    return files.filter(f => f.endsWith('.md')).map(f => f.replace('.md', ''));\n  }\n}\n\n// 使用示例\nconst pm = new PromptManager();\nconst prompt = await pm.getPrompt('component-generation');\n```\n\n### 权限和审批流程\n\n```typescript\n// rbac-config.ts\nconst permissions = {\n  junior: {\n    allowedModels: ['claude-3-haiku-20240307'],\n    maxTokensPerDay: 100000,\n    requiresApproval: true,\n  },\n  senior: {\n    allowedModels: ['claude-3-5-sonnet-20241022', 'claude-3-haiku-20240307'],\n    maxTokensPerDay: 500000,\n    requiresApproval: false,\n  },\n  lead: {\n    allowedModels: ['claude-3-opus-20240229', 'claude-3-5-sonnet-20241022'],\n    maxTokensPerDay: 1000000,\n    requiresApproval: false,\n  },\n};\n\nfunction checkPermission(userId: string, model: string) {\n  const user = getUser(userId);\n  const perm = permissions[user.role];\n\n  if (!perm.allowedModels.includes(model)) {\n    throw new Error(`你没有权限使用 ${model}`);\n  }\n\n  const usage = getTodayUsage(userId);\n  if (usage > perm.maxTokensPerDay) {\n    throw new Error('今日 Token 配额已用完');\n  }\n}\n```\n\n## 隐私和安全考虑\n\n### API Key 管理\n\n```typescript\n// ❌ 危险：硬编码\nconst apiKey = 'sk-ant-1234567890';\n\n// ✅ 安全：环境变量\nconst apiKey = process.env.ANTHROPIC_API_KEY;\n\n// ✅✅ 更安全：密钥轮转\nimport { SecretsManager } from '@aws-sdk/client-secrets-manager';\n\nasync function getApiKey() {\n  const client = new SecretsManager({ region: 'us-east-1' });\n  const response = await client.getSecretValue({ SecretId: 'anthropic-api-key' });\n  return response.SecretString;\n}\n```\n\n### 敏感数据脱敏\n\n```typescript\n// sanitize.ts\nfunction sanitizeCode(code: string): string {\n  return code\n    .replace(/sk-[a-zA-Z0-9]{48}/g, 'sk-***REDACTED***') // API Key\n    .replace(/\\b[\\w\\.-]+@[\\w\\.-]+\\.\\w+\\b/g, '***@***.com') // Email\n    .replace(/\\d{3}-\\d{4}-\\d{4}/g, '***-****-****'); // 手机号\n}\n\n// 发送给 AI 前先脱敏\nconst sanitizedContext = sanitizeCode(fileContent);\nconst result = await aiAgent.generate(requirement, sanitizedContext);\n```\n\n### 本地部署 vs 云服务对比\n\n| 维度 | 本地部署（Ollama + CodeLlama） | 云服务（Claude/GPT-4） |\n|------|-------------------------------|----------------------|\n| 成本 | 硬件投入高，使用免费 | 按量付费 |\n| 性能 | 依赖硬件（需高端 GPU） | 云端算力，速度快 |\n| 隐私 | 数据不出本地 | 数据上传云端 |\n| 维护 | 需要自己维护模型 | 无需维护 |\n| 适用场景 | 对隐私要求极高的场景 | 大多数商业场景 |\n\n**建议**：\n- 金融、医疗等强合规行业：本地部署\n- 一般企业：云服务 + 数据脱敏\n- 开源项目：云服务\n\n### 合规性考虑\n\n1. **GDPR**：确保用户代码不包含个人数据，或获得明确授权\n2. **企业政策**：检查公司是否允许将代码发送到外部 API\n3. **许可证**：AI 生成的代码许可证归属问题（建议添加审核步骤）\n\n## 总结与展望\n\n在本文中，我们解决了 AI Agent 落地的两大核心问题：\n\n**成本优化**：\n- 通过 Prompt Caching、模型分级、批处理等手段，可节省 **80%+ 成本**\n- 真实案例：月成本从 $630 降至 $78.75\n\n**团队协作**：\n- Prompt 版本管理、权限控制、审批流程缺一不可\n- 将 Prompt 当作代码管理，像管理 API 一样管理 AI\n\n**处理幻觉**：\n- 自动验证 + Few-shot Learning + 人工审核三管齐下\n- 降低生产事故风险\n\n下一篇文章，我们将探讨 **AI Agent 的未来展望与开源工具推荐**，包括：\n- 多模态 Agent（从设计稿直接生成代码）\n- Agent 编排框架（LangChain、LangGraph、AutoGen）\n- 如何构建自己的 Agent 工作流\n- 2026 年最值得关注的开源项目\n\n敬请期待！\n\n---\n\n**关于作者**：陈广亮，全栈工程师，AI 工程化实践者，专注于将 AI 技术落地到实际开发工作流中。本文所有代码和案例均来自真实项目经验。\n\n如果这篇文章对你有帮助，欢迎分享给你的团队！有任何问题，欢迎在评论区讨论。","src/data/blog/ai-agent-frontend-workflow-part3.md","6065600a86ae444f",{html:1864,metadata:1865},"<h2 id=\"前情回顾\">前情回顾</h2>\n<p>在本系列的前两篇文章中，我们探讨了如何利用 AI Agent 提升前端开发效率：</p>\n<ul>\n<li><strong>第一篇</strong>：介绍了如何使用 AI Agent 自动生成 React 组件、样式代码，以及如何通过精心设计的 Prompt 提高代码质量</li>\n<li><strong>第二篇</strong>：深入讲解了 AI Agent 在代码审查、自动化测试生成、以及 CI/CD 集成中的应用</li>\n</ul>\n<p>理论很美好，但当你真正在生产环境中落地 AI Agent 时，会遇到两个绕不开的核心问题：</p>\n<ol>\n<li><strong>成本控制</strong>：每次调用 GPT-4 或 Claude 都在烧钱，如何优化？</li>\n<li><strong>团队协作</strong>：个人玩得转，如何让整个团队用起来？</li>\n</ol>\n<p>今天这篇文章，我们就来解决这些实际落地中的硬核问题。</p>\n<h2 id=\"token-成本控制策略\">Token 成本控制策略</h2>\n<h3 id=\"成本构成分析\">成本构成分析</h3>\n<p>以 Anthropic Claude 为例，成本主要由三部分构成：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"plaintext\"><code><span class=\"line\"><span>总成本 = 输入 Token 成本 + 输出 Token 成本 + 缓存成本</span></span></code></pre>\n<p><strong>实际价格（Claude Sonnet 3.5）</strong>：</p>\n<ul>\n<li>输入：$3 / 1M tokens</li>\n<li>输出：$15 / 1M tokens</li>\n<li>缓存写入：$3.75 / 1M tokens</li>\n<li>缓存读取：$0.30 / 1M tokens</li>\n</ul>\n<p><strong>一个真实的案例</strong>：\n生成一个中等复杂度的 React 组件（约 200 行代码）：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"plaintext\"><code><span class=\"line\"><span>输入：系统 Prompt (2k) + 需求描述 (500) + 上下文代码 (3k) = 5,500 tokens</span></span>\n<span class=\"line\"><span>输出：生成代码 + 解释 = 1,200 tokens</span></span>\n<span class=\"line\"><span>成本：(5,500 × $3 + 1,200 × $15) / 1,000,000 = $0.0345</span></span></code></pre>\n<p>看起来很便宜？但如果你每天生成 100 个组件，每月成本就是 <strong>$103.5</strong>。如果是大团队，成本会指数级上升。</p>\n<h3 id=\"实战优化技巧\">实战优化技巧</h3>\n<h4 id=\"1-精简-prompt去除冗余上下文\">1. 精简 Prompt，去除冗余上下文</h4>\n<p><strong>反面案例</strong>（浪费 Token）：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"javascript\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> systemPrompt</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\"> `</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">你是一个专业的前端开发工程师，精通 React、TypeScript、Tailwind CSS。</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">请根据用户需求生成高质量的代码。注意代码规范、性能优化、可维护性。</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">遵循以下原则：</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">1. 使用函数式组件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">2. 合理使用 hooks</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">3. 保持代码简洁</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">4. 添加必要的注释</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">5. 处理边界情况</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">6. 确保类型安全</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">7. 优化渲染性能</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">8. 使用语义化标签</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">... (省略 50 行废话)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">当前项目技术栈：React 18.2、TypeScript 5.0、Vite 4.3...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">当前文件：</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">${</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">整个文件的代码</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D3423E;--shiki-dark-font-style:italic\">，</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">包括导入</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D3423E;--shiki-dark-font-style:italic\">、</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">样式等</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">相关依赖文件：</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">${</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">所有依赖文件的完整代码</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span></code></pre>\n<p><strong>优化后</strong>（节省 70% Token）：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"javascript\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> systemPrompt</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\"> `</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">React + TS 前端工程师。生成代码需：函数组件、类型安全、简洁。</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">技术栈：React 18、TS 5、Tailwind</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">相关类型：</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">${</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">仅提取必要的类型定义</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span></code></pre>\n<p><strong>节省效果</strong>：从 3,000 tokens 降至 900 tokens，每次节省 <strong>$0.0063</strong>。</p>\n<h4 id=\"2-使用-prompt-caching重要\">2. 使用 Prompt Caching（重要！）</h4>\n<p>Anthropic 的 Prompt Caching 可以将重复的上下文缓存起来，后续调用只需付缓存读取费用（便宜 10 倍）。</p>\n<p><strong>代码示例</strong>：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"typescript\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> Anthropic </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">@anthropic-ai/sdk</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> client</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> new</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> Anthropic</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  apiKey</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> process</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic\">env</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">ANTHROPIC_API_KEY</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">}</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">async</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> function</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> generateComponent</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">requirement</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> string</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> response</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> await</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> client</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic\">messages</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">create</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    model</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">claude-3-5-sonnet-20241022</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    max_tokens</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 2048</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    system</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">        type</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">text</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">        text</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">你是 React 前端专家，生成高质量组件代码。</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      }</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">        type</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">text</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">        text</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\"> `</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">项目规范文档：</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#F78C6C;--shiki-dark-font-style:italic\">\\n</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">${</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">projectGuidelines</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">}</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"> // 长文档</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">        cache_control</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> type</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">ephemeral</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> }</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"> // 🔥 关键：标记为可缓存</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      }</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">        type</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">text</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">        text</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\"> `</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">通用工具函数库：</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#F78C6C;--shiki-dark-font-style:italic\">\\n</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">${</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">utilsCode</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">}</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">        cache_control</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> type</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">ephemeral</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> }</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"> // 🔥 缓存工具库</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      }</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    ]</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    messages</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">        role</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">user</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">        content</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> requirement</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"> // 每次变化的部分</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      }</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    ]</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">  }</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  return</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\"> response</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">content</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">0</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">text</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span></code></pre>\n<p><strong>成本对比</strong>（10 次调用，每次 5k 缓存内容）：</p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<table><thead><tr><th>方案</th><th>首次成本</th><th>后续成本（9次）</th><th>总成本</th></tr></thead><tbody><tr><td>无缓存</td><td>$0.015</td><td>$0.135</td><td>$0.150</td></tr><tr><td>有缓存</td><td>$0.01875</td><td>$0.0135</td><td>$0.03225</td></tr></tbody></table>\n<p><strong>节省 78.5%！</strong></p>\n<h4 id=\"3-批处理策略\">3. 批处理策略</h4>\n<p>不要每次生成一个组件就调用一次 API，而是批量处理：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"typescript\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// ❌ 低效：每个组件单独调用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">for</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> component</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> of</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> components) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  await</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> generateComponent</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\">component</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">requirement</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// ✅ 高效：批量生成</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> batch</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> components</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">slice</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">0</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 5</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">map</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D7DBE0;--shiki-dark-font-style:italic\">c</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> c</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic\">requirement</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> prompt</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\"> `</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">批量生成以下 5 个组件，每个组件用 --- 分隔：</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">${</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">batch</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">map</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D7DBE0;--shiki-dark-font-style:italic\">req</span><span style=\"--shiki-light:#212121;--shiki-dark:#D3423E\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D7DBE0;--shiki-dark-font-style:italic\"> i</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\"> `</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">${</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">i</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> +</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">}</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">. </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">${</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">req</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">}</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">join</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#F78C6C\">\\n</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> result</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> await</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> generateComponents</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">prompt</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span></code></pre>\n<p><strong>节省效果</strong>：减少 API 调用次数，节省 <strong>40-60%</strong> 的输入成本。</p>\n<h4 id=\"4-模型选择按需使用\">4. 模型选择：按需使用</h4>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<table><thead><tr><th>模型</th><th>输入价格</th><th>输出价格</th><th>适用场景</th></tr></thead><tbody><tr><td>Opus</td><td>$15/1M</td><td>$75/1M</td><td>复杂架构设计、重要代码审查</td></tr><tr><td>Sonnet</td><td>$3/1M</td><td>$15/1M</td><td>日常组件生成、代码重构</td></tr><tr><td>Haiku</td><td>$0.25/1M</td><td>$1.25/1M</td><td>简单格式化、代码补全</td></tr></tbody></table>\n<p><strong>策略</strong>：</p>\n<ul>\n<li>用 Haiku 做代码格式化、导入语句补全（成本降低 <strong>90%</strong>）</li>\n<li>用 Sonnet 做常规开发（性价比最优）</li>\n<li>用 Opus 做关键决策（准确性优先）</li>\n</ul>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"typescript\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> MODEL_MAP</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  format</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">claude-3-haiku-20240307</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  component</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">claude-3-5-sonnet-20241022</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  architecture</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">claude-3-opus-20240229</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">}</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> selectModel</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">taskType</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> keyof</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> typeof</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\"> MODEL_MAP</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  return</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\"> MODEL_MAP</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[taskType];</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span></code></pre>\n<h3 id=\"优化前后对比\">优化前后对比</h3>\n<p><strong>优化前</strong>（某团队真实数据）：</p>\n<ul>\n<li>月调用次数：15,000</li>\n<li>平均每次成本：$0.042</li>\n<li>月总成本：<strong>$630</strong></li>\n</ul>\n<p><strong>优化后</strong>：</p>\n<ul>\n<li>启用 Prompt Caching：节省 75%</li>\n<li>模型分级使用：节省 40%</li>\n<li>批处理：节省 50%</li>\n<li>月总成本：<strong>$78.75</strong></li>\n</ul>\n<p><strong>节省 87.5%，年节省 $6,615！</strong></p>\n<h2 id=\"如何处理模型幻觉\">如何处理模型幻觉</h2>\n<h3 id=\"什么是幻觉\">什么是幻觉？</h3>\n<p><strong>幻觉（Hallucination）</strong>：AI 模型自信地输出错误或虚构的内容。</p>\n<h3 id=\"前端开发中的常见幻觉案例\">前端开发中的常见幻觉案例</h3>\n<h4 id=\"案例-1虚构-api\">案例 1：虚构 API</h4>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"typescript\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 🚨 AI 生成的代码</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { useDebounce } </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">react-hooks-library</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 这个库不存在！</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> SearchInput</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">()</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> debouncedValue</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> useDebounce</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">value</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 500</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  // ...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span></code></pre>\n<h4 id=\"案例-2错误的类型定义\">案例 2：错误的类型定义</h4>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"typescript\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 🚨 AI 认为这个属性存在</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">interface</span><span style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> User</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  id</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> string</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  emailVerifiedAt</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:</span><span style=\"--shiki-light:#6F42C1;--shiki-dark:#FFCB8B\"> Date</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 实际项目中没有这个字段</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span></code></pre>\n<h4 id=\"案例-3过时的-api-用法\">案例 3：过时的 API 用法</h4>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"typescript\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 🚨 React 18+ 已废弃 ReactDOM.render</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> ReactDOM </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">react-dom</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\">ReactDOM</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">render</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(&#x3C;</span><span style=\"--shiki-light:#6F42C1;--shiki-dark:#FFCB8B\">App</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> /></span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\"> document</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">getElementById</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">root</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">));</span></span></code></pre>\n<h3 id=\"应对策略\">应对策略</h3>\n<h4 id=\"1-增加自动验证步骤\">1. 增加自动验证步骤</h4>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"typescript\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// validation-agent.ts</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { exec } </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">child_process</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { promisify } </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">util</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> execAsync</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> promisify</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">exec</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">async</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> function</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> validateGeneratedCode</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">code</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> string</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> filePath</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> string</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  // 写入临时文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  await</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\"> fs</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">writeFile</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(filePath</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> code);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> checks</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [];</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  // 1. TypeScript 类型检查</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  try</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    await</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> execAsync</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">tsc --noEmit </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">${</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">filePath</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">}</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\">    checks</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">push</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">({ name</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">TypeScript</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> status</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">pass</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> });</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  } </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">catch</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (error) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\">    checks</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">push</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">({ name</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">TypeScript</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> status</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">fail</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> error</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\"> error</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">stderr</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> });</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  // 2. ESLint 检查</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  try</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    await</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> execAsync</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">eslint </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">${</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">filePath</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">}</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\">    checks</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">push</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">({ name</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">ESLint</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> status</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">pass</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> });</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  } </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">catch</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (error) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\">    checks</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">push</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">({ name</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">ESLint</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> status</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">fail</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> error</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\"> error</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">stdout</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> });</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  // 3. 导入检查（是否有不存在的包）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> imports</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> code</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">match</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#5CA7E4;--shiki-dark-font-style:italic\">from </span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">[</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">'\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">]</span><span style=\"--shiki-light:#22863A;--shiki-dark:#5CA7E4\">(</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">+?</span><span style=\"--shiki-light:#22863A;--shiki-dark:#5CA7E4\">)</span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">[</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">'\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">]</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#5CA7E4\">g</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ||</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [];</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  for</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> imp</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> of</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> imports) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> pkg</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> imp</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">match</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#5CA7E4;--shiki-dark-font-style:italic\">from </span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">[</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">'\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">]</span><span style=\"--shiki-light:#22863A;--shiki-dark:#5CA7E4\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">[</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">@\\w\\-/</span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">]</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">+</span><span style=\"--shiki-light:#22863A;--shiki-dark:#5CA7E4\">)</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">?.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">];</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (pkg </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">&#x26;&#x26;</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> !</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\">pkg</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">startsWith</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">.</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">      try</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\">        require</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">resolve</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(pkg);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\">        checks</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">push</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">({ name</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\"> `</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">Import: </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">${</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">pkg</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">}</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> status</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">pass</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> });</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      } </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">catch</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\">        checks</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">push</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">({ name</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\"> `</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">Import: </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">${</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">pkg</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">}</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> status</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">fail</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> error</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">Package not found</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> });</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> checks;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 使用示例</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> generatedCode</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> await</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> aiAgent</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">generateComponent</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">requirement</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> validation</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> await</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> validateGeneratedCode</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">generatedCode</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">./temp.tsx</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\">validation</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">some</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">c</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\"> c</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">status</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ===</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">fail</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  // 将错误反馈给 AI，让它修复</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> fixedCode</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> await</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> aiAgent</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">fixCode</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">generatedCode</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> validation</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span></code></pre>\n<h4 id=\"2-few-shot-learning提供正确示例\">2. Few-shot Learning（提供正确示例）</h4>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"typescript\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> fewShotPrompt</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\"> `</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">以下是正确的代码示例：</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">示例 1：使用项目中实际存在的 hooks</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#F78C6C;--shiki-dark-font-style:italic\">\\`\\`\\`</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">typescript</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">import { useDebounce } from '@/hooks/useDebounce'; // ✅ 项目内的 hook</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#F78C6C;--shiki-dark-font-style:italic\">\\`\\`\\`</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">示例 2：正确的 User 类型定义</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#F78C6C;--shiki-dark-font-style:italic\">\\`\\`\\`</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">typescript</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">interface User {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">  id: string;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">  email: string;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">  name: string;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">  createdAt: string; // ✅ ISO 8601 字符串，不是 Date</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#F78C6C;--shiki-dark-font-style:italic\">\\`\\`\\`</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">现在请生成：</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">${</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">requirement</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span></code></pre>\n<h4 id=\"3-结果校验和人工审核\">3. 结果校验和人工审核</h4>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"typescript\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// code-review-workflow.ts</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">async</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> function</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> codeGenerationWorkflow</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">requirement</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> string</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  // 1. 生成代码</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> code</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> await</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> aiAgent</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">generateComponent</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">requirement</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  // 2. 自动验证</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> validation</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> await</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> validateGeneratedCode</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">code</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  // 3. 风险评分</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> riskScore</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> calculateRisk</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">validation</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (riskScore </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">&#x3C;</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 30</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 低风险：自动合并</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    await</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> commitCode</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(code);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  } </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">else</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (riskScore </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">&#x3C;</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 70</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 中风险：创建 PR，等待审核</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    await</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> createPullRequest</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(code</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> validation);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  } </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">else</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 高风险：拒绝，要求人工介入</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    await</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> notifyDeveloper</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">({</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      message</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">生成的代码风险过高，请人工检查</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      code</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      issues</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\"> validation</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">filter</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">v</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\"> v</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">status</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ===</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">fail</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    });</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span></code></pre>\n<h2 id=\"团队协作最佳实践\">团队协作最佳实践</h2>\n<h3 id=\"如何在团队中推广-ai-agent\">如何在团队中推广 AI Agent</h3>\n<p><strong>分阶段推进</strong>：</p>\n<ol>\n<li>\n<p><strong>试点阶段</strong>（1-2 周）</p>\n<ul>\n<li>挑选 2-3 个技术能力强的开发者试用</li>\n<li>收集反馈，优化 Prompt 和工作流</li>\n<li>记录节省的时间和成本数据</li>\n</ul>\n</li>\n<li>\n<p><strong>小范围推广</strong>（1 个月）</p>\n<ul>\n<li>团队内培训（1 小时工作坊）</li>\n<li>提供标准化的 Prompt 模板</li>\n<li>建立反馈渠道</li>\n</ul>\n</li>\n<li>\n<p><strong>全面铺开</strong>（2-3 个月）</p>\n<ul>\n<li>纳入开发规范</li>\n<li>定期分享最佳实践</li>\n<li>持续优化</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"prompt-版本管理\">Prompt 版本管理</h3>\n<p>将 Prompt 当作代码来管理：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 项目结构</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">prompts/</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">  ├──</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> component-generation.md</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">  ├──</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> code-review.md</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">  ├──</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> test-generation.md</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">  └──</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> version.json</span></span></code></pre>\n<p><strong>示例：<code>prompts/component-generation.md</code></strong></p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"markdown\"><code><span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#82B1FF;--shiki-dark-font-weight:inherit\"># Component Generation Prompt</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">Version: 2.1.0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">Last Updated: 2026-02-10</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">Author: 陈广亮</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#82B1FF;--shiki-dark-font-weight:inherit\">## System Prompt</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">你是专业的 React + TypeScript 前端工程师。</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#82B1FF;--shiki-dark-font-weight:inherit\">## Rules</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">1.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> 必须使用函数式组件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">2.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> Props 必须有 TypeScript 类型定义</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">3.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> 使用 Tailwind CSS（不使用内联样式）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">4.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> 导入路径使用 </span><span style=\"--shiki-light:#2B5581;--shiki-dark:#C5E478\">`@/`</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> 别名</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#82B1FF;--shiki-dark-font-weight:inherit\">## Example</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#F78C6C\">\\`\\`\\`</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">typescript</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">// ✅ 正确示例</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">import { FC } from 'react';</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">interface ButtonProps {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  label: string;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  onClick: () => void;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">export const Button: FC&#x3C;ButtonProps> = ({ label, onClick }) => {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  return (</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    &#x3C;button</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      onClick={onClick}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      className=\"px-4 py-2 bg-blue-500 text-white rounded\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    ></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      {label}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    &#x3C;/button></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  );</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">};</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#F78C6C\">\\`\\`\\`</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#82B1FF;--shiki-dark-font-weight:inherit\">## User Input</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">${requirement}</span></span></code></pre>\n<p><strong>Git 管理</strong>：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">git</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> add</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> prompts/</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">git</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> commit</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\"> -m</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">feat(prompt): 优化组件生成 prompt，增加边界情况处理</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">git</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> push</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> origin</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> main</span></span></code></pre>\n<h3 id=\"建立团队-prompt-库\">建立团队 Prompt 库</h3>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"typescript\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// prompt-manager.ts</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> fs </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">fs/promises</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> path </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">path</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">class</span><span style=\"--shiki-light:#6F42C1;--shiki-dark:#FFCB8B\"> PromptManager</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  private</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> promptsDir </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">./prompts</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  async</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> getPrompt</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">name</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> string</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> version</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">?:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> string</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:</span><span style=\"--shiki-light:#6F42C1;--shiki-dark:#FFCB8B\"> Promise</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\">string</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#82AAFF\">    const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> filePath</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> path</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">join</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">this</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic\">promptsDir</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\"> `</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">${</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">name</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">}</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">.md</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#82AAFF\">    const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> content</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> await</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> fs</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">readFile</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">filePath</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">utf-8</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 如果指定版本，从 Git 历史获取</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (version) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#82AAFF\">      const</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> exec</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> }</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> require</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">child_process</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#82AAFF\">      const</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> stdout</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> }</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> await</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> exec</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">        `</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">git show </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">${</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">version</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">}</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">:</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">${</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">filePath</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">}</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      );</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">      return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> stdout;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> content;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  async</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> listPrompts</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">()</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:</span><span style=\"--shiki-light:#6F42C1;--shiki-dark:#FFCB8B\"> Promise</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\">string</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[]> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#82AAFF\">    const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> files</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> await</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> fs</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">readdir</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">this</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic\">promptsDir</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\"> files</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">filter</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">f</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\"> f</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">endsWith</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">.md</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">))</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">map</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">f</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\"> f</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">replace</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">.md</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> ''</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">));</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 使用示例</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> pm</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> new</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> PromptManager</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> prompt</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> await</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> pm</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">getPrompt</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">component-generation</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span></code></pre>\n<h3 id=\"权限和审批流程\">权限和审批流程</h3>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"typescript\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// rbac-config.ts</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> permissions</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  junior</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    allowedModels</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">claude-3-haiku-20240307</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    maxTokensPerDay</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 100000</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    requiresApproval</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FF5874;--shiki-dark-font-style:italic\"> true</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">  }</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  senior</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    allowedModels</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">claude-3-5-sonnet-20241022</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">claude-3-haiku-20240307</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    maxTokensPerDay</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 500000</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    requiresApproval</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FF5874;--shiki-dark-font-style:italic\"> false</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">  }</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  lead</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    allowedModels</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">claude-3-opus-20240229</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">claude-3-5-sonnet-20241022</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    maxTokensPerDay</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1000000</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    requiresApproval</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FF5874;--shiki-dark-font-style:italic\"> false</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">  }</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">}</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> checkPermission</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">userId</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> string</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> model</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> string</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> user</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> getUser</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">userId</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> perm</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> permissions</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">user</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic\">role</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">];</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">!</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\">perm</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic\">allowedModels</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">includes</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(model)) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    throw</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> new</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> Error</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">你没有权限使用 </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">${</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">model</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">}</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> usage</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> getTodayUsage</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">userId</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (usage </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">></span><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\"> perm</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">maxTokensPerDay</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    throw</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> new</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> Error</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">今日 Token 配额已用完</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span></code></pre>\n<h2 id=\"隐私和安全考虑\">隐私和安全考虑</h2>\n<h3 id=\"api-key-管理\">API Key 管理</h3>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"typescript\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// ❌ 危险：硬编码</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> apiKey</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">sk-ant-1234567890</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// ✅ 安全：环境变量</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> apiKey</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> process</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic\">env</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">ANTHROPIC_API_KEY</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// ✅✅ 更安全：密钥轮转</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { SecretsManager } </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">@aws-sdk/client-secrets-manager</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">async</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> function</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> getApiKey</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">()</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> client</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> new</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> SecretsManager</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">{</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> region</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">us-east-1</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> }</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> response</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> await</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> client</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">getSecretValue</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">{</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> SecretId</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">anthropic-api-key</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> }</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  return</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\"> response</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">SecretString</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span></code></pre>\n<h3 id=\"敏感数据脱敏\">敏感数据脱敏</h3>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"typescript\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// sanitize.ts</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> sanitizeCode</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">code</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> string</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> string</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> code</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    .</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">replace</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#22863A;--shiki-dark:#5CA7E4\">sk-</span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">[a-zA-Z0-9]</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">{48}</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#5CA7E4\">g</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">sk-***REDACTED***</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// API Key</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    .</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">replace</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">\\b</span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">[\\w</span><span style=\"--shiki-light:#22863A;--shiki-dark:#F78C6C\">\\.</span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">-]</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">+</span><span style=\"--shiki-light:#22863A;--shiki-dark:#5CA7E4\">@</span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">[\\w</span><span style=\"--shiki-light:#22863A;--shiki-dark:#F78C6C\">\\.</span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">-]</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">+</span><span style=\"--shiki-light:#22863A;--shiki-dark:#F78C6C\">\\.</span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">\\w</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">+</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">\\b</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#5CA7E4\">g</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">***@***.com</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// Email</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    .</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">replace</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">\\d</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">{3}</span><span style=\"--shiki-light:#22863A;--shiki-dark:#5CA7E4\">-</span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">\\d</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">{4}</span><span style=\"--shiki-light:#22863A;--shiki-dark:#5CA7E4\">-</span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">\\d</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">{4}</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#5CA7E4\">g</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">***-****-****</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 手机号</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 发送给 AI 前先脱敏</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> sanitizedContext</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> sanitizeCode</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">fileContent</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> result</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> await</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> aiAgent</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">generate</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">requirement</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> sanitizedContext</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span></code></pre>\n<h3 id=\"本地部署-vs-云服务对比\">本地部署 vs 云服务对比</h3>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<table><thead><tr><th>维度</th><th>本地部署（Ollama + CodeLlama）</th><th>云服务（Claude/GPT-4）</th></tr></thead><tbody><tr><td>成本</td><td>硬件投入高，使用免费</td><td>按量付费</td></tr><tr><td>性能</td><td>依赖硬件（需高端 GPU）</td><td>云端算力，速度快</td></tr><tr><td>隐私</td><td>数据不出本地</td><td>数据上传云端</td></tr><tr><td>维护</td><td>需要自己维护模型</td><td>无需维护</td></tr><tr><td>适用场景</td><td>对隐私要求极高的场景</td><td>大多数商业场景</td></tr></tbody></table>\n<p><strong>建议</strong>：</p>\n<ul>\n<li>金融、医疗等强合规行业：本地部署</li>\n<li>一般企业：云服务 + 数据脱敏</li>\n<li>开源项目：云服务</li>\n</ul>\n<h3 id=\"合规性考虑\">合规性考虑</h3>\n<ol>\n<li><strong>GDPR</strong>：确保用户代码不包含个人数据，或获得明确授权</li>\n<li><strong>企业政策</strong>：检查公司是否允许将代码发送到外部 API</li>\n<li><strong>许可证</strong>：AI 生成的代码许可证归属问题（建议添加审核步骤）</li>\n</ol>\n<h2 id=\"总结与展望\">总结与展望</h2>\n<p>在本文中，我们解决了 AI Agent 落地的两大核心问题：</p>\n<p><strong>成本优化</strong>：</p>\n<ul>\n<li>通过 Prompt Caching、模型分级、批处理等手段，可节省 <strong>80%+ 成本</strong></li>\n<li>真实案例：月成本从 $630 降至 $78.75</li>\n</ul>\n<p><strong>团队协作</strong>：</p>\n<ul>\n<li>Prompt 版本管理、权限控制、审批流程缺一不可</li>\n<li>将 Prompt 当作代码管理，像管理 API 一样管理 AI</li>\n</ul>\n<p><strong>处理幻觉</strong>：</p>\n<ul>\n<li>自动验证 + Few-shot Learning + 人工审核三管齐下</li>\n<li>降低生产事故风险</li>\n</ul>\n<p>下一篇文章，我们将探讨 <strong>AI Agent 的未来展望与开源工具推荐</strong>，包括：</p>\n<ul>\n<li>多模态 Agent（从设计稿直接生成代码）</li>\n<li>Agent 编排框架（LangChain、LangGraph、AutoGen）</li>\n<li>如何构建自己的 Agent 工作流</li>\n<li>2026 年最值得关注的开源项目</li>\n</ul>\n<p>敬请期待！</p>\n<hr>\n<p><strong>关于作者</strong>：陈广亮，全栈工程师，AI 工程化实践者，专注于将 AI 技术落地到实际开发工作流中。本文所有代码和案例均来自真实项目经验。</p>\n<p>如果这篇文章对你有帮助，欢迎分享给你的团队！有任何问题，欢迎在评论区讨论。</p>",{headings:1866,localImagePaths:1945,remoteImagePaths:1946,frontmatter:1947,imagePaths:1950},[1867,1869,1872,1874,1876,1880,1883,1886,1889,1891,1893,1896,1898,1901,1904,1907,1909,1912,1915,1918,1920,1923,1926,1929,1931,1933,1936,1938,1941,1943],{depth:31,slug:1868,text:1868},"前情回顾",{depth:31,slug:1870,text:1871},"token-成本控制策略","Token 成本控制策略",{depth:185,slug:1873,text:1873},"成本构成分析",{depth:185,slug:1875,text:1875},"实战优化技巧",{depth:1877,slug:1878,text:1879},4,"1-精简-prompt去除冗余上下文","1. 精简 Prompt，去除冗余上下文",{depth:1877,slug:1881,text:1882},"2-使用-prompt-caching重要","2. 使用 Prompt Caching（重要！）",{depth:1877,slug:1884,text:1885},"3-批处理策略","3. 批处理策略",{depth:1877,slug:1887,text:1888},"4-模型选择按需使用","4. 模型选择：按需使用",{depth:185,slug:1890,text:1890},"优化前后对比",{depth:31,slug:1892,text:1892},"如何处理模型幻觉",{depth:185,slug:1894,text:1895},"什么是幻觉","什么是幻觉？",{depth:185,slug:1897,text:1897},"前端开发中的常见幻觉案例",{depth:1877,slug:1899,text:1900},"案例-1虚构-api","案例 1：虚构 API",{depth:1877,slug:1902,text:1903},"案例-2错误的类型定义","案例 2：错误的类型定义",{depth:1877,slug:1905,text:1906},"案例-3过时的-api-用法","案例 3：过时的 API 用法",{depth:185,slug:1908,text:1908},"应对策略",{depth:1877,slug:1910,text:1911},"1-增加自动验证步骤","1. 增加自动验证步骤",{depth:1877,slug:1913,text:1914},"2-few-shot-learning提供正确示例","2. Few-shot Learning（提供正确示例）",{depth:1877,slug:1916,text:1917},"3-结果校验和人工审核","3. 结果校验和人工审核",{depth:31,slug:1919,text:1919},"团队协作最佳实践",{depth:185,slug:1921,text:1922},"如何在团队中推广-ai-agent","如何在团队中推广 AI Agent",{depth:185,slug:1924,text:1925},"prompt-版本管理","Prompt 版本管理",{depth:185,slug:1927,text:1928},"建立团队-prompt-库","建立团队 Prompt 库",{depth:185,slug:1930,text:1930},"权限和审批流程",{depth:31,slug:1932,text:1932},"隐私和安全考虑",{depth:185,slug:1934,text:1935},"api-key-管理","API Key 管理",{depth:185,slug:1937,text:1937},"敏感数据脱敏",{depth:185,slug:1939,text:1940},"本地部署-vs-云服务对比","本地部署 vs 云服务对比",{depth:185,slug:1942,text:1942},"合规性考虑",{depth:31,slug:1944,text:1944},"总结与展望",[],[],{author:14,pubDatetime:1948,title:1855,slug:1851,featured:165,draft:17,tags:1949,description:1859},["Date","2026-02-15T10:00:00.000Z"],[167,168,1857,1858],[],"ai-agent-frontend-workflow-part1",{id:1951,data:1953,body:1958,filePath:1959,digest:1960,rendered:1961},{author:14,pubDatetime:1954,title:1955,featured:165,draft:17,tags:1956,description:1957},["Date","2026-02-13T03:00:00.000Z"],"AI Agent 前端工作流（一）：理解 Agent 与组件自动生成实战",[167,168,1483,19],"AI Agent 不是简单的聊天机器人，而是能自主调用工具、管理上下文的智能助手。本文深入剖析 Agent 工作原理，并通过 React 组件自动生成实战，展示如何用 AI 重构前端开发流程。","前端开发正在经历一场范式转变。我不是在说又一个新框架，而是工作方式的根本改变——从「写代码」到「指挥 AI 写代码」。但市面上大多数 AI 编程助手本质上还是「智能补全」，你写一行，它猜下一行。真正改变游戏规则的是 **AI Agent**。\n\n## AI Agent 不是聊天机器人\n\n很多人第一次接触 AI 编程工具时，会觉得它像个「很懂代码的 ChatGPT」。这种理解差了十万八千里。\n\n传统 AI 编程助手（如早期的 GitHub Copilot）是**被动响应型**的：\n- 你写代码，它补全\n- 你问问题，它回答\n- 它的生命周期只存在于单次对话中\n\n而 AI Agent 是**主动执行型**的：\n- 它能调用工具（读文件、运行命令、调用 API）\n- 它能规划多步骤任务（「生成组件」→「写测试」→「运行测试」→「修 bug」）\n- 它能在上下文中持续工作，记住之前做了什么\n\n举个具体例子。如果你对 Copilot 说「生成一个用户卡片组件」，它会给你一段代码，然后就没了。你要自己复制、粘贴、保存文件、检查类型错误、写样式。\n\n而对一个前端 AI Agent 说同样的话，它会：\n1. 分析项目结构，找到组件存放位置\n2. 检查现有的设计系统和样式规范\n3. 生成符合项目风格的 TypeScript 代码\n4. 自动创建文件并保存\n5. 运行类型检查，如果有错误就修复\n6. 甚至可以生成对应的 Storybook 文档\n\n这就是质的区别。**Agent 是能干活的，Assistant 只是能聊天的。**\n\n## 核心差异：工具调用能力\n\nAI Agent 的灵魂是 **Function Calling**（也叫 Tool Use）。这是 2024 年开始大规模商用的技术，Anthropic、OpenAI 都支持。\n\n简单说，你可以给 AI 定义一组「工具」，比如：\n```typescript\nconst tools = [\n  {\n    name: \"read_file\",\n    description: \"读取项目文件内容\",\n    input_schema: {\n      type: \"object\",\n      properties: {\n        path: { type: \"string\", description: \"文件路径\" }\n      }\n    }\n  },\n  {\n    name: \"write_file\",\n    description: \"创建或修改文件\",\n    input_schema: {\n      type: \"object\",\n      properties: {\n        path: { type: \"string\" },\n        content: { type: \"string\" }\n      }\n    }\n  }\n]\n```\n\n然后把这些工具和用户请求一起发给 AI。AI 会决定：\n1. 我需要用哪个工具？\n2. 参数是什么？\n3. 工具返回结果后，我下一步该做什么？\n\n这就像给 AI 配了一个工具箱。以前它只能「说」，现在它能「做」。\n\n### 为什么前端开发特别适合 Agent？\n\n前端开发有几个痛点，天然适合用 Agent 解决：\n\n**1. 重复劳动太多**  \n创建一个新页面：建文件夹、写组件、配路由、写样式、加类型、写测试……每一步都很机械，但又不能出错。\n\n**2. 上下文切换频繁**  \n你要同时关注业务逻辑、UI 交互、性能优化、类型安全、可访问性……人脑很难同时 hold 住这么多维度。\n\n**3. 工具链复杂**  \nTypeScript、ESLint、Prettier、Tailwind、Vite……每个工具都有自己的配置和规则。新手光配环境就要一周。\n\n**4. 设计稿到代码的鸿沟**  \n设计师给你一个 Figma，你要把视觉语言翻译成代码。这个过程很耗时，而且容易出错。\n\nAI Agent 可以自动化这些流程。它不是替代你写代码，而是把你从机械劳动中解放出来，让你专注于「这个组件应该怎么设计」，而不是「这个 className 拼错了没有」。\n\n## 工作原理深入：从 Function Calling 到自主循环\n\n让我们拆解一个完整的 AI Agent 工作流程。以「生成 React 组件」为例：\n\n### 1. Function Calling 机制\n\n用户请求：「生成一个可排序的表格组件」\n\nAI 收到请求后，会进行**思维链推理**（Chain of Thought）：\n```\n我需要：\n1. 先看看项目里有没有类似的组件（工具：search_codebase）\n2. 检查项目用的是什么 UI 库（工具：read_file package.json）\n3. 生成代码\n4. 保存文件（工具：write_file）\n5. 运行类型检查（工具：run_command \"tsc --noEmit\"）\n```\n\n然后它会返回一个 **tool_use** 请求：\n```json\n{\n  \"type\": \"tool_use\",\n  \"id\": \"toolu_01A\",\n  \"name\": \"read_file\",\n  \"input\": {\n    \"path\": \"package.json\"\n  }\n}\n```\n\n你的代码执行这个工具，把结果返回给 AI。AI 继续下一步。这个循环会一直持续，直到任务完成。\n\n### 2. 上下文管理：不让 Token 爆炸\n\nAI 的「记忆」是有限的。Claude 3.5 Sonnet 的上下文窗口是 200K tokens，看起来很大，但一个中型项目的所有代码加起来可能就超过这个数字。\n\n怎么办？**选择性加载上下文**。\n\n聪明的 Agent 不会一次性把整个项目塞给 AI，而是：\n- **按需加载**：只有真正需要时才读文件\n- **摘要提取**：对于大文件，只提取关键信息（类型定义、导出的接口）\n- **优先级排序**：最近修改的文件、相关性高的代码优先加载\n\n举例：生成一个新组件时，Agent 会：\n```typescript\n// 高优先级：设计系统相关\n- components/design-system/Button.tsx  // 看看按钮怎么写的\n- styles/theme.ts  // 主题配置\n- tsconfig.json  // TypeScript 规则\n\n// 中优先级：相似组件\n- components/Table.tsx  // 如果已经有表格组件\n\n// 低优先级：其他\n- package.json  // 只看依赖列表，不看 devDependencies\n```\n\n这就像人类开发时的思维方式：你不会为了写一个按钮组件就把整个项目所有代码重读一遍，你只会参考相关的部分。\n\n### 3. 工具链设计：CLI 还是 IDE 插件？\n\n当前主流的 AI 编程工具分两派：\n\n**CLI 派（如 Cursor、Aider）**\n- 优点：灵活，能调用任何命令行工具\n- 缺点：脱离 IDE，需要切换上下文\n\n**IDE 插件派（如 GitHub Copilot、Continue）**\n- 优点：无缝集成，不用离开编辑器\n- 缺点：权限受限，很难调用外部工具\n\n我个人倾向于 **混合方案**：\n- 日常写代码用 IDE 插件（快速补全、重构）\n- 复杂任务用 CLI Agent（生成整个模块、批量重构）\n\n这和你平时开发时同时开着 VSCode 和终端是一个道理。\n\n## 实战：组件自动生成 Agent\n\n说了这么多理论，来点实战的。我们用 Claude API 实现一个简单但完整的「React 组件生成器」。\n\n### 场景设定\n\n需求：「生成一个用户评分卡片组件，支持 1-5 星评分，显示用户头像、名字、评论内容和时间」\n\n### 完整代码实现\n\n```typescript\n// component-generator.ts\nimport Anthropic from '@anthropic-ai/sdk';\nimport fs from 'fs/promises';\nimport path from 'path';\n\ninterface GenerateComponentOptions {\n  description: string;  // 组件需求描述\n  outputDir: string;    // 输出目录\n  projectContext?: {    // 项目上下文（可选）\n    usesTailwind: boolean;\n    usesTypeScript: boolean;\n  };\n}\n\nclass ComponentGenerator {\n  private client: Anthropic;\n  \n  constructor(apiKey: string) {\n    this.client = new Anthropic({ apiKey });\n  }\n\n  /**\n   * 定义 Agent 可用的工具\n   */\n  private getTools() {\n    return [\n      {\n        name: 'write_component_file',\n        description: '创建 React 组件文件',\n        input_schema: {\n          type: 'object',\n          properties: {\n            filename: {\n              type: 'string',\n              description: '文件名（不含路径），如 UserRatingCard.tsx'\n            },\n            content: {\n              type: 'string',\n              description: '完整的组件代码'\n            }\n          },\n          required: ['filename', 'content']\n        }\n      },\n      {\n        name: 'validate_typescript',\n        description: '验证 TypeScript 代码是否有类型错误',\n        input_schema: {\n          type: 'object',\n          properties: {\n            code: { type: 'string', description: 'TypeScript 代码' }\n          },\n          required: ['code']\n        }\n      }\n    ];\n  }\n\n  /**\n   * 执行工具调用\n   */\n  private async executeTool(\n    toolName: string,\n    toolInput: Record<string, unknown>,\n    outputDir: string\n  ): Promise<string> {\n    switch (toolName) {\n      case 'write_component_file': {\n        const { filename, content } = toolInput as { \n          filename: string; \n          content: string; \n        };\n        const filePath = path.join(outputDir, filename);\n        \n        try {\n          await fs.mkdir(outputDir, { recursive: true });\n          await fs.writeFile(filePath, content, 'utf-8');\n          return `文件已创建: ${filePath}`;\n        } catch (error) {\n          return `创建文件失败: ${(error as Error).message}`;\n        }\n      }\n\n      case 'validate_typescript': {\n        const { code } = toolInput as { code: string };\n        \n        // 简单的静态检查（实际项目中应该调用 tsc）\n        const hasExport = /export\\s+(default\\s+)?(function|const|class)/.test(code);\n        const hasProps = /interface\\s+\\w+Props/.test(code) || /type\\s+\\w+Props/.test(code);\n        \n        if (!hasExport) {\n          return '错误：组件没有 export';\n        }\n        if (!hasProps && code.includes('props')) {\n          return '警告：使用了 props 但未定义类型';\n        }\n        \n        return '类型检查通过';\n      }\n\n      default:\n        return `未知工具: ${toolName}`;\n    }\n  }\n\n  /**\n   * 生成组件的核心循环\n   */\n  async generate(options: GenerateComponentOptions): Promise<string> {\n    const { description, outputDir, projectContext } = options;\n    \n    // 构建初始 prompt\n    const systemPrompt = `你是一个专业的 React 组件生成助手。\n    \n项目配置：\n- TypeScript: ${projectContext?.usesTypeScript ? '是' : '否'}\n- Tailwind CSS: ${projectContext?.usesTailwind ? '是' : '否'}\n\n要求：\n1. 生成的组件必须是 TypeScript（.tsx）\n2. Props 必须有完整的类型定义\n3. 使用函数组件 + Hooks\n4. ${projectContext?.usesTailwind ? '使用 Tailwind 类名' : '使用 CSS-in-JS'}\n5. 包含详细的注释\n6. 生成完成后调用 write_component_file 保存文件\n\n注意：\n- 组件名用 PascalCase\n- 文件名和组件名一致\n- 代码必须可直接运行，不要有占位符`;\n\n    const messages: Anthropic.MessageParam[] = [\n      {\n        role: 'user',\n        content: `请生成组件：${description}`\n      }\n    ];\n\n    let continueLoop = true;\n    let iterations = 0;\n    const maxIterations = 10;  // 防止无限循环\n    let finalOutput = '';\n\n    // Agent 循环\n    while (continueLoop && iterations < maxIterations) {\n      iterations++;\n      \n      const response = await this.client.messages.create({\n        model: 'claude-3-5-sonnet-20241022',\n        max_tokens: 4096,\n        system: systemPrompt,\n        messages,\n        tools: this.getTools(),\n      });\n\n      // 检查 stop_reason\n      if (response.stop_reason === 'end_turn') {\n        continueLoop = false;\n      }\n\n      // 处理响应内容\n      const assistantMessage: Anthropic.MessageParam = {\n        role: 'assistant',\n        content: response.content\n      };\n      messages.push(assistantMessage);\n\n      // 执行工具调用\n      const toolResults: Anthropic.ToolResultBlockParam[] = [];\n      \n      for (const block of response.content) {\n        if (block.type === 'text') {\n          finalOutput += block.text + '\\n';\n        }\n        \n        if (block.type === 'tool_use') {\n          console.log(`🔧 执行工具: ${block.name}`);\n          console.log(`📥 参数:`, JSON.stringify(block.input, null, 2));\n          \n          const result = await this.executeTool(\n            block.name,\n            block.input,\n            outputDir\n          );\n          \n          console.log(`📤 结果: ${result}\\n`);\n          \n          toolResults.push({\n            type: 'tool_result',\n            tool_use_id: block.id,\n            content: result\n          });\n        }\n      }\n\n      // 如果有工具调用，继续循环\n      if (toolResults.length > 0) {\n        messages.push({\n          role: 'user',\n          content: toolResults\n        });\n        continueLoop = true;\n      }\n    }\n\n    return finalOutput;\n  }\n\n  /**\n   * 估算 token 消耗和成本\n   */\n  estimateCost(inputTokens: number, outputTokens: number): {\n    tokens: { input: number; output: number };\n    cost: number;\n  } {\n    // Claude 3.5 Sonnet 定价 (2026-02-13)\n    // Input: $3 / 1M tokens\n    // Output: $15 / 1M tokens\n    const inputCost = (inputTokens / 1_000_000) * 3;\n    const outputCost = (outputTokens / 1_000_000) * 15;\n    \n    return {\n      tokens: { input: inputTokens, output: outputTokens },\n      cost: inputCost + outputCost\n    };\n  }\n}\n\n// 使用示例\nasync function main() {\n  const apiKey = process.env.ANTHROPIC_API_KEY;\n  if (!apiKey) {\n    throw new Error('请设置 ANTHROPIC_API_KEY 环境变量');\n  }\n\n  const generator = new ComponentGenerator(apiKey);\n  \n  const result = await generator.generate({\n    description: '用户评分卡片组件，支持 1-5 星评分，显示用户头像、名字、评论内容和时间',\n    outputDir: './generated-components',\n    projectContext: {\n      usesTailwind: true,\n      usesTypeScript: true\n    }\n  });\n\n  console.log('生成完成！');\n  console.log(result);\n}\n\n// 错误处理\nmain().catch(error => {\n  console.error('生成失败:', error);\n  process.exit(1);\n});\n```\n\n### 生成的组件示例\n\n上面的代码运行后，会自动生成类似这样的组件：\n\n```tsx\n// UserRatingCard.tsx\nimport React from 'react';\n\n/**\n * 用户评分卡片组件的 Props 类型定义\n */\ninterface UserRatingCardProps {\n  /** 用户头像 URL */\n  avatarUrl: string;\n  /** 用户名 */\n  userName: string;\n  /** 评分（1-5） */\n  rating: 1 | 2 | 3 | 4 | 5;\n  /** 评论内容 */\n  comment: string;\n  /** 评论时间（ISO 8601 格式） */\n  timestamp: string;\n  /** 自定义类名 */\n  className?: string;\n}\n\n/**\n * 用户评分卡片组件\n * \n * @example\n * <UserRatingCard\n *   avatarUrl=\"https://i.pravatar.cc/150?img=1\"\n *   userName=\"张三\"\n *   rating={5}\n *   comment=\"非常好用！\"\n *   timestamp=\"2026-02-13T10:00:00Z\"\n * />\n */\nexport default function UserRatingCard({\n  avatarUrl,\n  userName,\n  rating,\n  comment,\n  timestamp,\n  className = ''\n}: UserRatingCardProps) {\n  // 格式化时间显示\n  const formatTime = (isoString: string): string => {\n    const date = new Date(isoString);\n    const now = new Date();\n    const diffMs = now.getTime() - date.getTime();\n    const diffMins = Math.floor(diffMs / 60000);\n    \n    if (diffMins < 60) return `${diffMins} 分钟前`;\n    if (diffMins < 1440) return `${Math.floor(diffMins / 60)} 小时前`;\n    return date.toLocaleDateString('zh-CN');\n  };\n\n  // 渲染星星\n  const renderStars = () => {\n    return Array.from({ length: 5 }, (_, i) => (\n      <svg\n        key={i}\n        className={`w-5 h-5 ${\n          i < rating ? 'text-yellow-400 fill-current' : 'text-gray-300'\n        }`}\n        viewBox=\"0 0 20 20\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n      >\n        <path d=\"M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z\" />\n      </svg>\n    ));\n  };\n\n  return (\n    <div className={`bg-white rounded-lg shadow-md p-6 ${className}`}>\n      {/* 用户信息区 */}\n      <div className=\"flex items-center gap-4 mb-4\">\n        <img\n          src={avatarUrl}\n          alt={userName}\n          className=\"w-12 h-12 rounded-full object-cover\"\n          loading=\"lazy\"\n        />\n        <div className=\"flex-1\">\n          <h3 className=\"font-semibold text-gray-900\">{userName}</h3>\n          <div className=\"flex items-center gap-2\">\n            <div className=\"flex gap-1\">{renderStars()}</div>\n            <span className=\"text-sm text-gray-500\">\n              {formatTime(timestamp)}\n            </span>\n          </div>\n        </div>\n      </div>\n\n      {/* 评论内容 */}\n      <p className=\"text-gray-700 leading-relaxed\">{comment}</p>\n    </div>\n  );\n}\n```\n\n### 实际效果分析\n\n运行上面的代码后，你会得到：\n1. ✅ 完整的 TypeScript 类型定义\n2. ✅ Tailwind CSS 样式（响应式、可访问性）\n3. ✅ 时间格式化逻辑（相对时间显示）\n4. ✅ 详细的注释和使用示例\n5. ✅ 懒加载图片优化\n\n**Token 消耗估算**：\n- Input: ~1,200 tokens（系统提示 + 用户需求 + 工具定义）\n- Output: ~800 tokens（生成的代码 + 工具调用）\n- 总成本: 约 $0.015（不到 2 分钱）\n\n对比手写：如果你从零开始写这个组件，包括类型定义、样式调整、时间格式化逻辑，大概需要 15-20 分钟。AI Agent 只用了 10 秒。\n\n### Prompt 设计技巧\n\n上面代码中的 `systemPrompt` 是关键。好的 Prompt 需要：\n\n**1. 明确约束条件**  \n不要说「生成一个组件」，要说「生成一个 TypeScript React 函数组件，使用 Tailwind CSS，Props 必须有类型定义」。\n\n**2. 提供上下文**  \n告诉 AI 项目的技术栈、代码风格、命名规范。你给的信息越详细，生成的代码越符合预期。\n\n**3. 强调关键点**  \n「代码必须可直接运行，不要有占位符」——这句话能避免 AI 生成 `// TODO: implement this` 这种废话。\n\n**4. 分步引导**  \n如果任务复杂，可以在 Prompt 里写「步骤 1: xxx，步骤 2: xxx」，帮助 AI 规划任务。\n\n### 边界情况处理\n\n实际使用中，你还需要考虑：\n\n```typescript\n// 处理 API 错误\ntry {\n  const response = await this.client.messages.create({...});\n} catch (error) {\n  if (error instanceof Anthropic.APIError) {\n    if (error.status === 429) {\n      // 速率限制，等待后重试\n      await sleep(1000);\n      return this.generate(options);\n    }\n    throw new Error(`API 错误: ${error.message}`);\n  }\n  throw error;\n}\n\n// 防止无限循环\nif (iterations >= maxIterations) {\n  throw new Error('Agent 执行超时，可能陷入循环');\n}\n\n// Token 超限检查\nif (response.usage && response.usage.input_tokens > 180000) {\n  console.warn('上下文即将超限，考虑清理历史消息');\n}\n```\n\n## 和现有工具对比\n\n你可能会问：这和 v0.dev、Cursor 有什么区别？\n\n**v0.dev**：\n- 优点：UI 漂亮，生成速度快，直接可视化预览\n- 缺点：封闭生态，只能在网页上用，无法集成到你的工作流\n\n**Cursor**：\n- 优点：IDE 集成，能看到项目全貌\n- 缺点：贵（$20/月），对工具调用的控制有限\n\n**自建 Agent**：\n- 优点：完全可控，能深度定制，成本低（按用量付费）\n- 缺点：需要写代码，有学习成本\n\n我的建议：日常用 Cursor，复杂定制用自建 Agent。两者不冲突。\n\n## 下一篇预告：代码审查与测试生成\n\n生成组件只是第一步。代码生成后：\n- 怎么自动 Review？（检查性能问题、可访问性、安全漏洞）\n- 怎么生成单元测试？（不是随便写几个 `expect`，而是有意义的测试）\n- 怎么做视觉回归测试？（保证改代码不会搞坏 UI）\n\n下一篇我们会深入这些主题，并实现一个完整的「生成 → 审查 → 测试」流水线。\n\n---\n\n**关键要点总结**：\n1. AI Agent ≠ 聊天机器人，核心是工具调用能力\n2. Function Calling 让 AI 能「做事」，不只是「说话」\n3. 上下文管理很关键，不要无脑塞所有代码\n4. 组件生成的成本很低（~$0.02），但价值很高（节省 20 分钟）\n5. Prompt 设计决定了生成质量，要明确、详细、可执行\n\n代码已开源在 [GitHub](#)，你可以直接拿去用。有问题欢迎在评论区讨论。","src/data/blog/ai-agent-frontend-workflow-part1.md","9dff4323d840a31e",{html:1962,metadata:1963},"<p>前端开发正在经历一场范式转变。我不是在说又一个新框架，而是工作方式的根本改变——从「写代码」到「指挥 AI 写代码」。但市面上大多数 AI 编程助手本质上还是「智能补全」，你写一行，它猜下一行。真正改变游戏规则的是 <strong>AI Agent</strong>。</p>\n<h2 id=\"ai-agent-不是聊天机器人\">AI Agent 不是聊天机器人</h2>\n<p>很多人第一次接触 AI 编程工具时，会觉得它像个「很懂代码的 ChatGPT」。这种理解差了十万八千里。</p>\n<p>传统 AI 编程助手（如早期的 GitHub Copilot）是<strong>被动响应型</strong>的：</p>\n<ul>\n<li>你写代码，它补全</li>\n<li>你问问题，它回答</li>\n<li>它的生命周期只存在于单次对话中</li>\n</ul>\n<p>而 AI Agent 是<strong>主动执行型</strong>的：</p>\n<ul>\n<li>它能调用工具（读文件、运行命令、调用 API）</li>\n<li>它能规划多步骤任务（「生成组件」→「写测试」→「运行测试」→「修 bug」）</li>\n<li>它能在上下文中持续工作，记住之前做了什么</li>\n</ul>\n<p>举个具体例子。如果你对 Copilot 说「生成一个用户卡片组件」，它会给你一段代码，然后就没了。你要自己复制、粘贴、保存文件、检查类型错误、写样式。</p>\n<p>而对一个前端 AI Agent 说同样的话，它会：</p>\n<ol>\n<li>分析项目结构，找到组件存放位置</li>\n<li>检查现有的设计系统和样式规范</li>\n<li>生成符合项目风格的 TypeScript 代码</li>\n<li>自动创建文件并保存</li>\n<li>运行类型检查，如果有错误就修复</li>\n<li>甚至可以生成对应的 Storybook 文档</li>\n</ol>\n<p>这就是质的区别。<strong>Agent 是能干活的，Assistant 只是能聊天的。</strong></p>\n<h2 id=\"核心差异工具调用能力\">核心差异：工具调用能力</h2>\n<p>AI Agent 的灵魂是 <strong>Function Calling</strong>（也叫 Tool Use）。这是 2024 年开始大规模商用的技术，Anthropic、OpenAI 都支持。</p>\n<p>简单说，你可以给 AI 定义一组「工具」，比如：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"typescript\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> tools</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">    name</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">read_file</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">    description</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">读取项目文件内容</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">    input_schema</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">      type</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">object</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">      properties</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">        path</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> type</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">string</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> description</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">文件路径</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">    name</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">write_file</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">    description</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">创建或修改文件</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">    input_schema</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">      type</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">object</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">      properties</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">        path</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> type</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">string</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> }</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">        content</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> type</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">string</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]</span></span></code></pre>\n<p>然后把这些工具和用户请求一起发给 AI。AI 会决定：</p>\n<ol>\n<li>我需要用哪个工具？</li>\n<li>参数是什么？</li>\n<li>工具返回结果后，我下一步该做什么？</li>\n</ol>\n<p>这就像给 AI 配了一个工具箱。以前它只能「说」，现在它能「做」。</p>\n<h3 id=\"为什么前端开发特别适合-agent\">为什么前端开发特别适合 Agent？</h3>\n<p>前端开发有几个痛点，天然适合用 Agent 解决：</p>\n<p><strong>1. 重复劳动太多</strong><br>\n创建一个新页面：建文件夹、写组件、配路由、写样式、加类型、写测试……每一步都很机械，但又不能出错。</p>\n<p><strong>2. 上下文切换频繁</strong><br>\n你要同时关注业务逻辑、UI 交互、性能优化、类型安全、可访问性……人脑很难同时 hold 住这么多维度。</p>\n<p><strong>3. 工具链复杂</strong><br>\nTypeScript、ESLint、Prettier、Tailwind、Vite……每个工具都有自己的配置和规则。新手光配环境就要一周。</p>\n<p><strong>4. 设计稿到代码的鸿沟</strong><br>\n设计师给你一个 Figma，你要把视觉语言翻译成代码。这个过程很耗时，而且容易出错。</p>\n<p>AI Agent 可以自动化这些流程。它不是替代你写代码，而是把你从机械劳动中解放出来，让你专注于「这个组件应该怎么设计」，而不是「这个 className 拼错了没有」。</p>\n<h2 id=\"工作原理深入从-function-calling-到自主循环\">工作原理深入：从 Function Calling 到自主循环</h2>\n<p>让我们拆解一个完整的 AI Agent 工作流程。以「生成 React 组件」为例：</p>\n<h3 id=\"1-function-calling-机制\">1. Function Calling 机制</h3>\n<p>用户请求：「生成一个可排序的表格组件」</p>\n<p>AI 收到请求后，会进行<strong>思维链推理</strong>（Chain of Thought）：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"plaintext\"><code><span class=\"line\"><span>我需要：</span></span>\n<span class=\"line\"><span>1. 先看看项目里有没有类似的组件（工具：search_codebase）</span></span>\n<span class=\"line\"><span>2. 检查项目用的是什么 UI 库（工具：read_file package.json）</span></span>\n<span class=\"line\"><span>3. 生成代码</span></span>\n<span class=\"line\"><span>4. 保存文件（工具：write_file）</span></span>\n<span class=\"line\"><span>5. 运行类型检查（工具：run_command \"tsc --noEmit\"）</span></span></code></pre>\n<p>然后它会返回一个 <strong>tool_use</strong> 请求：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"json\"><code><span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">  \"type\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#C789D6\">tool_use</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">  \"id\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#C789D6\">toolu_01A</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">  \"name\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#C789D6\">read_file</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">  \"input\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">    \"path\"</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#C789D6\">package.json</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span></code></pre>\n<p>你的代码执行这个工具，把结果返回给 AI。AI 继续下一步。这个循环会一直持续，直到任务完成。</p>\n<h3 id=\"2-上下文管理不让-token-爆炸\">2. 上下文管理：不让 Token 爆炸</h3>\n<p>AI 的「记忆」是有限的。Claude 3.5 Sonnet 的上下文窗口是 200K tokens，看起来很大，但一个中型项目的所有代码加起来可能就超过这个数字。</p>\n<p>怎么办？<strong>选择性加载上下文</strong>。</p>\n<p>聪明的 Agent 不会一次性把整个项目塞给 AI，而是：</p>\n<ul>\n<li><strong>按需加载</strong>：只有真正需要时才读文件</li>\n<li><strong>摘要提取</strong>：对于大文件，只提取关键信息（类型定义、导出的接口）</li>\n<li><strong>优先级排序</strong>：最近修改的文件、相关性高的代码优先加载</li>\n</ul>\n<p>举例：生成一个新组件时，Agent 会：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"typescript\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 高优先级：设计系统相关</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">-</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> components</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">/</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">design</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">-</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">system</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">/</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\">Button</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">tsx</span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  // 看看按钮怎么写的</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">-</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> styles</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">/</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\">theme</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">ts</span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  // 主题配置</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">-</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\"> tsconfig</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">json</span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  // TypeScript 规则</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 中优先级：相似组件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">-</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> components</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">/</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\">Table</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">tsx</span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  // 如果已经有表格组件</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 低优先级：其他</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">-</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\"> package</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">json</span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  // 只看依赖列表，不看 devDependencies</span></span></code></pre>\n<p>这就像人类开发时的思维方式：你不会为了写一个按钮组件就把整个项目所有代码重读一遍，你只会参考相关的部分。</p>\n<h3 id=\"3-工具链设计cli-还是-ide-插件\">3. 工具链设计：CLI 还是 IDE 插件？</h3>\n<p>当前主流的 AI 编程工具分两派：</p>\n<p><strong>CLI 派（如 Cursor、Aider）</strong></p>\n<ul>\n<li>优点：灵活，能调用任何命令行工具</li>\n<li>缺点：脱离 IDE，需要切换上下文</li>\n</ul>\n<p><strong>IDE 插件派（如 GitHub Copilot、Continue）</strong></p>\n<ul>\n<li>优点：无缝集成，不用离开编辑器</li>\n<li>缺点：权限受限，很难调用外部工具</li>\n</ul>\n<p>我个人倾向于 <strong>混合方案</strong>：</p>\n<ul>\n<li>日常写代码用 IDE 插件（快速补全、重构）</li>\n<li>复杂任务用 CLI Agent（生成整个模块、批量重构）</li>\n</ul>\n<p>这和你平时开发时同时开着 VSCode 和终端是一个道理。</p>\n<h2 id=\"实战组件自动生成-agent\">实战：组件自动生成 Agent</h2>\n<p>说了这么多理论，来点实战的。我们用 Claude API 实现一个简单但完整的「React 组件生成器」。</p>\n<h3 id=\"场景设定\">场景设定</h3>\n<p>需求：「生成一个用户评分卡片组件，支持 1-5 星评分，显示用户头像、名字、评论内容和时间」</p>\n<h3 id=\"完整代码实现\">完整代码实现</h3>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"typescript\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// component-generator.ts</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> Anthropic </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">@anthropic-ai/sdk</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> fs </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">fs/promises</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> path </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">path</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">interface</span><span style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> GenerateComponentOptions</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  description</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> string</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;  </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 组件需求描述</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  outputDir</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> string</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;    </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 输出目录</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  projectContext</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">?:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {    </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 项目上下文（可选）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    usesTailwind</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> boolean</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    usesTypeScript</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> boolean</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  };</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">class</span><span style=\"--shiki-light:#6F42C1;--shiki-dark:#FFCB8B\"> ComponentGenerator</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  private</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> client</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:</span><span style=\"--shiki-light:#6F42C1;--shiki-dark:#FFCB8B\"> Anthropic</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#82AAFF\">  constructor</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">apiKey</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> string</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-dark:#7FDBCA\">    this</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">client</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> new</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> Anthropic</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">({ apiKey });</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  /**</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">   * 定义 Agent 可用的工具</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">   */</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  private</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> getTools</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">()</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        name</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">write_component_file</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        description</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">创建 React 组件文件</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        input_schema</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">          type</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">object</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">          properties</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">            filename</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">              type</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">string</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">              description</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">文件名（不含路径），如 UserRatingCard.tsx</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">            }</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">            content</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">              type</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">string</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">              description</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">完整的组件代码</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">            }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">          }</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">          required</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">filename</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">content</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      }</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        name</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">validate_typescript</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        description</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">验证 TypeScript 代码是否有类型错误</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        input_schema</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">          type</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">object</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">          properties</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">            code</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { type</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">string</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> description</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">TypeScript 代码</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">          }</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">          required</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">code</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    ];</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  /**</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">   * 执行工具调用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">   */</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  private</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> async</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> executeTool</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">    toolName</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> string</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">    toolInput</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:</span><span style=\"--shiki-light:#6F42C1;--shiki-dark:#FFCB8B\"> Record</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\">string</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> unknown</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">></span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">    outputDir</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> string</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">  )</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:</span><span style=\"--shiki-light:#6F42C1;--shiki-dark:#FFCB8B\"> Promise</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\">string</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    switch</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (toolName) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">      case</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">write_component_file</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#82AAFF\">        const</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> filename</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> content</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> }</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> toolInput</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> as</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">          filename</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\"> string</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">;</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">          content</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\"> string</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">;</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">        }</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#82AAFF\">        const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> filePath</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> path</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">join</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">outputDir</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> filename</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        try</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">          await</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\"> fs</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">mkdir</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(outputDir</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { recursive</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\"> true</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> });</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">          await</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\"> fs</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">writeFile</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(filePath</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> content</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">utf-8</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">          return</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\"> `</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">文件已创建: </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">${</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">filePath</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">}</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        } </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">catch</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (error) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">          return</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\"> `</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">创建文件失败: </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">${</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(error</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> as</span><span style=\"--shiki-light:#6F42C1;--shiki-dark:#FFCB8B\"> Error</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">message</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">}</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">      case</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">validate_typescript</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#82AAFF\">        const</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> code</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> }</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> toolInput</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> as</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> code</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\"> string</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> }</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">        // 简单的静态检查（实际项目中应该调用 tsc）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#82AAFF\">        const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> hasExport</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> /</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#5CA7E4;--shiki-dark-font-style:italic\">export</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">\\s</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">+</span><span style=\"--shiki-light:#22863A;--shiki-dark:#5CA7E4\">(</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#5CA7E4;--shiki-dark-font-style:italic\">default</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">\\s</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">+</span><span style=\"--shiki-light:#22863A;--shiki-dark:#5CA7E4\">)</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">?</span><span style=\"--shiki-light:#22863A;--shiki-dark:#5CA7E4\">(</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#5CA7E4;--shiki-dark-font-style:italic\">function</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">|</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#5CA7E4;--shiki-dark-font-style:italic\">const</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">|</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#5CA7E4;--shiki-dark-font-style:italic\">class</span><span style=\"--shiki-light:#22863A;--shiki-dark:#5CA7E4\">)</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">test</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">code</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#82AAFF\">        const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> hasProps</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> /</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#5CA7E4;--shiki-dark-font-style:italic\">interface</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">\\s</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">+</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">\\w</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">+</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#5CA7E4;--shiki-dark-font-style:italic\">Props</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">test</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">code</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ||</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> /</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#5CA7E4;--shiki-dark-font-style:italic\">type</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">\\s</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">+</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">\\w</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">+</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#5CA7E4;--shiki-dark-font-style:italic\">Props</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">test</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">code</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">        if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">!</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">hasExport) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">          return</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">错误：组件没有 export</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">        if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">!</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">hasProps </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">&#x26;&#x26;</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\"> code</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">includes</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">props</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">          return</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">警告：使用了 props 但未定义类型</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        return</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">类型检查通过</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">      default</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        return</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\"> `</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">未知工具: </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">${</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">toolName</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">}</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  /**</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">   * 生成组件的核心循环</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">   */</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  async</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> generate</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">options</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:</span><span style=\"--shiki-light:#6F42C1;--shiki-dark:#FFCB8B\"> GenerateComponentOptions</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:</span><span style=\"--shiki-light:#6F42C1;--shiki-dark:#FFCB8B\"> Promise</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">&#x3C;</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\">string</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#82AAFF\">    const</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> description</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> outputDir</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> projectContext</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> }</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> options</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 构建初始 prompt</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#82AAFF\">    const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> systemPrompt</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\"> `</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">你是一个专业的 React 组件生成助手。</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">    </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">项目配置：</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">- TypeScript: </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">${</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">projectContext</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">?.</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic\">usesTypeScript</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ?</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">是</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">'</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> :</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">否</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">'</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">- Tailwind CSS: </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">${</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">projectContext</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">?.</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic\">usesTailwind</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ?</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">是</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">'</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> :</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">否</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">'</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">要求：</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">1. 生成的组件必须是 TypeScript（.tsx）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">2. Props 必须有完整的类型定义</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">3. 使用函数组件 + Hooks</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">4. </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">${</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">projectContext</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">?.</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic\">usesTailwind</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ?</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">使用 Tailwind 类名</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">'</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> :</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">使用 CSS-in-JS</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">'</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">5. 包含详细的注释</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">6. 生成完成后调用 write_component_file 保存文件</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">注意：</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">- 组件名用 PascalCase</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">- 文件名和组件名一致</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">- 代码必须可直接运行，不要有占位符</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#82AAFF\">    const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> messages</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> Anthropic</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#FFCB8B;--shiki-dark-font-style:italic\">MessageParam</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[]</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">        role</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">user</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">        content</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\"> `</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">请生成组件：</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">${</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">description</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">}</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    ];</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#82AAFF\">    let</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> continueLoop</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FF5874;--shiki-dark-font-style:italic\"> true</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#82AAFF\">    let</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> iterations</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 0</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#82AAFF\">    const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> maxIterations</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 10</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;  </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 防止无限循环</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#82AAFF\">    let</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> finalOutput</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> ''</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // Agent 循环</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    while</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (continueLoop </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">&#x26;&#x26;</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> iterations </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">&#x3C;</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> maxIterations) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      iterations</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">++</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#82AAFF\">      const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> response</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> await</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> this</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic\">client</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic\">messages</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">create</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        model</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">claude-3-5-sonnet-20241022</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        max_tokens</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 4096</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        system</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> systemPrompt</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">        messages</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        tools</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> this</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">getTools</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">      }</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">      // 检查 stop_reason</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">      if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\">response</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">stop_reason</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ===</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">end_turn</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        continueLoop </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\"> false</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">      // 处理响应内容</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#82AAFF\">      const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> assistantMessage</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> Anthropic</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#FFCB8B;--shiki-dark-font-style:italic\">MessageParam</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        role</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">assistant</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        content</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> response</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic\">content</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">      }</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\">      messages</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">push</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(assistantMessage);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">      // 执行工具调用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#82AAFF\">      const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> toolResults</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> Anthropic</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#FFCB8B;--shiki-dark-font-style:italic\">ToolResultBlockParam</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[]</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [];</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">      for</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#82AAFF\">const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> block</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> of</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\"> response</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">content</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">        if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\">block</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">type</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ===</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">text</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">          finalOutput </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">+=</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\"> block</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">text</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> +</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#F78C6C\">\\n</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">        if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\">block</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">type</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ===</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">tool_use</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\">          console</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">log</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">🔧 执行工具: </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">${</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\">block</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">name</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">}</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\">          console</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">log</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">📥 参数:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#82AAFF\"> JSON</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">stringify</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\">block</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">input</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\"> null</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 2</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">));</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">          </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#82AAFF\">          const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> result</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> await</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> this</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">executeTool</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">            block</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic\">name</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">            block</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic\">input</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">            outputDir</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">          );</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">          </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\">          console</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">log</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">📤 结果: </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">${</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">result</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">}</span><span style=\"--shiki-light:#22863A;--shiki-dark:#F78C6C\">\\n</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">          </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\">          toolResults</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">push</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">({</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">            type</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">tool_result</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">            tool_use_id</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\"> block</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">id</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">            content</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> result</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">          });</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">      // 如果有工具调用，继续循环</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">      if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\">toolResults</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#7FDBCA\">length</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ></span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 0</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\">        messages</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">push</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">({</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">          role</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">user</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">          content</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> toolResults</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        });</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        continueLoop </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\"> true</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> finalOutput;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  /**</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">   * 估算 token 消耗和成本</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">   */</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">  estimateCost</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">inputTokens</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> number</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> outputTokens</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> number</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    tokens</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { input</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> number</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">; output</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> number</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> };</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    cost</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> number</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  } {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // Claude 3.5 Sonnet 定价 (2026-02-13)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // Input: $3 / 1M tokens</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // Output: $15 / 1M tokens</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#82AAFF\">    const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> inputCost</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">inputTokens</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> /</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1_000_000</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> *</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 3</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#82AAFF\">    const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> outputCost</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">outputTokens</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> /</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1_000_000</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> *</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 15</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      tokens</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { input</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> inputTokens</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> output</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> outputTokens }</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      cost</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> inputCost </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">+</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> outputCost</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    };</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 使用示例</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">async</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> function</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> main</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">()</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> apiKey</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> process</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic\">env</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">ANTHROPIC_API_KEY</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">!</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">apiKey) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    throw</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> new</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> Error</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">请设置 ANTHROPIC_API_KEY 环境变量</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> generator</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> new</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> ComponentGenerator</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">apiKey</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> result</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> await</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> generator</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">generate</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    description</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">用户评分卡片组件，支持 1-5 星评分，显示用户头像、名字、评论内容和时间</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    outputDir</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">./generated-components</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    projectContext</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">      usesTailwind</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FF5874;--shiki-dark-font-style:italic\"> true</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">      usesTypeScript</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FF5874;--shiki-dark-font-style:italic\"> true</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">    }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">  }</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\">  console</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">log</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">生成完成！</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\">  console</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">log</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(result);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 错误处理</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">main</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">catch</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">error</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\">  console</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">error</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">生成失败:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> error);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\">  process</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">exit</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">});</span></span></code></pre>\n<h3 id=\"生成的组件示例\">生成的组件示例</h3>\n<p>上面的代码运行后，会自动生成类似这样的组件：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"tsx\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// UserRatingCard.tsx</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> React </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">react</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">/**</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"> * 用户评分卡片组件的 Props 类型定义</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"> */</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">interface</span><span style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> UserRatingCardProps</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  /** 用户头像 URL */</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  avatarUrl</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> string</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  /** 用户名 */</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  userName</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> string</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  /** 评分（1-5） */</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  rating</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> |</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 2</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> |</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 3</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> |</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 4</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> |</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 5</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  /** 评论内容 */</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  comment</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> string</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  /** 评论时间（ISO 8601 格式） */</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  timestamp</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> string</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  /** 自定义类名 */</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  className</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">?:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> string</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">/**</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"> * 用户评分卡片组件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"> * </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"> * </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">@example</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"> * &#x3C;UserRatingCard</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"> *   avatarUrl=\"https://i.pravatar.cc/150?img=1\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"> *   userName=\"张三\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"> *   rating={5}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"> *   comment=\"非常好用！\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"> *   timestamp=\"2026-02-13T10:00:00Z\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"> * /></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"> */</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">export</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> default</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> function</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> UserRatingCard</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">  avatarUrl</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">  userName</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">  rating</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">  comment</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">  timestamp</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">  className</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> ''</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:</span><span style=\"--shiki-light:#6F42C1;--shiki-dark:#FFCB8B\"> UserRatingCardProps</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  // 格式化时间显示</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  const</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> formatTime</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D7DBE0;--shiki-dark-font-style:italic\">isoString</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\"> string</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\"> string</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> date</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> new</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> Date</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">isoString</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> now</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> new</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> Date</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> diffMs</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> now</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">getTime</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> -</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> date</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">getTime</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> diffMins</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> Math</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">floor</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">diffMs</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> /</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 60000</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">diffMins</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> &#x3C;</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 60</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> return</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\"> `</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">${</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">diffMins</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">}</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\"> 分钟前</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">diffMins</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> &#x3C;</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 1440</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> return</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\"> `</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">${</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">Math</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">floor</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">diffMins</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> /</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 60</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">}</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\"> 小时前</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> date</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">toLocaleDateString</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">zh-CN</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">  }</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">  // 渲染星星</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  const</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> renderStars</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> ()</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\"> Array</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">from</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">{</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> length</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 5</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> }</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D7DBE0;--shiki-dark-font-style:italic\">_</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D7DBE0;--shiki-dark-font-style:italic\"> i</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">      &#x3C;</span><span style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">svg</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">        key</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D3423E\">{</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">i</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D3423E\">}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">        className</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D3423E\">{</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">w-5 h-5 </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">${</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">          i</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> &#x3C;</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> rating</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ?</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">text-yellow-400 fill-current</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">'</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> :</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">text-gray-300</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">        }</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D3423E\">}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">        viewBox</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">0 0 20 20</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">        xmlns</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">http://www.w3.org/2000/svg</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">      ></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">        &#x3C;</span><span style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">path</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\"> d</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> /></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">      &#x3C;/</span><span style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">svg</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    ))</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">  }</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">    &#x3C;</span><span style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">div</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\"> className</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D3423E\">{</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">bg-white rounded-lg shadow-md p-6 </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">${</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">className</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">}</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D3423E\">}</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D3423E\">      {</span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">/* 用户信息区 */</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D3423E\">}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">      &#x3C;</span><span style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">div</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\"> className</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">flex items-center gap-4 mb-4</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">        &#x3C;</span><span style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">img</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">          src</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D3423E\">{</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">avatarUrl</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D3423E\">}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">          alt</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D3423E\">{</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">userName</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D3423E\">}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">          className</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">w-12 h-12 rounded-full object-cover</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">          loading</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">lazy</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">        /></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">        &#x3C;</span><span style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">div</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\"> className</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">flex-1</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">          &#x3C;</span><span style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">h3</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\"> className</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">font-semibold text-gray-900</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D3423E\">{</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">userName</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D3423E\">}</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">&#x3C;/</span><span style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">h3</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">          &#x3C;</span><span style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">div</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\"> className</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">flex items-center gap-2</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">            &#x3C;</span><span style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">div</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\"> className</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">flex gap-1</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D3423E\">{</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">renderStars</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D3423E\">}</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">&#x3C;/</span><span style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">div</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">            &#x3C;</span><span style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">span</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\"> className</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">text-sm text-gray-500</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D3423E\">              {</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">formatTime</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(timestamp)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D3423E\">}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">            &#x3C;/</span><span style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">span</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">          &#x3C;/</span><span style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">div</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">        &#x3C;/</span><span style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">div</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">      &#x3C;/</span><span style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">div</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">></span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D3423E\">      {</span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">/* 评论内容 */</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D3423E\">}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">      &#x3C;</span><span style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">p</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\"> className</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">text-gray-700 leading-relaxed</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D3423E\">{</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">comment</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D3423E\">}</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">&#x3C;/</span><span style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">p</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">    &#x3C;/</span><span style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">div</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  );</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span></code></pre>\n<h3 id=\"实际效果分析\">实际效果分析</h3>\n<p>运行上面的代码后，你会得到：</p>\n<ol>\n<li>✅ 完整的 TypeScript 类型定义</li>\n<li>✅ Tailwind CSS 样式（响应式、可访问性）</li>\n<li>✅ 时间格式化逻辑（相对时间显示）</li>\n<li>✅ 详细的注释和使用示例</li>\n<li>✅ 懒加载图片优化</li>\n</ol>\n<p><strong>Token 消耗估算</strong>：</p>\n<ul>\n<li>Input: ~1,200 tokens（系统提示 + 用户需求 + 工具定义）</li>\n<li>Output: ~800 tokens（生成的代码 + 工具调用）</li>\n<li>总成本: 约 $0.015（不到 2 分钱）</li>\n</ul>\n<p>对比手写：如果你从零开始写这个组件，包括类型定义、样式调整、时间格式化逻辑，大概需要 15-20 分钟。AI Agent 只用了 10 秒。</p>\n<h3 id=\"prompt-设计技巧\">Prompt 设计技巧</h3>\n<p>上面代码中的 <code>systemPrompt</code> 是关键。好的 Prompt 需要：</p>\n<p><strong>1. 明确约束条件</strong><br>\n不要说「生成一个组件」，要说「生成一个 TypeScript React 函数组件，使用 Tailwind CSS，Props 必须有类型定义」。</p>\n<p><strong>2. 提供上下文</strong><br>\n告诉 AI 项目的技术栈、代码风格、命名规范。你给的信息越详细，生成的代码越符合预期。</p>\n<p><strong>3. 强调关键点</strong><br>\n「代码必须可直接运行，不要有占位符」——这句话能避免 AI 生成 <code>// TODO: implement this</code> 这种废话。</p>\n<p><strong>4. 分步引导</strong><br>\n如果任务复杂，可以在 Prompt 里写「步骤 1: xxx，步骤 2: xxx」，帮助 AI 规划任务。</p>\n<h3 id=\"边界情况处理\">边界情况处理</h3>\n<p>实际使用中，你还需要考虑：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"typescript\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 处理 API 错误</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">try</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> response</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> await</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> this</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic\">client</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic\">messages</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">create</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">{</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">...</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">}</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">} </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">catch</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (error) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (error </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">instanceof</span><span style=\"--shiki-light:#6F42C1;--shiki-dark:#D6DEEB\"> Anthropic</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-dark:#FFCB8B\">APIError</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\">error</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">status</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ===</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 429</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">      // 速率限制，等待后重试</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">      await</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> sleep</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">1000</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">      return</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#7FDBCA\"> this</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">generate</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(options);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    throw</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> new</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> Error</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">API 错误: </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">${</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\">error</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">message</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">}</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  throw</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> error;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 防止无限循环</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (iterations </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">>=</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> maxIterations) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  throw</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> new</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> Error</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">Agent 执行超时，可能陷入循环</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// Token 超限检查</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\">response</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">usage</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> &#x26;&#x26;</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\"> response</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic\">usage</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">input_tokens</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ></span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 180000</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-dark:#D6DEEB\">  console</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">warn</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">上下文即将超限，考虑清理历史消息</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span></code></pre>\n<h2 id=\"和现有工具对比\">和现有工具对比</h2>\n<p>你可能会问：这和 v0.dev、Cursor 有什么区别？</p>\n<p><strong>v0.dev</strong>：</p>\n<ul>\n<li>优点：UI 漂亮，生成速度快，直接可视化预览</li>\n<li>缺点：封闭生态，只能在网页上用，无法集成到你的工作流</li>\n</ul>\n<p><strong>Cursor</strong>：</p>\n<ul>\n<li>优点：IDE 集成，能看到项目全貌</li>\n<li>缺点：贵（$20/月），对工具调用的控制有限</li>\n</ul>\n<p><strong>自建 Agent</strong>：</p>\n<ul>\n<li>优点：完全可控，能深度定制，成本低（按用量付费）</li>\n<li>缺点：需要写代码，有学习成本</li>\n</ul>\n<p>我的建议：日常用 Cursor，复杂定制用自建 Agent。两者不冲突。</p>\n<h2 id=\"下一篇预告代码审查与测试生成\">下一篇预告：代码审查与测试生成</h2>\n<p>生成组件只是第一步。代码生成后：</p>\n<ul>\n<li>怎么自动 Review？（检查性能问题、可访问性、安全漏洞）</li>\n<li>怎么生成单元测试？（不是随便写几个 <code>expect</code>，而是有意义的测试）</li>\n<li>怎么做视觉回归测试？（保证改代码不会搞坏 UI）</li>\n</ul>\n<p>下一篇我们会深入这些主题，并实现一个完整的「生成 → 审查 → 测试」流水线。</p>\n<hr>\n<p><strong>关键要点总结</strong>：</p>\n<ol>\n<li>AI Agent ≠ 聊天机器人，核心是工具调用能力</li>\n<li>Function Calling 让 AI 能「做事」，不只是「说话」</li>\n<li>上下文管理很关键，不要无脑塞所有代码</li>\n<li>组件生成的成本很低（~$0.02），但价值很高（节省 20 分钟）</li>\n<li>Prompt 设计决定了生成质量，要明确、详细、可执行</li>\n</ol>\n<p>代码已开源在 <a href=\"#\">GitHub</a>，你可以直接拿去用。有问题欢迎在评论区讨论。</p>",{headings:1964,localImagePaths:2007,remoteImagePaths:2008,frontmatter:2009,imagePaths:2012},[1965,1968,1971,1974,1977,1980,1983,1986,1989,1991,1993,1995,1997,2000,2002,2004],{depth:31,slug:1966,text:1967},"ai-agent-不是聊天机器人","AI Agent 不是聊天机器人",{depth:31,slug:1969,text:1970},"核心差异工具调用能力","核心差异：工具调用能力",{depth:185,slug:1972,text:1973},"为什么前端开发特别适合-agent","为什么前端开发特别适合 Agent？",{depth:31,slug:1975,text:1976},"工作原理深入从-function-calling-到自主循环","工作原理深入：从 Function Calling 到自主循环",{depth:185,slug:1978,text:1979},"1-function-calling-机制","1. Function Calling 机制",{depth:185,slug:1981,text:1982},"2-上下文管理不让-token-爆炸","2. 上下文管理：不让 Token 爆炸",{depth:185,slug:1984,text:1985},"3-工具链设计cli-还是-ide-插件","3. 工具链设计：CLI 还是 IDE 插件？",{depth:31,slug:1987,text:1988},"实战组件自动生成-agent","实战：组件自动生成 Agent",{depth:185,slug:1990,text:1990},"场景设定",{depth:185,slug:1992,text:1992},"完整代码实现",{depth:185,slug:1994,text:1994},"生成的组件示例",{depth:185,slug:1996,text:1996},"实际效果分析",{depth:185,slug:1998,text:1999},"prompt-设计技巧","Prompt 设计技巧",{depth:185,slug:2001,text:2001},"边界情况处理",{depth:31,slug:2003,text:2003},"和现有工具对比",{depth:31,slug:2005,text:2006},"下一篇预告代码审查与测试生成","下一篇预告：代码审查与测试生成",[],[],{author:14,pubDatetime:2010,title:1955,slug:1951,featured:165,draft:17,tags:2011,description:1957},["Date","2026-02-13T03:00:00.000Z"],[167,168,1483,19],[],"ai-agent-frontend-workflow-part2",{id:2013,data:2015,body:2021,filePath:2022,digest:2023,rendered:2024},{author:14,pubDatetime:2016,title:2017,featured:165,draft:17,tags:2018,description:2020},["Date","2026-02-14T10:00:00.000Z"],"AI Agent 前端工作流（二）：智能代码审查与自动化测试",[167,168,2019,19],"测试","用 AI Agent 实现智能代码审查和自动化测试用例生成。从 Git Hook 集成到 E2E 测试，本文分享完整实战方案和真实项目效果数据。","## 回顾：从组件生成到质量保障\n\n[上一篇文章](/blog/ai-agent-frontend-workflow-part1)我们聊了用 AI Agent 生成 React 组件，从产品需求到可运行代码，效率提升了 3-5 倍。但是，代码能跑和代码质量高是两回事。\n\n生产环境的代码需要经过严格的审查和测试。传统上，这两个环节都是人力密集型工作：\n\n- **Code Review**：高级工程师花大量时间审查初级工程师的代码，但很难做到全面、一致\n- **写测试**：测试覆盖率常年在 30%-50% 徘徊，大家都知道应该写，但总是\"等下次有时间再补\"\n\n这篇文章我们要解决的问题是：**AI Agent 能不能承担这些质量保障工作？**\n\n答案是：能，而且效果超预期。\n\n## 一、AI 驱动的代码审查\n\n### 传统 Code Review 的三大困境\n\n让我们诚实一点：\n\n1. **精力有限**：资深工程师审 10 个 PR 后就会疲劳，后面的 PR 质量难保证\n2. **标准不一**：同一个问题，周一可能被指出，周五可能就被放过了\n3. **覆盖不全**：人很难在审查时同时关注性能、安全、可访问性、最佳实践……太多维度了\n\n结果就是：要么 Review 成本高昂（每个 PR 30 分钟+），要么流于形式（点个 LGTM 了事）。\n\n### AI Agent 的优势\n\nAI 不会累，不会情绪化，而且可以同时检查几十个维度。更重要的是：**它 24/7 在线，成本可控**。\n\n但关键是怎么集成到工作流里。我的方案是：**Git Hook + AI API**。\n\n### 实战：集成到 Git Hook\n\n我们用 Husky 在 `pre-commit` 阶段触发 AI 代码审查。完整实现如下：\n\n#### 1. 安装依赖\n\n```bash\nnpm install -D husky lint-staged\nnpx husky install\n```\n\n#### 2. 创建审查脚本\n\n在 `scripts/ai-code-review.js`：\n\n```javascript\n#!/usr/bin/env node\nimport { execSync } from 'child_process';\nimport Anthropic from '@anthropic-ai/sdk';\nimport fs from 'fs';\nimport path from 'path';\n\nconst client = new Anthropic({\n  apiKey: process.env.ANTHROPIC_API_KEY\n});\n\n// 获取暂存区的文件变更\nfunction getStagedDiff() {\n  try {\n    return execSync('git diff --cached', { encoding: 'utf-8' });\n  } catch (error) {\n    console.error('无法获取 git diff:', error.message);\n    return '';\n  }\n}\n\n// AI 审查 Prompt（这是关键）\nconst REVIEW_PROMPT = `你是一个资深前端工程师，负责代码审查。请审查以下 git diff，关注：\n\n**性能问题：**\n- 不必要的重渲染（缺少 useMemo、useCallback）\n- 大数组操作没有做虚拟化\n- 图片/资源未优化\n- 阻塞主线程的同步操作\n\n**安全隐患：**\n- XSS 风险（dangerouslySetInnerHTML 未做转义）\n- CSRF 防护缺失\n- 敏感信息泄露（API key、token 硬编码）\n- eval() 或 Function() 构造器的使用\n\n**最佳实践：**\n- 组件职责是否单一\n- props 类型检查（TypeScript / PropTypes）\n- 错误边界处理\n- 可访问性（aria 属性、语义化标签）\n- 命名规范和代码风格\n\n**边界情况：**\n- 空数组、null、undefined 的处理\n- 异步操作的错误处理\n- 网络请求失败的降级方案\n\n请按以下格式输出：\n\n## 🚨 Critical Issues（阻断性问题）\n- [文件名:行号] 问题描述 + 修复建议\n\n## ⚠️ Warnings（需要关注）\n- [文件名:行号] 问题描述 + 优化建议\n\n## ✅ Good Practices（做得好的地方）\n- 简要列出亮点\n\n## 📊 Summary\n- 总体评分（1-10）\n- 是否建议合并\n\n如果没有发现任何问题，输出 \"✅ LGTM - 代码质量良好，建议合并\"`;\n\nasync function reviewCode(diff) {\n  if (!diff || diff.trim().length === 0) {\n    console.log('✅ 没有代码变更需要审查');\n    return { shouldBlock: false, report: '' };\n  }\n\n  console.log('🤖 AI 正在审查代码...\\n');\n\n  try {\n    const message = await client.messages.create({\n      model: 'claude-sonnet-4-5',\n      max_tokens: 4096,\n      messages: [{\n        role: 'user',\n        content: `${REVIEW_PROMPT}\\n\\n## Git Diff:\\n\\`\\`\\`diff\\n${diff}\\n\\`\\`\\``\n      }]\n    });\n\n    const report = message.content[0].text;\n    \n    // 保存审查报告\n    const reportPath = path.join(process.cwd(), '.ai-review-report.md');\n    fs.writeFileSync(reportPath, report);\n    \n    console.log(report);\n    console.log(`\\n📄 完整报告已保存到: ${reportPath}\\n`);\n\n    // 判断是否有阻断性问题\n    const hasCriticalIssues = report.includes('## 🚨 Critical Issues') \n      && !report.match(/## 🚨 Critical Issues\\s*\\n\\s*无/);\n\n    return {\n      shouldBlock: hasCriticalIssues,\n      report\n    };\n\n  } catch (error) {\n    console.error('❌ AI 审查失败:', error.message);\n    // 降级策略：AI 失败不阻断提交\n    console.log('⚠️  AI 服务不可用，跳过审查（降级模式）');\n    return { shouldBlock: false, report: '' };\n  }\n}\n\nasync function main() {\n  const diff = getStagedDiff();\n  const { shouldBlock, report } = await reviewCode(diff);\n\n  if (shouldBlock) {\n    console.error('\\n❌ 发现阻断性问题，请修复后再提交\\n');\n    process.exit(1);\n  } else {\n    console.log('\\n✅ 代码审查通过\\n');\n    process.exit(0);\n  }\n}\n\nmain();\n```\n\n#### 3. 配置 Husky Hook\n\n在 `.husky/pre-commit`：\n\n```bash\n#!/bin/sh\n. \"$(dirname \"$0\")/_/husky.sh\"\n\n# 运行 AI 代码审查\nnode scripts/ai-code-review.js\n\n# 如果审查通过，继续执行 lint-staged\nnpx lint-staged\n```\n\n#### 4. 配置环境变量\n\n```bash\n# .env\nANTHROPIC_API_KEY=your_api_key_here\n```\n\n### 真实案例：AI 发现的问题\n\n上周我提交了一个表单组件，AI 审查发现了一个我完全没注意到的问题：\n\n```jsx\n// 我的原始代码\nfunction SearchInput({ onSearch }) {\n  const [query, setQuery] = useState('');\n  \n  const handleSubmit = (e) => {\n    e.preventDefault();\n    onSearch(query);\n  };\n\n  return (\n    <form onSubmit={handleSubmit}>\n      <input \n        value={query}\n        onChange={(e) => setQuery(e.target.value)}\n        placeholder=\"搜索...\"\n      />\n      <button type=\"submit\">搜索</button>\n    </form>\n  );\n}\n```\n\n**AI 的审查报告：**\n\n```markdown\n## ⚠️ Warnings\n\n- [SearchInput.jsx:7] **可访问性问题**：input 缺少 label 或 aria-label，\n  屏幕阅读器用户无法理解这个输入框的用途。\n  \n  建议修复：\n  <label htmlFor=\"search-input\" className=\"sr-only\">搜索</label>\n  <input \n    id=\"search-input\"\n    aria-label=\"搜索内容\"\n    ...\n  />\n\n- [SearchInput.jsx:12] **用户体验**：提交空字符串会触发无意义的搜索。\n  建议在 handleSubmit 中添加校验：\n  if (query.trim().length === 0) return;\n\n## 📊 Summary\n- 总体评分：7/10\n- 功能正常，但可访问性和边界情况处理需要改进\n- 建议修复后合并\n```\n\n这是一个典型的\"功能能跑，但不够专业\"的例子。人工审查很可能会漏掉可访问性问题，但 AI 每次都会检查。\n\n## 二、自动化测试用例生成\n\n### 为什么测试覆盖率总是上不去？\n\n老实说：**写测试太枯燥了**。\n\n你写完一个复杂组件，兴奋地想看效果，结果还要花同样的时间写一堆重复的测试用例。最后就变成了：\n\n- 核心逻辑有测试（因为有人盯着）\n- 边界情况？等有时间再说\n- UI 组件？手动点一下就行了\n- E2E 测试？那是 QA 的事\n\n结果就是测试覆盖率 30%，然后生产环境各种边界 case 爆炸。\n\n### AI 生成测试的思路\n\nAI 看代码比我们快，而且它知道所有的测试模式。我的做法是：\n\n1. **单元测试**：根据组件/函数生成 Jest + React Testing Library 测试\n2. **E2E 测试**：根据用户流程生成 Playwright 脚本\n3. **重点覆盖边界情况**：空数组、异常数据、网络失败等\n\n### 实战：单元测试生成\n\n创建脚本 `scripts/generate-tests.js`：\n\n```javascript\n#!/usr/bin/env node\nimport Anthropic from '@anthropic-ai/sdk';\nimport fs from 'fs';\nimport path from 'path';\n\nconst client = new Anthropic({\n  apiKey: process.env.ANTHROPIC_API_KEY\n});\n\nconst TEST_GENERATION_PROMPT = `你是一个测试工程师，擅长编写高质量的前端测试。\n\n请为以下代码生成完整的测试用例，使用 Jest + React Testing Library。\n\n**要求：**\n1. 覆盖所有主要功能路径\n2. 包含边界情况：空数组、null、undefined、错误数据\n3. 测试用户交互：点击、输入、提交\n4. 测试异步逻辑：API 调用成功和失败的情况\n5. 测试可访问性：aria 属性、键盘导航\n6. 使用语义化查询（getByRole > getByTestId）\n\n**输出格式：**\n- 完整可运行的测试文件\n- 包含必要的 import\n- 每个测试用例有清晰的描述\n- 使用 describe 分组组织测试\n\n现在请为以下代码生成测试：`;\n\nasync function generateTestForFile(filePath) {\n  const sourceCode = fs.readFileSync(filePath, 'utf-8');\n  const fileName = path.basename(filePath, path.extname(filePath));\n\n  console.log(`🤖 正在为 ${fileName} 生成测试...\\n`);\n\n  try {\n    const message = await client.messages.create({\n      model: 'claude-sonnet-4-5',\n      max_tokens: 8192,\n      messages: [{\n        role: 'user',\n        content: `${TEST_GENERATION_PROMPT}\\n\\n\\`\\`\\`jsx\\n${sourceCode}\\n\\`\\`\\``\n      }]\n    });\n\n    const testCode = message.content[0].text\n      .replace(/^```[a-z]*\\n/, '')\n      .replace(/\\n```$/, '');\n\n    // 确定输出路径\n    const testFilePath = filePath.replace(/\\.(jsx?|tsx?)$/, '.test.$1');\n    \n    fs.writeFileSync(testFilePath, testCode);\n    console.log(`✅ 测试已生成: ${testFilePath}\\n`);\n\n    return testFilePath;\n\n  } catch (error) {\n    console.error(`❌ 生成失败: ${error.message}`);\n    throw error;\n  }\n}\n\n// 示例：为指定文件生成测试\nconst targetFile = process.argv[2];\nif (!targetFile) {\n  console.error('用法: node generate-tests.js <文件路径>');\n  process.exit(1);\n}\n\ngenerateTestForFile(targetFile);\n```\n\n### 真实示例：AI 生成的测试\n\n我有一个 `UserProfile.jsx` 组件：\n\n```jsx\nimport { useState, useEffect } from 'react';\n\nexport function UserProfile({ userId }) {\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  useEffect(() => {\n    async function fetchUser() {\n      try {\n        setLoading(true);\n        const res = await fetch(`/api/users/${userId}`);\n        if (!res.ok) throw new Error('加载失败');\n        const data = await res.json();\n        setUser(data);\n      } catch (err) {\n        setError(err.message);\n      } finally {\n        setLoading(false);\n      }\n    }\n    fetchUser();\n  }, [userId]);\n\n  if (loading) return <div role=\"status\">加载中...</div>;\n  if (error) return <div role=\"alert\">{error}</div>;\n  if (!user) return null;\n\n  return (\n    <div>\n      <h2>{user.name}</h2>\n      <p>{user.email}</p>\n    </div>\n  );\n}\n```\n\n运行 `node scripts/generate-tests.js src/components/UserProfile.jsx`，AI 生成的测试：\n\n```javascript\nimport { render, screen, waitFor } from '@testing-library/react';\nimport { UserProfile } from './UserProfile';\n\n// Mock fetch\nglobal.fetch = jest.fn();\n\ndescribe('UserProfile', () => {\n  beforeEach(() => {\n    fetch.mockClear();\n  });\n\n  describe('加载状态', () => {\n    test('初始渲染时显示加载提示', () => {\n      fetch.mockImplementation(() => new Promise(() => {})); // 永不 resolve\n      render(<UserProfile userId=\"123\" />);\n      \n      expect(screen.getByRole('status')).toHaveTextContent('加载中...');\n    });\n  });\n\n  describe('成功场景', () => {\n    test('成功获取用户数据后显示用户信息', async () => {\n      const mockUser = {\n        id: '123',\n        name: '张三',\n        email: 'zhang@example.com'\n      };\n\n      fetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => mockUser\n      });\n\n      render(<UserProfile userId=\"123\" />);\n\n      await waitFor(() => {\n        expect(screen.getByText('张三')).toBeInTheDocument();\n      });\n\n      expect(screen.getByText('zhang@example.com')).toBeInTheDocument();\n      expect(fetch).toHaveBeenCalledWith('/api/users/123');\n    });\n  });\n\n  describe('错误处理', () => {\n    test('API 返回错误时显示错误信息', async () => {\n      fetch.mockResolvedValueOnce({\n        ok: false\n      });\n\n      render(<UserProfile userId=\"123\" />);\n\n      await waitFor(() => {\n        expect(screen.getByRole('alert')).toHaveTextContent('加载失败');\n      });\n    });\n\n    test('网络请求失败时显示错误信息', async () => {\n      fetch.mockRejectedValueOnce(new Error('网络错误'));\n\n      render(<UserProfile userId=\"456\" />);\n\n      await waitFor(() => {\n        expect(screen.getByRole('alert')).toHaveTextContent('网络错误');\n      });\n    });\n  });\n\n  describe('边界情况', () => {\n    test('用户数据为 null 时不渲染任何内容', async () => {\n      fetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => null\n      });\n\n      const { container } = render(<UserProfile userId=\"789\" />);\n\n      await waitFor(() => {\n        expect(container.firstChild).toBeNull();\n      });\n    });\n\n    test('userId 变化时重新获取数据', async () => {\n      fetch.mockResolvedValue({\n        ok: true,\n        json: async () => ({ id: '1', name: 'User 1', email: 'user1@example.com' })\n      });\n\n      const { rerender } = render(<UserProfile userId=\"1\" />);\n      \n      await waitFor(() => {\n        expect(screen.getByText('User 1')).toBeInTheDocument();\n      });\n\n      fetch.mockResolvedValueOnce({\n        ok: true,\n        json: async () => ({ id: '2', name: 'User 2', email: 'user2@example.com' })\n      });\n\n      rerender(<UserProfile userId=\"2\" />);\n\n      await waitFor(() => {\n        expect(screen.getByText('User 2')).toBeInTheDocument();\n      });\n\n      expect(fetch).toHaveBeenCalledTimes(2);\n    });\n  });\n\n  describe('可访问性', () => {\n    test('加载状态使用正确的 ARIA role', () => {\n      fetch.mockImplementation(() => new Promise(() => {}));\n      render(<UserProfile userId=\"123\" />);\n      \n      expect(screen.getByRole('status')).toBeInTheDocument();\n    });\n\n    test('错误信息使用正确的 ARIA role', async () => {\n      fetch.mockRejectedValueOnce(new Error('测试错误'));\n      render(<UserProfile userId=\"123\" />);\n\n      await waitFor(() => {\n        expect(screen.getByRole('alert')).toBeInTheDocument();\n      });\n    });\n  });\n});\n```\n\n**注意 AI 做了什么：**\n\n1. ✅ 覆盖了加载、成功、错误、边界四种场景\n2. ✅ 测试了 `userId` 变化时的重新获取逻辑（这个我自己写可能会漏）\n3. ✅ 检查了可访问性（role=\"status\" 和 role=\"alert\"）\n4. ✅ 所有测试用例都有清晰的描述\n5. ✅ 使用了语义化查询（getByRole > getByText）\n\n这个测试我自己写至少要 30 分钟，AI 生成只要 10 秒，Token 成本 ￥0.15。\n\n### E2E 测试生成\n\n对于端到端测试，我用类似的思路生成 Playwright 脚本：\n\n```javascript\n// scripts/generate-e2e.js\nconst E2E_PROMPT = `生成 Playwright E2E 测试，覆盖以下用户流程：\n\n1. 完整的用户旅程（从进入页面到完成目标）\n2. 表单验证（正常输入 + 错误输入）\n3. 异步操作（等待加载、错误重试）\n4. 边界情况（网络错误、超时）\n5. 可访问性（键盘导航、屏幕阅读器兼容）\n\n使用 Playwright 的最佳实践：\n- 使用 getByRole、getByLabel 等语义化定位器\n- 等待元素而非固定延时\n- 截图和视频用于调试\n\n请为以下场景生成测试：`;\n\n// 使用示例\nconst scenario = `\n用户登录流程：\n1. 访问登录页\n2. 输入用户名和密码\n3. 点击登录按钮\n4. 验证跳转到首页\n5. 验证用户信息显示正确\n`;\n\n// AI 生成的 E2E 测试（示例）\n```\n\n生成的测试示例：\n\n```javascript\nimport { test, expect } from '@playwright/test';\n\ntest.describe('用户登录流程', () => {\n  test('成功登录并跳转到首页', async ({ page }) => {\n    await page.goto('/login');\n\n    // 填写表单\n    await page.getByLabel('用户名').fill('testuser');\n    await page.getByLabel('密码').fill('password123');\n\n    // 提交\n    await page.getByRole('button', { name: '登录' }).click();\n\n    // 等待跳转\n    await expect(page).toHaveURL('/dashboard');\n\n    // 验证用户信息\n    await expect(page.getByText('欢迎, testuser')).toBeVisible();\n  });\n\n  test('用户名为空时显示错误', async ({ page }) => {\n    await page.goto('/login');\n\n    await page.getByLabel('密码').fill('password123');\n    await page.getByRole('button', { name: '登录' }).click();\n\n    await expect(page.getByText('请输入用户名')).toBeVisible();\n    await expect(page).toHaveURL('/login'); // 未跳转\n  });\n\n  test('密码错误时显示提示', async ({ page }) => {\n    await page.goto('/login');\n\n    await page.getByLabel('用户名').fill('testuser');\n    await page.getByLabel('密码').fill('wrongpassword');\n    await page.getByRole('button', { name: '登录' }).click();\n\n    await expect(page.getByRole('alert')).toHaveText('用户名或密码错误');\n  });\n\n  test('网络错误时显示友好提示', async ({ page }) => {\n    // 模拟网络错误\n    await page.route('/api/auth/login', route => route.abort());\n\n    await page.goto('/login');\n    await page.getByLabel('用户名').fill('testuser');\n    await page.getByLabel('密码').fill('password123');\n    await page.getByRole('button', { name: '登录' }).click();\n\n    await expect(page.getByText('网络错误，请稍后重试')).toBeVisible();\n  });\n});\n```\n\n## 三、效果对比：数据说话\n\n我在一个中型项目（15k 行代码，30+ 组件）上用了一个月 AI 代码审查 + 测试生成，数据如下：\n\n### 测试覆盖率提升\n\n| 指标 | 使用前 | 使用后 | 提升 |\n|------|--------|--------|------|\n| 单元测试覆盖率 | 32% | 78% | +144% |\n| E2E 测试场景数 | 5 | 23 | +360% |\n| 发现的边界 case bug | - | 17 个 | - |\n\n### 成本分析\n\n**人工成本：**\n- 代码审查：平均每个 PR 20 分钟 × 高级工程师时薪 ￥300/h = ￥100/PR\n- 写测试：平均每个组件 40 分钟 × ￥300/h = ￥200/组件\n\n**AI 成本：**\n- 代码审查：平均 3k tokens 输入 + 1.5k tokens 输出 = ￥0.08/PR (Claude Sonnet 4.5)\n- 测试生成：平均 2k tokens 输入 + 4k tokens 输出 = ￥0.12/组件\n\n**一个月数据（50 个 PR，30 个组件）：**\n- 人工成本：￥5000 (审查) + ￥6000 (测试) = ￥11000\n- AI 成本：￥4 (审查) + ￥3.6 (测试) = ￥7.6\n- **成本降低：99.93%**\n\n时间节省：\n- 代码审查：从 20 分钟降到 2 分钟查看报告 = 节省 90%\n- 测试编写：从 40 分钟降到 5 分钟微调 AI 生成的测试 = 节省 87.5%\n\n### 质量提升\n\nAI 发现的问题类型分布：\n\n- 可访问性问题：47%（这个人工审查几乎不查）\n- 边界情况处理：28%\n- 性能优化建议：15%\n- 安全隐患：10%\n\n最有价值的发现：一个组件在处理大数组（10k+ 项）时会卡死，AI 建议加虚拟滚动，修复后性能提升 95%。\n\n## 四、注意事项\n\n### 1. AI 不是银弹\n\n- **误报率**：约 5%-10%，需要人工判断\n- **上下文限制**：无法理解业务逻辑，只能检查技术层面\n- **降级策略**：AI 服务挂了不能阻断开发流程\n\n### 2. Prompt 很重要\n\n我的 Prompt 迭代了 5 个版本才稳定。关键点：\n\n- ✅ 明确输出格式（Markdown、JSON）\n- ✅ 提供具体的检查项（别说\"检查代码质量\"）\n- ✅ 给出示例（few-shot learning）\n- ✅ 设置边界（什么情况下 LGTM，什么情况下阻断）\n\n### 3. 人机协作\n\n最佳实践：\n\n- AI 做第一轮全面扫描\n- 人工审查 AI 标记的 Critical Issues\n- 对于复杂逻辑，还是需要资深工程师深度 Review\n\n## 五、下一步：成本优化和团队协作\n\nAI 代码审查和测试生成已经证明了价值，但还有两个问题需要解决：\n\n1. **成本优化**：虽然单次成本低，但频繁调用还是会累积。能不能用更便宜的模型？\n2. **团队协作**：如何让整个团队用上这套工具？如何统一标准？\n\n下一篇文章我们会深入讨论：\n\n- **成本降低 80% 的 Prompt 缓存技巧**\n- **多模型组合策略**（简单检查用快速模型，复杂逻辑用强模型）\n- **团队级 AI Agent 工作流**（从个人工具到团队基础设施）\n\n敬请期待。\n\n---\n\n**相关资源：**\n\n- 完整代码示例：[GitHub Repo](https://github.com/yourusername/ai-agent-frontend-workflow)\n- AI 代码审查 Prompt 库：[链接]\n- 测试生成最佳实践：[链接]\n\n有问题欢迎在评论区讨论，或者在 [Twitter](https://twitter.com/yourhandle) 上找我。","src/data/blog/ai-agent-frontend-workflow-part2.md","a3a304ea4c9dfa79",{html:2025,metadata:2026},"<h2 id=\"回顾从组件生成到质量保障\">回顾：从组件生成到质量保障</h2>\n<p><a href=\"/blog/ai-agent-frontend-workflow-part1\">上一篇文章</a>我们聊了用 AI Agent 生成 React 组件，从产品需求到可运行代码，效率提升了 3-5 倍。但是，代码能跑和代码质量高是两回事。</p>\n<p>生产环境的代码需要经过严格的审查和测试。传统上，这两个环节都是人力密集型工作：</p>\n<ul>\n<li><strong>Code Review</strong>：高级工程师花大量时间审查初级工程师的代码，但很难做到全面、一致</li>\n<li><strong>写测试</strong>：测试覆盖率常年在 30%-50% 徘徊，大家都知道应该写，但总是”等下次有时间再补”</li>\n</ul>\n<p>这篇文章我们要解决的问题是：<strong>AI Agent 能不能承担这些质量保障工作？</strong></p>\n<p>答案是：能，而且效果超预期。</p>\n<h2 id=\"一ai-驱动的代码审查\">一、AI 驱动的代码审查</h2>\n<h3 id=\"传统-code-review-的三大困境\">传统 Code Review 的三大困境</h3>\n<p>让我们诚实一点：</p>\n<ol>\n<li><strong>精力有限</strong>：资深工程师审 10 个 PR 后就会疲劳，后面的 PR 质量难保证</li>\n<li><strong>标准不一</strong>：同一个问题，周一可能被指出，周五可能就被放过了</li>\n<li><strong>覆盖不全</strong>：人很难在审查时同时关注性能、安全、可访问性、最佳实践……太多维度了</li>\n</ol>\n<p>结果就是：要么 Review 成本高昂（每个 PR 30 分钟+），要么流于形式（点个 LGTM 了事）。</p>\n<h3 id=\"ai-agent-的优势\">AI Agent 的优势</h3>\n<p>AI 不会累，不会情绪化，而且可以同时检查几十个维度。更重要的是：<strong>它 24/7 在线，成本可控</strong>。</p>\n<p>但关键是怎么集成到工作流里。我的方案是：<strong>Git Hook + AI API</strong>。</p>\n<h3 id=\"实战集成到-git-hook\">实战：集成到 Git Hook</h3>\n<p>我们用 Husky 在 <code>pre-commit</code> 阶段触发 AI 代码审查。完整实现如下：</p>\n<h4 id=\"1-安装依赖\">1. 安装依赖</h4>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">npm</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> install</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#82AAFF\"> -D</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> husky</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> lint-staged</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">npx</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> husky</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> install</span></span></code></pre>\n<h4 id=\"2-创建审查脚本\">2. 创建审查脚本</h4>\n<p>在 <code>scripts/ai-code-review.js</code>：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"javascript\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">#!/usr/bin/env node</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { execSync } </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">child_process</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> Anthropic </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">@anthropic-ai/sdk</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> fs </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">fs</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> path </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">path</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> client</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> new</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> Anthropic</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  apiKey</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> process</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic\">env</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">ANTHROPIC_API_KEY</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">}</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 获取暂存区的文件变更</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> getStagedDiff</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">()</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  try</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> execSync</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">git diff --cached</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { encoding</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">utf-8</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> });</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  } </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">catch</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">error</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">    console</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">error</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">无法获取 git diff:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> error</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">message</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> ''</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// AI 审查 Prompt（这是关键）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> REVIEW_PROMPT</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\"> `</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">你是一个资深前端工程师，负责代码审查。请审查以下 git diff，关注：</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">**性能问题：**</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">- 不必要的重渲染（缺少 useMemo、useCallback）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">- 大数组操作没有做虚拟化</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">- 图片/资源未优化</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">- 阻塞主线程的同步操作</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">**安全隐患：**</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">- XSS 风险（dangerouslySetInnerHTML 未做转义）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">- CSRF 防护缺失</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">- 敏感信息泄露（API key、token 硬编码）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">- eval() 或 Function() 构造器的使用</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">**最佳实践：**</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">- 组件职责是否单一</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">- props 类型检查（TypeScript / PropTypes）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">- 错误边界处理</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">- 可访问性（aria 属性、语义化标签）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">- 命名规范和代码风格</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">**边界情况：**</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">- 空数组、null、undefined 的处理</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">- 异步操作的错误处理</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">- 网络请求失败的降级方案</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">请按以下格式输出：</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">## 🚨 Critical Issues（阻断性问题）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">- [文件名:行号] 问题描述 + 修复建议</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">## ⚠️ Warnings（需要关注）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">- [文件名:行号] 问题描述 + 优化建议</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">## ✅ Good Practices（做得好的地方）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">- 简要列出亮点</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">## 📊 Summary</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">- 总体评分（1-10）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">- 是否建议合并</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">如果没有发现任何问题，输出 \"✅ LGTM - 代码质量良好，建议合并\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">async</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> function</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> reviewCode</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">diff</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">!</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">diff</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ||</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> diff</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">trim</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#7FDBCA\">length</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> ===</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 0</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">    console</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">log</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">✅ 没有代码变更需要审查</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { shouldBlock</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\"> false</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> report</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> ''</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> };</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">  console</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">log</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">🤖 AI 正在审查代码...</span><span style=\"--shiki-light:#22863A;--shiki-dark:#F78C6C\">\\n</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  try</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> message</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> await</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> client</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic\">messages</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">create</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">      model</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">claude-sonnet-4-5</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">      max_tokens</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 4096</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">      messages</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">        role</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">user</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">        content</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\"> `</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">${</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">REVIEW_PROMPT</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">}</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#F78C6C;--shiki-dark-font-style:italic\">\\n\\n</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">## Git Diff:</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#F78C6C;--shiki-dark-font-style:italic\">\\n\\`\\`\\`</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">diff</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#F78C6C;--shiki-dark-font-style:italic\">\\n</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">${</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">diff</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">}</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#F78C6C;--shiki-dark-font-style:italic\">\\n\\`\\`\\`</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      }]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">    }</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> report</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> message</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic\">content</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">0</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic\">text</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 保存审查报告</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> reportPath</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> path</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">join</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">process</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">cwd</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">.ai-review-report.md</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">    fs</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">writeFileSync</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">reportPath</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> report</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">    console</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">log</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">report</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">    console</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">log</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#22863A;--shiki-dark:#F78C6C\">\\n</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">📄 完整报告已保存到: </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">${</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">reportPath</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">}</span><span style=\"--shiki-light:#22863A;--shiki-dark:#F78C6C\">\\n</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 判断是否有阻断性问题</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> hasCriticalIssues</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> report</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">includes</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">## 🚨 Critical Issues</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">      &#x26;&#x26;</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> !</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">report</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">match</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#22863A;--shiki-dark:#5CA7E4\">## 🚨 Critical Issues</span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">\\s</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">*</span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">\\n\\s</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">*</span><span style=\"--shiki-light:#22863A;--shiki-dark:#5CA7E4\">无</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      shouldBlock</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> hasCriticalIssues</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">      report</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    };</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  } </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">catch</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">error</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">    console</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">error</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">❌ AI 审查失败:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> error</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">message</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 降级策略：AI 失败不阻断提交</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">    console</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">log</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">⚠️  AI 服务不可用，跳过审查（降级模式）</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { shouldBlock</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\"> false</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> report</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> ''</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> };</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">async</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> function</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> main</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">()</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> diff</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> getStagedDiff</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  const</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> shouldBlock</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> report</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> }</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> await</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> reviewCode</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">diff</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">shouldBlock</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">    console</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">error</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#F78C6C\">\\n</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">❌ 发现阻断性问题，请修复后再提交</span><span style=\"--shiki-light:#22863A;--shiki-dark:#F78C6C\">\\n</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">    process</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">exit</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  } </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">else</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">    console</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">log</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#F78C6C\">\\n</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">✅ 代码审查通过</span><span style=\"--shiki-light:#22863A;--shiki-dark:#F78C6C\">\\n</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">    process</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">exit</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">0</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">main</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();</span></span></code></pre>\n<h4 id=\"3-配置-husky-hook\">3. 配置 Husky Hook</h4>\n<p>在 <code>.husky/pre-commit</code>：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">#!/bin/sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">$(</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">dirname</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> \"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D7DBE0\">$0</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">)/_/husky.sh</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 运行 AI 代码审查</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">node</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> scripts/ai-code-review.js</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># 如果审查通过，继续执行 lint-staged</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">npx</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\"> lint-staged</span></span></code></pre>\n<h4 id=\"4-配置环境变量\">4. 配置环境变量</h4>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\"># .env</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C5E478\">ANTHROPIC_API_KEY</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#2B5581;--shiki-dark:#ECC48D\">your_api_key_here</span></span></code></pre>\n<h3 id=\"真实案例ai-发现的问题\">真实案例：AI 发现的问题</h3>\n<p>上周我提交了一个表单组件，AI 审查发现了一个我完全没注意到的问题：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"jsx\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 我的原始代码</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">function</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> SearchInput</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">{ </span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">onSearch</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> }</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  const</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> [</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">query</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> setQuery</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">]</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> useState</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">''</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  const</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> handleSubmit</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D7DBE0;--shiki-dark-font-style:italic\">e</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">    e</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">preventDefault</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">()</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">    onSearch</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">query</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">  }</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">    &#x3C;</span><span style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">form</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\"> onSubmit</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D3423E\">{</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">handleSubmit</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D3423E\">}</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">      &#x3C;</span><span style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">input</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">        value</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D3423E\">{</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">query</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D3423E\">}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">        onChange</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D3423E\">{</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">e</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> setQuery</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">e</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic\">target</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">value</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D3423E\">}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\">        placeholder</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">搜索...</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">      /></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">      &#x3C;</span><span style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">button</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\"> type</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">submit</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">搜索</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">&#x3C;/</span><span style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">button</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">    &#x3C;/</span><span style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">form</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  );</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span></code></pre>\n<p><strong>AI 的审查报告：</strong></p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"markdown\"><code><span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#82B1FF;--shiki-dark-font-weight:inherit\">## ⚠️ Warnings</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">-</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">SearchInput.jsx:7</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">] </span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#C5E478;--shiki-dark-font-weight:inherit\">**</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#C5E478;--shiki-dark-font-weight:bold\">可访问性问题</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#C5E478;--shiki-dark-font-weight:inherit\">**</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">：input 缺少 label 或 aria-label，</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  屏幕阅读器用户无法理解这个输入框的用途。</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  建议修复：</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  &#x3C;label htmlFor=\"search-input\" className=\"sr-only\">搜索&#x3C;/label></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  &#x3C;input </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    id=\"search-input\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    aria-label=\"搜索内容\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    ...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  /></span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">-</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">SearchInput.jsx:12</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">] </span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#C5E478;--shiki-dark-font-weight:inherit\">**</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#C5E478;--shiki-dark-font-weight:bold\">用户体验</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#C5E478;--shiki-dark-font-weight:inherit\">**</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">：提交空字符串会触发无意义的搜索。</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  建议在 handleSubmit 中添加校验：</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  if (query.trim().length === 0) return;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#82B1FF;--shiki-dark-font-weight:inherit\">## 📊 Summary</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">-</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> 总体评分：7/10</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">-</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> 功能正常，但可访问性和边界情况处理需要改进</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">-</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> 建议修复后合并</span></span></code></pre>\n<p>这是一个典型的”功能能跑，但不够专业”的例子。人工审查很可能会漏掉可访问性问题，但 AI 每次都会检查。</p>\n<h2 id=\"二自动化测试用例生成\">二、自动化测试用例生成</h2>\n<h3 id=\"为什么测试覆盖率总是上不去\">为什么测试覆盖率总是上不去？</h3>\n<p>老实说：<strong>写测试太枯燥了</strong>。</p>\n<p>你写完一个复杂组件，兴奋地想看效果，结果还要花同样的时间写一堆重复的测试用例。最后就变成了：</p>\n<ul>\n<li>核心逻辑有测试（因为有人盯着）</li>\n<li>边界情况？等有时间再说</li>\n<li>UI 组件？手动点一下就行了</li>\n<li>E2E 测试？那是 QA 的事</li>\n</ul>\n<p>结果就是测试覆盖率 30%，然后生产环境各种边界 case 爆炸。</p>\n<h3 id=\"ai-生成测试的思路\">AI 生成测试的思路</h3>\n<p>AI 看代码比我们快，而且它知道所有的测试模式。我的做法是：</p>\n<ol>\n<li><strong>单元测试</strong>：根据组件/函数生成 Jest + React Testing Library 测试</li>\n<li><strong>E2E 测试</strong>：根据用户流程生成 Playwright 脚本</li>\n<li><strong>重点覆盖边界情况</strong>：空数组、异常数据、网络失败等</li>\n</ol>\n<h3 id=\"实战单元测试生成\">实战：单元测试生成</h3>\n<p>创建脚本 <code>scripts/generate-tests.js</code>：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"javascript\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">#!/usr/bin/env node</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> Anthropic </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">@anthropic-ai/sdk</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> fs </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">fs</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> path </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">path</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> client</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> new</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> Anthropic</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  apiKey</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> process</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic\">env</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">ANTHROPIC_API_KEY</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">}</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> TEST_GENERATION_PROMPT</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\"> `</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">你是一个测试工程师，擅长编写高质量的前端测试。</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">请为以下代码生成完整的测试用例，使用 Jest + React Testing Library。</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">**要求：**</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">1. 覆盖所有主要功能路径</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">2. 包含边界情况：空数组、null、undefined、错误数据</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">3. 测试用户交互：点击、输入、提交</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">4. 测试异步逻辑：API 调用成功和失败的情况</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">5. 测试可访问性：aria 属性、键盘导航</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">6. 使用语义化查询（getByRole > getByTestId）</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">**输出格式：**</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">- 完整可运行的测试文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">- 包含必要的 import</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">- 每个测试用例有清晰的描述</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">- 使用 describe 分组组织测试</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">现在请为以下代码生成测试：</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">async</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> function</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> generateTestForFile</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">filePath</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> sourceCode</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> fs</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">readFileSync</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">filePath</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">utf-8</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> fileName</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> path</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">basename</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">filePath</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> path</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">extname</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">filePath</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">));</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">  console</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">log</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">🤖 正在为 </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">${</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">fileName</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">}</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\"> 生成测试...</span><span style=\"--shiki-light:#22863A;--shiki-dark:#F78C6C\">\\n</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  try</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> message</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> await</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> client</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FAF39F;--shiki-dark-font-style:italic\">messages</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">create</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">      model</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">claude-sonnet-4-5</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">      max_tokens</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\"> 8192</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">      messages</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">        role</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">user</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#D6DEEB;--shiki-dark-font-style:italic\">        content</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\"> `</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">${</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">TEST_GENERATION_PROMPT</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">}</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#F78C6C;--shiki-dark-font-style:italic\">\\n\\n\\`\\`\\`</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">jsx</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#F78C6C;--shiki-dark-font-style:italic\">\\n</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">${</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">sourceCode</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">}</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#F78C6C;--shiki-dark-font-style:italic\">\\n\\`\\`\\`</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      }]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">    }</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> testCode</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> message</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic\">content</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">0</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic\">text</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">      .</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">replace</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">^</span><span style=\"--shiki-light:#22863A;--shiki-dark:#5CA7E4\">```</span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">[a-z]</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">*</span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">\\n</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> ''</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">      .</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">replace</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#22863A;--shiki-dark:#82AAFF\">\\n</span><span style=\"--shiki-light:#22863A;--shiki-dark:#5CA7E4\">```</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">$</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> ''</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 确定输出路径</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">    const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> testFilePath</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> filePath</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">replace</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#F78C6C;--shiki-dark-font-style:italic\">\\.</span><span style=\"--shiki-light:#22863A;--shiki-dark:#5CA7E4\">(</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#5CA7E4;--shiki-dark-font-style:italic\">jsx</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">?|</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#5CA7E4;--shiki-dark-font-style:italic\">tsx</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">?</span><span style=\"--shiki-light:#22863A;--shiki-dark:#5CA7E4\">)</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">$</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">/</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">.test.$1</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">    fs</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">writeFileSync</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">testFilePath</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> testCode</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">    console</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">log</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">✅ 测试已生成: </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">${</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">testFilePath</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">}</span><span style=\"--shiki-light:#22863A;--shiki-dark:#F78C6C\">\\n</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> testFilePath</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  } </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">catch</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">error</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">    console</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">error</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">❌ 生成失败: </span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">${</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">error</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">message</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">}</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    throw</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> error</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 示例：为指定文件生成测试</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> targetFile</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> process</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#BAEBE2;--shiki-dark-font-style:italic\">argv</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">[</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">2</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">];</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">!</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">targetFile</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">  console</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">error</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">用法: node generate-tests.js &#x3C;文件路径></span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">  process</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">exit</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">1</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">generateTestForFile</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">targetFile</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span></code></pre>\n<h3 id=\"真实示例ai-生成的测试\">真实示例：AI 生成的测试</h3>\n<p>我有一个 <code>UserProfile.jsx</code> 组件：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"jsx\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { useState</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> useEffect } </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">react</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">export</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> function</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> UserProfile</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">{ </span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">userId</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> }</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  const</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> [</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">user</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> setUser</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">]</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> useState</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FF5874;--shiki-dark-font-style:italic\">null</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  const</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> [</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">loading</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> setLoading</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">]</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> useState</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FF5874;--shiki-dark-font-style:italic\">true</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  const</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> [</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">error</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> setError</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">]</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> useState</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#FF5874;--shiki-dark-font-style:italic\">null</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">  useEffect</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">()</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    async</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> function</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> fetchUser</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">()</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">      try</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">        setLoading</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\">true</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">        const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> res</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> await</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> fetch</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">/api/users/</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">${</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">userId</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D3423E\">}</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">        if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">!</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">res</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">ok</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">throw</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> new</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> Error</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">加载失败</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">        const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> data</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> await</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> res</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">json</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">        setUser</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">data</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      } </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">catch</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">err</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">        setError</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">err</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">message</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      } </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">finally</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">        setLoading</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\">false</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">    fetchUser</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  }</span><span style=\"--shiki-light:#212121;--shiki-dark:#5F7E97\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> [</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">userId</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">]);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">loading</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> &#x3C;</span><span style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">div</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\"> role</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">status</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">加载中...</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">&#x3C;/</span><span style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">div</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">error</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> &#x3C;</span><span style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">div</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\"> role</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">alert</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D3423E\">{</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">error</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D3423E\">}</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">&#x3C;/</span><span style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">div</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">  if</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">!</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">user</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">) </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">return</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\"> null</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">  return</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> (</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">    &#x3C;</span><span style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">div</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">      &#x3C;</span><span style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">h2</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D3423E\">{</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">user</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">name</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D3423E\">}</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">&#x3C;/</span><span style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">h2</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">      &#x3C;</span><span style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">p</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D3423E\">{</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">user</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">email</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D3423E\">}</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">&#x3C;/</span><span style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">p</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">    &#x3C;/</span><span style=\"--shiki-light:#22863A;--shiki-dark:#CAECE6\">div</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  );</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">}</span></span></code></pre>\n<p>运行 <code>node scripts/generate-tests.js src/components/UserProfile.jsx</code>，AI 生成的测试：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"javascript\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { render</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> screen</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> waitFor } </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">@testing-library/react</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { UserProfile } </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">./UserProfile</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// Mock fetch</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">global</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">fetch</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> jest</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">fn</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">describe</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">UserProfile</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> ()</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">  beforeEach</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">()</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">    fetch</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">mockClear</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  });</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">  describe</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">加载状态</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> ()</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">    test</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">初始渲染时显示加载提示</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> ()</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">      fetch</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">mockImplementation</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">()</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> new</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> Promise</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">()</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {})); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 永不 resolve</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">      render</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">&#x3C;</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">UserProfile</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\"> userId</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">123</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> /></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">      expect</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">screen</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">getByRole</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">status</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">))</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">toHaveTextContent</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">加载中...</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    });</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  });</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">  describe</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">成功场景</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> ()</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">    test</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">成功获取用户数据后显示用户信息</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> async</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> ()</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">      const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> mockUser</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        id</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">123</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        name</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">张三</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#C792EA\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">        email</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">zhang@example.com</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\">      }</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">      fetch</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">mockResolvedValueOnce</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">({</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        ok</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\"> true</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">        json</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> async</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> ()</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> mockUser</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      });</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">      render</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">&#x3C;</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">UserProfile</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\"> userId</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">123</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> /></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">      await</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> waitFor</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">()</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">        expect</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">screen</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">getByText</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">张三</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">))</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">toBeInTheDocument</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      });</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">      expect</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">screen</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">getByText</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">zhang@example.com</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">))</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">toBeInTheDocument</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">      expect</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">fetch</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">toHaveBeenCalledWith</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">/api/users/123</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    });</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  });</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">  describe</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">错误处理</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> ()</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">    test</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">API 返回错误时显示错误信息</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> async</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> ()</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">      fetch</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">mockResolvedValueOnce</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">({</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        ok</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\"> false</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      });</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">      render</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">&#x3C;</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">UserProfile</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\"> userId</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">123</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> /></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">      await</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> waitFor</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">()</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">        expect</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">screen</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">getByRole</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">alert</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">))</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">toHaveTextContent</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">加载失败</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      });</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    });</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">    test</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">网络请求失败时显示错误信息</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> async</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> ()</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">      fetch</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">mockRejectedValueOnce</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">new</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> Error</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">网络错误</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">));</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">      render</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">&#x3C;</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">UserProfile</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\"> userId</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">456</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> /></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">      await</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> waitFor</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">()</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">        expect</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">screen</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">getByRole</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">alert</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">))</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">toHaveTextContent</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">网络错误</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      });</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    });</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  });</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">  describe</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">边界情况</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> ()</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">    test</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">用户数据为 null 时不渲染任何内容</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> async</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> ()</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">      fetch</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">mockResolvedValueOnce</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">({</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        ok</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\"> true</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">        json</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> async</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> ()</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\"> null</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      });</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">      const</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> container</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> }</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> render</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">&#x3C;</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">UserProfile</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\"> userId</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">789</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> /></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">      await</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> waitFor</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">()</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">        expect</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">container</span><span style=\"--shiki-light:#24292EFF;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#BAEBE2\">firstChild</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">toBeNull</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      });</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    });</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">    test</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">userId 变化时重新获取数据</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> async</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> ()</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">      fetch</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">mockResolvedValue</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">({</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        ok</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\"> true</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">        json</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> async</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> ()</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> ({ id</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">1</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> name</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">User 1</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> email</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">user1@example.com</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> })</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      });</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">      const</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> {</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> rerender</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#C792EA\"> }</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> render</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">&#x3C;</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">UserProfile</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\"> userId</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">1</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> /></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">      await</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> waitFor</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">()</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">        expect</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">screen</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">getByText</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">User 1</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">))</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">toBeInTheDocument</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      });</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">      fetch</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">mockResolvedValueOnce</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">({</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">        ok</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#FF5874\"> true</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">        json</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> async</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> ()</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> ({ id</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">2</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> name</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">User 2</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> email</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">user2@example.com</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> })</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      });</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">      rerender</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">&#x3C;</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">UserProfile</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\"> userId</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">2</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> /></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">      await</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> waitFor</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">()</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">        expect</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">screen</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">getByText</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">User 2</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">))</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">toBeInTheDocument</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      });</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">      expect</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">fetch</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">toHaveBeenCalledTimes</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">2</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    });</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  });</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">  describe</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">可访问性</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> ()</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">    test</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">加载状态使用正确的 ARIA role</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> ()</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">      fetch</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">mockImplementation</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">()</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\"> new</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#C5E478\"> Promise</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">()</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {}));</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">      render</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">&#x3C;</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">UserProfile</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\"> userId</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">123</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> /></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">      expect</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">screen</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">getByRole</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">status</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">))</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">toBeInTheDocument</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    });</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">    test</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">错误信息使用正确的 ARIA role</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> async</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> ()</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">      fetch</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">mockRejectedValueOnce</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#7FDBCA\">new</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> Error</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">测试错误</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">));</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">      render</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\">&#x3C;</span><span style=\"--shiki-light:#1976D2;--shiki-dark:#F78C6C\">UserProfile</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C5E478;--shiki-dark-font-style:italic\"> userId</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">=</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">123</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">\"</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#7FDBCA\"> /></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">      await</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> waitFor</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">()</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">        expect</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">screen</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">getByRole</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">alert</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">))</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">toBeInTheDocument</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">      });</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">    });</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  });</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">});</span></span></code></pre>\n<p><strong>注意 AI 做了什么：</strong></p>\n<ol>\n<li>✅ 覆盖了加载、成功、错误、边界四种场景</li>\n<li>✅ 测试了 <code>userId</code> 变化时的重新获取逻辑（这个我自己写可能会漏）</li>\n<li>✅ 检查了可访问性（role=“status” 和 role=“alert”）</li>\n<li>✅ 所有测试用例都有清晰的描述</li>\n<li>✅ 使用了语义化查询（getByRole > getByText）</li>\n</ol>\n<p>这个测试我自己写至少要 30 分钟，AI 生成只要 10 秒，Token 成本 ￥0.15。</p>\n<h3 id=\"e2e-测试生成\">E2E 测试生成</h3>\n<p>对于端到端测试，我用类似的思路生成 Playwright 脚本：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"javascript\"><code><span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// scripts/generate-e2e.js</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> E2E_PROMPT</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\"> `</span><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">生成 Playwright E2E 测试，覆盖以下用户流程：</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">1. 完整的用户旅程（从进入页面到完成目标）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">2. 表单验证（正常输入 + 错误输入）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">3. 异步操作（等待加载、错误重试）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">4. 边界情况（网络错误、超时）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">5. 可访问性（键盘导航、屏幕阅读器兼容）</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">使用 Playwright 的最佳实践：</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">- 使用 getByRole、getByLabel 等语义化定位器</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">- 等待元素而非固定延时</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">- 截图和视频用于调试</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">请为以下场景生成测试：</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 使用示例</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\">const</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> scenario</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\"> `</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">用户登录流程：</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">1. 访问登录页</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">2. 输入用户名和密码</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">3. 点击登录按钮</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">4. 验证跳转到首页</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-light-font-style:inherit;--shiki-dark:#ECC48D;--shiki-dark-font-style:italic\">5. 验证用户信息显示正确</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#22863A;--shiki-dark:#D6DEEB\">`</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// AI 生成的 E2E 测试（示例）</span></span></code></pre>\n<p>生成的测试示例：</p>\n<pre class=\"astro-code astro-code-themes min-light night-owl\" style=\"--shiki-light:#24292eff;--shiki-dark:#d6deeb;--shiki-light-bg:#ffffff;--shiki-dark-bg:#011627; overflow-x: auto;--file-name-offset: -0.75rem;\" tabindex=\"0\" data-language=\"javascript\"><code><span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">import</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { test</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> expect } </span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">from</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">@playwright/test</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">test</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">describe</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">用户登录流程</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> ()</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">  test</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">成功登录并跳转到首页</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> async</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">{ </span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">page</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> }</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    await</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> page</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">goto</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">/login</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 填写表单</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    await</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> page</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">getByLabel</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">用户名</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">fill</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">testuser</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    await</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> page</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">getByLabel</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">密码</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">fill</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">password123</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 提交</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    await</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> page</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">getByRole</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">button</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { name</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">登录</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> })</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">click</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 等待跳转</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    await</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> expect</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">page</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">toHaveURL</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">/dashboard</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 验证用户信息</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    await</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> expect</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">page</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">getByText</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">欢迎, testuser</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">))</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">toBeVisible</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  });</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">  test</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">用户名为空时显示错误</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> async</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">{ </span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">page</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> }</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    await</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> page</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">goto</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">/login</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    await</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> page</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">getByLabel</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">密码</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">fill</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">password123</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    await</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> page</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">getByRole</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">button</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { name</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">登录</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> })</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">click</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    await</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> expect</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">page</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">getByText</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">请输入用户名</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">))</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">toBeVisible</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    await</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> expect</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">page</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">toHaveURL</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">/login</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">); </span><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">// 未跳转</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  });</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">  test</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">密码错误时显示提示</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> async</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">{ </span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">page</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> }</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    await</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> page</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">goto</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">/login</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    await</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> page</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">getByLabel</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">用户名</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">fill</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">testuser</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    await</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> page</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">getByLabel</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">密码</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">fill</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">wrongpassword</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    await</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> page</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">getByRole</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">button</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { name</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">登录</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> })</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">click</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    await</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> expect</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">page</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">getByRole</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">alert</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">))</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">toHaveText</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">用户名或密码错误</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  });</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">  test</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">网络错误时显示友好提示</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\"> async</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\"> (</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">{ </span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\">page</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> }</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D9F5DD\">)</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#C2C3C5;--shiki-light-font-style:inherit;--shiki-dark:#637777;--shiki-dark-font-style:italic\">    // 模拟网络错误</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    await</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> page</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">route</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">/api/auth/login</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D7DBE0\"> route</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#C792EA\"> =></span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> route</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">abort</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">());</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    await</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> page</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">goto</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">/login</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    await</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> page</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">getByLabel</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">用户名</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">fill</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">testuser</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    await</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> page</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">getByLabel</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">密码</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">)</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">fill</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">password123</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    await</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\"> page</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">getByRole</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">button</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#212121;--shiki-dark:#D6DEEB\">,</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> { name</span><span style=\"--shiki-light:#D32F2F;--shiki-dark:#D6DEEB\">:</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\"> '</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">登录</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\"> })</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">click</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#D32F2F;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">    await</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\"> expect</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#1976D2;--shiki-light-font-style:inherit;--shiki-dark:#7FDBCA;--shiki-dark-font-style:italic\">page</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">getByText</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">(</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#22863A;--shiki-dark:#ECC48D\">网络错误，请稍后重试</span><span style=\"--shiki-light:#22863A;--shiki-dark:#D9F5DD\">'</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">))</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#C792EA;--shiki-dark-font-style:italic\">.</span><span style=\"--shiki-light:#6F42C1;--shiki-light-font-style:inherit;--shiki-dark:#82AAFF;--shiki-dark-font-style:italic\">toBeVisible</span><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">  });</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#24292EFF;--shiki-dark:#D6DEEB\">});</span></span></code></pre>\n<h2 id=\"三效果对比数据说话\">三、效果对比：数据说话</h2>\n<p>我在一个中型项目（15k 行代码，30+ 组件）上用了一个月 AI 代码审查 + 测试生成，数据如下：</p>\n<h3 id=\"测试覆盖率提升\">测试覆盖率提升</h3>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<table><thead><tr><th>指标</th><th>使用前</th><th>使用后</th><th>提升</th></tr></thead><tbody><tr><td>单元测试覆盖率</td><td>32%</td><td>78%</td><td>+144%</td></tr><tr><td>E2E 测试场景数</td><td>5</td><td>23</td><td>+360%</td></tr><tr><td>发现的边界 case bug</td><td>-</td><td>17 个</td><td>-</td></tr></tbody></table>\n<h3 id=\"成本分析\">成本分析</h3>\n<p><strong>人工成本：</strong></p>\n<ul>\n<li>代码审查：平均每个 PR 20 分钟 × 高级工程师时薪 ￥300/h = ￥100/PR</li>\n<li>写测试：平均每个组件 40 分钟 × ￥300/h = ￥200/组件</li>\n</ul>\n<p><strong>AI 成本：</strong></p>\n<ul>\n<li>代码审查：平均 3k tokens 输入 + 1.5k tokens 输出 = ￥0.08/PR (Claude Sonnet 4.5)</li>\n<li>测试生成：平均 2k tokens 输入 + 4k tokens 输出 = ￥0.12/组件</li>\n</ul>\n<p><strong>一个月数据（50 个 PR，30 个组件）：</strong></p>\n<ul>\n<li>人工成本：￥5000 (审查) + ￥6000 (测试) = ￥11000</li>\n<li>AI 成本：￥4 (审查) + ￥3.6 (测试) = ￥7.6</li>\n<li><strong>成本降低：99.93%</strong></li>\n</ul>\n<p>时间节省：</p>\n<ul>\n<li>代码审查：从 20 分钟降到 2 分钟查看报告 = 节省 90%</li>\n<li>测试编写：从 40 分钟降到 5 分钟微调 AI 生成的测试 = 节省 87.5%</li>\n</ul>\n<h3 id=\"质量提升\">质量提升</h3>\n<p>AI 发现的问题类型分布：</p>\n<ul>\n<li>可访问性问题：47%（这个人工审查几乎不查）</li>\n<li>边界情况处理：28%</li>\n<li>性能优化建议：15%</li>\n<li>安全隐患：10%</li>\n</ul>\n<p>最有价值的发现：一个组件在处理大数组（10k+ 项）时会卡死，AI 建议加虚拟滚动，修复后性能提升 95%。</p>\n<h2 id=\"四注意事项\">四、注意事项</h2>\n<h3 id=\"1-ai-不是银弹\">1. AI 不是银弹</h3>\n<ul>\n<li><strong>误报率</strong>：约 5%-10%，需要人工判断</li>\n<li><strong>上下文限制</strong>：无法理解业务逻辑，只能检查技术层面</li>\n<li><strong>降级策略</strong>：AI 服务挂了不能阻断开发流程</li>\n</ul>\n<h3 id=\"2-prompt-很重要\">2. Prompt 很重要</h3>\n<p>我的 Prompt 迭代了 5 个版本才稳定。关键点：</p>\n<ul>\n<li>✅ 明确输出格式（Markdown、JSON）</li>\n<li>✅ 提供具体的检查项（别说”检查代码质量”）</li>\n<li>✅ 给出示例（few-shot learning）</li>\n<li>✅ 设置边界（什么情况下 LGTM，什么情况下阻断）</li>\n</ul>\n<h3 id=\"3-人机协作\">3. 人机协作</h3>\n<p>最佳实践：</p>\n<ul>\n<li>AI 做第一轮全面扫描</li>\n<li>人工审查 AI 标记的 Critical Issues</li>\n<li>对于复杂逻辑，还是需要资深工程师深度 Review</li>\n</ul>\n<h2 id=\"五下一步成本优化和团队协作\">五、下一步：成本优化和团队协作</h2>\n<p>AI 代码审查和测试生成已经证明了价值，但还有两个问题需要解决：</p>\n<ol>\n<li><strong>成本优化</strong>：虽然单次成本低，但频繁调用还是会累积。能不能用更便宜的模型？</li>\n<li><strong>团队协作</strong>：如何让整个团队用上这套工具？如何统一标准？</li>\n</ol>\n<p>下一篇文章我们会深入讨论：</p>\n<ul>\n<li><strong>成本降低 80% 的 Prompt 缓存技巧</strong></li>\n<li><strong>多模型组合策略</strong>（简单检查用快速模型，复杂逻辑用强模型）</li>\n<li><strong>团队级 AI Agent 工作流</strong>（从个人工具到团队基础设施）</li>\n</ul>\n<p>敬请期待。</p>\n<hr>\n<p><strong>相关资源：</strong></p>\n<ul>\n<li>完整代码示例：<a href=\"https://github.com/yourusername/ai-agent-frontend-workflow\">GitHub Repo</a></li>\n<li>AI 代码审查 Prompt 库：[链接]</li>\n<li>测试生成最佳实践：[链接]</li>\n</ul>\n<p>有问题欢迎在评论区讨论，或者在 <a href=\"https://twitter.com/yourhandle\">Twitter</a> 上找我。</p>",{headings:2027,localImagePaths:2100,remoteImagePaths:2101,frontmatter:2102,imagePaths:2105},[2028,2031,2034,2037,2040,2043,2046,2049,2052,2055,2058,2061,2064,2067,2070,2073,2076,2079,2081,2083,2085,2088,2091,2094,2097],{depth:31,slug:2029,text:2030},"回顾从组件生成到质量保障","回顾：从组件生成到质量保障",{depth:31,slug:2032,text:2033},"一ai-驱动的代码审查","一、AI 驱动的代码审查",{depth:185,slug:2035,text:2036},"传统-code-review-的三大困境","传统 Code Review 的三大困境",{depth:185,slug:2038,text:2039},"ai-agent-的优势","AI Agent 的优势",{depth:185,slug:2041,text:2042},"实战集成到-git-hook","实战：集成到 Git Hook",{depth:1877,slug:2044,text:2045},"1-安装依赖","1. 安装依赖",{depth:1877,slug:2047,text:2048},"2-创建审查脚本","2. 创建审查脚本",{depth:1877,slug:2050,text:2051},"3-配置-husky-hook","3. 配置 Husky Hook",{depth:1877,slug:2053,text:2054},"4-配置环境变量","4. 配置环境变量",{depth:185,slug:2056,text:2057},"真实案例ai-发现的问题","真实案例：AI 发现的问题",{depth:31,slug:2059,text:2060},"二自动化测试用例生成","二、自动化测试用例生成",{depth:185,slug:2062,text:2063},"为什么测试覆盖率总是上不去","为什么测试覆盖率总是上不去？",{depth:185,slug:2065,text:2066},"ai-生成测试的思路","AI 生成测试的思路",{depth:185,slug:2068,text:2069},"实战单元测试生成","实战：单元测试生成",{depth:185,slug:2071,text:2072},"真实示例ai-生成的测试","真实示例：AI 生成的测试",{depth:185,slug:2074,text:2075},"e2e-测试生成","E2E 测试生成",{depth:31,slug:2077,text:2078},"三效果对比数据说话","三、效果对比：数据说话",{depth:185,slug:2080,text:2080},"测试覆盖率提升",{depth:185,slug:2082,text:2082},"成本分析",{depth:185,slug:2084,text:2084},"质量提升",{depth:31,slug:2086,text:2087},"四注意事项","四、注意事项",{depth:185,slug:2089,text:2090},"1-ai-不是银弹","1. AI 不是银弹",{depth:185,slug:2092,text:2093},"2-prompt-很重要","2. Prompt 很重要",{depth:185,slug:2095,text:2096},"3-人机协作","3. 人机协作",{depth:31,slug:2098,text:2099},"五下一步成本优化和团队协作","五、下一步：成本优化和团队协作",[],[],{author:14,pubDatetime:2103,title:2017,slug:2013,featured:165,draft:17,tags:2104,description:2020},["Date","2026-02-14T10:00:00.000Z"],[167,168,2019,19],[]];

export { _astro_dataLayerContent as default };
